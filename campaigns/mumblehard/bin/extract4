#!/bin/bash

SRC=files4
INT1=intermediate4.1
INT2=intermediate4.2
INT3=intermediate4.3
INT4=intermediate4.4
INT5=intermediate4.5

rm -rf $INT1
mkdir $INT1
rm -rf $INT2
mkdir $INT2
rm -rf $INT3
mkdir $INT3
rm -rf $INT4
mkdir $INT4
rm -rf $INT5
mkdir $INT5

for FNAME in $SRC/*
do
	IP=$(basename $FNAME)
	echo "<?php" > $INT1/$IP
	sed -n '1,/";.$/p' $FNAME >> $INT1/$IP
	echo 'print(base64_decode($code));' >> $INT1/$IP
	php $INT1/$IP > $INT2/$IP
	echo "<?php" > $INT3/$IP
	sed -n '/^$s=/,/^$o=/p' $INT2/$IP >> $INT3/$IP
	echo 'print($s);'  >> $INT3/$IP
	php $INT3/$IP > $INT4/$IP
	X=$(echo $IP | sed 's/\./_/g')
	echo "begin 644 $X" > $INT5/$IP.uu
	sed -n -e '/^M............................................................$/,/^BDRPDATABSD$/p' -e '/^BDRP/d' -e '/``/q' $INT4/$IP >> $INT5/$IP.uu
	cd $INT5
	uudecode $IP.uu
	cd ..
done
