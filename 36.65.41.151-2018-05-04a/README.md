# Spam Blocklist Recon 

Checks if the host it's installed on is in
either Google's "safe browsing" list as unsafe,
or on Spamhaus' block list.

Probably part of Canadian pharmacy scam,
or maybe just trying to implicate some other spammer.

## Origin

### Download

Sent to what attacker thought was an instance of Web Shell by oRb, WSO or "FilesMan".

Arrived with "pass" parameter set,
which probably means scripted access.

Uses "Php" action to send "[dropper](dropper.php)" PHP code that creates a file
named `a33135603c3c7c6097a920ea04f2cc9b.php`
in Apache's Document Root directory,
for either Linux or Windows.

It would reply to the HTTP request that sent the dropper with
something like:

    ##**##"http://stratigery.com]/a33135603c3c7c6097a920ea04f2cc9b.php###***###

That's pretty obviously machine-parseable,
so the automatic install will get feedback about what URL to call it by.
Since that URL has not been invoked,
I assume that the downloader wants that feedback before trying the URL.


### IP Address

36.65.41.151 does not have a DNS name associated.

    % Information related to '36.65.32.0/20AS17974'
    route:          36.65.32.0/20
    descr:          PT. Telekomunikasi Indonesia
    country:        ID
    origin:         AS17974
    mnt-by:         MAINT-TELKOMNET
    last-modified:  2013-12-10T08:18:03Z

It is in Indonesia, and routed to an Indonesian company.

The final code does a HTTP 302 redirect to 185.174.175.30,
which right now is `prodelivery.su`

    domain:        PRODELIVERY.SU
    nserver:       ns1.prodelivery.su. 185.174.175.30
    nserver:       ns2.prodelivery.su. 37.46.130.221
    state:         REGISTERED, DELEGATED
    person:        Private Person
    e-mail:        lera.ulybasheva@mail.ru
    registrar:     REGRU-SU

prodelivery.su gets the same IP address as ns1.prodelivery.su,
the nameserver for the domain.

    % Information related to '185.174.172.0/22AS21100'
    route:          185.174.172.0/22
    descr:          SECOM NL
    origin:         AS21100
    mnt-by:         ITL-MNT
    created:        2017-07-10T17:18:09Z
    last-modified:  2017-07-10T17:18:09Z

`geoiplookup` agrees that 185.174.175.30 is in Ukraine.

## Analysis

The final file, `a33135603c3c7c6097a920ea04f2cc9b.php`,
is a simple PHP program.

It checks to see if hostname of machine it runs on is in Spam blacklists.
If a HTTP GET parameter named "mod" has the right value(s).

* 0XX 00X - http://www.google.com/safebrowsing/diagnostic
* X0X 00X - `gethostbyname('stratigery.com.dbl.spamhaus.org')`

Those values of "mod" allow you to check one,
or the other,
or both of the blacklists in a single call.

Without  HTTP GET parameter 'mod',
it does an HTTP 302 redirect to prodelivery.su, 185.174.175.30 at the moment.

I'm not sure that the code does what it's supposed to do.
That is, I think this code is buggy.

Visited with Firefox, prodelivery.su shows a "Canadian pharmacy" site.
Is this a redirect to scam site to make money,
or a redirect to some other bad actor's web site to implicate them?

