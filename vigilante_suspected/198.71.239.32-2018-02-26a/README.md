# Older Vigilant Malware Cleaner

This is an older (2018-02-24T02:28:55.000-0700) capture
of the vigilant malware cleaner.
I did not recognize it for what it is when I first found it.
I'm including it with the newer capture so as to see how the vigilantes have changed the code.

## Origin

### IP Address 198.71.239.32

198.71.239.32 &rarr; a2nlwpweb031.prod.iad2.secureserver.net

a2nlwpweb031.prod.iad2.secureserver.net &rarr; 198.71.239.32

Both 198.71.239.32 and domain secureserver.net belong to GoDaddy.

`traceroute` has 198.71.239.32 behind godaddy.com and secureserver.net
IP addresses.

This is pretty much like the newer cleaner.

### Download

Downloaded to the fake WSO web shell componet of my WordPress
honey pot. Downloader called the "RC" action with PHP code
you can see in `198.71.239.32WpEwV-t@zpEjMNWi9KQirQAAAAY.php.file`
as one of the POST parameters. WSO's RC action is an immediate
eval backdoor for PHP code The downloader expected the PHP
to run immediately, and return text to him or her.

## Decoding

`198.71.239.32WpEwV-t@zpEjMNWi9KQirQAAAAY.php.file` has 2 base64-encoded
lines at the time. Take care of those.

1. Edit `198.71.239.32WpEwV-t@zpEjMNWi9KQirQAAAAY.php.file` into `dc1.php` and `db1.php`
2. Edit `dc1.php`, add `<?php` and change "eval" to "print"
3. Invoke `php dc1.php > dc2.php`
4. Invoke `/home/bediger/src/php/reverse-php-malware/pp.php dc2.php > f2.php`

`dc2.php` has unindented code. Pretty-print to aid in readability.
Code in `f2.php` creates a number of oddly-named PHP functions.

1. Edit `db1.php`, add `<?php` and add `var_dump($defs);` to get a readable version of unserialized object.
2. Invoke `php db1.php > defs.dump`

`defs.dump` contains an array of 3-element arrays, one of which
looks like this:

    array(3) {
      [0]=>
      int(191)
      [1]=>
      string(8) "rqwrdtyq"
      [2]=>
      string(7) "gejtcnw"
    }

Functions named "rqwrdtyq" and "gejtcnw" exist in `f2.php`.

## Analysis

The serialized array-of-arrays has only 88 entries in this version,
as opposed to 112 in the newer cleaner.
The function names are different as well,
suggesting some kind of renaming before including them in the serialized code,
and in the "eval" that defines the functions.

The differences between the newer and older functions appear to
comprise addition of new checks, deletion of some checks, and a few bug fixes,
like having a function return FALSE instead of no return at all.

The vigilantes are increasing their reach.
