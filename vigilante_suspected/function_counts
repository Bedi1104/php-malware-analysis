#!/bin/bash

rm -rf serial_number_lists
mkdir serial_number_lists
for FNAME in extracted_defs/*
do
	TIMESTAMP=$(basename $FNAME | sed 's/def.//')
	cut -f1 $FNAME > serial_number_lists/$TIMESTAMP
done

echo '|Capture date|Serial Number Count  |Deletions  |Additions  |'
echo '|------------|:-------------------:|:---------:|:---------:|'

PREV=serial_number_lists/2016-04-17a
for FNAME in serial_number_lists/*
do
	if [[ $FNAME != serial_number_lists/2016-04-17a ]]
	then
		TIMESTAMP=$(basename $FNAME | sed -e 's/def.//' -e 's/.$//' )
		# Elements of B not in A:
		# fgrep -v -f A B       
		ADDITIONS=$( fgrep -x -v -f $PREV $FNAME | wc -l )
		SUBTRACTIONS=$( fgrep -x -v -f $FNAME $PREV | wc -l )
		TOTAL=$( cat $FNAME | wc -l)
		echo '|'$TIMESTAMP'|'$TOTAL'|'$SUBTRACTIONS'|'$ADDITIONS'|'
		PREV=$FNAME
	fi
done
