#!/bin/bash

rm -f multiple.functions.per.sn

# Use cksum checksum as a numerical value to compare
# for equality. Find all functions (.php files) that have
# more than 1 checksum value. function names have serial number
# in them.
find renamed_functions -type f -name '*.php' |
xargs cksum | cut -f1,3 -d' ' |
sed -e 's/renamed_functions\/....-..-..\///' | sort | uniq | cut -d' ' -f2 |
sort | uniq -c  | awk '{if ($1 > 1) {print $2}}' > multiple.functions.per.sn

# Sort through the G*.php files (cleanup functions) to
# find the G*.php file names that have more than 1 checksum.
# Find the first date a G*.php file appears, then find the
# next instance that has a different size. This part uses file
# size as something to compare for equality.
find renamed_functions -type f -name 'G*php' |
xargs ls -l |
awk '{print $5, $9}' |
fgrep -f multiple.functions.per.sn |
sed -e 's/renamed_functions.//' -e 's/\// /' |
sort -k3.1 -k2.1 | tee -a abcd |
awk  'NR==1 {size=$1; fn=$3; print $0} \
	NR>1 { \
	if (fn == $3 && size != $1) { print $0; size = $1 } \
		else if (fn != $3) { print $0; size = $1; fn = $3 } \
	}\
'
