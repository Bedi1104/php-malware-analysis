#!/bin/bash
rm -f defs.cont
touch defs.cont
for FNAME in extracted_defs/*
do
	TIMESTAMP=$(basename $FNAME | sed -e 's/def.//'  -e 's/.$//' )
	# Skip timestamps in which no changes take place
	if [[ $TIMESTAMP =~ 2018-11-2[235] ]]
	then
		:
	elif  [[ $TIMESTAMP =~ 2019-07-02 ]]
	then
		:
	elif  [[ $TIMESTAMP =~ 2019-09-2[456789] ]]
	then
		:
	elif  [[ $TIMESTAMP =~ 2019-09-30 ]]
	then
		:
	elif  [[ $TIMESTAMP =~ 2019-10-0[13] ]]
	then
		:
	elif  [[ $TIMESTAMP =~ 2019-10-1[67] ]]
	then
		:
	elif  [[ $TIMESTAMP =~ 2019-10-26 ]]
	then
		:
	else
		while read SERIAL NAME1 NAME2
		do
			echo $TIMESTAMP $SERIAL >> defs.cont
		done < $FNAME
		echo >> defs.cont
	fi
done

sort -k2.1n defs.cont | awk 'NR==1 {lastline=$0; last=$2; print $0} NR>1 {if (lastline != $0) {if (last != $2) { print "\n"} print $0; last=$2} lastline=$0}' > defs.lines
