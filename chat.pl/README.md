
# chat.pl - self-contained email spamming tool

A self-contained Perl email spamming server. Native Perl
versions of DNS lookup and SMTP email sending.

## Origin

### IP Address

Right now, 87.106.242.16 is in 87.106.0.0/16AS8560. That looks like
a 1&1 German subsidiary, in Karlsruhe, Germany.

DNS says 87.106.242.16 is s15316012.onlinehome-server.info

`whois onlinehome-server.info` gives 1&1 Internet Inc. as admin, registrant and billing contacts.

### Download

Downloaded to a honey pot WSO web shell. The downloader wanted to
execute the "Php" action that WSO provides, which is immediate eval of
PHP code, with no file created. The code downloaded does create a file
in which to store the Perl payload, but it deletes that file as soon
as it can.

## Decoding

1. Hand edit `87.106.242.16WjPLrzyjMixMC240GgLqBAAAAAo.php.file` into `dc1.php` to decode the Base64-encoded block of text.
2. Execute `php dc1.php > chat.pl`

Downloaded a PHP program to a PHP program, that creates a Perl program.

## Analysis

It looks like `chat.pl` can work under Linux, FreeBSD and "MSWin32".
The Linux and FreeBSD specific code seems appropriate.
I can't speak to the quality of the Windows-specific code.

The `chat.pl` program seems like a decently written Perl
server. It does smart server things like change directory to
"/", the root of the filesystem,
it ignores signals like HUP, INT, QUIT, etc,
that Linux/Unix server processes should ignore.
and re-opens STDIN, STDOUT and STDERR as /dev/null.
It forks and sets a session ID, to detach itself from any TTY.

The code is of uniform style and quality. It does `use strict;`
which is wise for Perl programs.
Variables and functions are consistently named in all lower-case.
Functions are called old school style, i.e. `&startserver();`,
with a leading ampersand.

Under Linux or "BSD" it leaves behind another payload,
and sets `cron` to execute the payload: "*/10 * * * * "
Check to see what this means.
