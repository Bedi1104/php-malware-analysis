#!/usr/bin/env php
<?php

// First 16 bytes of ciphertext go into $h[] as indexes.
// Values are 0 - 16, conveniently 0x00 - 0x0f.
// Each byte of the rest of the ciphertext will
// have a value of one of the indexes into $h[].
// Use bytes of ciphertext to index $h[] to
// get the cleartext nibbles, then shift the
// high nibble and add it to the low nibble.

$ciphertext = file_get_contents($argv[1]);
$length = strlen($ciphertext);
$d = '';
$h = array();  // Transposition array.
for ($o = 0; $o < $length; $o++) {
    if ($o < 16) {
        $h[$ciphertext[$o]] = $o;
    } else {
        $d .= @chr(($h[$ciphertext[$o]] << 4) + $h[$ciphertext[++$o]]);
    }
}
print($d);
