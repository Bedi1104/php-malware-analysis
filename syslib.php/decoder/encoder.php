#!/usr/bin/env php
<?php

// Encode cleartext to superfetchexec-encoded cipertext.

// Need 16 bytes as transposed ciphertext of the
// 2, 4-bit nibbles of a cleartext byte.
$printable_encoding = $argv[1];
$filename = $argv[2];

$cleartext = file_get_contents($filename);

// First 16 bytes of $cipertext are the values of
// encoded nibbles
$ciphertext = $printable_encoding;

$length = strlen($cleartext);

for ($i = 0; $i < $length; ++$i) {
	// $cleartext[$i], a byte, gets encoded
	// as 2 ciphertext bytes.
	$high = 0x0f & (ord($cleartext[$i]) >> 4);
	$low  = 0x0f & ord($cleartext[$i]);
	$ciphertext .= $printable_encoding[$high];
	$ciphertext .= $printable_encoding[$low];
}

print $ciphertext;
