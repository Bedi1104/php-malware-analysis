# Extensible backdoor

An extensible backdoor.

1. Plugins can be added, removed and executed.
2. Immediate code eval.
3. Some recon info: PHP version, its own version.
4. Password authenticated access.

I got 71 downloads of essentially the same code from
2018-03-15 to 2018-03-15.
All code purports to be version "1.0-2".
Higher-numbered versions exist.
You can get [version 2.0-1](https://pastebin.com/qUM2RubB) from pastebin.

I got another spin on version 2.0-1 via email.
It's in the [ico](ico) directory.

## Origin

### Download

Attacker wanted to download to the "RC" action of a WSO
(Web Shell by oRb) instance.
Code downloaded to the WSO part of my WordPress honey pot.

Every request made of the fake WSO arrives with a WSO cookie.
The password is "nhzgrf", a common WSO password.

### Source IP Addresses

|IP address|Download time|DNS name|
|----------|-------------|--------|
|212.63.109.204|2018-03-15T03:13:33.000-0600|dns109204.phdns10.es|
|85.128.142.46|2018-03-16T07:59:31.000-0600|akl46.rev.netart.pl|
|119.59.120.3|2018-03-17T08:16:53.000-0600|N/A|
|194.54.82.78|2018-03-18T02:01:56.000-0600|dolina-82-78.dolina.rx-name.net|
|162.241.218.136|2018-03-19T06:34:18.000-0600|box5566.bluehost.com|
|184.168.200.228|2018-03-20T02:06:41.000-0600|p3plcpnl0168.prod.phx3.secureserver.net|
|121.127.254.2|2018-03-21T06:43:55.000-0600|N/A|
|103.95.197.62|2018-03-22T02:34:12.000-0600|host62.cloudzone.vn|
|162.241.226.121|2018-03-23T05:26:53.000-0600|box5342.bluehost.com|
|173.201.196.148|2018-03-24T03:03:45.000-0600|p3nlhg290.shr.prod.phx3.secureserver.net|
|173.201.196.110|2018-03-25T04:27:29.000-0600|p3nlhg302.shr.prod.phx3.secureserver.net|
|118.123.16.54|2018-03-26T03:49:21.000-0600|N/A|
|148.72.232.52|2018-03-27T02:49:23.000-0600|sg2plcpnl0173.prod.sin2.secureserver.net|
|85.128.142.58|2018-03-28T03:11:08.000-0600|akl58.rev.netart.pl|
|198.71.239.47|2018-03-29T07:30:25.000-0600|a2nlwpweb045.prod.iad2.secureserver.net|
|113.212.162.149|2018-03-30T08:21:34.000-0600|mail.bias-samudra.com|
|66.147.240.198|2018-03-31T02:10:45.000-0600|host398.hostmonster.com|
|207.246.249.205|2018-04-01T05:19:51.000-0600|N/A|
|50.63.194.158|2018-04-02T03:56:41.000-0600|p3nlhg1432.shr.prod.phx3.secureserver.net|
|184.168.27.12|2018-04-03T04:14:59.000-0600|p3nlhg836.shr.prod.phx3.secureserver.net|
|91.200.60.68|2018-04-04T03:37:00.000-0600|wezom3.linevps.net|
|158.69.8.115|2018-04-04T01:10:37.000-0600|N/A|
|160.153.147.139|2018-04-05T07:28:33.000-0600|n3nlwpweb011.prod.ams3.secureserver.net|
|182.50.135.55|2018-04-06T03:45:10.000-0600|sg2plcpnl0107.prod.sin2.secureserver.net|
|212.174.107.137|2018-04-07T04:05:25.000-0600|lpm3-ppp137.verisoft.net.tr|
|178.210.90.90|2018-04-08T04:06:56.000-0600|tproxy1102.nic.ru|
|198.71.238.6|2018-04-09T05:56:10.000-0600|a2nlwpweb054.prod.iad2.secureserver.net|
|198.71.238.11|2018-04-10T01:23:34.000-0600|a2nlwpweb059.prod.iad2.secureserver.net|
|50.62.176.242|2018-04-11T05:51:13.000-0600|p3plcpnl0726.prod.phx3.secureserver.net|
|184.168.27.140|2018-04-12T04:20:50.000-0600|p3nlhg913.shr.prod.phx3.secureserver.net|
|50.62.208.38|2018-04-13T03:37:27.000-0600|p3nlwpweb053.shr.prod.phx3.secureserver.net|
|178.210.90.90|2018-04-14T04:25:48.000-0600|tproxy1102.nic.ru|
|112.78.2.202|2018-04-15T01:06:48.000-0600|N/A|
|42.98.72.36|2018-04-16T07:19:46.000-0600|42-98-72-036.static.netvigator.com|
|209.175.164.195|2018-04-17T07:50:11.000-0600|N/A|
|122.114.43.148|2018-04-18T04:28:21.000-0600|N/A|
|78.24.221.82|2018-04-19T08:46:54.000-0600|legendgroup.fvds.ru|
|162.241.216.242|2018-04-20T10:03:16.000-0600|box5442.bluehost.com|
|149.202.83.87|2018-04-21T07:12:55.000-0600|ns3019045.ip-149-202-83.eu|
|168.167.251.215|2018-04-22T08:32:53.000-0600|N/A|
|132.148.104.129|2018-04-23T01:29:39.000-0600|p3nlhg2080.shr.prod.phx3.secureserver.net|
|50.87.144.119|2018-04-25T07:23:11.000-0600|gator3084.hostgator.com|
|185.26.122.29|2018-04-25T05:55:34.000-0600|serv29-26.hostland.ru|
|107.180.120.64|2018-04-26T06:32:10.000-0600|a2nlwpweb145.prod.iad2.secureserver.net|
|151.1.184.134|2018-04-27T07:40:37.000-0600|N/A|
|95.58.31.174|2018-04-28T04:01:05.000-0600|N/A|
|210.61.49.127|2018-05-06T03:18:37.000-0600|210-61-49-127.hinet-ip.hinet.net|
|182.50.151.55|2018-05-07T03:13:32.000-0600|sg2plcpnl0074.prod.sin2.secureserver.net|
|45.40.166.153|2018-05-08T05:35:46.000-0600|p3nlhg2063.shr.prod.phx3.secureserver.net|
|213.142.130.42|2018-05-09T01:49:54.000-0600|lhost452.websahibi.com|
|62.210.185.4|2018-05-10T05:48:22.000-0600|nat-dc2-2.online.net|
|207.148.119.51|2018-05-11T05:03:21.000-0600|207.148.119.51.vultr.com|
|198.71.238.17|2018-05-12T06:42:15.000-0600|a2nlwpweb064.prod.iad2.secureserver.net|
|198.71.239.45|2018-05-13T06:55:18.000-0600|a2nlwpweb044.prod.iad2.secureserver.net|
|188.187.190.59|2018-05-14T01:08:57.000-0600|188x187x190x59.static-customer.yola.ertelecom.ru|
|34.197.246.236|2018-05-15T03:26:38.000-0600|ec2-34-197-246-236.compute-1.amazonaws.com|
|50.62.177.187|2018-05-16T03:29:19.000-0600|p3plcpnl0887.prod.phx3.secureserver.net|
|50.87.144.56|2018-05-17T01:58:28.000-0600|gator3037.hostgator.com|
|107.180.120.67|2018-05-18T05:23:55.000-0600|a2nlwpweb147.prod.iad2.secureserver.net|
|107.180.120.45|2018-05-19T08:28:42.000-0600|a2nlwpweb128.prod.iad2.secureserver.net|
|198.71.239.9|2018-05-20T04:18:36.000-0600|a2nlwpweb007.prod.iad2.secureserver.net|
|182.50.130.35|2018-05-21T05:26:24.000-0600|sg2nw8shg139.shr.prod.sin2.secureserver.net|
|81.91.86.129|2018-05-22T05:43:57.000-0600|rs29.web4u.cz|
|82.209.199.218|2018-05-23T03:06:19.000-0600|metropr.by|
|79.170.40.55|2018-05-24T04:11:03.000-0600|web55.extendcp.co.uk|
|176.31.236.164|2018-05-25T07:14:22.000-0600|tarkett-2013.hosting.clever-age.net|
|192.185.83.194|2018-05-26T03:15:28.000-0600|marzal.websitewelcome.com|
|198.71.238.9|2018-05-27T02:51:42.000-0600|a2nlwpweb056.prod.iad2.secureserver.net|
|184.168.46.128|2018-05-28T02:35:37.000-0600|p3nlhg738.shr.prod.phx3.secureserver.net|
|195.74.38.66|2018-05-29T10:27:34.000-0600|cl-05.atm.binero.net|
|184.168.152.99|2018-05-30T03:54:00.000-0600|p3nlhg663.shr.prod.phx3.secureserver.net|

Looks like they have a fondness for GoDaddy (secureserver.net) machines.

## Deobfuscation

The script `extract` contains the entire process,
which goes something like this:

1. For each file named `files/*.php.file`:

	i. Create a file with `<?php` at the beginning,
	and the contents of the original file, with "print"
	substituted for "eval"
	ii. Append a line with "rawurldecode()" or "base64_decode()",
	depending on what the encoding in `files/*.php.file`

2. Execute the files created in step 1, substituting "print" for
"eval" in the output.
3. Execute the files from step 2, saving the contents in `final/`

### Actual run-time execution

Any of the files name `files/*.php.file` contains similar PHP.
This PHP would get eval'ed by `function actionRC()` in a real WSO web shell.

The [code](dropper.php) eval'ed by `function actionRC()`
should 

## Analysis

Style notes: fr_* funcntion names, snake_case everything.

Made a [client](client.php) to understand cipher,
verify that backdoor works,
and understand the code better.
