# Kinked Exec-PHP plugin

Apparently, an Exec-PHP plugin exists,
but has been [removed](https://wordpress.org/plugins/exec-php/)
from Worpress.com's official list of plugins because it hasn't been
updated since 2009.

That reconciles with this [exec-php github repository](https://github.com/wp-plugins/exec-php).
It appears that one of the original Exec-PHP's big contributors put the code on Github 
in 2009.
The github repo's latest release is Exec-PHP 4.9,
the same version sported by the kinked plugin documented here.

The kinked Zip file contains two files that don't appear identically
in the exec-php githup repository.
These two files have Zip file dates much later than every other file in the downloade Zip file:

    1851  2017-11-03 14:46   exec-php/wall.php
    2376  2016-11-07 12:18   exec-php/login_wall.php

The file `exec-php/login_wall.php` has contents related to other [login_wall.php files](../login_wall).

These two files are the kink in the Exec-PHP plugin.

## Origin

### IP Address 95.85.38.41

It's a Digital Ocean address. Not much to be learned there.

    inetnum:        95.85.32.0 - 95.85.39.255
    netname:        DIGITALOCEAN-AMS-4
    descr:          Digital Ocean, Inc.
    country:        NL
    created:        2013-11-23T02:11:35Z
    last-modified:  2015-11-20T14:44:10Z

### Download

Downloaded to my honey pot as if the attackers had invoked a real WordPress site's
upload plugin URL (`/wordpress/wp-admin/plugin-install.php?tab=upload`).
As such, the attackers sent a Zip file with the 

## Deobfuscating

The two malicious files in the plugin-download-Zip-file aren't terribly obfuscated.

### `wall.php`

`wall.php`, when executed, tries to download 3 files from somewhere on the web:

    http://ga-google.com/Nic/wu/bob.txt
    http://ga-google.com/Nic/wu/emb.txt
    http://ga-google.com/Nic/wu/plugin.txt


### plugin.txt

1. `~/src/php/reverse-php-malware/pp.php plugin.txt > d1.php`
2. `~/src/php/reverse-php-malware/revphp plugin.txt > d2.php`
3. `php d2.php > d3.php`

### bob.txt

 1066  vi emb.txt -> a1.php
 1067  ~/src/php/reverse-php-malware/revphp a1.php > a2.php
 1072  cp bob.txt a3.php
 1074  php a3.php > a4.php
 1082  php a3.php > a4.php
 1084  ~/src/php/reverse-php-malware/pp.php a4.php > a5.php

## Deep Regrets

I didn't follow up fast enough before ga-google.com got wiped off the face of the earth.

`whois` says this:

    Domain Name:ga-google.com
    Registry Domain ID:1965912374_domain_com-vrsn
    Registrar WHOIS Server:whois.paycenter.com.cn
    Registrar URL:http://www.xinnet.com
    Updated Date:2018-10-06T00:37:45.00Z
    Creation Date:2015-10-04T08:25:02.00Z
    Registrar Registration Expiration Date:2019-10-04T08:25:02.00Z
    Registrar:XINNET TECHNOLOGY CORPORATION
    Registrar IANA ID:120
    Registrar Abuse Contact Email:supervision@xinnet.com
    Registrar Abuse Contact Phone:+86.1087128064

ga-google.com has IP address 209.141.58.97,
and `whois` says this about 209.141.58.97:

    NetRange:       209.141.32.0 - 209.141.63.255
    CIDR:           209.141.32.0/19
    NetName:        PONYNET-04
    NetHandle:      NET-209-141-32-0-1
    Parent:         NET209 (NET-209-0-0-0-0)
    NetType:        Direct Allocation
    OriginAS:       AS53667
    Organization:   FranTech Solutions (SYNDI-5)
    RegDate:        2011-01-27
    Updated:        2012-03-25
    Ref:            https://rdap.arin.net/registry/ip/209.141.32.0
