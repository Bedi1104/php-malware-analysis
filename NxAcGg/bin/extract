#!/bin/bash
SRC=files
DIR=data
rm -rf $DIR
mkdir $DIR

while read FNAME
do
	NAME=$SRC/$FNAME
	DST=$DIR/$FNAME
	if [[ -r $NAME ]]
	then
		ex $NAME << END_EDITS
1,/\[p1\]/-1d
1s/^..*=> //
/^\$/+1,\$d
w $DST
q
END_EDITS
	fi
done < flist
