#!/usr/bin/env php
<?php

$pwd = md5('Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.2) Gecko/20100115 Firefox/3.6');
print("\$pwd = \"$pwd\"\n");
#$action = iconv('UTF-8', "UTF-8", decrypt($argv[1], $pwd));
$action = decrypt($argv[1], $pwd);
echo $argv[1] . ' -> "' . $action . "\"\n";

function decrypt($str, $pwd)
{
    $pwd = base64_encode($pwd);
print("decrypt \$pwd = \"$pwd\"\n");
    $str = base64_decode($str);
    $enc_chr = '';
    $enc_str = '';
    $i = 0;
    while ($i < strlen($str)) {
        for ($j = 0; $j < strlen($pwd); $j++) {
            $enc_chr = chr(ord($str[$i]) ^ ord($pwd[$j]));
            $enc_str .= $enc_chr;
            $i++;
            if ($i >= strlen($str)) {
                break;
            }
        }
    }
	print("decrypt \$enc_str = \"$enc_str\"\n");
    return base64_decode($enc_str);
}
