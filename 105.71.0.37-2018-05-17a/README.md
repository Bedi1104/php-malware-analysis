# zzz.php - Email access verification

A small PHP program, downloaded to WSO honey pot, then accessed via HTTP.
Just sends an email

## Origin

### IP Address 105.71.0.37

No A record for 105.71.0.37 

    inetnum:        105.71.0.0 - 105.71.255.255
    netname:        INWI-Internet-UGW-MAR01
    descr:          This subnet is dedicated to 2G/3G/4G UGW users, managed by Marrakech Datacenter

GeoIP Country Edition: MA, Morocco

The last hop responding on a `traceroute` is 213.140.51.73, somewhere in Spain,
which is just across the Straits of Gibraltar from Morroco.

    % Information related to '213.140.32.0/19AS12956'
    route:          213.140.32.0/19
    descr:          Telefonica  International  Wholesale Network
    origin:         AS12956
    mnt-by:         TDATANET-RR

I'll buy the Morocco location.

### Download

The attacker(s) clearly thought they were downloading to an instance of the WSO web shell,
at `/wp-content/uploads/2015/11/mod_arcweb.php`,
a URI used by a lot of the attackers contacting my WordPress honey pot.

The POST request has 'a', 'c', 'p1', and 'charset' POST parameters,
typical of WSO accesses.
The 'a' parameter has the stereotypical value "FilesMAn"
and the 'p1' parameter has the value "uploadFile",
used to get a file to the machine WSO runs on.
There's a cookie named "d8670190bc460b6abebf276d20db5892"
which is the value returned by PHP function `md5('stratigery.com')`.
That, too, is typical of WSO accesses.

The downloaded file would have appeared as `zzz.php` had a real WSO received the download.

There is one unusual POST parameter named "key",
"sdfadsgh4513sdGG435341FDGWWDFGDFHDFGDSFGDFSGDFG" value.
This key/value appears in a lot of invocations of `mod_arcweb.php` on my honey post,
but almost always only with another key, "fack", which contains base64-encoded PHP.
I've lost the orignal `mod_arcweb.php` file,
but it must comprise one of the simple "eval a POST parameter" type, one-liner backdoors.
The value of "key" never appears to be used to decode the value of "fack",
or in the decoded PHP from "fack", so I don't know what to make of this oddity.

## Analysis

No decoding/deciphering - the file is completely cleartext.

Invoked without a POST paramenter named "email",
it generates shoddy HTML that has an input field named "email",
and a submit button.

Invoked with POST parameter named "email",
it uses the PHP `mail()` builtin to send an email with a random number in it
to the address value of parameter "email".
The random number presumably appears to prove that PHP interpreted the code,
so this recon checks that as well as email setup.

![appearance of zzz.php](https://raw.githubusercontent.com/bediger4000/php-malware-analysis/master/105.71.0.37-2018-05-17a/mail_recon.png)

`zzz.php` got downloaded on 2018-05-17T12:57:12-06:00.
Within a minute, another Morocco IP address tried to invoke it:

    105.71.0.37 - - [17/May/2018:12:57:23 -0600] "GET /wp-content/uploads/2015/11/zzz.php HTTP/1.1" 200 13343 "-" "Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.139 Safari/537.36"
    105.71.0.37 - - [17/May/2018:12:57:28 -0600] "GET /wp-content/uploads/2015/11/zzz.php HTTP/1.1" 200 13343 "-" "Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.139 Safari/537.36"

At least my fake WSO fooled them into thinking they downloaded something correctly.
